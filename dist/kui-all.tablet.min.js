xhr={request:function(t,e){var i=t.url;let n=t.data||t.params||{},s=t.type||"json",a=t.success,o=t.error;var r=utils.getParameters(t.url);n={...r,...n},window&&window.user&&(n._current_user=window.user.userId);t=t.usecase||"";let l=new XMLHttpRequest;l.timeout=1e4,l.onload=function(){let e=l.responseText;if("json"==s)try{e=JSON.parse(e)}catch(t){return void(o&&o(e))}4==l.readyState&&"200"==l.status?a&&a(e):o&&o(e)},l.onerror=function(){o&&o({error:{code:-500,message:"网络访问错误！"}})},l.ontimeout=function(){o&&o({error:{code:-501,message:"网络请求超时！"}})},l.open(e,i,!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("usecase",t),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),window.user?l.setRequestHeader("_current_user",window.user.userId):l.setRequestHeader("_current_user","unauthorized user"),n?l.send(JSON.stringify(n)):l.send(null)},get:function(t){var e=t.url;t.data;let i=t.success,n=t.error,s=new XMLHttpRequest;s.open("GET",e,!0),s.onload=function(){var t=s.responseText;4==s.readyState&&"200"==s.status?i&&i(t):n&&n(t)},s.send(null)},post:function(t){let e=t.url;"undefined"!=typeof HOST&&-1==e.indexOf("http")&&(e=HOST+e,t.url=e),xhr.request(t,"POST")},put:function(t){xhr.request(t,"PUT")},delete:function(t){xhr.request(t,"DELETE")},connect:function(t){xhr.request(t,"CONNECT")},upload:function(e){var t,i=e.url,n=e.data||e.params;let s=e.type||"json",a=e.success,o=e.error,r=new FormData;for(t in n)r.append(t,n[t]);r.append("file",e.file);let l=new XMLHttpRequest;l.timeout=1e4,l.onload=function(){let e=l.responseText;if("json"==s)try{e=JSON.parse(e)}catch(t){return void(o&&o(e))}4==l.readyState&&"200"==l.status?a&&a(e):o&&o(e)},e.progress&&(l.onprogress=function(t){e.progress(t.loaded,t.total)}),l.onerror=function(){o&&o({error:{code:-500,message:"网络访问错误！"}})},l.ontimeout=function(){o&&o({error:{code:-501,message:"网络请求超时！"}})},l.open("POST",i,!0),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),l.send(r)},asyncUpload:async function(d){return new Promise(function(t,e){var i=d.url,n=d.data||d.params;let s=d.type||"json";d.success;let a=d.error,o=new FormData;for(var r in n)o.append(r,n[r]);o.append("file",d.file);let l=new XMLHttpRequest;l.timeout=1e4,l.onload=function(){let e=l.responseText;if("json"==s)try{e=JSON.parse(e)}catch(t){return void(a&&a(e))}(4==l.readyState&&"200"==l.status||a)&&t(e)},d.progress&&(l.onprogress=function(t){d.progress(t.loaded,t.total)}),l.onerror=function(){a&&a({error:{code:-500,message:"网络访问错误！"}})},l.ontimeout=function(){a&&a({error:{code:-501,message:"网络请求超时！"}})},l.open("POST",i,!0),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),l.send(o)})},chain:function(i){if(0!=i.length){var t=i[0];let e=t.success;xhr.promise(t,function(t){e(t),xhr.chain(i.slice(1))})}},asyncGet:function(i,n){return new Promise(function(e,t){i.success=function(t){e(t)},i.error=n,xhr.get(i)})},promise:function(i,n){return new Promise(function(e,t){i.success=function(t){t.error?n?n(t.error):dialog.error(t.error.message):e(t.data)},i.error=n||(()=>{e({error:{code:"500",message:"网络异常"}})}),xhr.post(i)})},longpromise:function(i,n){let t=i.container||dom.find("#container");var e=i.tooltip||"操作处理中...";let s=dom.element(`
    <div class="page-loading hide">
      <div class="ring">${e}
        <span></span>
      </div>
    </div>
  `);return t.appendChild(s),s.classList.remove("hide"),new Promise(function(e,t){i.success=function(t){if(t.error)return setTimeout(()=>{s.classList.add("hide"),s.remove()},600),dialog.error(t.error.message),void(n&&n(t.error));setTimeout(()=>{s.classList.add("hide"),s.remove()},1200),e(t.data)},i.error=n,xhr.post(i)})},download:function(a){let o=new XMLHttpRequest;o.open("POST",a.url,!0),o.responseType="arraybuffer",o.onload=function(){if(200===this.status){let i="",n=o.getResponseHeader("Content-Disposition");if(n&&-1!==n.indexOf("attachment")){let t=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,e=t.exec(n);null!=e&&e[1]&&(i=e[1].replace(/['"]/g,""))}var t,e,s=o.getResponseHeader("Content-Type"),s=new Blob([this.response],{type:s});void 0!==window.navigator.msSaveBlob?window.navigator.msSaveBlob(s,i):(t=window.URL||window.webkitURL,e=t.createObjectURL(s),void 0===(s=document.createElement("a")).download?window.location=e:(s.href=e,s.download=a.filename||"下载的文件",document.body.appendChild(s),s.click()),setTimeout(function(){t.revokeObjectURL(e)},100))}},o.setRequestHeader("Content-type","application/json"),"undefined"!=typeof APPTOKEN&&o.setRequestHeader("apptoken",APPTOKEN),o.send(JSON.stringify(a.params||{}))},asyncRequest:function(t,s){let a=t.url,o=t.data||t.params,r=t.type||"json",l=t.usecase||"";return new Promise((i,n)=>{if(a){let e=new XMLHttpRequest;e.timeout=1e4,e.onload=function(){let t=e.responseText;if("json"==r)try{t=JSON.parse(t)}catch(t){return console.log(t),void n(t)}(4==e.readyState&&"200"==e.status?i:n)(t)},e.onerror=function(){n({error:{code:-500,message:"网络访问错误！"}})},e.ontimeout=function(){n({error:{code:-501,message:"网络请求超时！"}})},e.open(s,a,!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("usecase",l),"undefined"!=typeof APPTOKEN&&e.setRequestHeader("apptoken",APPTOKEN),o?e.send(JSON.stringify(o)):e.send(null)}})},asyncPost:function(t){let e=t.url;return"undefined"!=typeof HOST&&-1==e.indexOf("http")&&(e=HOST+e,t.url=e),xhr.asyncRequest(t,"POST")}},"undefined"!=typeof module&&(module.exports={xhr:xhr});var ajax={save:function(t){for(var e=t.url||"",i=t.form,n=t.button,s=t.success,a=i.validate(),o="",r=0;r<a.length;r++)o+=a[r].message+"<br>";""==o?(n&&n.prop("disabled",!0),i=i.formdata(),$.ajax({url:e,data:i,method:"POST",dataType:"json",success:function(t){if(void 0!==t.error)return dialog.error("保存信息出错！"),void(n&&n.prop("disabled",!1));dialog.success("保存信息成功！"),void 0!==s&&s(t),n&&n.prop("disabled",!1)},error:function(){dialog.error("系统异常！"),n&&n.prop("disabled",!1)}})):dialog.error(o)},post:function(e){var t={...utils.getParameters(e.url),...e.data};$.ajax({url:e.url,data:t,method:"POST",dataType:"json",success:function(t){void 0!==e.success&&e.success(t)}})},get:function(e){$.ajax({url:e.url,data:e.data,dataType:"json",success:function(t){void 0!==e.success&&e.success(t)}})},text:function(t,e,i){$.ajax({url:t,data:e,success:function(t){void 0!==i&&i(t)}})},view:function(t){"undefined"!=typeof schedule&&t.clear&&schedule.stop();let e=t.url,n=!1;n=void 0===t.empty||t.empty;let i=t.page;e&&0==e.indexOf(":")&&(i=e.substring(1),e=null);let s=utils.getParameters(t.url),a={...s,...t.params},o=t.title||"",r=t.containerId,l=t.success,d=null;if("string"==typeof r?(d=document.getElementById(r.trim()),null==d&&(d=document.querySelector(r.trim()))):d=r,void 0===a&&(a={}),window.parameters)for(var c in a)window.parameters[c]=a[c];e?xhr.get({url:e,success:function(t){let e=null;d&&(e=utils.append(d,t,n)),e&&e.id&&window[e.id]&&window[e.id].show&&!l&&window[e.id].show(s),l&&l(o,e,s)}}):i&&xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:i},success:function(t){let e=t.data.script;e=e||'<div class="full-width full-height d-flex"><img src="img/under-construction.jpeg" class="m-auto full-width"></div>';let i=null;d&&(i=utils.append(d,e,n)),l&&l(o,i,s)}})}};ajax.append=function(l){"undefined"!=typeof schedule&&l.clear&&schedule.stop();let d=dom.find("#tabsMain"),c=dom.find("#tabsOthers");if(null!=d){let o=d.children.length,i=l.url,s=l.title||"",t=l.containerId,e=l.params,a=l.success,r=null;if("string"==typeof t?(r=document.getElementById(t.trim()),null==r&&(r=document.querySelector(t.trim()))):r=t,void 0===e&&(e={}),window.parameters)for(var u in e)window.parameters[u]=e[u];h();let n=r.querySelector('div[data-url="'+i+'"]');if(null!=n){n.classList.remove("hide"),setTimeout(function(){n.classList.add("show")},150);let t=dom.find('a[data-url="'+i+'"]',d);return null!=t?void t.classList.add("active"):void dom.find('a[data-url="'+i+'"]',c).classList.add("active")}if(0==i.indexOf(":")){let e=i.substring(1);xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:e},success:function(t){t=t.data.script;utils.append(r,t,!1);for(let e=r.children.length-1;0<=e;e--){let t=r.children[e];if("DIV"==t.tagName){t.setAttribute("data-url",i),setTimeout(function(){t.classList.add("show")},150);break}}p(s,i),stdbiz.render(e,r.querySelector('[data-url="'+i+'"]'),{})}})}else m(i);function h(){r.querySelectorAll("div[data-url]").forEach(t=>{t.classList.remove("show"),t.classList.add("hide","fade","fadeIn")}),d.querySelectorAll("a.active").forEach(t=>{t.classList.remove("active")}),c.querySelectorAll("a.active").forEach(t=>{t.classList.remove("active")})}function p(e,i){if(""==e||null==d)return;var t=dom.element(`
      <li class="nav-item">
        <a class="nav-link head-link">
          <span></span>
          <i class="fas fa-times-circle ml-1"></i>
        </a>
      </li>
    `);dom.find("a",t).setAttribute("data-url",i),dom.bind(dom.find("i",t),"click",e=>{e.preventDefault(),e.stopPropagation();let t=e.target.parentElement,i=r.querySelector('div[data-url="'+t.getAttribute("data-url")+'"]');if(i&&i.remove(),e.target.parentElement.parentElement.remove(),0<r.querySelectorAll("div[data-url]").length&&d.children[0].click(),0<c.children.length){let t=c.children[0];t.remove(),e=t,dom.find("a",e).classList.add("nav-link"),dom.find("a",e).classList.remove("dropdown-item"),dom.find("i",e).classList.add("ml-1"),dom.find("i",e).classList.remove("float-right"),d.appendChild(e)}}),dom.bind(dom.find("a",t),"click",t=>{let e=dom.ancestor(t.target,"a");e.classList.contains("active")||(h(),e.classList.add("active"),m(a.getAttribute("data-url")))});let n=!1;if(d.querySelectorAll("li").forEach(t=>{dom.find("span",t).innerText==e&&(n=!0,dom.find("a",t).classList.add("active"))}),n)return;if(0==o)d.appendChild(t);else if(o+1>MAX_HEAD_LINK_COUNT){let t=dom.find("li:last-child",d);t.remove(),i=t,dom.find("a",i).classList.add("pointer"),dom.find("a",i).classList.remove("nav-link"),dom.find("a",i).classList.add("dropdown-item"),dom.find("i",i).classList.remove("ml-1"),dom.find("i",i).classList.add("float-right"),0==c.children.length?c.appendChild(i):c.insertBefore(i,c.children[0])}d.insertBefore(t,d.children[0]);let s=dom.find("span",t),a=dom.find("a",t);a.classList.add("active"),s.innerText=e}function m(n){r.querySelectorAll("div[data-url]").forEach(t=>{t.classList.remove("show"),t.classList.add("hide")});let e=r.querySelector('div[data-url="'+n+'"]');if(null!=e){e.classList.remove("hide"),setTimeout(function(){e.classList.add("show")},150);let t=dom.find('a[data-url="'+n+'"]',d);return null!=t?void t.classList.add("active"):void dom.find('a[data-url="'+n+'"]',c).classList.add("active")}xhr.get({url:n,success:function(t){var e=utils.getParameters(n),i=utils.append(r,t,!1);i.id&&window[i.id]&&window[i.id].show&&window[i.id].show(e);for(let e=r.children.length-1;0<=e;e--){let t=r.children[e];if("DIV"==t.tagName){t.setAttribute("data-url",n),setTimeout(function(){t.classList.add("show")},150);break}}p(s,n),a&&a(s,t)}})}}else ajax.view(l)},ajax.shade=function(e){"undefined"!=typeof schedule&&schedule.stop();let t=e.url,i=e.success,n=document.querySelector(".page.full");null!=n&&n.parentElement.remove(),-1===t.indexOf(":")?xhr.get({url:t,success:function(t){t=utils.append(document.body,t);i&&i(e.title||"",t)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:t.substring(1)},success:function(t){t=t.data.script,t=utils.append(document.body,t);i&&i(e.title||"",t)}})},ajax.shade2=function(e){"undefined"!=typeof schedule&&schedule.stop();var t=e.url;let i=e.success;xhr.get({url:t,success:function(t){t=utils.append(document.body,t);i&&i(e.title||"",t)}})},ajax.overlay=function(e){"undefined"!=typeof schedule&&schedule.stop();var t=e.url,i=e.html;let n=e.success,s=document.querySelector(".page.overlay");null!=s&&s.parentElement.remove(),t?xhr.get({url:t,success:function(t){t=utils.append(document.body,t);n&&n(e.title||"",t)}}):(i=utils.append(document.body,i),n&&n(e.title||"",i))},ajax.stack=function(t){"undefined"!=typeof schedule&&t.clear&&schedule.stop();var i=t.pageId,e=t.params;let n=dom.find(t.containerId);let s=!1;for(let e=0;e<n.children.length;e++){let t=n.children[e];"DIV"==t.tagName&&"true"!=t.getAttribute("data-stack-back")&&(t.classList.remove("show"),t.classList.add("hide"),t.id==i&&(t.classList.remove("hide"),t.classList.add("show"),s=!0))}s||(t.empty=!1,ajax.view(t));let a=dom.find("div[data-stack-back]",n);null==a&&(a=dom.element(`
    <div data-stack-back="true" class="pointer">
      <i class="fas fa-angle-left font-32" style="margin-top: 12px;"></i>
    </div>
  `),a.style.position="fixed",a.style.width="60px",a.style.height="60px",a.style.bottom="40px",a.style.right="40px",a.style.backgroundColor="#0C9",a.style.color="#fff",a.style.borderRadius="50px",a.style.textAlign="center",a.style.boxShadow="2px 2px 3px #999",a.style.zIndex="99",dom.bind(a,"click",t=>{a.remove(),ajax.unstack({containerId:n})}),n.appendChild(a))},ajax.unstack=function(t){t=dom.find(t.containerId);let e=t.children[t.children.length-1];e.remove();let i=t.children[t.children.length-1];i.classList.remove("hide"),i.classList.add("show")},ajax.template=function(t){var e=t.url,i=t.usecase;let n=t.containerId,s=t.templateId;var a=t.data;let o=t.success;xhr.post({url:e,usecase:i,data:a,success:function(t){var e;n&&(e=document.getElementById(s).innerHTML,e=Handlebars.compile(e)(t),document.getElementById(n).innerHTML=e),o&&o(t)}})},ajax.dialog=async function(t){let n=t.title||"";var e=t.url;let i=t.html;var s=t.params||{};let a=t.success;var o=t.end,r=!1!==t.shadeClose,l=!0===t.allowClose,d=t.width||"80%",c=t.height||"",t=t.offset||"auto";if(window.parameters)for(var u in s)window.parameters[u]=s[u];e&&(i=await xhr.asyncGet({url:e})),layer.open({type:1,offset:t,title:n,closeBtn:!0==l?1:0,shade:.5,shadeClose:r,area:[d,c],content:i,success:function(t,e){let i=document.querySelector(".layui-layer-content");i.style.overflow="hidden",""!=n&&(i.style.height="calc(100% - 42px);"),a&&a()},end:o||function(){}})},ajax.video=function(t,e,i,n){layer.open({type:2,title:!1,closeBtn:1,shade:[0],area:[i+"px",n+"px"],offset:"rb",anim:2,content:[t,"no"]})},ajax.svg=function(t,i,e,n){void 0===e&&(e={}),$.ajax({url:t,data:e,success:function(t){i.empty();var e=(new XMLSerializer).serializeToString(t.documentElement);i.html(e),n&&n(t)}})},ajax.upload=function(e){let t=e.data;void 0===t&&(t={});let i=new FormData;for(var n in t)i.append(n,t[n]);$.ajax({url:e.url,data:i,method:"POST",cache:!1,contentType:!1,processData:!1,xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&e.progress&&t.upload.addEventListener("progress",function(t){t.lengthComputable&&e.progress&&e.progress(t.total,t.loaded)},!1),t},success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},ajax.sidebar=async function(t){let e=dom.find(t.containerId),i=t.success||function(t,e){},n=dom.find("[widget-id=right-bar]");var s=t.allowClose||!1;null!=n&&n.remove(),n=dom.element(`
    <div widget-id="right-bar" style="position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: transparent; z-index: 999999;">
      <div class="right-bar fade show">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="card-header pl-3">
              <h5 class="modal-title"></h5>
              <button type="button" class="close text-danger position-relative">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="modal-body" style="overflow-y: auto;"></div>
            <div style="position: absolute; bottom: 24px; left: 0; width: 100%; height: 48px; border-top: 1px solid lightgrey; background: white; display:none; z-index: 99999999;">
              <div widget-id="right-bar-bottom" class="mh-10 mt-2" style="float: right;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `),!0===t.showBottom&&(dom.find(".modal-body",n).style.marginBottom="48px",dom.find("[widget-id=right-bar-bottom]",n).parentElement.style.display=""),n.addEventListener("click",t=>{"right-bar"===t.target.getAttribute("widget-id")&&(n.children[0].classList.remove("in"),n.children[0].classList.add("out"),setTimeout(function(){n.remove()},300))}),e.appendChild(n),t.url&&0==t.url.indexOf(":")&&(t.page=t.url.substring(1),t.url=null);let a="";if(t.url?a=await xhr.asyncGet({url:t.url}):t.html&&(a=t.html),dom.find(".modal-title",n).innerHTML=t.title||"",dom.find(".modal-body",n).innerHTML="",s||t.close||dom.find("button.close",n).classList.add("hidden"),!0===s){let t=dom.find("button.close",n),e=dom.find(".card-header",n);var o=t.getBoundingClientRect(),o=(e.getBoundingClientRect().height-o.height)/2;t.style.top=o+"px",t.style.right=o+"px"}dom.find("button.close",n).addEventListener("click",function(){n.children[0].classList.add("out"),n.remove(),t.close&&t.close()});o=utils.append(dom.find(".modal-body",n),a);i&&i(t.title||"",o),setTimeout(function(){n.children[0].classList.remove("out"),n.children[0].classList.add("in")},300)},ajax.bottombar=function(i){let t=dom.find(i.containerId),n=i.success||function(){},s=dom.find(".bottom-bar",t),a=i.allowClose||!1;null!=s&&s.remove(),s=dom.element(`
    <div class="bottom-bar fade show">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="card-header pt-2 pb-2">
            <button type="button" class="close text-danger">
              <i class="fas fa-times"></i>
            </button>
            <h5 class="modal-title"></h5>
          </div>
          <div class="modal-body" style="overflow-y: auto"></div>
        </div>
      </div>
    </div>
  `),t.appendChild(s);var e=s.parentElement.clientWidth,o=parseInt(window.getComputedStyle(s.parentElement,null).getPropertyValue("padding-left")),r=parseInt(window.getComputedStyle(s.parentElement,null).getPropertyValue("padding-right"));s.style.width=e-r-o+"px",i.url?xhr.get({url:i.url,success:function(t){dom.find(".modal-title",s).innerHTML=i.title||"",a||i.close||dom.find("button.close",s).classList.add("hidden"),dom.find("button.close",s).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),i.close&&i.close()}),utils.append(dom.find(".modal-body",s),t),n&&n(t),setTimeout(function(){s.classList.remove("out"),s.classList.add("in")},200)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:i.page},success:function(t){var e=t.data.script;utils.append(dom.find(".modal-body",s),e),dom.find(".modal-title",s).innerHTML=i.title,a||i.close||dom.find("button.close",s).classList.add("hidden"),dom.find("button.close",s).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),i.close&&i.close()}),n&&n(t),setTimeout(function(){s.classList.remove("out"),s.classList.add("in")},200)}})},ajax.tabs=function(t){let e=document.querySelector(t.containerId);var n=t.tabs;t.closeable;let a=dom.create("ul","nav","nav-tabs"),o=dom.create("div","tab-content"),i=dom.create("div","float-right");t=dom.create("button","btn","btn-link");function r(t,e,i,n){ajax.view({url:e,containerId:t,success:function(){window[i]&&window[i].show(n)}})}i.appendChild(t),dom.bind(t,"click",function(){let t=dom.find("li.active link",this.parentElement.parentElement);var e=t.getAttribute("data-model-url"),i=t.getAttribute("data-model-page"),n=JSON.parse("data-model-data");r(dom.find("div.tab-content div[data-model-url='"+e+"']",this.parentElement.parentElement),e,i,n)});for(let i=0;i<n.length;i++){var l=n[i];let t=dom.create("li","nav-item"),s=dom.create("a","nav-link");0==i&&s.classList.add("active"),s.setAttribute("data-model-url",l.url),s.setAttribute("data-model-data",JSON.stringify(l.data||{})),s.setAttribute("data-model-page",l.page),s.innerHTML=l.title,dom.bind(s,"click",function(){if(!this.classList.contains("active")){dom.find("a.active",this.parentElement.parentElement.parentElement).classList.remove("active"),dom.find("div.active",this.parentElement.parentElement.parentElement).classList.remove("active");var e=s.getAttribute("data-model-url"),i=JSON.parse(s.getAttribute("data-model-data")),n=s.getAttribute("data-model-page");let t=dom.find("div.tab-content div[data-model-url='"+e+"']",this.parentElement.parentElement.parentElement);this.classList.add("active"),t.classList.add("active"),""===t.innerHTML.trim()&&r(t,e,n,i)}}),t.appendChild(s),a.appendChild(t);let e=dom.create("div","tab-pane");0==i&&(e.classList.add("active"),r(e,l.url,l.page,l.data)),e.setAttribute("data-model-url",l.url),o.append(e)}e.appendChild(i),e.appendChild(a),e.appendChild(o)},ajax.download=(t,i)=>{fetch(t).then(t=>t.blob()).then(t=>{let e=document.createElement("a");t=window.URL.createObjectURL(t);e.href=t,e.download=i+".docx",e.click(),window.URL.revokeObjectURL(t),e.remove()})},ajax.upload=i=>{let n=dom.create("input");n.setAttribute("type","file"),n.setAttribute("accept",i.accept||"*"),n.style.display="none",n.onchange=async t=>{var e=n.files[0],e=await xhr.asyncUpload({url:"/api/v3/common/upload",params:{directoryKey:i.directoryKey},file:e});i.success&&i.success(e)},n.click()},"undefined"==typeof dialog&&(dialog={}),dialog.alert=function(t){layer.open({type:0,icon:0,offset:"150px",shade:0,shadeClose:!0,title:"警告",content:t})},dialog.info=function(t){layer.open({type:0,offset:"150px",shade:0,shadeClose:!0,title:"信息",content:t})},dialog.info2=function(t){layer.open({type:0,offset:"100px",shade:.3,shadeClose:!0,title:"信息",content:t})},dialog.error=function(t){t=t.replaceAll("\n","<br>"),layer.open({type:0,icon:2,offset:"150px",shade:0,shadeClose:!0,title:"错误",content:t})},dialog.success=function(t,i){i?layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:t,btn:["确定","确定并返回"],yes:function(t,e){layer.close(t)},btn2:function(t,e){layer.close(t),i()}}):layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:t})},dialog.confirm=function(t,i){layer.confirm(t,{title:"确认",btn:["确定","取消"]},function(t,e){e=dom.formdata(e[0]);layer.close(t),i(e)},function(){})},dialog.view=function(i){let n=i.title;var t=i.url;$(document.body);$("#dialogApplication").length&&$("#dialogApplication").remove();let s=[];i.save&&s.push({text:"保存",class:"btn-save",onClicked:i.save}),$.ajax({url:t,success:function(t){let e=Handlebars.compile('<div class="modal fade fadeIn show" id="dialogApplication">  <div class="modal-dialog modal-dialog-centered">    <div class="modal-content">      <div class="modal-header">        <h4 class="modal-title">{{title}}</h4>        <button type="button" class="close" data-dismiss="modal">&times;</button>      </div>      <div id="dialogApplicationBody" class="modal-body">{{{body}}}</div>      <div class="modal-footer">        {{#each buttons}}        <button type="button" class="btn {{class}}" data-dismiss="modal">{{text}}</button>        {{/each}}        <button type="button" class="btn btn-close" data-dismiss="modal">关闭</button>      </div>    </div>  </div></div>');t=e({title:n,body:t,buttons:s});$(document.body).append(t),i.success&&i.success({onClosed:i.onClosed}),$("#dialogApplication").modal("show")}})},dialog.select=function(e){ajax.view({url:e.url,success:function(t){layer.open({type:0,icon:1,offset:"150px",shade:.5,shadeClose:!0,title:e.title,content:t})}})},dialog.simplelist=async function(i){var n=await xhr.promise({url:i.url,params:i.params||{}}),t=dom.element(`
    <div>
      <ul class="list-group"></ul>
    </div>
  `);let s=dom.find("ul",t);for(let e=0;e<n.length;e++){var a=n[e];let t=dom.create("li","list-group-item","list-group-item-action");dom.model(t,a),t.innerText=a[i.fields.text],s.appendChild(t)}layer.open({type:0,closeBtn:1,btn:[],shade:.5,shadeClose:!0,title:"",content:t.innerHTML,success:function(t,e){t.get(0).querySelectorAll("li").forEach((t,e)=>{dom.bind(t,"click",t=>{layer.close(layer.index);t=dom.model(t.target);i.onAccept(t)})})}})},dialog.html=function(i){layer.open({type:0,closeBtn:1,offset:"150px",shade:.5,area:[i.width||"50%",""],shadeClose:!0,title:i.title||"&nbsp;",content:i.html,btn:["确定","关闭"],success:function(t,e){i.load&&i.load(t,e)},yes:function(t){layer.close(t),1==dom.find(".layui-layer-content").children.length?i.success(dom.find(".layui-layer-content").children[0]):i.success(dom.find(".layui-layer-content").children)},btn1:function(){}})},dialog.iframe=function(t){layer.open({title:t.title,type:2,area:[t.width,t.height],content:t.url,resize:!1,maxmin:!0,shade:!1,success:t.success||function(t,e){}})};var dom={slideInFromRight:(t,e)=>{t.classList.remove("out"),t.classList.add("in"),setTimeout(()=>{t.style.right="0"},300),e&&(e.style.display="")},slideOutToRight:(t,e,i)=>{t.classList.contains("in")&&(t.classList.contains("out")||(t.classList.remove("in"),t.classList.add("out"),setTimeout(()=>{t.style.right=e},300),i&&(i.style.display="none")))},slideInFromLeft:(t,e)=>{t.classList.remove("out"),t.classList.add("in"),setTimeout(()=>{t.style.left="0"},300),e&&(e.style.display="")},slideOutToLeft:(t,e,i)=>{t.classList.contains("in")&&(t.classList.contains("out")||(t.classList.remove("in"),t.classList.add("out"),setTimeout(()=>{t.style.left=e},300),i&&(i.style.display="none")))},toggle:(e,i)=>{if(Array.isArray(i))for(let t=0;t<i.length;t++)dom.toggle(e,i[t]);else i.classList.contains(e)?i.classList.remove(e):i.classList.add(e)},exclusive:(t,e,i)=>{var n;for(n of i.querySelectorAll(e.tagName+"."+t))n.classList.remove(t);e.classList.add(t)},delayTo:t=>{clearTimeout(dom.timeoutDelayTo),dom.timeoutDelayTo=setTimeout(()=>{},600)},value:function(t,e){const i=document.querySelector(t);if(!e)return i.value.trim();i.value=e},empty:function(t){const e=document.querySelector(t);e.value?e.value="":e.innerHTML=""},valid:function(t){const e=document.querySelector(t);return void 0!==e.value&&null!=e.value&&""!=e.value.trim()},create:function(t){var e=Array.prototype.slice.call(arguments,1);let i=document.createElement(t);for(let t=0;t<e.length;t++)i.classList.add(e[t]);return i},fix:function(t){let e=null;e="string"==typeof t?document.querySelector(t):t;var i=e.getBoundingClientRect(),n=i.left,s=i.top,a=(i.width,i.height),o=(parseInt(window.getComputedStyle(e,null).getPropertyValue("padding-left")),parseInt(window.getComputedStyle(e,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(e,null).getPropertyValue("padding-top"))),r=parseInt(window.getComputedStyle(e,null).getPropertyValue("padding-bottom"));parseInt(window.getComputedStyle(e,null).getPropertyValue("margin-left")),parseInt(window.getComputedStyle(e,null).getPropertyValue("margin-right")),parseInt(window.getComputedStyle(e,null).getPropertyValue("margin-top")),parseInt(window.getComputedStyle(e,null).getPropertyValue("margin-bottom"));let l=e.parentElement.parentElement;t=l.getBoundingClientRect(),i=parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-left"));parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-top")),parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-bottom"));return e.style.position="absolute",e.style.top=s-t.top+"px",e.style.left=n-t.left+"px",e.style.width="calc(100% - "+2*i+"px )",{top:s-t.top,left:n-t.left,width:t.width-2*i,height:a+o+r}},find:function(t,e){if(e=e||document,"string"!=typeof t)return t;t=e.querySelectorAll(t);return 0==t.length?null:1==t.length?t[0]:t},ancestor:function(t,e,i){let n=null;if(i=i||"",n="string"==typeof t?document.querySelector(t):t,null==n)return null;e=e.toUpperCase();let s=n;if(""==i)for(;null!=s&&s.tagName!=e;)s=s.parentElement;else for(;null!=s&&(s.tagName!=e||!s.classList.contains(i));)s=s.parentElement;return s},element:function(t){let e=document.createElement("div");return e.innerHTML=t,e.firstElementChild},bind:function(t,e,i){let n=null;n="string"==typeof t?document.querySelector(t):t,null!=n&&n&&n.addEventListener(e,i)},model:function(t,i){let n=null;if(n="string"==typeof t?document.querySelector(t):t,void 0===i){let i={};return Array.prototype.slice.call(n.attributes).forEach(function(e){if(0==e.name.indexOf("data-model-"))if(0==e.value.indexOf("{"))try{i[utils.nameVar(e.name.slice("data-model-".length))]=JSON.parse(e.value)}catch(t){i[utils.nameVar(e.name.slice("data-model-".length))]=e.value}else i[utils.nameVar(e.name.slice("data-model-".length))]=e.value}),i}var s=Array.prototype.slice.call(arguments,2);if(0==s.length)for(const e in i)0!=e.indexOf("||")&&0!=e.indexOf("//")&&0!=e.indexOf(">>")&&("object"==typeof i[e]?n.setAttribute(utils.nameAttr(e),JSON.stringify(i[e])):n.setAttribute(utils.nameAttr(e),i[e]));else for(let e=0;e<s.length;e++){let t=s[e];0!=t.indexOf("||")&&0!=t.indexOf("//")&&0!=t.indexOf(">>")&&("object"==typeof i[t]?n.setAttribute(utils.nameAttr(t),JSON.stringify(i[t])):n.setAttribute(utils.nameAttr(t),i[t]))}},collect:function(t,n){let s=[],a=document.querySelectorAll(t);for(let i=0;i<a.length;i++){let e={};if(Array.isArray(n))for(let t=0;t<n.length;t++)e[n[t]]=a[i].getAttribute(utils.nameAttr(n[t]));else e[n]=a.getAttribute(utils.nameAttr(n[j]));s.push(e)}return s},propagate:function(t,e,i,n){let s=n(e);if(Array.isArray(i))for(let t=0;t<i.length;t++)s.setAttribute(utils.nameAttr(i[t]),e[i[t]]);else s.setAttribute(utils.nameAttr(i),e[i]);t.appendChild(s)},toggle2:function(t,a){var i=document.querySelectorAll(t);for(let e=0;e<i.length;e++){let t=i[e];t.addEventListener("click",function(){let t=this.getAttribute("data-toggle"),e=t.split(">>"),i=e[0].split("+"),n=e[1].split("+"),s=!1;for(let e=0;e<i.length;e++){let t=i[e].trim();s=0==t.indexOf(".")?this.classList.contains(t.substring(1)):null!=this.querySelector(t)}if(s){for(let t=0;t<n.length;t++){let e=n[t].trim();if(0===e.indexOf("."))this.classList.add(e.substring(1));else{let t=this.querySelector(e.substring(0,e.indexOf(".")));t.classList.add(e.substring(e.indexOf(".")+1))}}for(let t=0;t<i.length;t++){let e=i[t].trim();if(0==e.indexOf("."))this.classList.remove(e.substring(1));else{let t=this.querySelector(e);t.classList.remove(e.substring(e.indexOf(".")+1))}}}else{for(let t=0;t<i.length;t++){let e=i[t].trim();if(0==e.indexOf("."))this.classList.add(e.substring(1));else{let t=this.querySelector(e.substring(0,e.indexOf(".")));t.classList.add(e.substring(e.indexOf(".")+1))}}for(let t=0;t<n.length;t++){let e=n[t].trim();if(0==e.indexOf("."))this.classList.remove(e.substring(1));else{let t=this.querySelector(e);t.classList.remove(e.substring(e.indexOf(".")+1))}}a&&resovle(this)}})}},switch:function(t,n){let s=dom.find(t),e=s.getAttribute("data-switch"),a=e.split("+");var o=s.querySelectorAll(a[0]);for(let t=0;t<o.length;t++){let i=o[t];i.onclick=t=>{let e=s.querySelectorAll(a[0]);for(let t=0;t<e.length;t++)e[t].classList.remove(a[1].substring(1));i.classList.add(a[1].substring(1)),n&&n(i)}}},tabs:function(t){let n=dom.find(t);if(null!=n){let i=n.getAttribute("data-tab-active-class");for(let t=0;t<n.children.length;t++){let e=n.children[t];e.addEventListener("click",t=>{for(let e=0;e<n.children.length;e++){let t=n.children[e];t.classList.remove(i)}e.classList.add(i)})}}},top:function(t){let e=null;if(e="string"==typeof t?document.querySelector(t):t,null==e)return 0;let i=e.offsetTop;return void 0!==e.offsetParent&&(i+=dom.top(e.offsetParent)),i},formdata:function(t,e){let s=null;if(s="string"==typeof t?document.querySelector(t):t,void 0===e){let i={},n={};var a=s.querySelectorAll("input");for(let e=0;e<a.length;e++){var o=a[e];let t=o.name;var r=o.type,l=o.value;"text"==r||"number"==r||"password"==r||"hidden"==r?(i[t]=null,""!=l?-1!=t.indexOf("[]")?i[t]=[l]:i[t]=l:i[t]=""):"radio"==r?o.checked&&(i[t]=l):"checkbox"==r&&(void 0===n[t]&&(n[t]=0),o.checked&&(void 0===i[t]&&(n[t]=0,i[t]=[]),i[t].push(l)),n[t]+=1)}var d=s.querySelectorAll("select");for(let e=0;e<d.length;e++){var c=d[e];let t=c.name;i[t]=null,-1!=c.selectedIndex?-1!=t.indexOf("[]")?i[t]=[c.value]:i[t]=c.value:i[t]=""}var u,h,p=s.querySelectorAll("textarea");for(let t=0;t<p.length;t++){var m=p[t],f=m.name;i[f]=null,i[f]=m.value}for(u in n)-1==u.indexOf("[]")&&1==n[u]&&i[u]&&(i[u]=i[u][0]);for(h in i)"string"==typeof i[h]&&0==i[h].indexOf("${")&&(i[h]=i[i[h].substring(2,i[h].length-1)]);return i}function i(t,e,i){let n=dom.find("[name='"+e+"']",t);if(null!=n){if(1<n.length&&"radio"==n[0].type){let t=n;t.forEach((t,e)=>{t.value===i?t.checked=!0:t.checked=!1})}"INPUT"==n.tagName?"check"==n.type||(n.value=i||""):"SELECT"==n.tagName?$("select[name='"+e+"']").val(i).trigger("change"):"TEXTAREA"==n.tagName&&(n.innerHTML=i)}}for(var n in e)if("object"==typeof e[n])for(var g in e[n])i(s,n+"."+g,e[n][g]);else i(s,n,e[n])},setAttribute:function(t,e,i){let n=document.querySelectorAll(t);for(let t=0;t<n.length;t++)n[t][e]=i},removeAttribute:function(t,e){let i=document.querySelectorAll(t);for(let t=0;t<i.length;t++)i[t].removeAttribute(e)},enable:function(t){let e=document.querySelectorAll(t);for(let t=0;t<e.length;t++)e[t].disabled=!1},disable:function(t){let e;e="string"==typeof t?document.querySelectorAll(t):t;for(let t=0;t<e.length;t++)e[t].disabled=!0},index:function(t,i,e){let n;if(n="string"==typeof t?dom.find(t):t,!e){var s=n.getAttribute(i),a=n.parentElement.querySelectorAll(n.tagName);for(let e=0;e<a.length;e++){let t=a[e];if(s==t.getAttribute(i))return e}}return-1},elementAt:function(t,i,n){var s=document.querySelectorAll(t);for(let e=0;e<s.length;e++){let t=s[e];if(n==t.getAttribute(i))return{index:e,element:t}}return null},elementAtTree:function(t,i,n,s,a){var o=document.querySelectorAll(t);let r=0;for(let e=0;e<o.length;e++){let t=o[e];var l=t.getAttribute(i),d=t.getAttribute(n);if(a==d&&(r++,s==l))return{index:r,element:t}}},stack:function(e,i,n,s){let a=dom.create("a","btn","btn-link");var t=dom.create("i","fas","fa-caret-right","mr-1");a.appendChild(t),dom.bind(a,"click",function(){let t=dom.find("i",a);t.classList.contains("fa-caret-right")?(e.container.querySelectorAll("i.fa-caret-down").forEach(t=>{t.classList.remove("fa-caret-down"),t.classList.add("fa-caret-right")}),t.classList.remove("fa-caret-right"),t.classList.add("fa-caret-down"),e.stack(n,function(t){t.parentElement.classList.add("fade","fadeIn"),t.style.paddingLeft="50px",t.style.paddingRight="50px",setTimeout(function(){t.parentElement.classList.add("show")},200),s(t)})):(t.classList.remove("fa-caret-down"),t.classList.add("fa-caret-right"),i.parentElement.nextSibling.remove())})},inner:function(t){var e=t.clientHeight,i=t.clientWidth,t=getComputedStyle(t);return{height:e-parseInt(t.paddingTop)-parseInt(t.paddingBottom),width:i-parseInt(t.paddingLeft)-parseInt(t.paddingLeft)}},outer:function(t){var e=t.clientHeight,i=t.clientWidth,t=getComputedStyle(t);return{height:e+parseInt(t.marginTop)+parseInt(t.borderTop)+parseInt(t.marginBottom)+parseInt(t.borderBottom),width:i+parseInt(t.marginLeft)+parseInt(t.borderLeft)+parseInt(t.marginRight)+parseInt(t.borderRight)}},height:function(t,e,i){e=e||0,i=(i=void 0===i?dom.find("#container"):i)||document.body;let n=null;n="string"==typeof t?document.querySelector(t):t;var s=dom.top(n);let a=getComputedStyle(i,null);parseInt(a.getPropertyValue("padding-top"));t=parseInt(a.getPropertyValue("padding-bottom"));a=getComputedStyle(n,null);parseInt(a.getPropertyValue("border-top-width")),parseInt(a.getPropertyValue("border-bottom-width"));n.style.marginBottom="0px",n.style.height=i.clientHeight-s-e-t+"px",n.style.overflowY="auto"},height2:function(t,e,i){e=e||0,i=(i=void 0===i?dom.find("#container"):i)||document.body;let n=null;n="string"==typeof t?document.querySelector(t):t;dom.top(n);let s=getComputedStyle(i,null);var a=parseInt(s.getPropertyValue("padding-top")),o=parseInt(s.getPropertyValue("padding-bottom"));s=getComputedStyle(n,null);var r=parseInt(s.getPropertyValue("border-top-width")),l=parseInt(s.getPropertyValue("border-bottom-width")),d=parseInt(s.getPropertyValue("border-top-width")),t=parseInt(s.getPropertyValue("border-bottom-width"));n.style.marginBottom="0px";i=i.getBoundingClientRect();n.style.height=i.height-a-o-r-l-d-t-e+"px",n.style.overflowY="auto"},autoheight:function(t,e,i){i=i||0;let n=dom.find(t);var s=(e=e||document.body).getBoundingClientRect();let a=s.height;e===document.body&&(a=window.innerHeight);let o=n.parentElement;o.getBoundingClientRect();t=n.getBoundingClientRect(),parseInt(o.offsetTop),t=t.top-s.top;let r=0;for(;o!==e;){var l=getComputedStyle(o);r+=parseInt(l.paddingBottom),r+=parseInt(l.marginBottom),r+=parseInt(l.borderBottomWidth),o=o.parentElement}s=getComputedStyle(n);r+=parseInt(s.borderBottomWidth),n.style.height=a-r-i-t+"px",n.style.overflowY="auto"},templatize:function(t,e){let i=Handlebars.compile(t);e=i(e);return dom.element(e)}};dom.render=function(t,e,s){let i=null;function n(t,e,i){let n=dom.find("[name='"+e+"']",t);null!=n&&("DIV"===n.nodeName&&s?i&&function(t,e){let i=dom.find("[value='"+e+"']",t);null!=i&&(i.checked=!0)}(n,i):"INPUT"==n.tagName?"radio"==n.type||(n.value=i):"SPAN"==n.tagName?i&&(n.innerHTML=i):"SELECT"==n.tagName&&$("select[name='"+e+"']").val(i).trigger("change"))}for(var a in i="string"==typeof t?document.querySelector(t):t,e)if("object"==typeof e[a])for(var o in e[a])n(i,a+"."+o,e[a][o]);else n(i,a,e[a])},dom.popup=function(t,e){let i=dom.create("div","full-width","full-height","position-absolute");return i.style.background="transparent",dom.bind(i,"click",t=>{i.remove(),e.remove()}),document.body.appendChild(i),t.appendChild(e),i},dom.html=function(t){let e=dom.element("<div></div>");return e.appendChild(t),e.innerHTML},dom.init=function(e,i){if(i){let t=i.getAttribute("name");t&&""!=t||(t=i.getAttribute("widget-id")),t&&""!=t&&(e[t]=i);var n=i.getAttribute("widget-model-tooltip");n&&""!=n&&tippy(i,{content:n});for(let t=0;t<i.children.length;t++){var s=i.children[t];dom.init(e,s)}}},dom.exists=(e,i,n)=>{for(let t=0;t<e.length;t++){var s=e[t];if(dom.model(s)[n]===i[n])return!0}return!1};var NO_ERRORS=0,REQUIRED_ERROR=1,FORMAT_ERROR=2,INVALID_ERROR=3;function DataSheet(t){this.columns=t.columns,this.columnCount=this.getColumnCount(this.columns),this.rowHeaderWidth=t.rowHeaderWidth||150,this.rowHeaders=t.rowHeaders,this.rowCount=this.getRowCount(this.rowHeaders),this.readonly=!0===t.readonly,this.totalColumns=[];for(let t=0;t<this.columns.length;t++){var e=this.columns[t];e.totalable&&this.totalColumns.push(e)}this.onCellClicked=t.onCellClicked,this.onRowHeaderClicked=t.onRowHeaderClicked,this.rowHeaderColumnCount=this.getRowHeaderColumnCount(this.rowHeaders),this.colHeaderColumnCount=this.getColumnHeaderColumnCount(this.columns),this.rowHeaderRowCount=this.getRowHeaderRowCount(this.rowHeaders),this.colHeaderRowCount=this.getColumnHeaderRowCount(this.columns),this.matrixColumn=[],this.matrixRowHeader=[],this.buildColumnMatrix(this.columns,this.matrixColumn,0),this.buildRowHeaderMatrix(this.rowHeaders,this.matrixRowHeader,0)}function Tabs(t){this.navigator=dom.find(t.navigatorId),this.navigator.classList.add("d-flex","align-items-center"),this.content=dom.find(t.contentId),this.tabActiveClass=t.tabActiveClass,this.tabs=t.tabs,this.lazy=!1!==t.lazy,this.autoClear=!0===t.autoClear}function PaginationGrid(t){let e=this;"object"==typeof t.url?(this.url=t.url.root,this.urlChild=t.url.child):this.url=t.url,"object"==typeof t.usecase?(this.usecase=t.usecase.root,this.usecaseChild=t.usecase.child):this.usecase=t.usecase,this.onRender=t.render,this.filters=t.params||t.filters||{},this.favourite=t.favourite||!1,this.start=t.start||0,this.limit=t.limit||5,this.colspan=t.colspan,this.borderless=t.borderless||!1,t.filter&&(t.filter.query={callback:function(t){e.go(1,t)}},(t.filter.table=this).queryFilter=new QueryFilter(t.filter))}function Timeline(t){this.url=t.url,this.params=t.params||{},this.data=t.data||[],this.fnTitle=t.title||function(t,e){return""},this.fnSubtitle=t.subtitle||function(t,e){return""},this.fnContent=t.content||function(t,e){return""},this.onComplete=t.onComplete}function ListView(t){this.url=t.url,this.usecase=t.usecase,this.params=t.params||{},this.lazy=!0===t.lazy,this.hoverable=!1!==t.hoverable,this.activateable=!0===t.activateable,this.itemClass=t.itemClass||[],this.slidingActions=t.slidingActions||[],this.emptyHtml=t.emptyHtml||`
    <div class="d-flex flex-wrap mt-2">
      <img class="m-auto" src="img/nodata.png" width="60%">
      <div style="flex-basis: 100%; height: 0;"></div>
      <div class="text-muted m-auto mt-2" style="font-weight: bold;">没有任何数据</div>
    </div>
  `,this.idField=t.idField,this.compare=t.compare||function(t,e){return!1},this.selections=t.selections||[],this.local=t.local||[],this.create=t.create||function(t,e){},this.complete=t.complete,this.draggable=!0===t.draggable,this.start=t.start||0,this.limit=t.limit||-1,this.borderless=t.borderless||!1,this.height=t.height,this.tooltip=t.tooltip,this.required=t.required||!1,this.onRemove=t.onRemove,this.onReorder=t.onReorder,this.onCheck=t.onCheck,this.onSelect=t.onSelect,this.onFilter=t.onFilter,this.onAdd=t.onAdd,this.onSearch=t.onSearch,this.onClick=t.onClick,this.observableItems=new rxjs.Observable}function Wizard(t){this.topic=t.topic,this.steps=t.steps||[],this.root=dom.element(`
    <div>
      <div class="ui ordered steps m-b-0">
      </div>
      <div class="tab-content">
      </div>
    </div>
  `)}function Chat(t){this.host=t.host||"",this.userId=t.userId,this.userType=t.userType,this.getConversations=t.getConversations,this.onInit=t.onInit||async function(){},this.onSendTextMessage=t.onSendTextMessage,this.onSendImageMessage=t.onSendImageMessage,this.onSendAudioMessage=t.onSendAudioMessage,this.onSendVideoMessage=t.onSendVideoMessage,this.onSendCustomMessage=t.onSendCustomMessage,this.onRevokeMessage=t.onRevokeMessage||function(t){},this.onMessageReceived=t.onMessageReceived,this.onUnreadMessages=t.onUnreadMessages||function(t){},this.onReadMessages=t.onReadMessages||function(t){}}String.prototype.trim||function(){var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(t,"")}}(),$.fn.validate=function(t){return Validation.validate(this,t)},Validation={validate:function(t,e){var o=[];void 0===t&&(t=$(document)),(t=$(t)).find("input[type!=checkbox][type!=radio][type!=button]").each(function(t,e){var i=$(e).val().trim(),n=Validation.getLabel(e),s=$(e).attr("data-required-message")?$(e).attr("data-required-message"):n+"必须填写！";Validation.isRequired(e)&&""===i&&o.push({element:e,message:s});var a=$(e).attr("data-domain-type");if(a){s=n+"填写不合要求。",a=Validation.getDomainValidator(new ValidationModel(a));if(null!=a&&""!==i){i=a.test(i);switch(i){case REQUIRED_ERROR:break;case FORMAT_ERROR:s=$(e).attr("data-format-message")?$(e).attr("data-format-message"):s;break;case INVALID_ERROR:s=$(e).attr("data-invalid-message")?$(e).attr("data-invalid-message"):s}i!=NO_ERRORS&&o.push({element:$(e),message:s})}}}),t.find("textarea").each(function(t,e){var i=$(e).val().trim(),n=Validation.getLabel(e),s=$(e).attr("data-required-message")?$(e).attr("data-required-message"):n+"必须填写！";Validation.isRequired(e)&&""===i&&o.push({element:e,message:s});var a=$(e).attr("data-domain-type");if(a){s=n+"填写不合要求。",a=Validation.getDomainValidator(new ValidationModel(a));if(null!=a&&""!==i){i=a.test(i);switch(i){case REQUIRED_ERROR:break;case FORMAT_ERROR:s=$(e).attr("data-format-message")?$(e).attr("data-format-message"):s;break;case INVALID_ERROR:s=$(e).attr("data-invalid-message")?$(e).attr("data-invalid-message"):s}i!=NO_ERRORS&&o.push({element:$(e),message:s})}}}),t.find("select").each(function(t,e){var i;!Validation.isRequired(e)||"-1"!=$(e).val()&&""!=$(e).val()&&null!=$(e).val()||(i=Validation.getLabel(e)+"必须选择！",i=$(e).attr("data-required-message")?$(e).attr("data-required-message"):i,o.push({element:$(e),message:i}))});var i={};for(r in t.find("input[type=checkbox]").each(function(t,e){e=$(e).attr("name");i[e]=e}),i){var n=!1,s=null,a=null;t.find('input[name="'+r+'"]').each(function(t,e){0==t&&(s=Validation.getLabel(e),a=e),!n&&$(e).prop("checked")&&(n=!0)}),!n&&Validation.isRequired(a)&&(l=s+"必须选择！",l=$(a).attr("data-required-message")?$(a).attr("data-required-message"):l,o.push({element:$(a),message:l}))}var r,i={};for(r in t.find("input[type=radio]").each(function(t,e){e=$(e).attr("name");i[e]=e}),i){var l,n=!1,s=null,a=null;t.find('input[name="'+r+'"]').each(function(t,e){0==t&&(s=Validation.getLabel(e),a=e),!n&&$(e).prop("checked")&&(n=!0)}),!1===n&&$(a).prop("required")&&(l=s+"必须选择！",l=$(a).attr("data-required-message")?$(a).attr("data-required-message"):l,o.push({element:$(a),message:l}))}return t.find("input[remote]").each(function(t,e){var i=$(e).attr("remote"),n=$(e).val().trim();i&&""!=i&&""!=n&&$.ajax({url:i,method:"POST",data:"check="+n,success:function(t){t=$.parseJSON(t);t.err&&o.push({element:$(e),message:t.msg})}})}),e&&e(o),o},getLabel:function(t){t=$(t);return t.attr("label")||$(t).attr("data-required")||t.attr("name")||t.attr("id")},isRequired:function(t){let e=$(t);return!!e.prop("required")||("required"==e.attr("required")||void 0!==e.attr("data-required")&&""!=e.attr("data-required"))},getDomainValidator:function(t){var e=t.keyword.toLowerCase(),i=t,t=null;if("mail"===e||"email"===e)t=new Validation.Mail;else if("number"===e)t=new Validation.Number(i.symbol,i.args);else if("string"===e)t=new Validation.String(i.args);else if("mobile"===e)t=new Validation.Mobile;else if("range"===e)t=new Validation.Range(i.opts,i.args);else if("phone"===e)t=new Validation.Phone;else if("cmpexp"===e)t=new Validation.CmpExp(i.args[0],i.args[1]);else if("regexp"===e)t=new Validation.RegExp(i.args[0]);else if("remote"===e)t=new Validation.Remote(i.args[0]);else if("date"===e)t=new Validation.Date;else if("time"===e)t=new Validation.Time;else{if("datetime"!==e)throw new Error('not support for the domain("'+e+'")');t=new Validation.DateTime}return t},String:function(t){this.min=0,this.max=parseInt(t[0]),1<t.length&&(this.min=parseInt(t[0]),this.max=parseInt(t[1])),this.test=function(t){return t.length<this.min||this.max&&t.length>this.max?FORMAT_ERROR:NO_ERRORS}},Number:function(t,e){this.plus=-1,this.minus=-1,"-"===t?this.minus=0:"+"===t&&(this.plus=0),0!=this.minus&&this.plus,this.precision=parseInt(e[0]),1<e.length&&(this.scale=parseInt(e[1])),this.test=function(t){if(0==this.plus){if(!/^\s*(\+)?((\d+(\.\d+)?)|(\.\d+))\s*$/.test(t))return FORMAT_ERROR}else if(0==this.minus){if(!/^\s*(-)((\d+(\.\d+)?)|(\.\d+))\s*$/.test(t))return FORMAT_ERROR}else if(!/^\s*(\+)?((\d+(\.\d+)?)|(\.\d+))\s*$/.test(t))return FORMAT_ERROR;var e=t.indexOf("."),i=-1==e?this.precision:this.precision+1,i=0==this.plus||0==this.minus?i+1:i;if(t.length>i)return FORMAT_ERROR;if(-1!=e&&this.scale&&t.substring(e+1).length>this.scale)return FORMAT_ERROR;return NO_ERRORS}},Mail:function(){this.test=function(t){return/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(t)?NO_ERRORS:FORMAT_ERROR}},Phone:function(){this.test=function(t){return/^\d{11}$/i.test(t)?NO_ERRORS:FORMAT_ERROR}},Mobile:function(){this.test=function(t){return/^\d{11}$/i.test(t)?NO_ERRORS:FORMAT_ERROR}},Date:function(){this.test=function(t){return/^\d{4}-\d{1,2}-\d{1,2}$/.test(t)?isNaN(Date.parse(t))?INVALID_ERROR:NO_ERRORS:FORMAT_ERROR}},Time:function(){this.test=function(t){return/^\d{1,2}:\d{1,2}(:\d{1,2})?$/.test(t)?(t="1970-01-01 "+t,isNaN(Date.parse(t))?INVALID_ERROR:NO_ERRORS):FORMAT_ERROR}},DateTime:function(){this.test=function(t){return/^\d{4}-\d{1,2}-\d{1,2} \d{1,2}:\d{1,2}(:\d{1,2})?$/.test(t)?isNaN(Date.parse(t))?INVALID_ERROR:NO_ERRORS:FORMAT_ERROR}},RegExp:function(t){this.re=new RegExp(t),this.test=function(t){return this.re.test(t)?NO_ERRORS:FORMAT_ERROR}},CmpExp:function(type,expr){this.model=new ValidationModel(type),this.expr=expr,this.ignore=!1;var self=this;this.test=function(str){var expr=this.expr,dt=Validation.getDomainValidator(this.model);if(dt.test(str)!=NO_ERRORS)return FORMAT_ERROR;if($("input[type!=checkbox][type!=radio][type!=button]").each(function(t,e){var i=$(e).attr("name"),e=$(e).val();-1!=expr.indexOf(i)&&(""==e&&(self.ignore=!0),expr=expr.replace(new RegExp(i,"g"),e))}),!this.ignore)try{if(!eval(expr))return INVALID_ERROR}catch(e){return INVALID_ERROR}return NO_ERRORS}},Remote:function(e){this.test=function(t){$.ajax({url:e+t,dataType:"json",success:function(t){t.error}})}},Range:function(i,t){this.min=parseFloat(t[0]),this.max=parseFloat(t[1]),this.test=function(t){var e=parseFloat(t.trim());if(isNaN(e))return INVALID_ERROR;t=!1;return">"==i[0]?t=e>this.min:">="===i[0]&&(t=e>=this.min),t?("<"==i[1]?t=e<this.max:"<="===i[1]&&(t=e<=this.max),t?NO_ERRORS:INVALID_ERROR):INVALID_ERROR}}},ValidationModel=function(t){this.symbol="",this.keyword="",this.opts=[],this.args=[],this.unary_ops={"+":!0,"-":!0},this.keywords={string:!0,number:!0,range:!0,regexp:!0,mobile:!0,email:!0,phone:!0,cmpexp:!0};for(var e=0,i=t.length,n="";e<i;){var s=t.charAt(e);if(this.isUnaryOp(s)&&0==e)this.symbol=s;else if("["==s)if(""!=this.keyword)n+=s;else{if(!this.stringEqual("range",n))throw new Error('"[" is just available for range.');this.keyword=n,this.opts.push(">="),n=""}else"("==s?""!=this.keyword?(this.opts.push("("),n+=s):(this.keyword=n,this.opts.push(">"),n=""):"]"==s?(this.opts.push("<="),this.args.push(n),n=""):")"==s&&e==i-1?(this.args.push(n),this.opts.push("<"),n=""):")"==s?(this.opts.pop("<"),1==this.opts.length&&(n+=s)):","==s&&1==this.opts.length?(this.args.push(n),n=""):n+=s;e++}""==this.keyword&&(this.keyword=n)},ValidationModel.prototype={isKeyword:function(t){return this.keywords[t.toLowerCase()]},isUnaryOp:function(t){return this.unary_ops[t]},isDecimalDigit:function(t){return 48<=t&&t<=57},isIdentifierStart:function(t){return 36===t||95===t||65<=t&&t<=90||97<=t&&t<=122},isIdentifierPart:function(t){return 36===t||95===t||65<=t&&t<=90||97<=t&&t<=122||48<=t&&t<=57},stringEqual:function(t,e){return t.toLowerCase()===e.toLowerCase()}},$.fn.formdata=function(e){if(void 0!==e){let t;t="string"==typeof e?$.parseJSON(e):e,$(this).find("input").each(function(t,e){$(this).val("")}),$(this).find("input[type=checkbox]").each(function(t,e){$(this).prop("checked",!1)}),$(this).find("textarea").each(function(t,e){$(this).val("")});let a=t;for(let s in a){let n;this.find("[name="+s+"]").each(function(t,e){if(n=$(this)[0].nodeName,"INPUT"!=n||"radio"!=$(this).attr("type")&&"checkbox"!=$(this).attr("type"))if("INPUT"!=n||"file"!=$(this).attr("type")&&"button"!=$(this).attr("type"))if("SELECT"==n){let e=!1;$(this).find("option").each(function(){let t=$(this);t.attr("value")==a[s]&&(t.prop("selected",!0),e=!0)}),e||$(this).val($($(this).find("option:first")).val()),$(this).val(null).trigger("change")}else"date"==$(this).attr("data-domain-type")?$(this).val(moment(a[s]).format("YYYY-MM-DD")):$(this).val(a[s]);else;else if(a[s].constructor==Array){var i=a[s];for(let t=0;t<i.length;t++)$(this).val()==i[t]&&$(this).prop("checked",!0)}else $(this).val()==a[s]&&$(this).prop("checked",!0)})}return{}}let r={};return this.find("input[type!=checkbox][type!=radio][type!=button]").each(function(t,n){let s=$(n).attr("name");if(s){let e=s,i="";var a=-1!=s.indexOf("[]"),o=s.indexOf("."),n=$(n).val();if(-1!=o&&(e=s.substr(0,o),i=s.substr(o+1,a?s.indexOf("[]")-e.length-1:s.length-e.length-1)),a)if(r[e]=r[e]||[],""!=i){let t={};t[i]=n,r[e].push(t)}else r[s].push(n);else if(""!=i){let t={};t[i]=n,r[e]=s}else r[s]=n}}),this.find("input[type=checkbox]").each(function(t,n){if($(n).prop("checked")){let i=$(n).attr("name");if(-1!=i.indexOf("[]")){let e=i;var s=e.indexOf(".");if(-1==s)r[e]=r[e]||[],r[e].push($(n).val());else{e=i.substr(0,s),s=i.substr(s+1,i.indexOf("[]")-e.length-1),r[e]=r[e]||[];let t={};t[s]=$(n).val(),r[e].push(t)}}else r[i]=$(n).val()}}),this.find("input[type=checkbox]").each(function(t,e){let i=$(e).attr("name");void 0===r[i]&&-1==i.indexOf("[]")&&(r[i]="")}),this.find("input[type=radio]").each(function(t,e){$(e).prop("checked")&&(r[$(e).attr("name")]=$(e).val())}),this.find("input[type=radio]").each(function(t,e){e=$(e).attr("name");void 0===r[e]&&(r[e]="")}),this.find("select").each(function(t,n){if(""!=$(n).val()&&"-1"!=$(n).val()&&null!=$(n).val()){let t=$(n).attr("name");var s=$(n).val();let e=t,i="";if(void 0!==t){var a=t.indexOf(".");if(-1!=a&&(e=t.substr(0,a),i=t.substr(a+1,t.length-e.length-1)),"object"==typeof $(n).val())r[$(n).attr("name")]=$(n).val().join(",");else if(""!=i){let t={};t[i]=s,r[e]=t}else r[t]=s}}else $(n).val(),r[$(n).attr("name")]=""}),this.find("textarea").each(function(t,e){""!=$(e).val()?r[$(e).attr("name")]=$(e).val():r[$(e).attr("name")]=""}),r},utils={append:function(t,e,i){let n=dom.create("div");n.style.height="100%",n.style.width="100%",i=i||!1;let s=document.createRange();e=s.createContextualFragment(e);!1!==i&&(t.innerHTML=""),t.appendChild(n),n.appendChild(e);e=dom.find("[id^=page]",n);return e?n.setAttribute("page-id",e.id):n.setAttribute("page-id","page.not.in.database"),{id:e?e.id:"",container:n}},message:function(i){if(i||0!=i.length){let e="";for(let t=0;t<i.length;t++)e+=i[t].message+"<br>";return e}},prompt:function(e){if(e||0!=e.length)for(let t=0;t<e.length;t++)$(e[t].element).addClass("is-invalid")},render:function(t,e,i){e=document.getElementById(e).innerHTML;let n=Handlebars.compile(e);i=n(i);let s=document.getElementById(t);s.innerHTML=i},assemble:function(t,e){if("object"==typeof t)for(var i in t){var n=t[i];"object"==typeof n&&(t[i+"Id"]=n.id),"id"==i?t[e+"Id"]=n:"name"==i&&(t[e+"Name"]=n)}},in:function(t){var e=t.split(" ");let i=null,n=[];1==e.length?(i=document.getElementById(t),n.push(i)):(i=document.getElementById(e[0]),n=i.querySelectorAll(e[1]));for(let t=0;t<n.length;t++)i=n[t],i.addEventListener("animationend",function(){this.classList.remove("animated","fadeIn"),this.style.display="",this.removeEventListener("animationend",function(){}),this.removeEventListener("animationstart",function(){})}),i.classList.remove("fadeOut","hide"),i.classList.add("animated","fadeIn","show")},out:function(t){var e=t.split(" ");let i=null,n=[];1==e.length?(i=document.getElementById(t),n.push(i)):(i=document.getElementById(e[0]),n=i.querySelectorAll(e[1]));for(let t=0;t<n.length;t++)i=n[t],i.addEventListener("animationend",function(){this.classList.remove("animated","fadeOut"),this.removeEventListener("animationend",function(){})}),i.classList.remove("fadeIn","show"),i.classList.add("animated","fadeOut","hide")},nameAttr:function(i){const n=[];let s="";for(let e=0;e<i.length;e++){let t=i.charAt(e);t==t.toUpperCase()?(n.push(s),s="",s+=t.toLowerCase()):s+=t}return""!=s&&n.push(s),"data-model-"+n.join("-")},nameVar:function(e,t){if(-1==e.indexOf(t=t||"-"))return e;var i=e.split(t);let n="";for(let t=0;t<i.length;t++){const e=i[t];0==t?n+=e:n+=e.charAt(0).toUpperCase()+e.slice(1)}return n},camelcase:function(e,t){if(-1==e.indexOf(t))return e;var i=e.split(t);let n="";for(let t=0;t<i.length;t++){const e=i[t];0==t?n+=e:n+=e.charAt(0).toUpperCase()+e.slice(1)}return n},pascalcase:function(e,t){if(-1==e.indexOf(t))return e.charAt(0).toUpperCase()+e.slice(1);var i=e.split(t);let n="";for(let t=0;t<i.length;t++){const e=i[t];n+=e.charAt(0).toUpperCase()+e.slice(1)}return n},clone:function(t,e){for(var i in t=t||{})e[i]=t[i]},get:function(e){var i=Array.prototype.slice.call(arguments,1);let n={};for(let t=0;t<i.length;t++)n[i[t]]=e[i[t]];return n},isEmpty:function(t){let e=0;for(var i in t)e++;return 0==e},isBlank:function(t){let e=0;for(var i in t)null!=t[i]&&""!==t[i]&&e++;return 0==e},getParameter:function(t,e){e=e.replace(/[\[\]]/g,"\\$&");let i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=i.exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},getParameters:function(t){if(-1==t.indexOf("?"))return{};let i={},n=(t=t.substring(t.indexOf("?")+1)).split("&");for(let e=0;e<n.length;e++){let t=n[e].split("=");if(1==t.length)return{};i[t[0].trim()]=decodeURIComponent(t[1].trim())}return i},isExisting:(e,i,n)=>{for(let t=0;t<e.length;t++)if(e[t][n]===i[n])return!0;return!1},textSize:(t,e)=>{const i=document.createElement("canvas"),n=i.getContext("2d");n.font=e;t=n.measureText(t);return i.remove(),{width:t.width,height:t.height}},base64:n=>new Promise((t,e)=>{const i=new FileReader;i.readAsDataURL(n),i.onload=()=>t(i.result),i.onerror=e}),randomId:()=>{let e="";var i="abcdefghijklmnopqrstuvwxyz",n=i.length;let s=0;for(let t=0;t<2;t++){for(s=0;s<6;)e+=i.charAt(Math.floor(Math.random()*n)),s+=1;e+="_"}return e.substring(0,e.length-1)},camelcaseAttribute:(t,e)=>(t=t.toLowerCase(),"id"!=(e=e.toLowerCase())&&"name"!=e&&"type"!=e||(e=t+"_"+e),utils.camelcase(e,"_"))},DataSheet.prototype.root=function(s){s=s||{};let a=this;this.table=dom.create("table","table","table-bordered");let t=dom.create("thead");this.tbody=dom.create("tbody");let e=dom.create("tr"),i=dom.create("th");i.style.borderBottomWidth="0",i.style.width=this.rowHeaderWidth+"px",t.appendChild(e),this.table.appendChild(t),this.table.appendChild(this.tbody);for(let t=0;t<this.columns.length;t++){var n=this.columns[t];i=dom.create("th","text-center"),i.style.borderBottomWidth="0",i.innerHTML=n.title,e.appendChild(i)}for(let n=0;n<this.rowCount;n++){var o=this.rowHeaders[n];let e=dom.create("tr"),i=dom.create("td");i.innerHTML=o.title,i.style.fontWeight="bold",e.appendChild(i);for(let t=0;t<this.columnCount;t++){var r=this.columns[t];i=dom.create("td"),i.style.textAlign="right",i.style.padding="6px 12px",i.setAttribute("data-ds-format",r.format||""),i.setAttribute("data-ds-row",n),i.setAttribute("data-ds-column",t),i.addEventListener("focus",function(){}),s[o.title]&&s[o.title][r.title]?i.innerHTML=s[o.title][r.title]:i.innerHTML="",i.addEventListener("keyup",function(t){var e=parseInt(this.getAttribute("data-ds-row")),i=parseInt(this.getAttribute("data-ds-column"));let n=null;if(13==t.keyCode)n=this;else if(37==t.keyCode){if(0==i)return;n=a.getCell(e,i-1)}else if(38==t.keyCode){if(0==e)return;n=a.getCell(e-1,i)}else if(39==t.keyCode){if(i==a.columnCount-1)return;n=a.getCell(e,i+1)}else if(40==t.keyCode){if(e==a.rowCount-1)return;n=a.getCell(e+1,i)}a.totalize(),null!=n&&(this.blur(),n.focus(),document.execCommand("selectAll",!1,null))}),e.appendChild(i)}this.tbody.appendChild(e)}if(0<this.totalColumns.length){let e=dom.create("tr"),i=dom.create("td");i.innerHTML="合计",i.style.fontWeight="bold",e.appendChild(i);for(let t=0;t<this.columnCount;t++)i=dom.create("td"),e.appendChild(i);this.tbody.appendChild(e)}return this.totalize(),this.table},DataSheet.prototype.getCell=function(e,i){var n=dom.find("tbody",this.table);let s=null;for(let t=0;t<n.children.length;t++){var a=n.children[t];if(t==e){for(let t=1;t<a.children.length;t++)if(t-1==i){s=a.children[t];break}break}}return s},DataSheet.prototype.render=function(t,e){this.container=dom.find(t),this.container.innerHTML="";t=dom.element(`
    <table class="table table-bordered">
      <thead></thead>
      <tbody></tbody>
    </table>
  `);let i=dom.find("thead",t),n=dom.find("tbody",t);this.rowHeaderRowCount,this.colHeaderRowCount;let s=[];for(let t=0;t<this.colHeaderRowCount;t++){var a=dom.create("tr");s.push(a),i.appendChild(a)}for(let i=0;i<this.colHeaderRowCount;i++){let e=s[i];for(let t=0;t<this.colHeaderColumnCount;t++){var o=this.matrixColumn[i][t];if(null!=o){let t=dom.create("th","text-center");t.style="border-bottom-width: 1px;",t.setAttribute("colspan",this.getSpanColumnCount(o)),t.innerHTML=o.title,e.appendChild(t)}}}for(let i=0;i<this.rowHeaderRowCount;i++){let e=dom.create("tr");for(let t=0;t<this.rowHeaderColumnCount;t++){var r=this.matrixRowHeader[t][i];if(null!=r){let i=dom.create("td");i.style="vertical-align: middle;",i.setAttribute("rowspan",this.getSpanRowCount(r)),i.innerHTML="<strong>"+r.title+"</strong>",this.onRowHeaderClicked&&(i.onclick=t=>{let e=Array.prototype.slice.call(i.parentElement.children);this.onRowHeaderClicked(i,e.indexOf(i))}),e.appendChild(i)}}for(let t=0;t<this.colHeaderColumnCount-this.rowHeaderColumnCount;t++){let i=dom.create("td");i.style.textAlign="right",i.style.padding="6px 12px",this.onCellClicked&&(i.onclick=t=>{let e=Array.prototype.slice.call(i.parentElement.children);this.onCellClicked(i,e.indexOf(i))}),e.appendChild(i)}n.appendChild(e)}this.container.appendChild(t)},DataSheet.prototype.getValues=function(){let i={};for(let e=0;e<this.rowHeaders.length;e++){var n=this.rowHeaders[e];i[n.title]={};for(let t=0;t<this.columns.length;t++){var s=this.columns[t];i[n.title][s.title]=this.tbody.rows[e].cells[t+1].innerText.trim()}}return i},DataSheet.prototype.totalize=function(){if(0!=this.totalColumns.length){let t=this.tbody.children[this.tbody.children.length-1];for(let n=0;n<this.columns.length;n++)if(!0===this.columns[n].totalable){let e=0,i=!1;for(let t=0;t<this.rowHeaders.length;t++){var s=parseFloat(this.tbody.rows[t].cells[n+1].innerText.trim());isNaN(s)||(e+=s,i=!0)}isNaN(e)||!0!==i||(t.cells[n+1].innerText=e.toFixed(2))}}},DataSheet.prototype.buildColumnMatrix=function(i,n,s){if(i){let e;n[s]?e=n[s]:(e=[],n.push(e));for(let t=0;t<i.length;t++){var a=i[t];e.push(a);var o=this.getSpanColumnCount(a);for(let t=1;t<o;t++)e.push(null);this.buildColumnMatrix(a.children,n,s+1)}}},DataSheet.prototype.buildRowHeaderMatrix=function(i,n,s){if(i){let e;n[s]?e=n[s]:(e=[],n.push(e));for(let t=0;t<i.length;t++){var a=i[t];e.push(a);var o=this.getSpanRowCount(a);for(let t=1;t<o;t++)e.push(null);this.buildRowHeaderMatrix(a.children,n,s+1)}}},DataSheet.prototype.getSpanColumnCount=function(e){let i=0;if(!e.children||0==e.children.length)return 1;for(let t=0;t<e.children.length;t++)i+=this.getSpanColumnCount(e.children[t]);return i},DataSheet.prototype.getSpanRowCount=function(t){return t.children&&0!=t.children.length?t.children.length:1},DataSheet.prototype.getRowCount=function(e){let i=0;for(let t=0;t<e.length;t++){var n=e[t];i+=1,n.children&&(i+=this.getRowCount(n.children))}return i},DataSheet.prototype.getColumnCount=function(e){let i=0;for(let t=0;t<e.length;t++){var n=e[t];i+=1,n.children&&(i+=this.getColumnCount(n.children))}return i},DataSheet.prototype.getColumnHeaderRowCount=function(i){let n=1;for(let e=0;e<i.length;e++){let t=1;var s=i[e];s.children&&(t+=this.getColumnHeaderRowCount(s.children)),t>n&&(n=t)}return n},DataSheet.prototype.getRowHeaderRowCount=function(e){let i=0;for(let t=0;t<e.length;t++){var n=e[t];n.children?i+=this.getRowHeaderRowCount(n.children):i+=1}return i},DataSheet.prototype.getColumnHeaderColumnCount=function(e){let i=0;for(let t=0;t<e.length;t++){var n=e[t];n.children?i+=this.getColumnHeaderColumnCount(n.children):i+=1}return i},DataSheet.prototype.getRowHeaderColumnCount=function(i){let n=1;for(let e=0;e<i.length;e++){let t=1;var s=i[e];s.children&&(t+=this.getRowHeaderColumnCount(s.children)),t>n&&(n=t)}return n},Tabs.prototype.loadPage=function(t,e,i,n){let s=dom.find(`div[data-tab-content-id="${t}"]`);null==s?(s=dom.templatize('<div data-tab-content-id="{{id}}"></div>',{id:t}),this.content.appendChild(s)):s.innerHTML="",void 0!==e&&ajax.view({url:e,containerId:s,success:n||function(){}}),!0===i&&(s.style.display="none")},Tabs.prototype.reload=function(t){let i=0,n=this.navigator.children[i];for(let e=1;e<this.navigator.children.length;e++){let t=this.navigator.children[e];if(t.classList.contains(this.tabActiveClass)){i=e-1,n=t;break}}this.loadPage(n.getAttribute("data-tab-id"),n.getAttribute("data-tab-url"),!1,t=>{this.tabs[i].success(t)})},Tabs.prototype.render=function(){let a=this;this.content&&(this.content.innerHTML=""),this.navigator.innerHTML="",this.slider=dom.element('<div class="slider position-absolute"></div>'),this.navigator.appendChild(this.slider),this.tabs.forEach((n,t)=>{n.style=n.style||"padding: 0 16px;",n.style?n.style=n.style:n.style+="min-width: "+(16*n.text.length+32)+"px;text-align: center;";let s=dom.templatize(`
      <div class="nav-item font-weight-bold mr-0 pointer" style="{{style}}"
           data-tab-url="{{{url}}}"
           data-tab-id="{{{id}}}" >{{{text}}}</div>
    `,n);a.navigator.appendChild(s),dom.bind(s,"click",e=>{if(!s.classList.contains(a.tabActiveClass)){for(let e=0;e<a.navigator.children.length;e++){let t=a.navigator.children[e];t.classList.remove(a.tabActiveClass)}if(a.content)for(let t=0;t<a.content.children.length;t++)a.content.children[t].style.display="none";a.activate(s),!0===this.autoClear&&(this.content.innerHTML="");let t=dom.find('div[data-tab-content-id="'+s.getAttribute("data-tab-id")+'"]',a.content);var i;null!=t?t.style.display="":n.onClicked?n.onClicked(e):(i=s.getAttribute("data-tab-id"),e=s.getAttribute("data-tab-url"),a.loadPage(i,e,!1,n.success))}}),!0===a.lazy?0==t&&(a.activate(s),n.onClicked?n.onClicked():a.loadPage(n.id,n.url,!1,n.success)):0==t?(a.activate(s),n.onClicked?n.onClicked():a.loadPage(n.id,n.url,!1,n.success)):n.onClicked?n.onClicked():a.loadPage(n.id,n.url,!0,n.success)})},Tabs.prototype.activate=function(t){t.classList.add(this.tabActiveClass),this.slider.style.width=t.clientWidth+"px",this.slider.style.left=t.offsetLeft+"px"},PaginationGrid.prototype.root=function(){let t=dom.element(`
    <div class="card">
      <div class="card-body">
        <div class="row" style="margin-left: -5px; margin-right: -5px;"></div>
      </div>
    </div>
  `);return this.rootBody=t.children[0].children[0],1==this.borderless&&(t.classList.add("b-a-0","mb-0"),t.children[0].classList.add("p-0")),t},PaginationGrid.prototype.request=function(e){let n=this;if(e=e||{},this.favourite){let t=dom.find("a[widget-id=toggleFavourite] i",this.container);t.classList.contains("fas")?e._favourite="true":e._favourite="false"}if(this.widgetFilter){var t,i=this.widgetFilter.getQuery();for(t in i)e[t]=i[t]}if(this.queryFilter){var s,a=this.queryFilter.getValues();for(s in a)e[s]=a[s]}for(var o in this.filters)e[o]=this.filters[o];e.start=this.start,e.limit=this.limit,xhr.post({url:this.url,usecase:this.usecase,data:e,success:function(t){n.total=t.total;var e=t.data;if(e)if(n.rootBody.innerHTML="",n.showPageNumber(),0!=e.length){for(let t=0;t<e.length;t++){var i=e[t];n.addRow(i,t)}n.addMore()}else{let t=n.rootBody;t.innerHTML='<div class="text-center pt-4 full-width">  <img width="48" height="48" src="img/kui/nodata.png" class="mb-2" style="opacity: 25%;">  <p style="opacity: 40%; color: black;">没有匹配的数据</p></div>'}}})},PaginationGrid.prototype.addRow=function(t,e){var i=dom.create("div","col-md-"+this.colspan);this.rootBody.appendChild(i),this.onRender(i,t,e)},PaginationGrid.prototype.replaceRow=function(e,i){if(this.rootBody.children[i]){let t=this.rootBody.children[i];t.innerHTML="",this.onRender(t,e,i)}},PaginationGrid.prototype.addMore=function(){if(this.start/this.limit+1!=this.lastPageNumber()){let e=this.rootBody.children[this.rootBody.children.length-1];if(e){let t=dom.element(`
    <div>
      <div class="card b-a-0">
        <div class="card-body">
          <a class="btn text-secondary font-56 position-absolute" style="top: calc(50% - 45px); left: calc(50% - 41px);">
            <i class="fas fa-ellipsis-h"></i>
          </a>
        </div>
      </div>
    </div>
  `);dom.bind(dom.find("a",t),"click",t=>{this.next()});var i=e.getBoundingClientRect().height;t.classList.add(e.classList),t.children[0].children[0].style.height=i-15+"px",this.rootBody.appendChild(t)}}},PaginationGrid.prototype.render=function(t,e){this.container="string"==typeof t?document.querySelector(t):t,this.container.innerHTML="";let i=this.root();this.container.appendChild(this.actionbar()),this.container.appendChild(i),this.container.appendChild(this.pagination());t=dom.top(this.container);i.style.height="calc(100% - 20px - "+t+"px)",this.request(e=e||{})},PaginationGrid.prototype.actionbar=function(){let i=this,t=$('<div class="full-width d-flex overflow-hidden" style="height: 26px;"></div>');this.queryFilter?t.append(this.queryFilter.getRoot()):t.append(dom.element('<div class="full-width"></div>'));let n=t.get(0);if(this.favourite){let e=dom.element('<a widget-id="toggleFavourite" class="card-header-action text-yellow">\n  <i class="far fa-star position-relative font-16" style="top: 4px;"></i>\n</a>');n.appendChild(e),dom.bind(e,"click",function(){let t=dom.find("i",e);t.classList.contains("far")?(t.classList.remove("far"),t.classList.add("fas"),i.go(1,{_favourite:"true"})):(t.classList.remove("fas"),t.classList.add("far"),i.go(1,{_favourite:"false"}))})}if(this.widgetFilter){let e=dom.create("div","card","widget-query","fade","fadeIn");this.widgetFilter.render(e),this.container.appendChild(e);var s=dom.element('<a widget-id="toggleFilter" class="card-header-action text-primary">\n  <i class="fas fa-filter position-relative" style="top: 4px;"></i>\n</a>');dom.bind(s,"click",function(){let t=e;t.classList.contains("show")?t.classList.remove("show"):t.classList.add("show")})}this.group&&(s=dom.element('<a widget-id="toggleGroup" class="card-header-action">\n  <i class="fas fa-bars"></i>\n</a>'),n.appendChild(s)),this.sort&&(e=dom.element('<a widget-id="toggleSort" class="card-header-action">\n  <i class="fas fa-sort-amount-down-alt position-relative" style="top: 4px; font-size: 17px;"></i>\n</a>'),n.appendChild(e));var e=dom.element('<a widget-id="toggleFilter" class="card-header-action text-primary ml-2">\n  <i class="fas fa-sync-alt position-relative" style="top: 3px;"></i>\n</a>');return dom.bind(e,"click",function(){i.request()}),n.appendChild(e),t.get(0)},PaginationGrid.prototype.pagination=function(){let t=this,e=dom.create("div","full-width","d-flex");e.style.top="0",e.style.overflow="hidden",e.style.zIndex=900;let i=dom.create("ul","pagination","mb-0");i.style.marginLeft="auto",this.firstPage=dom.create("li","page-item");let n=dom.create("a","page-link","b-a-0","pt-0","font-14");return n.setAttribute("href","javascript:void(0)"),n.style.paddingBottom="0px",n.style.lineHeight="32px",n.style.height="32px",n.innerHTML='<i class="material-icons">first_page</i>',dom.bind(n,"click",function(){t.go(1)}),this.firstPage.appendChild(n),i.appendChild(this.firstPage),this.prevPage=dom.create("li","page-item"),n=dom.create("a","page-link","b-a-0","pt-0","font-14"),n.setAttribute("href","javascript:void(0)"),n.style.paddingBottom="0px",n.style.lineHeight="32px",n.style.height="32px",n.innerHTML='<i class="material-icons">chevron_left</i>',dom.bind(n,"click",function(){t.prev()}),this.prevPage.appendChild(n),i.appendChild(this.prevPage),li=dom.create("li","page-item","disabled"),li.style.paddingTop="4px",this.pagebar=dom.create("a","page-link","b-a-0","pt-0","font-14"),this.pagebar.setAttribute("href","javascript:void(0)"),this.pagebar.style.cursor="default",this.pagebar.style.paddingBottom="0px",this.pagebar.innerText="0/0",li.appendChild(this.pagebar),i.appendChild(li),this.nextPage=dom.create("li","page-item"),n=dom.create("a","page-link","b-a-0","pt-0","font-14"),n.setAttribute("href","javascript:void(0)"),n.style.paddingBottom="0px",n.style.lineHeight="32px",n.style.height="32px",n.innerHTML='<i class="material-icons">chevron_right</i>',dom.bind(n,"click",function(){t.next()}),this.nextPage.appendChild(n),i.appendChild(this.nextPage),this.lastPage=dom.create("li","page-item"),n=dom.create("a","page-link","b-a-0","pt-0","font-14"),n.setAttribute("href","javascript:void(0)"),n.style.paddingBottom="0px",n.style.lineHeight="32px",n.style.height="32px",n.innerHTML='<i class="material-icons">last_page</i>',dom.bind(n,"click",function(){t.go(t.lastPageNumber())}),this.lastPage.appendChild(n),i.append(this.lastPage),0<this.limit&&e.appendChild(i),e},PaginationGrid.prototype.lastPageNumber=function(){return 0==this.total||-1==this.limit?1:0==this.total%this.limit?parseInt(this.total/this.limit):parseInt(this.total/this.limit+1)},PaginationGrid.prototype.prev=function(){this.start<=0||this.go((this.start-this.limit)/this.limit+1)},PaginationGrid.prototype.next=function(){this.start+this.limit>=this.total||this.go((this.start+this.limit)/this.limit+1)},PaginationGrid.prototype.go=function(t,e){t<=0||t>this.lastPageNumber()||(this.start=this.limit*(t-1),this.request(e))},PaginationGrid.prototype.showPageNumber=function(){var t=this.start/this.limit+1;let e=this.lastPageNumber(),i=this.total;e=e||0,i=i||0,this.limit<=0||(this.pagebar.innerHTML=t+"/"+e+"&nbsp;&nbsp;共"+i+"条记录",this.firstPage.classList.remove("disabled"),this.prevPage.classList.remove("disabled"),this.nextPage.classList.remove("disabled"),this.lastPage.classList.remove("disabled"),1==t&&(this.firstPage.classList.add("disabled"),this.prevPage.classList.add("disabled")),t==this.lastPageNumber()&&(this.nextPage.classList.add("disabled"),this.lastPage.classList.add("disabled")))},PaginationGrid.skeleton=function(){return dom.element(`
    <div style="display: flex; flex-wrap: wrap; margin: 0px -8px; width: 100%;">
      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">
        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">
        </div>
      </div>
      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">
        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">
        </div>
      </div>
      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">
          <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">
          </div>
      </div>
      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">
        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">
        </div>
      </div>
      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">
        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">
        </div>
      </div>
      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">
        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">
        </div>
      </div>
      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">
        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">
        </div>
      </div>
      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">
        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">
        </div>
      </div>
      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">
        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">
        </div>
      </div>
      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">
        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">
        </div>
      </div>
    </div>
  `)},Timeline.prototype.createTile=function(t,e){var i,n=dom.element(`
    <li class="timeline-item">
      <div class="time"></div>
      <div class="small text-muted"></div>
      <p></p>
    </li>
  `);let s=n.children[0],a=n.children[1],o=n.children[2];return this.fnTitle&&(void 0===(i=this.fnTitle(t,e))?s.innerHTML="":"string"==typeof i||"number"==typeof i?s.innerHTML=i:s.appendChild(i)),this.fnSubtitle&&(void 0===(i=this.fnSubtitle(t,e))?a.innerHTML="":"string"==typeof i||"number"==typeof i?a.innerHTML=i:a.appendChild(i)),this.fnContent&&(void 0===(e=this.fnContent(t,e))?o.innerHTML="":"string"==typeof e||"number"==typeof e?o.innerHTML=e:o.appendChild(e)),n},Timeline.prototype.render=function(t,e){let i=this;this.container="string"==typeof t?document.querySelector(t):t,this.container.innerHTML="",e=e||{};let n=dom.create("ul","timeline-simple");this.container.appendChild(n);t={};if(utils.clone(this.params,t),utils.clone(e,t),this.url)xhr.post({url:this.url,params:t,success:function(t){if(t.data){var e=t.data;for(let t=0;t<e.length;t++)n.appendChild(i.createTile(e[t],t))}}});else for(let t=0;t<i.data.length;t++)n.appendChild(i.createTile(i.data[t],t));i.onComplete&&i.onComplete()},ListView.prototype.fetch=async function(t){var e={};t=t||{},utils.clone(this.params,e),utils.clone(t,e);this.url&&(this.data=this.data||{},this.data.start=this.start,this.data.limit=this.limit,e=await xhr.promise({url:this.url,params:e}),Array.prototype.push.apply(this.local,e)),0==this.local.length?this.emptyHtml&&(this.contentContainer.innerHTML=this.emptyHtml):this.append(this.local)},ListView.prototype.render=function(e,t){this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="";e=this.height-37;if(this.onFilter){let t=dom.element(`
      <div class="input-group position-sticky" style="top: 0; left: 0; z-index: 10;">
        <div class="input-group-prepend">
          <span class="input-group-text" style="border-bottom-left-radius: unset;">
            <i class="fas fa-search"></i>
          </span>
        </div>
        <input class="form-control" placeholder="搜索..."  style="border-bottom-right-radius: unset;">
        <div class="input-group-append">
          <span class="input-group-text pointer text-primary" style="border-bottom-right-radius: unset;">
            <i class="fas fa-plus"></i>
          </span>
          <span class="input-group-text" style="border-bottom-right-radius: unset;">
            <i class="fas fa-question icon-general"></i>
          </span>
          <span class="input-group-text" style="border-bottom-right-radius: unset;">
            <i class="fas fa-asterisk icon-required"></i>
          </span>
        </div>
      </div>
    `),e=dom.find("input",t);dom.bind(e,"input",t=>{clearTimeout(this.delayToSearch),this.delayToSearch=setTimeout(()=>{this.onFilter(this,e.value)},500)}),this.required||t.children[2].children[2].remove(),this.tooltip||t.children[2].children[1].remove(),this.onAdd||t.children[2].children[0].remove(),0==t.children[2].children.length&&t.children[2].remove(),this.container.appendChild(t)}this.contentContainer=dom.create("div","full-width");let i=dom.create("ul","list-group","full-width","overflow-hidden");if(this.borderless&&i.classList.add("b-a-0"),this.onFilter){let t=dom.create("div");t.style.height=e+"px",t.style.overflowY="auto",t.style.border="1px solid rgba(0, 0, 0, 0.125)",t.style.borderTop="",t.appendChild(i),this.contentContainer.appendChild(t)}else this.contentContainer.appendChild(i);this.container.appendChild(this.contentContainer),!1!==t&&!0!==this.lazy&&this.reload()},ListView.prototype.reload=function(t){t=t||{};let e=dom.find("ul",this.container);e.innerHTML="",this.start=0,this.url&&(this.local=[]),this.fetch(t)},ListView.prototype.load=function(){this.start=this.local.length,this.fetch()},ListView.prototype.remove=function(i){if(this.idField){var n=dom.find("ul",this.container);for(let e=0;e<n.children.length;e++){let t=n.children[e];dom.model(t)[this.idField]===i[this.idField]&&t.remove()}}},ListView.prototype.append=function(e,i){let n=this,a=this.container.querySelector("ul");var o=a.querySelectorAll("li").length;if(Array.isArray(e)){var s=e;for(let t=0;t<s.length;t++)this.append(s[t]);n.complete&&n.complete(e)}else{var r=e;if(this.idField)for(let t=0;t<a.children.length;t++){var l=a.children[t];if(dom.model(l)[this.idField]===r[this.idField])return}let s=dom.create("li","list-group-item");!1!==this.hoverable&&s.classList.add("list-group-item-action"),!0===this.activateable&&dom.bind(s,"click",t=>{for(let e=0;e<s.parentElement.children.length;e++){let t=s.parentElement.children[e];t.classList.remove("active")}s.classList.add("active")});for(let t=0;t<this.itemClass.length;t++)s.classList.add(this.itemClass[t]);this.borderless&&s.classList.add("b-a-0"),this.onClick&&dom.bind(s,"click",this.onClick),s.style.paddingLeft="16px",s.style.paddingRight="16px",s.style.paddingTop="8px",s.style.paddingBottom="8px",s.style.display="flex",s.style.alignItems="center",this.onFilter&&(s.style.borderLeftWidth="0",s.style.borderRightWidth="0",s.style.borderBottomWidth="0");let t=this.create(o,r,s);if(t.style.width="100%",this.onCheck){let e=dom.element(`
        <input class="pointer checkbox color-info is-outline mr-2" type="checkbox">
      `);for(let t=0;t<this.selections.length;t++)if(this.compare(this.selections[t],r)){e.setAttribute("checked",!0);break}dom.bind(e,"change",function(){n.onCheck(this.checked,dom.model(this),this)}),dom.model(e,r),s.appendChild(e)}if(s.appendChild(t),0<this.slidingActions.length){this.actionElements=[];for(let e=0;e<this.slidingActions.length;e++){let t=this.slidingActions[e];t.width=parseInt(t.width||64),s.appendChild(t.create())}dom.bind(s,"touchstart",t=>{this.touchStartX=t.touches[0].screenX,this.touchStartY=t.touches[0].screenY}),dom.bind(s,"touchmove",t=>{this.touchMoveX=t.touches[0].screenX,this.touchMoveY=t.touches[0].screenY;let i=this.touchStartX-this.touchMoveX;t=this.touchStartY-this.touchMoveY;if(!(Math.abs(i)<30||30<Math.abs(t)))if(0<i){let e=i/this.slidingActions.length;for(let t=1;t<s.children.length;t++)s.children[t].getBoundingClientRect().width>=this.slidingActions[t-1].width||(e>=this.slidingActions[t-1].width&&(e=this.slidingActions[t-1].width),s.children[t].style.minWidth=e+"px",s.children[t].style.display="")}else{i=-i/10;var n=i/this.slidingActions.length;for(let e=1;e<s.children.length;e++){let t=s.children[e].getBoundingClientRect().width-n;t=t<=5?0:t,0==t?(s.children[e].style.width="0",s.children[e].style.minWidth="unset"):s.children[e].style.minWidth=t+"px"}}}),dom.bind(s,"touchend",t=>{this.touchendX=t.changedTouches[0].screenX,this.touchendY=t.changedTouches[0].screenY;var e=this.touchStartX-this.touchendX,t=this.touchStartY-this.touchendY;Math.abs(e)<30||30<Math.abs(t)||(30<=e?this.expandSlidingActions(s):this.collapseSlidingActions(s))})}this.idField&&s.setAttribute("data-list-item-id",r[this.idField]),dom.model(s,r),"number"==typeof i?i<0?a.insertBefore(s,a.children[a.children.length+i]):a.insertBefore(s,a.children[i]):a.appendChild(s),this.onRemove&&(i=dom.element(`
        <a class="btn text-danger float-right font-18" style="padding: 0; margin-left: auto;">
          <i class="fas fa-times" style=""></i>
        </a>
      `),dom.bind(i,"click",function(t){t.stopPropagation(),n.onRemove(this.parentElement,dom.model(this.parentElement))}),dom.model(i,r),s.appendChild(i)),this.onReorder?this.setReorderable(s):this.draggable&&(s.setAttribute("draggable","true"),s.addEventListener("dragover",function(t){t.preventDefault()}),s.addEventListener("dragstart",function(t){}))}},ListView.prototype.setLocal=function(t){if(!t||0==t.length)return this.contentContainer.innerHTML="",void(this.emptyHtml&&(this.contentContainer.innerHTML=this.emptyHtml));this.contentContainer.innerHTML="";let e=dom.find("ul",this.contentContainer);if(null==e){let t=dom.create("ul","list-group","full-width");this.borderless&&t.classList.add("b-a-0");let e=dom.create("div");var i=this.height-37;e.style.height=i+"px",e.style.overflowY="auto",e.style.border="1px solid rgba(0, 0, 0, 0.125)",e.style.borderTop="",e.appendChild(t),this.contentContainer.appendChild(e)}else e.innerHTML="";for(var n of t)this.append(n)},ListView.prototype.replace=function(i){var n=this.container.querySelector("ul");for(let e=0;e<n.children.length;e++){let t=n.children[e];if(dom.model(t)[this.idField]===i[this.idField]){dom.model(t,i),t.innerHTML="",t.appendChild(this.create(e,i));break}}},ListView.prototype.search=function(i){var n=this.container.querySelector("ul");for(let e=0;e<n.children.length;e++){let t=n.children[e];-1!=t.innerText.indexOf(i)?t.style.display="":t.style.display="none"}},ListView.prototype.setReorderable=function(t){let e=dom.find("ul",this.container);e.addEventListener("dragover",function(t){t.preventDefault()}),e.ondrop=t=>{this.onReorder&&this.onReorder(dom.model(this.draggingElement),this.getItemIndex(this.draggingElement),this.draggingElementOriginalIndex),this.draggingElement.style.opacity="",this.draggingElement=null,this.clonedDraggingElement=null},t.setAttribute("draggable","true"),t.ondragover=t=>{var e,i=dom.ancestor(t.target,"li");let n=i.parentElement;i!=this.draggingElement&&((e=this.getItemIndex(i))<this.draggingElementIndex?n.insertBefore(this.draggingElement,i):e>this.draggingElementIndex&&(null==i.nextElementSibling?n.appendChild(this.draggingElement):n.insertBefore(this.draggingElement,i.nextElementSibling)),this.draggingElementIndex=e,t.preventDefault())},t.ondragstart=t=>{let e=dom.ancestor(t.target,"li");e.parentElement,t.layerX;var i=t.layerY,i=t.target.offsetTop+i;this.clonedDraggingElement=e.cloneNode(!0),this.draggingElement=e,this.draggingElement.style.opacity="0.3",this.draggingElementIndex=this.getItemIndex(e),this.draggingElementOriginalIndex=this.draggingElementIndex,t.dataTransfer.setData("id",e.getAttribute("data-list-item-id")),t.dataTransfer.setData("y",i)}},ListView.prototype.getItemIndex=function(e){var i=e.parentElement;for(let t=0;t<i.children.length;t++)if(e==i.children[t])return t},ListView.prototype.setHeight=function(t){let e=this.container.querySelector("ul");e.style.height=t+"px"},ListView.prototype.activate=function(t){let e=this.container.querySelector("ul");for(let t=0;t<e.children.length;t++)e.children[t].classList.remove("active");t.classList.add("active")},ListView.prototype.getCheckedValues=function(){if(!this.onCheck)return[];var t,e;let i=[];for(t of this.container.querySelectorAll("input.checkbox"))!0===t.checked&&(e=dom.ancestor(t,"li"),i.push(dom.model(e)));return i},ListView.prototype.expandSlidingActions=function(e){if(!(e.children[1].getBoundingClientRect().width>=this.slidingActions[0].width.width)){let t=i=>{for(let e=1;e<i.children.length;e++){let t=i.children[e];var n=t.getBoundingClientRect();n.width+5>=this.slidingActions[e-1].width?(t.style.minWidth=this.slidingActions[e-1].width+"px",clearInterval(this.interval4SlidingActions)):t.style.minWidth=n.width+5+"px"}};this.interval4SlidingActions=setInterval(()=>{t(e)},5)}},ListView.prototype.collapseSlidingActions=function(n){n.children[1].getBoundingClientRect().width<=0||(this.interval4SlidingActions=setInterval(()=>{for(let e=1;e<n.children.length;e++){let t=n.children[e];var i=t.getBoundingClientRect();i.width-5<=0?(t.style.width="0",t.style.minWidth="unset",t.style.display="none",clearInterval(this.interval4SlidingActions)):t.style.minWidth=i.width-5+"px"}},10))},ListView.prototype.subscribe=function(t,e){},Wizard.prototype.render=function(t,e){this.container=dom.find(t),this.body=dom.find("div.tab-content",this.root);let n=dom.find("div.steps",this.root);for(let i=0;i<this.steps.length;i++){let t=this.steps[i],e=dom.element(`
      <div class="step" widget-on-render="" data-step="${i}" style="cursor: pointer;">
        <div class="content">
          <div class="title"></div>
          <div class="description"></div>
        </div>
      </div>
    `);t.index=i,t.active&&(this.current=t),null==this.current&&e.classList.add("completed"),dom.find("div.title",e).innerHTML=t.title,dom.find("div.description",e).innerHTML=t.description,n.appendChild(e)}this.container.appendChild(this.root),this.display(this.current)},Wizard.prototype.display=function(i){let e=this,t=dom.find('div.step[data-step="'+i.index+'"]',this.root);t.classList.remove("completed"),t.classList.add("active");let n=!1;for(let e=0;e<this.body.children.length;e++){let t=this.body.children[e];t.getAttribute("data-page-url")==i.url?(n=!0,t.classList.add("active")):t.classList.remove("active")}var s;n||(s=dom.create("div","tab-pane","active"),this.body.appendChild(s),ajax.view({url:i.url,page:i.page,containerId:s,success:function(t){e.body.children[e.body.children.length-1].setAttribute("data-page-url",i.url)}}))},Wizard.prototype.commit=function(){let t=dom.find("div.step.active",this.root);var e=parseInt(t.getAttribute("data-step"));t.classList.remove("active"),t.classList.add("completed"),this.display(this.steps[e+1])},Wizard.prototype.rollback=function(){let t=dom.find("div.step.active",this.container);var e=parseInt(t.getAttribute("data-step"));t.classList.remove("active"),this.display(this.steps[e-1])},Chat.MESSAGE_TYPE_TEXT="TEXT",Chat.MESSAGE_TYPE_IMAGE="IMAGE",Chat.MESSAGE_TYPE_AUDIO="AUDIO",Chat.MESSAGE_TYPE_VIDEO="VIDEO",Chat.MESSAGE_TYPE_PATIENT="PATIENT",Chat.MESSAGE_TYPE_CUSTOM="CUSTOM",Chat.MESSAGE_STATUS_UNREAD="01",Chat.MESSAGE_STATUS_READ="02",Chat.MESSAGE_STATUS_REVOKE="90",Chat.prototype.init=async function(t){await this.onInit();this.scheduleName=t;var e=this.userId+"@"+this.userType,i=await xhr.promise({url:this.host+"/api/v3/common/script/tim/user_signature",params:{userId:e}}),t={SDKAppID:i.appId};this.tim=TIM.create(t),this.tim.setLogLevel(1),this.tim.registerPlugin({"tim-upload-plugin":TIMUploadPlugin}),this.tim.login({userID:e,userSig:i.signature}),this.tim.on(TIM.EVENT.SDK_READY,function(t){}),this.tim.on(TIM.EVENT.MESSAGE_RECEIVED,s=>{for(let n=0;n<s.data.length;n++){let t=s.data[n],e=Chat.MESSAGE_TYPE_TEXT,i=null;"TIMCustomElem"===t.type?(i=JSON.parse(t.payload.data).messageContent,i.imagepath?e=Chat.MESSAGE_TYPE_IMAGE:i.audiopath?e=Chat.MESSAGE_TYPE_AUDIO:i.archiveId&&(e=Chat.MESSAGE_TYPE_PATIENT)):i=t.payload.text,this.onMessageReceived({senderId:t.conversationID.substring(3),messageTime:moment(1e3*s.data[n].time).format("YYYY-MM-DD HH:mm"),messageType:e,messageContent:i})}})},Chat.prototype.getConversations=async function(){var t,e=await xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId}});let i={};for(let t=0;t<e.length;t++){var n=e[t],s=n.senderId+"#"+n.senderType;if(i[s]){let t=i[s];t.createTime=n.createTime,t.messages.push(n)}else{let t={messages:[]};i[s]=t,t.id=s,t.createTime=n.createTime,t.name=n.senderType,t.senderId=n.senderId,t.senderType=n.senderType,t.messages.push(n)}}let a=[];for(t in i)a.push(i[t]);return a},Chat.prototype.fetchMessages=async function(t,e,i){let n="";n=t>this.userId?t+"&"+this.userId:this.userId+"&"+t;var s=await xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{conversationId:n,_order_by:"messageTime asc"}});let a=[],o=null;for(let n=0;n<s.length;n++){var r=s[n],l=moment(r.createTime).format("YYYY-MM-DD HH:mm");l!=o&&(o=l,a.push({createTime:l,groupingMessages:[{direction:r.senderId==this.userId?"outgoing":"incoming",messages:[]}]}));let t=a[a.length-1],e=t.groupingMessages[t.groupingMessages.length-1],i="";i=r.senderId==this.userId?"outgoing":"incoming",e.direction===i?e.messages.push(r):t.groupingMessages.push({direction:i,messages:[r]})}return a},Chat.prototype.fetchUnreadMessages=function(){let e=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId,receiverType:this.userType}}).then(t=>{e.onUnreadMessages(t)})},Chat.prototype.sendMessage=async function(t,e,i,n,s){return s=s||this.userId+"&"+t,"string"==typeof n&&(n=n.replace("\\","\\\\")),xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/save",params:{conversationId:s,senderId:this.userId,senderType:this.userType,receiverId:t,receiverType:e,messageType:i,messageTime:"now",messageContent:n,createTime:"now",status:Chat.MESSAGE_STATUS_UNREAD,"||stdbiz/pim/conversation/merge":{conversationId:s,conversationName:s,unreadCount:1,lastConversationTime:"now"}}})},Chat.prototype.sendTextMessage=async function(t,e,i,n){var s=t+"@"+e,n=await this.sendMessage(t,e,Chat.MESSAGE_TYPE_TEXT,i,n),i=this.tim.createTextMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{id:n.conversationMessageId,text:i}});return this.tim.sendMessage(i)},Chat.prototype.sendImageMessage=async function(t,e,i,n){var s=t+"@"+e,i=await xhr.promise({url:this.host+"/api/v3/common/image",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:i.ext}}),n=await this.sendMessage(t,e,Chat.MESSAGE_TYPE_IMAGE,JSON.stringify({imagepath:i.filepath,thumbnail:i.thumbnail}),n),i=this.tim.createCustomMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_IMAGE,messageContent:{id:n.conversationMessageId,imagepath:i.filepath,thumbnail:i.thumbnail}})}});return this.tim.sendMessage(i)},Chat.prototype.sendAudioMessage=async function(t,e,i,n){var s=t+"@"+e,i=await xhr.promise({url:this.host+"/api/v3/common/audio",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:"ogg"}}),n=await this.sendMessage(t,e,Chat.MESSAGE_TYPE_AUDIO,JSON.stringify({audiopath:i.filepath,duration:i.duration}),n),i=this.tim.createCustomMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_AUDIO,messageContent:{id:n.conversationMessageId,audiopath:i.filepath,duration:i.duration}})}});return this.tim.sendMessage(i)},Chat.prototype.sendPatientMessage=async function(t,e,i,n){var s=t+"@"+e,n=await this.sendMessage(t,e,Chat.MESSAGE_TYPE_PATIENT,JSON.stringify(i),n);i.id=n.conversationMessageId;i=this.tim.createCustomMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_PATIENT,messageContent:i})}});return this.tim.sendMessage(i)},Chat.prototype.readMessages=function(t){let e=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{senderId:t,readTime:"now",status:Chat.MESSAGE_STATUS_READ}}).then(t=>{e.onReadMessages(t)})},Chat.prototype.revokeMessage=function(e){return xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{messageId:e,status:Chat.MESSAGE_STATUS_REVOKE}}).then(t=>{this.onRevokeMessage(e)})},Chat.prototype.stop=function(){schedule.stop(this.scheduleName)},"undefined"!=typeof module&&(module.exports={Chat:Chat}),"undefined"!=typeof Handlebars&&Handlebars.registerHelper("ifeq",function(t,e,i){return t==e?i.fn(this):i.inverse(this)}),kuit={main:t=>{var e=t.url;let i=utils.getParameters(t.url);i={...i,...t.params};let n=t.title||"",s=t.success;xhr.get({url:e,success:function(t){let e=document.createRange();t=e.createContextualFragment(t);document.body.innerHTML="",document.body.appendChild(t),s&&s(n,t,i)}})},view:t=>{let n=dom.find("#container");for(let t=0;t<n.children.length;t++){var e=n.children[t].getAttribute("page-id");window[e].destroy&&window[e].destroy()}n.innerHTML="";var i=t.url;let s=utils.getParameters(t.url);s={...s,...t.params};let a=t.title||"",o=t.success;xhr.get({url:i,success:function(t){let e=null;n&&(e=utils.append(n,t,!1)),o&&o(a,e,s);let i=dom.element(`
        <li class="active">${a}</li>
      `);pageMain.navPage.innerHTML="",pageMain.navPage.appendChild(i),window[e.id].show(s),setTimeout(()=>{i.classList.add("in"),window[e.id].page.classList.add("in")},100)}})},stack:function(t){let s=dom.find("#container");var e=t.url;let a=utils.getParameters(t.url);a={...a,...t.params};let o=t.title||"",r=t.success;for(let e=0;e<s.children.length;e++){let t=s.children[e];"DIV"==t.tagName&&"true"!=t.getAttribute("data-stack-back")&&(t.style.display="none")}xhr.get({url:e,success:function(t){let e=null;s&&(e=utils.append(s,t,!1)),r&&r(o,e,a);for(let e=0;e<pageMain.navPage.children.length;e++){let t=pageMain.navPage.children[e];var i=t.innerText;t.innerText="";i=dom.element('<a href="#">'+i+"</a>");t.appendChild(i),t.removeAttribute("class"),dom.bind(i,"click",kuit.switch),t.style.transform="unset"}let n=dom.element(`
        <li class="active">${o}</li>
      `);pageMain.navPage.appendChild(n),setTimeout(()=>{n.classList.add("in"),s.children[s.children.length-1].classList.add("out"),window[e.id].page.classList.add("in")},100),window[e.id].show(a)}})},switch:t=>{let i=dom.find("#container"),e=dom.ancestor(t.target,"li"),n=Array.prototype.slice.call(pageMain.navPage.children);var s=n.indexOf(e);for(let e=i.children.length-1;e>s;e--){let t=i.children[e];var a=t.getAttribute("page-id");window[a].destroy&&window[a].destroy(),n[e].remove(),t.remove()}t=e.innerText;e.classList.add("active"),e.innerHTML=t,i.children[s].style.display=""},rightbar:t=>{let e=dom.find(".rightbar"),i=dom.find("#overlay");e.classList.remove("out"),e.classList.add("in"),i.style.display="",i.onclick=t=>{e.classList.remove("in"),e.classList.add("out"),i.style.display="none"};var n=t.url;ajax.view({url:n,containerId:e,success:()=>{t.success&&t.success()}})}};
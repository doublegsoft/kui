function asyncGeneratorStep(e,t,n,i,r,a,o){try{var s=e[a](o),d=s.value}catch(e){return void n(e)}s.done?t(d):Promise.resolve(d).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function a(e){asyncGeneratorStep(s,i,r,a,o,"next",e)}function o(e){asyncGeneratorStep(s,i,r,a,o,"throw",e)}var s=e.apply(t,n);a(void 0)})}}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function asyncGeneratorStep(e,t,n,i,r,a,o){try{var s=e[a](o),d=s.value}catch(e){return void n(e)}s.done?t(d):Promise.resolve(d).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function a(e){asyncGeneratorStep(s,i,r,a,o,"next",e)}function o(e){asyncGeneratorStep(s,i,r,a,o,"throw",e)}var s=e.apply(t,n);a(void 0)})}}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function asyncGeneratorStep(e,t,n,i,r,a,o){try{var s=e[a](o),d=s.value}catch(e){return void n(e)}s.done?t(d):Promise.resolve(d).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function a(e){asyncGeneratorStep(s,i,r,a,o,"next",e)}function o(e){asyncGeneratorStep(s,i,r,a,o,"throw",e)}var s=e.apply(t,n);a(void 0)})}}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function DataSheet(e){this.columns=e.columns,this.columnCount=this.getColumnCount(this.columns),this.rowHeaderWidth=e.rowHeaderWidth||150,this.rowHeaders=e.rowHeaders,this.rowCount=this.getRowCount(this.rowHeaders),this.readonly=!0===e.readonly,this.totalColumns=[];for(var t=0;t<this.columns.length;t++){var n=this.columns[t];n.totalable&&this.totalColumns.push(n)}this.onCellClicked=e.onCellClicked,this.onRowHeaderClicked=e.onRowHeaderClicked,this.rowHeaderColumnCount=this.getRowHeaderColumnCount(this.rowHeaders),this.colHeaderColumnCount=this.getColumnHeaderColumnCount(this.columns),this.rowHeaderRowCount=this.getRowHeaderRowCount(this.rowHeaders),this.colHeaderRowCount=this.getColumnHeaderRowCount(this.columns),this.matrixColumn=[],this.matrixRowHeader=[],this.buildColumnMatrix(this.columns,this.matrixColumn,0),this.buildRowHeaderMatrix(this.rowHeaders,this.matrixRowHeader,0)}function Tabs(e){this.navigator=dom.find(e.navigatorId),this.navigator.classList.add("d-flex","align-items-center"),this.content=dom.find(e.contentId),this.tabActiveClass=e.tabActiveClass,this.tabs=e.tabs,this.lazy=!1!==e.lazy,this.autoClear=!0===e.autoClear}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function PaginationGrid(e){var t=this;"object"===_typeof(e.url)?(this.url=e.url.root,this.urlChild=e.url.child):this.url=e.url,"object"===_typeof(e.usecase)?(this.usecase=e.usecase.root,this.usecaseChild=e.usecase.child):this.usecase=e.usecase,this.onRender=e.render,this.filters=e.params||e.filters||{},this.favourite=e.favourite||!1,this.start=e.start||0,this.limit=e.limit||5,this.colspan=e.colspan,this.borderless=e.borderless||!1,e.filter&&(e.filter.query={callback:function(e){t.go(1,e)}},e.filter.table=this,this.queryFilter=new QueryFilter(e.filter))}function Timeline(e){this.url=e.url,this.params=e.params||{},this.data=e.data||[],this.fnTitle=e.title||function(e,t){return""},this.fnSubtitle=e.subtitle||function(e,t){return""},this.fnContent=e.content||function(e,t){return""},this.onComplete=e.onComplete}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function asyncGeneratorStep(e,t,n,i,r,a,o){try{var s=e[a](o),d=s.value}catch(e){return void n(e)}s.done?t(d):Promise.resolve(d).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function a(e){asyncGeneratorStep(s,i,r,a,o,"next",e)}function o(e){asyncGeneratorStep(s,i,r,a,o,"throw",e)}var s=e.apply(t,n);a(void 0)})}}function ListView(e){this.url=e.url,this.usecase=e.usecase,this.params=e.params||{},this.lazy=!0===e.lazy,this.hoverable=!1!==e.hoverable,this.activateable=!0===e.activateable,this.itemClass=e.itemClass||[],this.slidingActions=e.slidingActions||[],this.emptyHtml=e.emptyHtml||'\n    <div class="d-flex flex-wrap mt-2">\n      <img class="m-auto" src="/img/nodata.png" width="60%">\n      <div style="flex-basis: 100%; height: 0;"></div>\n      <div class="text-muted m-auto mt-2" style="font-weight: bold;">没有任何数据</div>\n    </div>\n  ',this.idField=e.idField,this.compare=e.compare||function(e,t){return!1},this.selections=e.selections||[],this.local=e.local||[],this.create=e.create||function(e,t){},this.complete=e.complete,this.draggable=!0===e.draggable,this.start=e.start||0,this.limit=e.limit||-1,this.borderless=e.borderless||!1,this.height=e.height,this.tooltip=e.tooltip,this.required=e.required||!1,this.onRemove=e.onRemove,this.onReorder=e.onReorder,this.onCheck=e.onCheck,this.onSelect=e.onSelect,this.onFilter=e.onFilter,this.onAdd=e.onAdd,this.onSearch=e.onSearch,this.onClick=e.onClick,this.observableItems=new rxjs.Observable}function Wizard(e){this.topic=e.topic,this.steps=e.steps||[],this.root=dom.element('\n    <div>\n      <div class="ui ordered steps m-b-0">\n      </div>\n      <div class="tab-content">\n      </div>\n    </div>\n  ')}function asyncGeneratorStep(e,t,n,i,r,a,o){try{var s=e[a](o),d=s.value}catch(e){return void n(e)}s.done?t(d):Promise.resolve(d).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function a(e){asyncGeneratorStep(s,i,r,a,o,"next",e)}function o(e){asyncGeneratorStep(s,i,r,a,o,"throw",e)}var s=e.apply(t,n);a(void 0)})}}function Chat(e){this.host=e.host||"",this.userId=e.userId,this.userType=e.userType,this.getConversations=e.getConversations,this.onInit=e.onInit||_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),this.onSendTextMessage=e.onSendTextMessage,this.onSendImageMessage=e.onSendImageMessage,this.onSendAudioMessage=e.onSendAudioMessage,this.onSendVideoMessage=e.onSendVideoMessage,this.onSendCustomMessage=e.onSendCustomMessage,this.onRevokeMessage=e.onRevokeMessage||function(e){},this.onMessageReceived=e.onMessageReceived,this.onUnreadMessages=e.onUnreadMessages||function(e){},this.onReadMessages=e.onReadMessages||function(e){}}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}xhr={},xhr.request=function(e,t){var n=e.url,i=e.data||e.params||{},r=e.type||"json",a=e.success,o=e.error,s=utils.getParameters(e.url);i=_objectSpread(_objectSpread({},s),i),window&&window.user&&(i._current_user=window.user.userId);var d=e.usecase||"",l=new XMLHttpRequest;l.timeout=1e4,l.onload=function(){var e=l.responseText;if("json"==r)try{e=JSON.parse(e)}catch(t){return void(o&&o(e))}4==l.readyState&&"200"==l.status?a&&a(e):o&&o(e)},l.onerror=function(){o&&o({error:{code:-500,message:"网络访问错误！"}})},l.ontimeout=function(){o&&o({error:{code:-501,message:"网络请求超时！"}})},l.open(t,n,!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("usecase",d),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),window.user?l.setRequestHeader("_current_user",window.user.userId):l.setRequestHeader("_current_user","unauthorized user"),i?l.send(JSON.stringify(i)):l.send(null)},xhr.get=function(e){var t=e.url,n=(e.data,e.success),i=e.error,r=new XMLHttpRequest;r.open("GET",t,!0),r.onload=function(){var e=r.responseText;4==r.readyState&&"200"==r.status?n&&n(e):i&&i(e)},r.send(null)},xhr.post=function(e){var t=e.url;"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.request(e,"POST")},xhr.put=function(e){xhr.request(e,"PUT")},xhr.delete=function(e){xhr.request(e,"DELETE")},xhr.connect=function(e){xhr.request(e,"CONNECT")},xhr.upload=function(e){var t=e.url,n=e.data||e.params,i=e.type||"json",r=e.success,a=e.error,o=new FormData;for(var s in n)o.append(s,n[s]);o.append("file",e.file);var d=new XMLHttpRequest;d.timeout=1e4,d.onload=function(){var e=d.responseText;if("json"==i)try{e=JSON.parse(e)}catch(t){return void(a&&a(e))}4==d.readyState&&"200"==d.status?r&&r(e):a&&a(e)},e.progress&&(d.onprogress=function(t){e.progress(t.loaded,t.total)}),d.onerror=function(){a&&a({error:{code:-500,message:"网络访问错误！"}})},d.ontimeout=function(){a&&a({error:{code:-501,message:"网络请求超时！"}})},d.open("POST",t,!0),"undefined"!=typeof APPTOKEN&&d.setRequestHeader("apptoken",APPTOKEN),d.send(o)},xhr.asyncUpload=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var i=t.url,r=t.data||t.params,a=t.type||"json",o=(t.success,t.error),s=new FormData;for(var d in r)s.append(d,r[d]);s.append("file",t.file);var l=new XMLHttpRequest;l.timeout=1e4,l.onload=function(){var t=l.responseText;if("json"==a)try{t=JSON.parse(t)}catch(e){return void(o&&o(t))}4==l.readyState&&"200"==l.status?e(t):o&&e(t)},t.progress&&(l.onprogress=function(e){t.progress(e.loaded,e.total)}),l.onerror=function(){o&&o({error:{code:-500,message:"网络访问错误！"}})},l.ontimeout=function(){o&&o({error:{code:-501,message:"网络请求超时！"}})},l.open("POST",i,!0),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),l.send(s)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),xhr.chain=function(e){if(0!=e.length){var t=e[0],n=t.success,i=function(t){n(t),xhr.chain(e.slice(1))};xhr.promise(t,i)}},xhr.asyncGet=function(e,t){return new Promise(function(n,i){e.success=function(e){n(e)},e.error=t,xhr.get(e)})},xhr.promise=function(e,t){return new Promise(function(n,i){e.success=function(e){if(e.error)return void(t?t(e.error):dialog.error(e.error.message));n(e.data)},e.error=t||function(){n({error:{code:"500",message:"网络异常"}})},xhr.post(e)})},xhr.longpromise=function(e,t){var n=e.container||dom.find("#container"),i=e.tooltip||"操作处理中...",r=dom.element('\n    <div class="page-loading hide">\n      <div class="ring">'.concat(i,"\n        <span></span>\n      </div>\n    </div>\n  "));return n.appendChild(r),r.classList.remove("hide"),new Promise(function(n,i){e.success=function(e){if(e.error)return setTimeout(function(){r.classList.add("hide"),r.remove()},600),dialog.error(e.error.message),void(t&&t(e.error));setTimeout(function(){r.classList.add("hide"),r.remove()},1200),n(e.data)},e.error=t,xhr.post(e)})},xhr.download=function(e){var t=new XMLHttpRequest;t.open("POST",e.url,!0),t.responseType="arraybuffer",t.onload=function(){if(200===this.status){var n="",i=t.getResponseHeader("Content-Disposition");if(i&&-1!==i.indexOf("attachment")){var r=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,a=r.exec(i);null!=a&&a[1]&&(n=a[1].replace(/['"]/g,""))}var o=t.getResponseHeader("Content-Type"),s=new Blob([this.response],{type:o});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(s,n);else{var d=window.URL||window.webkitURL,l=d.createObjectURL(s),c=document.createElement("a");void 0===c.download?window.location=l:(c.href=l,c.download=e.filename||"下载的文件",document.body.appendChild(c),c.click()),setTimeout(function(){d.revokeObjectURL(l)},100)}}},t.setRequestHeader("Content-type","application/json"),"undefined"!=typeof APPTOKEN&&t.setRequestHeader("apptoken",APPTOKEN),t.send(JSON.stringify(e.params||{}))},xhr.asyncRequest=function(e,t){var n=e.url,i=e.data||e.params,r=e.type||"json",a=e.usecase||"";return new Promise(function(e,o){if(n){var s=new XMLHttpRequest;s.timeout=1e4,s.onload=function(){var t=s.responseText;if("json"==r)try{t=JSON.parse(t)}catch(e){return console.log(e),void o(e)}4==s.readyState&&"200"==s.status?e(t):o(t)},s.onerror=function(){o({error:{code:-500,message:"网络访问错误！"}})},s.ontimeout=function(){o({error:{code:-501,message:"网络请求超时！"}})},s.open(t,n,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("usecase",a),"undefined"!=typeof APPTOKEN&&s.setRequestHeader("apptoken",APPTOKEN),i?s.send(JSON.stringify(i)):s.send(null)}})},xhr.asyncPost=function(e){var t=e.url;return"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.asyncRequest(e,"POST")},"undefined"!=typeof module&&(module.exports={xhr:xhr});var ajax={};ajax.save=function(e){for(var t=e.url||"",n=e.form,i=e.button,r=e.success,a=n.validate(),o="",s=0;s<a.length;s++)o+=a[s].message+"<br>";if(""!=o)return void dialog.error(o);i&&i.prop("disabled",!0);var d=n.formdata();$.ajax({url:t,data:d,method:"POST",dataType:"json",success:function(e){if(void 0!==e.error)return dialog.error("保存信息出错！"),void(i&&i.prop("disabled",!1));dialog.success("保存信息成功！"),void 0!==r&&r(e),i&&i.prop("disabled",!1)},error:function(){dialog.error("系统异常！"),i&&i.prop("disabled",!1)}})},ajax.post=function(e){var t=utils.getParameters(e.url),n=_objectSpread(_objectSpread({},t),e.data);$.ajax({url:e.url,data:n,method:"POST",dataType:"json",success:function(t){void 0!==e.success&&e.success(t)}})},ajax.get=function(e){$.ajax({url:e.url,data:e.data,dataType:"json",success:function(t){void 0!==e.success&&e.success(t)}})},ajax.text=function(e,t,n){$.ajax({url:e,data:t,success:function(e){void 0!==n&&n(e)}})},ajax.view=function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();var t=e.url,n=!1;n=void 0===e.empty||e.empty;var i=e.page;t&&0==t.indexOf(":")&&(i=t.substring(1),t=null);var r=utils.getParameters(e.url),a=_objectSpread(_objectSpread({},r),e.params),o=e.title||"",s=e.containerId,d=e.success,l=null;if("string"==typeof s?null==(l=document.getElementById(s.trim()))&&(l=document.querySelector(s.trim())):l=s,void 0===a&&(a={}),window.parameters)for(var c in a)window.parameters[c]=a[c];t?xhr.get({url:t,success:function(e){var t=null;l&&(t=utils.append(l,e,n)),t&&t.id&&window[t.id]&&window[t.id].show&&!d&&window[t.id].show(r),d&&d(o,t,r)}}):i&&xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:i},success:function(e){var t=e.data.script;t||(t='<div class="full-width full-height d-flex"><img src="img/under-construction.jpeg" class="m-auto full-width"></div>');var i=null;l&&(i=utils.append(l,t,n)),d&&d(o,i,r)}})},ajax.append=function(e){function t(){f.querySelectorAll("div[data-url]").forEach(function(e){e.classList.remove("show"),e.classList.add("hide","fade","fadeIn")}),o.querySelectorAll("a.active").forEach(function(e){e.classList.remove("active")}),s.querySelectorAll("a.active").forEach(function(e){e.classList.remove("active")})}function n(e){dom.find("a",e).classList.add("pointer"),dom.find("a",e).classList.remove("nav-link"),dom.find("a",e).classList.add("dropdown-item"),dom.find("i",e).classList.remove("ml-1"),dom.find("i",e).classList.add("float-right"),0==s.children.length?s.appendChild(e):s.insertBefore(e,s.children[0])}function i(e){dom.find("a",e).classList.add("nav-link"),dom.find("a",e).classList.remove("dropdown-item"),dom.find("i",e).classList.add("ml-1"),dom.find("i",e).classList.remove("float-right"),o.appendChild(e)}function r(e,r){if(""!=e&&null!=o){var l=dom.element('\n      <li class="nav-item">\n        <a class="nav-link head-link">\n          <span></span>\n          <i class="fas fa-times-circle ml-1"></i>\n        </a>\n      </li>\n    ');dom.find("a",l).setAttribute("data-url",r),dom.bind(dom.find("i",l),"click",function(e){e.preventDefault(),e.stopPropagation();var t=e.target.parentElement,n=f.querySelector('div[data-url="'+t.getAttribute("data-url")+'"]');if(n&&n.remove(),e.target.parentElement.parentElement.remove(),f.querySelectorAll("div[data-url]").length>0&&o.children[0].click(),s.children.length>0){var r=s.children[0];r.remove(),i(r)}}),dom.bind(dom.find("a",l),"click",function(e){var n=dom.ancestor(e.target,"a");n.classList.contains("active")||(t(),n.classList.add("active"),a(h.getAttribute("data-url")))});var c=!1;if(o.querySelectorAll("li").forEach(function(t){dom.find("span",t).innerText==e&&(c=!0,dom.find("a",t).classList.add("active"))}),!c){if(0==d)o.appendChild(l);else if(d+1>MAX_HEAD_LINK_COUNT){var u=dom.find("li:last-child",o);u.remove(),n(u)}o.insertBefore(l,o.children[0]);var p=dom.find("span",l),h=dom.find("a",l);h.classList.add("active"),p.innerText=e}}}function a(e){f.querySelectorAll("div[data-url]").forEach(function(e){e.classList.remove("show"),e.classList.add("hide")});var t=f.querySelector('div[data-url="'+e+'"]');if(null!=t){t.classList.remove("hide"),setTimeout(function(){t.classList.add("show")},150);var n=dom.find('a[data-url="'+e+'"]',o);return null!=n?void n.classList.add("active"):void dom.find('a[data-url="'+e+'"]',s).classList.add("active")}xhr.get({url:e,success:function(t){var n=utils.getParameters(e),i=utils.append(f,t,!1);i.id&&window[i.id]&&window[i.id].show&&window[i.id].show(n);for(var a=f.children.length-1;a>=0&&!function(){var t=f.children[a];if("DIV"==t.tagName)return t.setAttribute("data-url",e),setTimeout(function(){t.classList.add("show")},150),1}();a--);r(c,e),h&&h(c,t)}})}"undefined"!=typeof schedule&&e.clear&&schedule.stop();var o=dom.find("#tabsMain"),s=dom.find("#tabsOthers");if(null==o)return void ajax.view(e);var d=o.children.length,l=e.url,c=e.title||"",u=e.containerId,p=e.params,h=e.success,f=null;if("string"==typeof u?null==(f=document.getElementById(u.trim()))&&(f=document.querySelector(u.trim())):f=u,void 0===p&&(p={}),window.parameters)for(var m in p)window.parameters[m]=p[m];t();var g=f.querySelector('div[data-url="'+l+'"]');if(null!=g){g.classList.remove("hide"),setTimeout(function(){g.classList.add("show")},150);var v=dom.find('a[data-url="'+l+'"]',o);return null!=v?void v.classList.add("active"):void dom.find('a[data-url="'+l+'"]',s).classList.add("active")}if(0==l.indexOf(":")){var y=l.substring(1);xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:y},success:function(e){var t=e.data.script;utils.append(f,t,!1);for(var n=f.children.length-1;n>=0&&!function(){var e=f.children[n];if("DIV"==e.tagName)return e.setAttribute("data-url",l),setTimeout(function(){e.classList.add("show")},150),1}();n--);r(c,l),stdbiz.render(y,f.querySelector('[data-url="'+l+'"]'),{})}})}else a(l)},ajax.shade=function(e){"undefined"!=typeof schedule&&schedule.stop();var t=e.url,n=e.success,i=document.querySelector(".page.full");null!=i&&i.parentElement.remove(),-1===t.indexOf(":")?xhr.get({url:t,success:function(t){var i=utils.append(document.body,t);n&&n(e.title||"",i)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:t.substring(1)},success:function(t){var i=t.data.script,r=utils.append(document.body,i);n&&n(e.title||"",r)}})},ajax.shade2=function(e){"undefined"!=typeof schedule&&schedule.stop();var t=e.url,n=e.success;xhr.get({url:t,success:function(t){var i=utils.append(document.body,t);n&&n(e.title||"",i)}})},ajax.overlay=function(e){"undefined"!=typeof schedule&&schedule.stop();var t=e.url,n=e.html,i=e.success,r=document.querySelector(".page.overlay");if(null!=r&&r.parentElement.remove(),t)xhr.get({url:t,success:function(t){var n=utils.append(document.body,t);i&&i(e.title||"",n)}});else{var a=utils.append(document.body,n);i&&i(e.title||"",a)}},ajax.stack=function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();var t=e.pageId,n=e.params,i=dom.find(e.containerId);void 0===n&&(n={});for(var r=!1,a=0;a<i.children.length;a++){var o=i.children[a];"DIV"==o.tagName&&"true"!=o.getAttribute("data-stack-back")&&(o.classList.remove("show"),o.classList.add("hide"),o.id==t&&(o.classList.remove("hide"),o.classList.add("show"),r=!0))}r||(e.empty=!1,ajax.view(e));var s=dom.find("div[data-stack-back]",i);null==s&&(s=dom.element('\n    <div data-stack-back="true" class="pointer">\n      <i class="fas fa-angle-left font-32" style="margin-top: 12px;"></i>\n    </div>\n  '),s.style.position="fixed",s.style.width="60px",s.style.height="60px",s.style.bottom="40px",s.style.right="40px",s.style.backgroundColor="#0C9",s.style.color="#fff",s.style.borderRadius="50px",s.style.textAlign="center",s.style.boxShadow="2px 2px 3px #999",s.style.zIndex="99",dom.bind(s,"click",function(e){s.remove(),ajax.unstack({containerId:i})}),i.appendChild(s))},ajax.unstack=function(e){var t=dom.find(e.containerId);t.children[t.children.length-1].remove();var n=t.children[t.children.length-1];n.classList.remove("hide"),n.classList.add("show")},ajax.template=function(e){var t=e.url,n=e.usecase,i=e.containerId,r=e.templateId,a=e.data,o=e.success;xhr.post({url:t,usecase:n,data:a,success:function(e){if(i){var t=document.getElementById(r).innerHTML,n=Handlebars.compile(t),a=n(e);document.getElementById(i).innerHTML=a}o&&o(e)}})},ajax.dialog=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,a,o,s,d,l,c,u,p,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.title||"",i=t.url,r=t.html,a=t.params||{},o=t.success,s=t.end,d=!1!==t.shadeClose,l=!0===t.allowClose,c=t.width||"80%",u=t.height||"",p=t.offset||"auto",window.parameters)for(h in a)window.parameters[h]=a[h];if(!i){e.next=16;break}return e.next=15,xhr.asyncGet({url:i});case 15:r=e.sent;case 16:layer.open({type:1,offset:p,title:n,closeBtn:!0===l?1:0,shade:.5,shadeClose:d,area:[c,u],content:r,success:function(e,t){var i=document.querySelector(".layui-layer-content");i.style.overflow="hidden",""!=n&&(i.style.height="calc(100% - 42px);"),o&&o()},end:s||function(){}});case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),ajax.video=function(e,t,n,i){layer.open({type:2,title:!1,closeBtn:1,shade:[0],area:[n+"px",i+"px"],offset:"rb",anim:2,content:[e,"no"]})},ajax.svg=function(e,t,n,i){void 0===n&&(n={}),$.ajax({url:e,data:n,success:function(e){t.empty();var n=(new XMLSerializer).serializeToString(e.documentElement);t.html(n),i&&i(e)}})},ajax.upload=function(e){var t=e.data;void 0===t&&(t={});var n=new FormData;for(var i in t)n.append(i,t[i]);$.ajax({url:e.url,data:n,method:"POST",cache:!1,contentType:!1,processData:!1,xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&e.progress&&t.upload.addEventListener("progress",function(t){t.lengthComputable&&e.progress&&e.progress(t.total,t.loaded)},!1),t},success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},ajax.sidebar=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,a,o,s,d,l,c,u,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=dom.find(t.containerId),i=t.success||function(e,t){},r=dom.find("[widget-id=right-bar]"),a=t.allowClose||!1,null!=r&&r.remove(),r=dom.element('\n    <div widget-id="right-bar" style="position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: transparent; z-index: 999999;">\n      <div class="right-bar fade show">\n        <div class="modal-dialog" role="document">\n          <div class="modal-content">\n            <div class="card-header pl-3">\n              <h5 class="modal-title"></h5>\n              <button type="button" class="close text-danger position-relative">\n                <i class="fas fa-times"></i>\n              </button>\n            </div>\n            <div class="modal-body" style="overflow-y: auto;"></div>\n            <div style="position: absolute; bottom: 24px; left: 0; width: 100%; height: 48px; border-top: 1px solid lightgrey; background: white; display:none; z-index: 99999999;">\n              <div widget-id="right-bar-bottom" class="mh-10 mt-2" style="float: right;"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  '),!0===t.showBottom&&(dom.find(".modal-body",r).style.marginBottom="48px",dom.find("[widget-id=right-bar-bottom]",r).parentElement.style.display=""),r.addEventListener("click",function(e){"right-bar"===e.target.getAttribute("widget-id")&&(r.children[0].classList.remove("in"),r.children[0].classList.add("out"),setTimeout(function(){r.remove()},300))}),n.appendChild(r),t.url&&0==t.url.indexOf(":")&&(t.page=t.url.substring(1),t.url=null),o="",!t.url){e.next=17;break}return e.next=14,xhr.asyncGet({url:t.url});case 14:o=e.sent,e.next=18;break;case 17:t.html&&(o=t.html);case 18:dom.find(".modal-title",r).innerHTML=t.title||"",dom.find(".modal-body",r).innerHTML="",a||t.close||dom.find("button.close",r).classList.add("hidden"),!0===a&&(s=dom.find("button.close",r),d=dom.find(".card-header",r),l=s.getBoundingClientRect(),c=d.getBoundingClientRect(),u=(c.height-l.height)/2,s.style.top=u+"px",s.style.right=u+"px"),dom.find("button.close",r).addEventListener("click",function(){r.children[0].classList.add("out"),r.remove(),t.close&&t.close()}),p=utils.append(dom.find(".modal-body",r),o),i&&i(t.title||"",p),setTimeout(function(){r.children[0].classList.remove("out"),r.children[0].classList.add("in")},300);case 26:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),ajax.bottombar=function(e){var t=dom.find(e.containerId),n=e.success||function(){},i=dom.find(".bottom-bar",t),r=e.allowClose||!1;null!=i&&i.remove(),i=dom.element('\n    <div class="bottom-bar fade show">\n      <div class="modal-dialog" role="document">\n        <div class="modal-content">\n          <div class="card-header pt-2 pb-2">\n            <button type="button" class="close text-danger">\n              <i class="fas fa-times"></i>\n            </button>\n            <h5 class="modal-title"></h5>\n          </div>\n          <div class="modal-body" style="overflow-y: auto"></div>\n        </div>\n      </div>\n    </div>\n  '),t.appendChild(i);var a=i.parentElement.clientWidth,o=parseInt(window.getComputedStyle(i.parentElement,null).getPropertyValue("padding-left")),s=parseInt(window.getComputedStyle(i.parentElement,null).getPropertyValue("padding-right"));i.style.width=a-s-o+"px",e.url?xhr.get({url:e.url,success:function(t){dom.find(".modal-title",i).innerHTML=e.title||"",r||e.close||dom.find("button.close",i).classList.add("hidden"),dom.find("button.close",i).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),e.close&&e.close()}),
utils.append(dom.find(".modal-body",i),t),n&&n(t),setTimeout(function(){i.classList.remove("out"),i.classList.add("in")},200)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:e.page},success:function(t){var a=t.data.script;utils.append(dom.find(".modal-body",i),a),dom.find(".modal-title",i).innerHTML=e.title,r||e.close||dom.find("button.close",i).classList.add("hidden"),dom.find("button.close",i).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),e.close&&e.close()}),n&&n(t),setTimeout(function(){i.classList.remove("out"),i.classList.add("in")},200)}})},ajax.tabs=function(e){function t(e,t,n,i){ajax.view({url:t,containerId:e,success:function(){window[n]&&window[n].show(i)}})}var n=document.querySelector(e.containerId),i=e.tabs,r=(e.closeable,dom.create("ul","nav","nav-tabs")),a=dom.create("div","tab-content"),o=dom.create("div","float-right"),s=dom.create("button","btn","btn-link");o.appendChild(s),dom.bind(s,"click",function(){var e=dom.find("li.active link",this.parentElement.parentElement),n=e.getAttribute("data-model-url"),i=e.getAttribute("data-model-page"),r=JSON.parse("data-model-data");t(dom.find("div.tab-content div[data-model-url='"+n+"']",this.parentElement.parentElement),n,i,r)});for(var d=0;d<i.length;d++)!function(){var e=i[d],n=dom.create("li","nav-item"),o=dom.create("a","nav-link");0==d&&o.classList.add("active"),o.setAttribute("data-model-url",e.url),o.setAttribute("data-model-data",JSON.stringify(e.data||{})),o.setAttribute("data-model-page",e.page),o.innerHTML=e.title,dom.bind(o,"click",function(){if(!this.classList.contains("active")){dom.find("a.active",this.parentElement.parentElement.parentElement).classList.remove("active"),dom.find("div.active",this.parentElement.parentElement.parentElement).classList.remove("active");var e=o.getAttribute("data-model-url"),n=JSON.parse(o.getAttribute("data-model-data")),i=o.getAttribute("data-model-page"),r=dom.find("div.tab-content div[data-model-url='"+e+"']",this.parentElement.parentElement.parentElement);this.classList.add("active"),r.classList.add("active"),""===r.innerHTML.trim()&&t(r,e,i,n)}}),n.appendChild(o),r.appendChild(n);var s=dom.create("div","tab-pane");0==d&&(s.classList.add("active"),t(s,e.url,e.page,e.data)),s.setAttribute("data-model-url",e.url),a.append(s)}();n.appendChild(o),n.appendChild(r),n.appendChild(a)},ajax.download=function(e,t){fetch(e).then(function(e){return e.blob()}).then(function(e){var n=document.createElement("a"),i=window.URL.createObjectURL(e);n.href=i,n.download=t+".docx",n.click(),window.URL.revokeObjectURL(i),n.remove()})},ajax.upload=function(e){var t=dom.create("input");t.setAttribute("type","file"),t.setAttribute("accept",e.accept||"*"),t.style.display="none",t.onchange=function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function n(i){var r,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.files[0],n.next=3,xhr.asyncUpload({url:"/api/v3/common/upload",params:{directoryKey:e.directoryKey},file:r});case 3:a=n.sent,e.success&&e.success(a);case 5:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}(),t.click()},"undefined"==typeof dialog&&(dialog={}),dialog.alert=function(e){layer.open({type:0,icon:0,offset:"150px",shade:0,shadeClose:!0,title:"警告",content:e})},dialog.info=function(e){layer.open({type:0,offset:"150px",shade:0,shadeClose:!0,title:"信息",content:e})},dialog.info2=function(e){layer.open({type:0,offset:"100px",shade:.3,shadeClose:!0,title:"信息",content:e})},dialog.error=function(e){e=e.replaceAll("\n","<br>"),layer.open({type:0,icon:2,offset:"150px",shade:0,shadeClose:!0,title:"错误",content:e})},dialog.success=function(e,t){t?layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e,btn:["确定","确定并返回"],yes:function(e,t){layer.close(e)},btn2:function(e,n){layer.close(e),t()}}):layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e})},dialog.confirm=function(e,t){layer.confirm(e,{title:"确认",btn:["确定","取消"]},function(e,n){var i=dom.formdata(n[0]);layer.close(e),t(i)},function(){})},dialog.view=function(e){var t=e.title,n=e.url;$(document.body);$("#dialogApplication").length&&$("#dialogApplication").remove();var i=[];e.save&&i.push({text:"保存",class:"btn-save",onClicked:e.save}),$.ajax({url:n,success:function(n){var r=Handlebars.compile('<div class="modal fade fadeIn show" id="dialogApplication">  <div class="modal-dialog modal-dialog-centered">    <div class="modal-content">      <div class="modal-header">        <h4 class="modal-title">{{title}}</h4>        <button type="button" class="close" data-dismiss="modal">&times;</button>      </div>      <div id="dialogApplicationBody" class="modal-body">{{{body}}}</div>      <div class="modal-footer">        {{#each buttons}}        <button type="button" class="btn {{class}}" data-dismiss="modal">{{text}}</button>        {{/each}}        <button type="button" class="btn btn-close" data-dismiss="modal">关闭</button>      </div>    </div>  </div></div>'),a=r({title:t,body:n,buttons:i});$(document.body).append(a),e.success&&e.success({onClosed:e.onClosed}),$("#dialogApplication").modal("show")}})},dialog.select=function(e){ajax.view({url:e.url,success:function(t){layer.open({type:0,icon:1,offset:"150px",shade:.5,shadeClose:!0,title:e.title,content:t})}})},dialog.simplelist=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xhr.promise({url:t.url,params:t.params||{}});case 2:for(n=e.sent,i=dom.element('\n    <div>\n      <ul class="list-group"></ul>\n    </div>\n  '),r=dom.find("ul",i),a=0;a<n.length;a++)o=n[a],s=dom.create("li","list-group-item","list-group-item-action"),dom.model(s,o),s.innerText=o[t.fields.text],r.appendChild(s);layer.open({type:0,closeBtn:1,btn:[],shade:.5,shadeClose:!0,title:"",content:i.innerHTML,success:function(e,n){e.get(0).querySelectorAll("li").forEach(function(e,n){dom.bind(e,"click",function(e){layer.close(layer.index);var n=dom.model(e.target);t.onAccept(n)})})}});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),dialog.html=function(e){layer.open({type:0,closeBtn:1,offset:"150px",shade:.5,area:[e.width||"50%",""],shadeClose:!0,title:e.title||"&nbsp;",content:e.html,btn:["确定","关闭"],success:function(t,n){e.load&&e.load(t,n)},yes:function(t,n){var i=dom.find("div.layui-layer-content",n[0]);1==i.children.length?e.success(i.children[0]):e.success(i.children),layer.close(t)},btn1:function(){}})},dialog.iframe=function(e){layer.open({title:e.title,type:2,area:[e.width,e.height],content:e.url,resize:!1,maxmin:!0,shade:!1,success:e.success||function(e,t){}})};var dom={};dom.closeRightBar=function(){var e=dom.find("div[widget-id=right-bar]");null!=e&&(e.children[0].classList.add("out"),setTimeout(function(){e.remove()},300))},dom.slideInFromRight=function(e,t){e.classList.remove("out"),e.classList.add("in"),setTimeout(function(){e.style.right="0"},300),t&&(t.style.display="")},dom.slideOutToRight=function(e,t,n){e.classList.contains("in")&&(e.classList.contains("out")||(e.classList.remove("in"),e.classList.add("out"),setTimeout(function(){e.style.right=t},300),n&&(n.style.display="none")))},dom.slideInFromLeft=function(e,t){e.classList.remove("out"),e.classList.add("in"),setTimeout(function(){e.style.left="0"},300),t&&(t.style.display="")},dom.slideOutToLeft=function(e,t,n){e.classList.contains("in")&&(e.classList.contains("out")||(e.classList.remove("in"),e.classList.add("out"),setTimeout(function(){e.style.left=t},300),n&&(n.style.display="none")))},dom.toggle=function(e,t){if(Array.isArray(t))for(var n=0;n<t.length;n++)dom.toggle(e,t[n]);else t.classList.contains(e)?t.classList.remove(e):t.classList.add(e)},dom.exclusive=function(e,t,n){var i,r=n.querySelectorAll(t.tagName+"."+e),a=_createForOfIteratorHelper(r);try{for(a.s();!(i=a.n()).done;){i.value.classList.remove(e)}}catch(e){a.e(e)}finally{a.f()}t.classList.add(e)},dom.delayTo=function(e){clearTimeout(dom.timeoutDelayTo),dom.timeoutDelayTo=setTimeout(function(){},600)},dom.value=function(e,t){var n=document.querySelector(e);return t?void(n.value=t):n.value.trim()},dom.empty=function(e){var t=document.querySelector(e);t.value?t.value="":t.innerHTML=""},dom.valid=function(e){var t=document.querySelector(e);return void 0!==t.value&&null!=t.value&&""!=t.value.trim()},dom.create=function(e){for(var t=Array.prototype.slice.call(arguments,1),n=document.createElement(e),i=0;i<t.length;i++)n.classList.add(t[i]);return n},dom.fix=function(e){var t=null;t="string"==typeof e?document.querySelector(e):e;var n=t.getBoundingClientRect(),i=n.left,r=n.top,a=(n.width,n.height),o=(parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-top"))),s=parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-bottom")),d=(parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-top")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-bottom")),t.parentElement.parentElement),l=d.getBoundingClientRect(),c=parseInt(window.getComputedStyle(d,null).getPropertyValue("padding-left"));parseInt(window.getComputedStyle(d,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(d,null).getPropertyValue("padding-top")),parseInt(window.getComputedStyle(d,null).getPropertyValue("padding-bottom"));return t.style.position="absolute",t.style.top=r-l.top+"px",t.style.left=i-l.left+"px",t.style.width="calc(100% - "+2*c+"px )",{top:r-l.top,left:i-l.left,width:l.width-2*c,height:a+o+s}},dom.find=function(e,t){if(t=t||document,"string"!=typeof e)return e;var n=t.querySelectorAll(e);return 0==n.length?null:1==n.length?n[0]:n},dom.ancestor=function(e,t,n){var i=null;if(n=n||"",null==(i="string"==typeof e?document.querySelector(e):e))return null;t=t.toUpperCase();var r=i;if(""==n)for(;null!=r&&r.tagName!=t;)r=r.parentElement;else for(;null!=r&&(r.tagName!=t||!r.classList.contains(n));)r=r.parentElement;return r},dom.element=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},dom.bind=function(e,t,n){var i=null;null!=(i="string"==typeof e?document.querySelector(e):e)&&i&&i.addEventListener(t,n)},dom.model=function(e,t){var n=null;if(n="string"==typeof e?document.querySelector(e):e,void 0===t){var i={};return Array.prototype.slice.call(n.attributes).forEach(function(e){if(0==e.name.indexOf("data-model-"))if(0==e.value.indexOf("{"))try{i[utils.nameVar(e.name.slice("data-model-".length))]=JSON.parse(e.value)}catch(t){i[utils.nameVar(e.name.slice("data-model-".length))]=e.value}else i[utils.nameVar(e.name.slice("data-model-".length))]=e.value}),i}var r=Array.prototype.slice.call(arguments,2);if(0==r.length)for(var a in t)0!=a.indexOf("||")&&0!=a.indexOf("//")&&0!=a.indexOf(">>")&&("object"===_typeof(t[a])?n.setAttribute(utils.nameAttr(a),JSON.stringify(t[a])):n.setAttribute(utils.nameAttr(a),t[a]));else for(var o=0;o<r.length;o++){var s=r[o];0!=s.indexOf("||")&&0!=s.indexOf("//")&&0!=s.indexOf(">>")&&("object"===_typeof(t[s])?n.setAttribute(utils.nameAttr(s),JSON.stringify(t[s])):n.setAttribute(utils.nameAttr(s),t[s]))}},dom.collect=function(e,t){for(var n=[],i=document.querySelectorAll(e),r=0;r<i.length;r++){var a={};if(Array.isArray(t))for(var o=0;o<t.length;o++)a[t[o]]=i[r].getAttribute(utils.nameAttr(t[o]));else a[t]=i.getAttribute(utils.nameAttr(t[j]));n.push(a)}return n},dom.propagate=function(e,t,n,i){var r=i(t);if(Array.isArray(n))for(var a=0;a<n.length;a++)r.setAttribute(utils.nameAttr(n[a]),t[n[a]]);else r.setAttribute(utils.nameAttr(n),t[n]);e.appendChild(r)},dom.toggle2=function(e,t){for(var n=document.querySelectorAll(e),i=0;i<n.length;i++){n[i].addEventListener("click",function(){for(var e=this.getAttribute("data-toggle"),n=e.split(">>"),i=n[0].split("+"),r=n[1].split("+"),a=!1,o=0;o<i.length;o++){var s=i[o].trim();if(0==s.indexOf("."))a=this.classList.contains(s.substring(1));else{a=null!=this.querySelector(s)}}if(a){for(var d=0;d<r.length;d++){var l=r[d].trim();if(0===l.indexOf("."))this.classList.add(l.substring(1));else{this.querySelector(l.substring(0,l.indexOf("."))).classList.add(l.substring(l.indexOf(".")+1))}}for(var c=0;c<i.length;c++){var u=i[c].trim();if(0==u.indexOf("."))this.classList.remove(u.substring(1));else{this.querySelector(u).classList.remove(u.substring(u.indexOf(".")+1))}}}else{for(var p=0;p<i.length;p++){var h=i[p].trim();if(0==h.indexOf("."))this.classList.add(h.substring(1));else{this.querySelector(h.substring(0,h.indexOf("."))).classList.add(h.substring(h.indexOf(".")+1))}}for(var f=0;f<r.length;f++){var m=r[f].trim();if(0==m.indexOf("."))this.classList.remove(m.substring(1));else{this.querySelector(m).classList.remove(m.substring(m.indexOf(".")+1))}}t&&resovle(this)}})}},dom.switch=function(e,t){for(var n=dom.find(e),i=n.getAttribute("data-switch"),r=i.split("+"),a=n.querySelectorAll(r[0]),o=0;o<a.length;o++)!function(){var e=a[o];e.onclick=function(i){for(var a=n.querySelectorAll(r[0]),o=0;o<a.length;o++)a[o].classList.remove(r[1].substring(1));e.classList.add(r[1].substring(1)),t&&t(e)}}()},dom.tabs=function(e){var t=dom.find(e);if(null!=t)for(var n=t.getAttribute("data-tab-active-class"),i=0;i<t.children.length;i++)!function(){var e=t.children[i];e.addEventListener("click",function(i){for(var r=0;r<t.children.length;r++){t.children[r].classList.remove(n)}e.classList.add(n)})}()},dom.top=function(e){var t=null;if(null==(t="string"==typeof e?document.querySelector(e):e))return 0;var n=t.offsetTop;return void 0!==t.offsetParent&&(n+=dom.top(t.offsetParent)),n},dom.formdata=function(e,t){var n=null;if(n="string"==typeof e?document.querySelector(e):e,void 0===t){for(var i={},r={},a=n.querySelectorAll("input"),o=0;o<a.length;o++){var s=a[o],d=s.name,l=s.type,c=s.value;"text"==l||"number"==l||"password"==l||"hidden"==l?(i[d]=null,""!=c?-1!=d.indexOf("[]")?i[d]=[c]:i[d]=c:i[d]=""):"radio"==l?s.checked&&(i[d]=c):"checkbox"==l&&(void 0===r[d]&&(r[d]=0),s.checked&&(void 0===i[d]&&(r[d]=0,i[d]=[]),i[d].push(c)),r[d]+=1)}for(var u=n.querySelectorAll("select"),p=0;p<u.length;p++){var h=u[p],f=h.name;i[f]=null,-1!=h.selectedIndex?-1!=f.indexOf("[]")?i[f]=[h.value]:i[f]=h.value:i[f]=""}for(var m=n.querySelectorAll("textarea"),g=0;g<m.length;g++){var v=m[g],y=v.name;i[y]=null,i[y]=v.value}for(var b in r)-1==b.indexOf("[]")&&1==r[b]&&i[b]&&(i[b]=i[b][0]);for(var x in i)"string"==typeof i[x]&&0==i[x].indexOf("${")&&(i[x]=i[i[x].substring(2,i[x].length-1)]);return i}var w=function(e,t,n){var i=dom.find("[name='"+t+"']",e);if(null!=i){if(i.length>1&&"radio"==i[0].type){i.forEach(function(e,t){e.value===n?e.checked=!0:e.checked=!1})}"INPUT"==i.tagName?"check"==i.type||(i.value=n||""):"SELECT"==i.tagName?$("select[name='"+t+"']").val(n).trigger("change"):"TEXTAREA"==i.tagName&&(i.innerHTML=n)}};for(var C in t)if("object"===_typeof(t[C]))for(var S in t[C])w(n,C+"."+S,t[C][S]);else w(n,C,t[C])},dom.setAttribute=function(e,t,n){for(var i=document.querySelectorAll(e),r=0;r<i.length;r++)i[r][t]=n},dom.removeAttribute=function(e,t){for(var n=document.querySelectorAll(e),i=0;i<n.length;i++)n[i].removeAttribute(t)},dom.enable=function(e){for(var t=document.querySelectorAll(e),n=0;n<t.length;n++)t[n].disabled=!1},dom.disable=function(e){var t;t="string"==typeof e?document.querySelectorAll(e):e;for(var n=0;n<t.length;n++)t[n].disabled=!0},dom.index=function(e,t,n){var i;if(i="string"==typeof e?dom.find(e):e,n);else for(var r=i.getAttribute(t),a=i.parentElement.querySelectorAll(i.tagName),o=0;o<a.length;o++){var s=a[o],d=s.getAttribute(t);if(r==d)return o}return-1},dom.elementAt=function(e,t,n){for(var i=document.querySelectorAll(e),r=0;r<i.length;r++){var a=i[r];if(n==a.getAttribute(t))return{index:r,element:a}}return null},dom.elementAtTree=function(e,t,n,i,r){for(var a=document.querySelectorAll(e),o=0,s=0;s<a.length;s++){var d=a[s],l=d.getAttribute(t);if(r==d.getAttribute(n)&&(o++,i==l))return{index:o,element:d}}},dom.stack=function(e,t,n,i){var r=dom.create("a","btn","btn-link"),a=dom.create("i","fas","fa-caret-right","mr-1");r.appendChild(a),dom.bind(r,"click",function(){var a=dom.find("i",r);a.classList.contains("fa-caret-right")?(e.container.querySelectorAll("i.fa-caret-down").forEach(function(e){e.classList.remove("fa-caret-down"),e.classList.add("fa-caret-right")}),a.classList.remove("fa-caret-right"),a.classList.add("fa-caret-down"),e.stack(n,function(e){e.parentElement.classList.add("fade","fadeIn"),e.style.paddingLeft="50px",e.style.paddingRight="50px",setTimeout(function(){e.parentElement.classList.add("show")},200),i(e)})):(a.classList.remove("fa-caret-down"),a.classList.add("fa-caret-right"),t.parentElement.nextSibling.remove())})},dom.inner=function(e){var t=e.clientHeight,n=e.clientWidth,i=getComputedStyle(e);return{height:t-parseInt(i.paddingTop)-parseInt(i.paddingBottom),width:n-parseInt(i.paddingLeft)-parseInt(i.paddingLeft)}},dom.outer=function(e){var t=e.clientHeight,n=e.clientWidth,i=getComputedStyle(e);return{height:t+parseInt(i.marginTop)+parseInt(i.borderTop)+parseInt(i.marginBottom)+parseInt(i.borderBottom),width:n+parseInt(i.marginLeft)+parseInt(i.borderLeft)+parseInt(i.marginRight)+parseInt(i.borderRight)}},dom.height=function(e,t,n){t=t||0,void 0===n&&(n=dom.find("#container")),n=n||document.body;var i=null;i="string"==typeof e?document.querySelector(e):e;var r=dom.top(i),a=getComputedStyle(n,null),o=(parseInt(a.getPropertyValue("padding-top")),parseInt(a.getPropertyValue("padding-bottom")));a=getComputedStyle(i,null);parseInt(a.getPropertyValue("border-top-width")),parseInt(a.getPropertyValue("border-bottom-width"));i.style.marginBottom="0px",i.style.height=n.clientHeight-r-t-o+"px",i.style.overflowY="auto"},dom.height2=function(e,t,n){t=t||0,void 0===n&&(n=dom.find("#container")),n=n||document.body;var i=null;i="string"==typeof e?document.querySelector(e):e;var r=(dom.top(i),getComputedStyle(n,null)),a=parseInt(r.getPropertyValue("padding-top")),o=parseInt(r.getPropertyValue("padding-bottom"));r=getComputedStyle(i,null);var s=parseInt(r.getPropertyValue("border-top-width")),d=parseInt(r.getPropertyValue("border-bottom-width")),l=parseInt(r.getPropertyValue("border-top-width")),c=parseInt(r.getPropertyValue("border-bottom-width"));i.style.marginBottom="0px";var u=n.getBoundingClientRect();i.style.height=u.height-a-o-s-d-l-c-t+"px",i.style.overflowY="auto"},dom.autoheight=function(e,t,n){n=n||0;var i=dom.find(e);t=t||document.body;var r=t.getBoundingClientRect(),a=r.height;t===document.body&&(a=window.innerHeight);for(var o=i.parentElement,s=(o.getBoundingClientRect(),i.getBoundingClientRect()),d=(parseInt(o.offsetTop),s.top-r.top),l=0;o!==t;){var c=getComputedStyle(o);l+=parseInt(c.paddingBottom),l+=parseInt(c.marginBottom),l+=parseInt(c.borderBottomWidth),o=o.parentElement}var u=getComputedStyle(i);l+=parseInt(u.borderBottomWidth),i.style.height=a-l-n-d+"px",i.style.overflowY="auto"},dom.templatize=function(e,t){var n=Handlebars.compile(e),i=n(t);return dom.element(i)},dom.render=function(e,t,n){function i(e,t){var n=dom.find("[value='"+t+"']",e);null!=n&&(n.checked=!0)}function r(e,t,r){var a=dom.find("[name='"+t+"']",e);if(null!=a){"DIV"===a.nodeName&&n?r&&i(a,r):"INPUT"==a.tagName?"radio"==a.type||(a.value=r):"SPAN"==a.tagName?r&&(a.innerHTML=r):"SELECT"==a.tagName&&$("select[name='"+t+"']").val(r).trigger("change")}}var a=null;a="string"==typeof e?document.querySelector(e):e;for(var o in t)if("object"===_typeof(t[o]))for(var s in t[o])r(a,o+"."+s,t[o][s]);else r(a,o,t[o])},dom.popup=function(e,t){var n=dom.create("div","full-width","full-height","position-absolute");return n.style.background="transparent",dom.bind(n,"click",function(e){n.remove(),t.remove()}),document.body.appendChild(n),e.appendChild(t),n},dom.html=function(e){var t=dom.element("<div></div>");return t.appendChild(e),t.innerHTML},dom.init=function(e,t){if(t){var n=t.getAttribute("name");n&&""!=n||(n=t.getAttribute("widget-id")),n&&""!=n&&(e[n]=t);var i=t.getAttribute("widget-model-tooltip");i&&""!=i&&tippy(t,{content:i});for(var r=0;r<t.children.length;r++){var a=t.children[r];dom.init(e,a)}}},dom.makeUpload=function(e,t,n,i){t.onchange=function(e){t.files&&0!=t.files.length&&xhr.upload({url:"/api/v3/common/upload",params:_objectSpread(_objectSpread({},n),{},{file:t.files[0]}),success:function(e){e.data&&(e=e.data),i(e.webpath)}})},e.onclick=function(e){t.click()}},dom.exists=function(e,t,n){for(var i=0;i<e.length;i++){var r=e[i];if(dom.model(r)[n]===t[n])return!0}return!1};var NO_ERRORS=0,REQUIRED_ERROR=1,FORMAT_ERROR=2,INVALID_ERROR=3;String.prototype.trim||function(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(e,"")}}(),$.fn.validate=function(e){return Validation.validate(this,e)},Validation={validate:function(e,t){var n=[];void 0===e&&(e=$(document)),e=$(e),e.find("input[type!=checkbox][type!=radio][type!=button]").each(function(e,t){var i=$(t).val().trim(),r=Validation.getLabel(t),a=$(t).attr("data-required-message")?$(t).attr("data-required-message"):r+"必须填写！";Validation.isRequired(t)&&""===i&&n.push({element:t,message:a});var o=$(t).attr("data-domain-type");if(o){var a=r+"填写不合要求。",s=Validation.getDomainValidator(new ValidationModel(o));if(null!=s&&""!==i){var d=s.test(i);switch(d){case REQUIRED_ERROR:break;case FORMAT_ERROR:a=$(t).attr("data-format-message")?$(t).attr("data-format-message"):a;break;case INVALID_ERROR:a=$(t).attr("data-invalid-message")?$(t).attr("data-invalid-message"):a}d!=NO_ERRORS&&n.push({element:$(t),message:a})}}}),e.find("textarea").each(function(e,t){var i=$(t).val().trim(),r=Validation.getLabel(t),a=$(t).attr("data-required-message")?$(t).attr("data-required-message"):r+"必须填写！";Validation.isRequired(t)&&""===i&&n.push({element:t,message:a});var o=$(t).attr("data-domain-type");if(o){var a=r+"填写不合要求。",s=Validation.getDomainValidator(new ValidationModel(o));if(null!=s&&""!==i){var d=s.test(i);switch(d){case REQUIRED_ERROR:break;case FORMAT_ERROR:a=$(t).attr("data-format-message")?$(t).attr("data-format-message"):a;break;case INVALID_ERROR:a=$(t).attr("data-invalid-message")?$(t).attr("data-invalid-message"):a}d!=NO_ERRORS&&n.push({element:$(t),message:a})}}}),e.find("select").each(function(e,t){if(Validation.isRequired(t)&&("-1"==$(t).val()||""==$(t).val()||null==$(t).val())){var i=Validation.getLabel(t),r=i+"必须选择！";r=$(t).attr("data-required-message")?$(t).attr("data-required-message"):r,n.push({element:$(t),message:r})}});var i={};e.find("input[type=checkbox]").each(function(e,t){var n=$(t).attr("name");i[n]=n});for(var r in i){var a=!1,o=null,s=null;if(e.find('input[name="'+r+'"]').each(function(e,t){0==e&&(o=Validation.getLabel(t),s=t),!a&&$(t).prop("checked")&&(a=!0)}),!a&&Validation.isRequired(s)){var d=o+"必须选择！";d=$(s).attr("data-required-message")?$(s).attr("data-required-message"):d,n.push({element:$(s),message:d})}}var i={};e.find("input[type=radio]").each(function(e,t){var n=$(t).attr("name");i[n]=n});for(var r in i){var a=!1,o=null,s=null;if(e.find('input[name="'+r+'"]').each(function(e,t){0==e&&(o=Validation.getLabel(t),s=t),!a&&$(t).prop("checked")&&(a=!0)}),!1===a&&$(s).prop("required")){var d=o+"必须选择！";d=$(s).attr("data-required-message")?$(s).attr("data-required-message"):d,n.push({element:$(s),message:d})}}return e.find("input[remote]").each(function(e,t){var i=$(t).attr("remote"),r=$(t).val().trim();i&&""!=i&&""!=r&&$.ajax({url:i,method:"POST",data:"check="+r,success:function(e){var i=$.parseJSON(e);i.err&&n.push({element:$(t),message:i.msg})}})}),t&&t(n),n},getLabel:function(e){var t=$(e);return t.attr("label")||$(t).attr("data-required")||t.attr("name")||t.attr("id")},isRequired:function(e){var t=$(e);return!!t.prop("required")||("required"==t.attr("required")||void 0!==t.attr("data-required")&&""!=t.attr("data-required"))},getDomainValidator:function(e){var t=e.keyword.toLowerCase(),n=e,i=null;if("mail"===t||"email"===t)i=new Validation.Mail;else if("number"===t)i=new Validation.Number(n.symbol,n.args);else if("string"===t)i=new Validation.String(n.args);else if("mobile"===t)i=new Validation.Mobile;else if("range"===t)i=new Validation.Range(n.opts,n.args);else if("phone"===t)i=new Validation.Phone;else if("cmpexp"===t)i=new Validation.CmpExp(n.args[0],n.args[1]);else if("regexp"===t)i=new Validation.RegExp(n.args[0]);else if("remote"===t)i=new Validation.Remote(n.args[0]);else if("date"===t)i=new Validation.Date;else if("time"===t)i=new Validation.Time;else{if("datetime"!==t)throw new Error('not support for the domain("'+t+'")');i=new Validation.DateTime}return i},String:function(e){this.min=0,this.max=parseInt(e[0]),e.length>1&&(this.min=parseInt(e[0]),this.max=parseInt(e[1])),this.test=function(e){return e.length<this.min?FORMAT_ERROR:this.max&&e.length>this.max?FORMAT_ERROR:NO_ERRORS}},Number:function(e,t){var n=7;this.plus=-1,this.minus=-1,"-"===e?this.minus=0:"+"===e&&(this.plus=0),0!=this.minus&&0!=this.plus||(n+=1),this.precision=parseInt(t[0]),t.length>1&&(this.scale=parseInt(t[1])),this.test=function(e){if(0==this.plus){var t=/^\s*(\+)?((\d+(\.\d+)?)|(\.\d+))\s*$/;if(!t.test(e))return FORMAT_ERROR}else if(0==this.minus){var t=/^\s*(-)((\d+(\.\d+)?)|(\.\d+))\s*$/;if(!t.test(e))return FORMAT_ERROR}else{var t=/^\s*(\+)?((\d+(\.\d+)?)|(\.\d+))\s*$/;if(!t.test(e))return FORMAT_ERROR}var n=e.indexOf("."),i=-1==n?this.precision:this.precision+1;if(i=0==this.plus||0==this.minus?i+1:i,e.length>i)return FORMAT_ERROR;if(-1!=n&&this.scale){if(e.substring(n+1).length>this.scale)return FORMAT_ERROR}return NO_ERRORS}},Mail:function(){this.test=function(e){return/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(e)?NO_ERRORS:FORMAT_ERROR}},Phone:function(){this.test=function(e){return/^\d{11}$/i.test(e)?NO_ERRORS:FORMAT_ERROR}},Mobile:function(){this.test=function(e){return/^\d{11}$/i.test(e)?NO_ERRORS:FORMAT_ERROR}},Date:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){this.test=function(e){return/^\d{4}-\d{1,2}-\d{1,2}$/.test(e)?isNaN(Date.parse(e))?INVALID_ERROR:NO_ERRORS:FORMAT_ERROR}}),Time:function(){this.test=function(e){return/^\d{1,2}:\d{1,2}(:\d{1,2})?$/.test(e)?(e="1970-01-01 "+e,isNaN(Date.parse(e))?INVALID_ERROR:NO_ERRORS):FORMAT_ERROR}},DateTime:function(){this.test=function(e){return/^\d{4}-\d{1,2}-\d{1,2} \d{1,2}:\d{1,2}(:\d{1,2})?$/.test(e)?isNaN(Date.parse(e))?INVALID_ERROR:NO_ERRORS:FORMAT_ERROR}},RegExp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){this.re=new RegExp(e),this.test=function(e){return this.re.test(e)?NO_ERRORS:FORMAT_ERROR}}),CmpExp:function CmpExp(type,expr){this.model=new ValidationModel(type),this.expr=expr,this.ignore=!1;var self=this;this.test=function(str){var expr=this.expr,dt=Validation.getDomainValidator(this.model);if(dt.test(str)!=NO_ERRORS)return FORMAT_ERROR;if($("input[type!=checkbox][type!=radio][type!=button]").each(function(e,t){var n=$(t).attr("name"),i=$(t).val();-1!=expr.indexOf(n)&&(""==i&&(self.ignore=!0),expr=expr.replace(new RegExp(n,"g"),i))}),!this.ignore)try{if(!eval(expr))return INVALID_ERROR}catch(e){return INVALID_ERROR}return NO_ERRORS}},Remote:function(e){this.test=function(t){$.ajax({url:e+t,dataType:"json",success:function(e){e.error}})}},Range:function(e,t){this.min=parseFloat(t[0]),this.max=parseFloat(t[1]),this.test=function(t){var n=parseFloat(t.trim());if(isNaN(n))return INVALID_ERROR;var i=!1;return">"==e[0]?i=n>this.min:">="===e[0]&&(i=n>=this.min),i?("<"==e[1]?i=n<this.max:"<="===e[1]&&(i=n<=this.max),i?NO_ERRORS:INVALID_ERROR):INVALID_ERROR}}},ValidationModel=function(e){this.symbol="",this.keyword="",this.opts=[],this.args=[],this.unary_ops={"+":!0,"-":!0},this.keywords={string:!0,number:!0,range:!0,regexp:!0,mobile:!0,email:!0,phone:!0,cmpexp:!0};for(var t=0,n=e.length,i="";t<n;){var r=e.charAt(t);if(this.isUnaryOp(r)&&0==t)this.symbol=r;else if("["==r)if(""!=this.keyword)i+=r;else{if(!this.stringEqual("range",i))throw new Error('"[" is just available for range.');this.keyword=i,this.opts.push(">="),i=""}else"("==r?""!=this.keyword?(this.opts.push("("),i+=r):(this.keyword=i,this.opts.push(">"),i=""):"]"==r?(this.opts.push("<="),this.args.push(i),i=""):")"==r&&t==n-1?(this.args.push(i),this.opts.push("<"),i=""):")"==r?(this.opts.pop("<"),1==this.opts.length&&(i+=r)):","==r&&1==this.opts.length?(this.args.push(i),i=""):i+=r;t++}""==this.keyword&&(this.keyword=i)},ValidationModel.prototype={isKeyword:function(e){return this.keywords[e.toLowerCase()]},isUnaryOp:function(e){return this.unary_ops[e]},isDecimalDigit:function(e){return e>=48&&e<=57},isIdentifierStart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122},isIdentifierPart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57},stringEqual:function(e,t){return e.toLowerCase()===t.toLowerCase()}},$.fn.formdata=function(e){var t=this;if(void 0!==e){var n;n="string"==typeof e?$.parseJSON(e):e,$(this).find("input").each(function(e,t){$(this).val("")}),$(this).find("input[type=checkbox]").each(function(e,t){$(this).prop("checked",!1)}),$(this).find("textarea").each(function(e,t){$(this).val("")});var i=n;for(var r in i)!function(e){var n;t.find("[name="+e+"]").each(function(t,r){if("INPUT"!=(n=$(this)[0].nodeName)||"radio"!=$(this).attr("type")&&"checkbox"!=$(this).attr("type"))if("INPUT"!=n||"file"!=$(this).attr("type")&&"button"!=$(this).attr("type"))if("SELECT"==n){var a=!1;$(this).find("option").each(function(){var t=$(this);t.attr("value")==i[e]&&(t.prop("selected",!0),a=!0)}),a||$(this).val($($(this).find("option:first")).val()),$(this).val(null).trigger("change")}else"date"==$(this).attr("data-domain-type")?$(this).val(moment(i[e]).format("YYYY-MM-DD")):$(this).val(i[e]);else;else if(i[e].constructor==Array)for(var o=i[e],s=0;s<o.length;s++)$(this).val()==o[s]&&$(this).prop("checked",!0);else $(this).val()==i[e]&&$(this).prop("checked",!0)})}(r);return{}}var a={};return this.find("input[type!=checkbox][type!=radio][type!=button]").each(function(e,t){var n=$(t).attr("name");if(n){var i=n,r="",o=-1!=n.indexOf("[]"),s=n.indexOf("."),d=$(t).val();if(-1!=s&&(i=n.substr(0,s),r=n.substr(s+1,o?n.indexOf("[]")-i.length-1:n.length-i.length-1)),o)if(a[i]=a[i]||[],""!=r){var l={};l[r]=d,a[i].push(l)}else a[n].push(d);else if(""!=r){var c={};c[r]=d,a[i]=n}else a[n]=d}}),this.find("input[type=checkbox]").each(function(e,t){if($(t).prop("checked")){var n=$(t).attr("name");if(-1!=n.indexOf("[]")){var i=n,r="",o=i.indexOf(".");if(-1==o)a[i]=a[i]||[],a[i].push($(t).val());else{i=n.substr(0,o),r=n.substr(o+1,n.indexOf("[]")-i.length-1),a[i]=a[i]||[];var s={};s[r]=$(t).val(),a[i].push(s)}}else a[n]=$(t).val()}}),this.find("input[type=checkbox]").each(function(e,t){var n=$(t).attr("name");void 0===a[n]&&-1==n.indexOf("[]")&&(a[n]="")}),this.find("input[type=radio]").each(function(e,t){$(t).prop("checked")&&(a[$(t).attr("name")]=$(t).val())}),this.find("input[type=radio]").each(function(e,t){var n=$(t).attr("name");void 0===a[n]&&(a[n]="")}),this.find("select").each(function(e,t){if(""!=$(t).val()&&"-1"!=$(t).val()&&null!=$(t).val()){var n=$(t).attr("name"),i=$(t).val(),r=n,o="";if(void 0===n)return;var s=n.indexOf(".");if(-1!=s&&(r=n.substr(0,s),o=n.substr(s+1,n.length-r.length-1)),"object"===_typeof($(t).val()))a[$(t).attr("name")]=$(t).val().join(",");else if(""!=o){var d={};d[o]=i,a[r]=d}else a[n]=i}else $(t).val(),a[$(t).attr("name")]=""}),
this.find("textarea").each(function(e,t){""!=$(t).val()?a[$(t).attr("name")]=$(t).val():a[$(t).attr("name")]=""}),a},utils={},utils.append=function(e,t,n){var i=dom.create("div");i.style.height="100%",i.style.width="100%",n=n||!1;var r=document.createRange(),a=r.createContextualFragment(t);!1!==n&&(e.innerHTML=""),e.appendChild(i),i.appendChild(a);var o=dom.find("[id^=page]",i);return o?i.setAttribute("page-id",o.id):i.setAttribute("page-id","page.not.in.database"),{id:o?o.id:"",container:i}},utils.message=function(e){if(e||0!=e.length){for(var t="",n=0;n<e.length;n++)t+=e[n].message+"<br>";return t}},utils.prompt=function(e){if(e||0!=e.length)for(var t=0;t<e.length;t++)$(e[t].element).addClass("is-invalid")},utils.render=function(e,t,n){var i=document.getElementById(t).innerHTML,r=Handlebars.compile(i),a=r(n);document.getElementById(e).innerHTML=a},utils.assemble=function(e,t){if("object"===_typeof(e))for(var n in e){var i=e[n];"object"===_typeof(i)&&(e[n+"Id"]=i.id),"id"==n?e[t+"Id"]=i:"name"==n&&(e[t+"Name"]=i)}},utils.in=function(e){var t=e.split(" "),n=null,i=[];1==t.length?(n=document.getElementById(e),i.push(n)):(n=document.getElementById(t[0]),i=n.querySelectorAll(t[1]));for(var r=0;r<i.length;r++)n=i[r],n.addEventListener("animationend",function(){this.classList.remove("animated","fadeIn"),this.style.display="",this.removeEventListener("animationend",function(){}),this.removeEventListener("animationstart",function(){})}),n.classList.remove("fadeOut","hide"),n.classList.add("animated","fadeIn","show")},utils.out=function(e){var t=e.split(" "),n=null,i=[];1==t.length?(n=document.getElementById(e),i.push(n)):(n=document.getElementById(t[0]),i=n.querySelectorAll(t[1]));for(var r=0;r<i.length;r++)n=i[r],n.addEventListener("animationend",function(){this.classList.remove("animated","fadeOut"),this.removeEventListener("animationend",function(){})}),n.classList.remove("fadeIn","show"),n.classList.add("animated","fadeOut","hide")},utils.nameAttr=function(e){for(var t=[],n="",i=0;i<e.length;i++){var r=e.charAt(i);r==r.toUpperCase()?(t.push(n),n="",n+=r.toLowerCase()):n+=r}return""!=n&&t.push(n),"data-model-"+t.join("-")},utils.nameVar=function(e,t){if(t=t||"-",-1==e.indexOf(t))return e;for(var n=e.split(t),i="",r=0;r<n.length;r++){var a=n[r];i+=0==r?a:a.charAt(0).toUpperCase()+a.slice(1)}return i},utils.camelcase=function(e,t){if(-1==e.indexOf(t))return e;for(var n=e.split(t),i="",r=0;r<n.length;r++){var a=n[r];i+=0==r?a:a.charAt(0).toUpperCase()+a.slice(1)}return i},utils.pascalcase=function(e,t){if(-1==e.indexOf(t))return e.charAt(0).toUpperCase()+e.slice(1);for(var n=e.split(t),i="",r=0;r<n.length;r++){var a=n[r];i+=a.charAt(0).toUpperCase()+a.slice(1)}return i},utils.clone=function(e,t){e=e||{};for(var n in e)t[n]=e[n]},utils.get=function(e){for(var t=Array.prototype.slice.call(arguments,1),n={},i=0;i<t.length;i++)n[t[i]]=e[t[i]];return n},utils.isEmpty=function(e){var t=0;for(var n in e)t++;return 0==t},utils.isBlank=function(e){var t=0;for(var n in e)null!=e[n]&&""!==e[n]&&t++;return 0==t},utils.getParameter=function(e,t){t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),i=n.exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},utils.getParameters=function(e){if(-1==e.indexOf("?"))return{};var t={};e=e.substring(e.indexOf("?")+1);for(var n=e.split("&"),i=0;i<n.length;i++){var r=n[i].split("=");if(1==r.length)return{};t[r[0].trim()]=decodeURIComponent(r[1].trim())}return t},utils.isExisting=function(e,t,n){for(var i=0;i<e.length;i++)if(e[i][n]===t[n])return!0;return!1},utils.textSize=function(e,t){var n=document.createElement("canvas"),i=n.getContext("2d");i.font=t;var r=i.measureText(e);return n.remove(),{width:r.width,height:r.height}},utils.base64=function(e){return new Promise(function(t,n){var i=new FileReader;i.readAsDataURL(e),i.onload=function(){return t(i.result)},i.onerror=n})},utils.randomId=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyz",n=t.length,i=0,r=0;r<2;r++){for(i=0;i<6;)e+=t.charAt(Math.floor(Math.random()*n)),i+=1;e+="_"}return e.substring(0,e.length-1)},utils.camelcaseAttribute=function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),"id"!=t&&"name"!=t&&"type"!=t||(t=e+"_"+t),utils.camelcase(t,"_")},utils.nameAttribute=function(e,t,n){n=n||"";var i="",r="";return n.startsWith("&")&&(i=n.substring(1,n.indexOf("(")),r=n.substring(n.indexOf("(")+1,n.indexOf(")"))),e=e.toLowerCase(),t=t.toLowerCase(),""!==i&&(t=t===i?i+"_"+r:t+"_"+i+"_"+r),"id"!=t&&"name"!=t&&"type"!=t||(t=e+"_"+t),t},DataSheet.prototype.root=function(e){e=e||{};var t=this;this.table=dom.create("table","table","table-bordered");var n=dom.create("thead");this.tbody=dom.create("tbody");var i=dom.create("tr"),r=dom.create("th");r.style.borderBottomWidth="0",r.style.width=this.rowHeaderWidth+"px",n.appendChild(i),this.table.appendChild(n),this.table.appendChild(this.tbody);for(var a=0;a<this.columns.length;a++){var o=this.columns[a];r=dom.create("th","text-center"),r.style.borderBottomWidth="0",r.innerHTML=o.title,i.appendChild(r)}for(var s=0;s<this.rowCount;s++){var d=this.rowHeaders[s],l=dom.create("tr"),c=dom.create("td");c.innerHTML=d.title,c.style.fontWeight="bold",l.appendChild(c);for(var u=0;u<this.columnCount;u++){var p=this.columns[u];c=dom.create("td"),c.style.textAlign="right",c.style.padding="6px 12px",c.setAttribute("data-ds-format",p.format||""),c.setAttribute("data-ds-row",s),c.setAttribute("data-ds-column",u),c.addEventListener("focus",function(){}),e[d.title]&&e[d.title][p.title]?c.innerHTML=e[d.title][p.title]:c.innerHTML="",c.addEventListener("keyup",function(e){var n=this,i=parseInt(n.getAttribute("data-ds-row")),r=parseInt(n.getAttribute("data-ds-column")),a=null;if(13==e.keyCode)a=n;else if(37==e.keyCode){if(0==r)return;a=t.getCell(i,r-1)}else if(38==e.keyCode){if(0==i)return;a=t.getCell(i-1,r)}else if(39==e.keyCode){if(r==t.columnCount-1)return;a=t.getCell(i,r+1)}else if(40==e.keyCode){if(i==t.rowCount-1)return;a=t.getCell(i+1,r)}t.totalize(),null!=a&&(n.blur(),a.focus(),document.execCommand("selectAll",!1,null))}),l.appendChild(c)}this.tbody.appendChild(l)}if(this.totalColumns.length>0){var h=dom.create("tr"),f=dom.create("td");f.innerHTML="合计",f.style.fontWeight="bold",h.appendChild(f);for(var m=0;m<this.columnCount;m++)f=dom.create("td"),h.appendChild(f);this.tbody.appendChild(h)}return this.totalize(),this.table},DataSheet.prototype.getCell=function(e,t){for(var n=dom.find("tbody",this.table),i=null,r=0;r<n.children.length;r++){var a=n.children[r];if(r==e){for(var o=1;o<a.children.length;o++)if(o-1==t){i=a.children[o];break}break}}return i},DataSheet.prototype.render=function(e,t){var n=this;this.container=dom.find(e),this.container.innerHTML="";for(var i=dom.element('\n    <table class="table table-bordered">\n      <thead></thead>\n      <tbody></tbody>\n    </table>\n  '),r=dom.find("thead",i),a=dom.find("tbody",i),o=(this.rowHeaderRowCount,this.colHeaderRowCount,[]),s=0;s<this.colHeaderRowCount;s++){var d=dom.create("tr");o.push(d),r.appendChild(d)}for(var l=0;l<this.colHeaderRowCount;l++)for(var c=o[l],u=0;u<this.colHeaderColumnCount;u++){var p=this.matrixColumn[l][u];if(null!=p){var h=dom.create("th","text-center");h.style="border-bottom-width: 1px;",h.setAttribute("colspan",this.getSpanColumnCount(p)),h.innerHTML=p.title,c.appendChild(h)}}for(var f=0;f<this.rowHeaderRowCount;f++){for(var m=dom.create("tr"),g=0;g<this.rowHeaderColumnCount;g++)!function(){var e=n.matrixRowHeader[_j3][f];if(null==e)return 1;var t=dom.create("td");t.style="vertical-align: middle;",t.setAttribute("rowspan",n.getSpanRowCount(e)),t.innerHTML="<strong>"+e.title+"</strong>",n.onRowHeaderClicked&&(t.onclick=function(e){var i=Array.prototype.slice.call(t.parentElement.children);n.onRowHeaderClicked(t,i.indexOf(t))}),m.appendChild(t)}();for(var v=0;v<this.colHeaderColumnCount-this.rowHeaderColumnCount;v++)!function(){var e=dom.create("td");e.style.textAlign="right",e.style.padding="6px 12px",n.onCellClicked&&(e.onclick=function(t){var i=Array.prototype.slice.call(e.parentElement.children);n.onCellClicked(e,i.indexOf(e))}),m.appendChild(e)}();a.appendChild(m)}this.container.appendChild(i)},DataSheet.prototype.getValues=function(){for(var e={},t=0;t<this.rowHeaders.length;t++){var n=this.rowHeaders[t];e[n.title]={};for(var i=0;i<this.columns.length;i++){var r=this.columns[i];e[n.title][r.title]=this.tbody.rows[t].cells[i+1].innerText.trim()}}return e},DataSheet.prototype.totalize=function(){if(0!=this.totalColumns.length)for(var e=this.tbody.children[this.tbody.children.length-1],t=0;t<this.columns.length;t++){var n=this.columns[t];if(!0===n.totalable){for(var i=0,r=!1,a=0;a<this.rowHeaders.length;a++){var o=parseFloat(this.tbody.rows[a].cells[t+1].innerText.trim());isNaN(o)||(i+=o,r=!0)}isNaN(i)||!0!==r||(e.cells[t+1].innerText=i.toFixed(2))}}},DataSheet.prototype.buildColumnMatrix=function(e,t,n){if(e){var i;t[n]?i=t[n]:(i=[],t.push(i));for(var r=0;r<e.length;r++){var a=e[r];i.push(a);for(var o=this.getSpanColumnCount(a),s=1;s<o;s++)i.push(null);this.buildColumnMatrix(a.children,t,n+1)}}},DataSheet.prototype.buildRowHeaderMatrix=function(e,t,n){if(e){var i;t[n]?i=t[n]:(i=[],t.push(i));for(var r=0;r<e.length;r++){var a=e[r];i.push(a);for(var o=this.getSpanRowCount(a),s=1;s<o;s++)i.push(null);this.buildRowHeaderMatrix(a.children,t,n+1)}}},DataSheet.prototype.getSpanColumnCount=function(e){var t=0;if(!e.children||0==e.children.length)return 1;for(var n=0;n<e.children.length;n++)t+=this.getSpanColumnCount(e.children[n]);return t},DataSheet.prototype.getSpanRowCount=function(e){return e.children&&0!=e.children.length?e.children.length:1},DataSheet.prototype.getRowCount=function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];t+=1,i.children&&(t+=this.getRowCount(i.children))}return t},DataSheet.prototype.getColumnCount=function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];t+=1,i.children&&(t+=this.getColumnCount(i.children))}return t},DataSheet.prototype.getColumnHeaderRowCount=function(e){for(var t=1,n=0;n<e.length;n++){var i=1,r=e[n];r.children&&(i+=this.getColumnHeaderRowCount(r.children)),i>t&&(t=i)}return t},DataSheet.prototype.getRowHeaderRowCount=function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];i.children?t+=this.getRowHeaderRowCount(i.children):t+=1}return t},DataSheet.prototype.getColumnHeaderColumnCount=function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];i.children?t+=this.getColumnHeaderColumnCount(i.children):t+=1}return t},DataSheet.prototype.getRowHeaderColumnCount=function(e){for(var t=1,n=0;n<e.length;n++){var i=1,r=e[n];r.children&&(i+=this.getRowHeaderColumnCount(r.children)),i>t&&(t=i)}return t},Tabs.prototype.loadPage=function(e,t,n,i){var r=dom.find('div[data-tab-content-id="'.concat(e,'"]'));null==r?(r=dom.templatize('<div data-tab-content-id="{{id}}"></div>',{id:e}),this.content.appendChild(r)):r.innerHTML="",void 0!==t&&ajax.view({url:t,containerId:r,success:i||function(){}}),!0===n&&(r.style.display="none")},Tabs.prototype.reload=function(e){for(var t=this,n=0,i=this.navigator.children[n],r=1;r<this.navigator.children.length;r++){var a=this.navigator.children[r];if(a.classList.contains(this.tabActiveClass)){n=r-1,i=a;break}}this.loadPage(i.getAttribute("data-tab-id"),i.getAttribute("data-tab-url"),!1,function(e){t.tabs[n].success(e)})},Tabs.prototype.render=function(){var e=this,t=this;this.content&&(this.content.innerHTML=""),this.navigator.innerHTML="",this.slider=dom.element('<div class="slider position-absolute"></div>'),this.navigator.appendChild(this.slider),this.tabs.forEach(function(n,i){n.style=n.style||"padding: 0 16px;",n.style?n.style=n.style:n.style+="min-width: "+(16*n.text.length+32)+"px;text-align: center;";var r=dom.templatize('\n      <div class="nav-item font-weight-bold mr-0 pointer" style="{{style}}"\n           data-tab-url="{{{url}}}"\n           data-tab-id="{{{id}}}" >{{{text}}}</div>\n    ',n);t.navigator.appendChild(r),dom.bind(r,"click",function(i){if(!r.classList.contains(t.tabActiveClass)){for(var a=0;a<t.navigator.children.length;a++){t.navigator.children[a].classList.remove(t.tabActiveClass)}if(t.content)for(var o=0;o<t.content.children.length;o++)t.content.children[o].style.display="none";t.activate(r),!0===e.autoClear&&(e.content.innerHTML="");var s=dom.find('div[data-tab-content-id="'+r.getAttribute("data-tab-id")+'"]',t.content);if(null!=s)s.style.display="";else if(n.onClicked)n.onClicked(i);else{var d=r.getAttribute("data-tab-id"),l=r.getAttribute("data-tab-url");t.loadPage(d,l,!1,n.success)}}}),!0===t.lazy?0==i&&(t.activate(r),n.onClicked?n.onClicked():t.loadPage(n.id,n.url,!1,n.success)):0==i?(t.activate(r),n.onClicked?n.onClicked():t.loadPage(n.id,n.url,!1,n.success)):n.onClicked?n.onClicked():t.loadPage(n.id,n.url,!0,n.success)})},Tabs.prototype.activate=function(e){e.classList.add(this.tabActiveClass),this.slider.style.width=e.clientWidth+"px",this.slider.style.left=e.offsetLeft+"px"},PaginationGrid.prototype.root=function(){var e=dom.element('\n    <div class="card">\n      <div class="card-body">\n        <div class="row" style="margin-left: -5px; margin-right: -5px;"></div>\n      </div>\n    </div>\n  ');return this.rootBody=e.children[0].children[0],1==this.borderless&&(e.classList.add("b-a-0","mb-0"),e.children[0].classList.add("p-0")),e},PaginationGrid.prototype.request=function(e){var t=this;if(e=e||{},this.favourite){dom.find("a[widget-id=toggleFavourite] i",this.container).classList.contains("fas")?e._favourite="true":e._favourite="false"}if(this.widgetFilter){var n=this.widgetFilter.getQuery();for(var i in n)e[i]=n[i]}if(this.queryFilter){var r=this.queryFilter.getValues();for(var a in r)e[a]=r[a]}for(var o in this.filters)e[o]=this.filters[o];e.start=this.start,e.limit=this.limit,xhr.post({url:this.url,usecase:this.usecase,data:e,success:function(e){t.total=e.total;var n=e.data;if(n){if(t.rootBody.innerHTML="",t.showPageNumber(),0==n.length){return void(t.rootBody.innerHTML='<div class="text-center pt-4 full-width">  <img width="48" height="48" src="/img/kui/nodata.png" class="mb-2" style="opacity: 25%;">  <p style="opacity: 40%; color: black;">没有匹配的数据</p></div>')}for(var i=0;i<n.length;i++){var r=n[i];t.addRow(r,i)}t.addMore()}}})},PaginationGrid.prototype.addRow=function(e,t){var n=dom.create("div","col-md-"+this.colspan);this.rootBody.appendChild(n),this.onRender(n,e,t)},PaginationGrid.prototype.replaceRow=function(e,t){if(this.rootBody.children[t]){var n=this.rootBody.children[t];n.innerHTML="",this.onRender(n,e,t)}},PaginationGrid.prototype.addMore=function(){var e=this;if(this.start/this.limit+1!=this.lastPageNumber()){var t=this.rootBody.children[this.rootBody.children.length-1];if(t){var n=dom.element('\n    <div>\n      <div class="card b-a-0">\n        <div class="card-body">\n          <a class="btn text-secondary font-56 position-absolute" style="top: calc(50% - 45px); left: calc(50% - 41px);">\n            <i class="fas fa-ellipsis-h"></i>\n          </a>\n        </div>\n      </div>\n    </div>\n  ');dom.bind(dom.find("a",n),"click",function(t){e.next()});var i=t.getBoundingClientRect().height;n.classList.add(t.classList),n.children[0].children[0].style.height=i-15+"px",this.rootBody.appendChild(n)}}},PaginationGrid.prototype.render=function(e,t){this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="";var n=this.root();this.container.appendChild(this.actionbar()),this.container.appendChild(n),this.container.appendChild(this.pagination());var i=dom.top(this.container);n.style.height="calc(100% - 20px - "+i+"px)",t=t||{},this.request(t)},PaginationGrid.prototype.actionbar=function(){var e=this,t=$('<div class="full-width d-flex overflow-hidden" style="height: 26px;"></div>');this.queryFilter?t.append(this.queryFilter.getRoot()):t.append(dom.element('<div class="full-width"></div>'));var n=t.get(0);if(this.favourite){var i=dom.element('<a widget-id="toggleFavourite" class="card-header-action text-yellow">\n  <i class="far fa-star position-relative font-16" style="top: 4px;"></i>\n</a>');n.appendChild(i),dom.bind(i,"click",function(){var t=dom.find("i",i);t.classList.contains("far")?(t.classList.remove("far"),t.classList.add("fas"),e.go(1,{_favourite:"true"})):(t.classList.remove("fas"),t.classList.add("far"),e.go(1,{_favourite:"false"}))})}if(this.widgetFilter){var r=dom.create("div","card","widget-query","fade","fadeIn");this.widgetFilter.render(r),this.container.appendChild(r);var a=dom.element('<a widget-id="toggleFilter" class="card-header-action text-primary">\n  <i class="fas fa-filter position-relative" style="top: 4px;"></i>\n</a>');dom.bind(a,"click",function(){var e=r;e.classList.contains("show")?e.classList.remove("show"):e.classList.add("show")})}if(this.group){var o=dom.element('<a widget-id="toggleGroup" class="card-header-action">\n  <i class="fas fa-bars"></i>\n</a>');n.appendChild(o)}if(this.sort){var s=dom.element('<a widget-id="toggleSort" class="card-header-action">\n  <i class="fas fa-sort-amount-down-alt position-relative" style="top: 4px; font-size: 17px;"></i>\n</a>');n.appendChild(s)}var d=dom.element('<a widget-id="toggleFilter" class="card-header-action text-primary ml-2">\n  <i class="fas fa-sync-alt position-relative" style="top: 3px;"></i>\n</a>');return dom.bind(d,"click",function(){e.request()}),n.appendChild(d),t.get(0)},PaginationGrid.prototype.pagination=function(){var e=this,t=dom.create("div","full-width","d-flex");t.style.top="0",t.style.overflow="hidden",t.style.zIndex=900;var n=dom.create("ul","pagination","mb-0");n.style.marginLeft="auto",this.firstPage=dom.create("li","page-item");var i=dom.create("a","page-link","b-a-0","pt-0","font-14");return i.setAttribute("href","javascript:void(0)"),i.style.paddingBottom="0px",i.style.lineHeight="32px",i.style.height="32px",i.innerHTML='<i class="material-icons">first_page</i>',dom.bind(i,"click",function(){e.go(1)}),this.firstPage.appendChild(i),n.appendChild(this.firstPage),this.prevPage=dom.create("li","page-item"),i=dom.create("a","page-link","b-a-0","pt-0","font-14"),i.setAttribute("href","javascript:void(0)"),i.style.paddingBottom="0px",i.style.lineHeight="32px",i.style.height="32px",i.innerHTML='<i class="material-icons">chevron_left</i>',dom.bind(i,"click",function(){e.prev()}),this.prevPage.appendChild(i),n.appendChild(this.prevPage),li=dom.create("li","page-item","disabled"),li.style.paddingTop="4px",this.pagebar=dom.create("a","page-link","b-a-0","pt-0","font-14"),this.pagebar.setAttribute("href","javascript:void(0)"),this.pagebar.style.cursor="default",this.pagebar.style.paddingBottom="0px",this.pagebar.innerText="0/0",li.appendChild(this.pagebar),n.appendChild(li),this.nextPage=dom.create("li","page-item"),i=dom.create("a","page-link","b-a-0","pt-0","font-14"),i.setAttribute("href","javascript:void(0)"),i.style.paddingBottom="0px",i.style.lineHeight="32px",i.style.height="32px",i.innerHTML='<i class="material-icons">chevron_right</i>',dom.bind(i,"click",function(){e.next()}),this.nextPage.appendChild(i),n.appendChild(this.nextPage),this.lastPage=dom.create("li","page-item"),i=dom.create("a","page-link","b-a-0","pt-0","font-14"),i.setAttribute("href","javascript:void(0)"),i.style.paddingBottom="0px",i.style.lineHeight="32px",i.style.height="32px",i.innerHTML='<i class="material-icons">last_page</i>',dom.bind(i,"click",function(){e.go(e.lastPageNumber())}),this.lastPage.appendChild(i),n.append(this.lastPage),this.limit>0&&t.appendChild(n),t},PaginationGrid.prototype.lastPageNumber=function(){return 0==this.total||-1==this.limit?1:0==this.total%this.limit?parseInt(this.total/this.limit):parseInt(this.total/this.limit+1)},PaginationGrid.prototype.prev=function(){this.start<=0||this.go((this.start-this.limit)/this.limit+1)},PaginationGrid.prototype.next=function(){this.start+this.limit>=this.total||this.go((this.start+this.limit)/this.limit+1)},PaginationGrid.prototype.go=function(e,t){e<=0||e>this.lastPageNumber()||(this.start=this.limit*(e-1),this.request(t))},PaginationGrid.prototype.showPageNumber=function(){var e=this.start/this.limit+1,t=this.lastPageNumber(),n=this.total;t=t||0,n=n||0,this.limit<=0||(this.pagebar.innerHTML=e+"/"+t+"&nbsp;&nbsp;共"+n+"条记录",this.firstPage.classList.remove("disabled"),this.prevPage.classList.remove("disabled"),this.nextPage.classList.remove("disabled"),this.lastPage.classList.remove("disabled"),1==e&&(this.firstPage.classList.add("disabled"),this.prevPage.classList.add("disabled")),e==this.lastPageNumber()&&(this.nextPage.classList.add("disabled"),this.lastPage.classList.add("disabled")))},PaginationGrid.skeleton=function(){return dom.element('\n    <div style="display: flex; flex-wrap: wrap; margin: 0px -8px; width: 100%;">\n      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">\n        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">\n        </div>\n      </div>\n      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">\n        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">\n        </div>\n      </div>\n      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">\n          <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">\n          </div>\n      </div>\n      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">\n        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">\n        </div>\n      </div>\n      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">\n        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">\n        </div>\n      </div>\n      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">\n        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">\n        </div>\n      </div>\n      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">\n        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">\n        </div>\n      </div>\n      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">\n        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">\n        </div>\n      </div>\n      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">\n        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">\n        </div>\n      </div>\n      <div style="flex-basis: 25%; margin-bottom: 24px; padding: 0px 8px;">\n        <div style="background-color: rgba(0, 0, 0, 0.3); border-radius: 2px; height: 80px; width: 100%;">\n        </div>\n      </div>\n    </div>\n  ')},Timeline.prototype.createTile=function(e,t){var n=dom.element('\n    <li class="timeline-item">\n      <div class="time"></div>\n      <div class="small text-muted"></div>\n      <p></p>\n    </li>\n  '),i=n.children[0],r=n.children[1],a=n.children[2];if(this.fnTitle){var o=this.fnTitle(e,t);void 0===o?i.innerHTML="":"string"==typeof o||"number"==typeof o?i.innerHTML=o:i.appendChild(o)}if(this.fnSubtitle){var s=this.fnSubtitle(e,t);void 0===s?r.innerHTML="":"string"==typeof s||"number"==typeof s?r.innerHTML=s:r.appendChild(s)}if(this.fnContent){var d=this.fnContent(e,t);void 0===d?a.innerHTML="":"string"==typeof d||"number"==typeof d?a.innerHTML=d:a.appendChild(d)}return n},Timeline.prototype.render=function(e,t){var n=this;this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="",t=t||{};var i=dom.create("ul","timeline-simple");this.container.appendChild(i);var r={};if(utils.clone(this.params,r),utils.clone(t,r),this.url)xhr.post({url:this.url,params:r,success:function(e){if(e.data)for(var t=e.data,r=0;r<t.length;r++)i.appendChild(n.createTile(t[r],r))}});else for(var a=0;a<n.data.length;a++)i.appendChild(n.createTile(n.data[a],a));n.onComplete&&n.onComplete()},ListView.prototype.fetch=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},t=t||{},utils.clone(this.params,n),utils.clone(t,n),i=this,!this.url){e.next=13;break}return this.data=this.data||{},this.data.start=this.start,this.data.limit=this.limit,e.next=11,xhr.promise({url:this.url,params:n});case 11:r=e.sent,Array.prototype.push.apply(i.local,r);case 13:0==i.local.length?this.emptyHtml&&(this.contentContainer.innerHTML=this.emptyHtml):i.append(this.local);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),ListView.prototype.render=function(e,t){var n=this;this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="";var i=this.height-37;if(this.onFilter){var r=dom.element('\n      <div class="input-group position-sticky" style="top: 0; left: 0; z-index: 10;">\n        <div class="input-group-prepend">\n          <span class="input-group-text" style="border-bottom-left-radius: unset;">\n            <i class="fas fa-search"></i>\n          </span>\n        </div>\n        <input class="form-control" placeholder="搜索..."  style="border-bottom-right-radius: unset;">\n        <div class="input-group-append">\n          <span class="input-group-text pointer text-primary" style="border-bottom-right-radius: unset;">\n            <i class="fas fa-plus"></i>\n          </span>\n          <span class="input-group-text" style="border-bottom-right-radius: unset;">\n            <i class="fas fa-question icon-general"></i>\n          </span>\n          <span class="input-group-text" style="border-bottom-right-radius: unset;">\n            <i class="fas fa-asterisk icon-required"></i>\n          </span>\n        </div>\n      </div>\n    '),a=dom.find("input",r);dom.bind(a,"input",function(e){clearTimeout(n.delayToSearch),n.delayToSearch=setTimeout(function(){n.onFilter(n,a.value)},500)}),this.required||r.children[2].children[2].remove(),this.tooltip||r.children[2].children[1].remove(),this.onAdd||r.children[2].children[0].remove(),0==r.children[2].children.length&&r.children[2].remove(),this.container.appendChild(r)}this.contentContainer=dom.create("div","full-width");var o=dom.create("ul","list-group","full-width","overflow-hidden");if(this.borderless&&o.classList.add("b-a-0"),this.onFilter){var s=dom.create("div");s.style.height=i+"px",s.style.overflowY="auto",s.style.border="1px solid rgba(0, 0, 0, 0.125)",s.style.borderTop="",s.appendChild(o),this.contentContainer.appendChild(s)}else this.contentContainer.appendChild(o);this.container.appendChild(this.contentContainer),!1!==t&&!0!==this.lazy&&this.reload()},ListView.prototype.reload=function(e){e=e||{},dom.find("ul",this.container).innerHTML="",this.start=0,this.url&&(this.local=[]),this.fetch(e)},ListView.prototype.load=function(){this.start=this.local.length,this.fetch()},ListView.prototype.remove=function(e){if(this.idField)for(var t=dom.find("ul",this.container),n=0;n<t.children.length;n++){var i=t.children[n],r=dom.model(i);r[this.idField]===e[this.idField]&&i.remove()}},ListView.prototype.append=function(e,t){var n=this,i=this,r=this.container.querySelector("ul");null==r&&(this.container.innerHTML="",r=dom.create("ul","list-group","full-width"),this.container.appendChild(r));var a=r.querySelectorAll("li").length;if(Array.isArray(e)){for(var o=e,s=0;s<o.length;s++)this.append(o[s]);i.complete&&i.complete(e)}else{var d=e;if(this.idField)for(var l=0;l<r.children.length;l++){var c=r.children[l],u=dom.model(c);if(u[this.idField]===d[this.idField])return}var p=dom.create("li","list-group-item");!1!==this.hoverable&&p.classList.add("list-group-item-action"),!0===this.activateable&&dom.bind(p,"click",function(e){for(var t=0;t<p.parentElement.children.length;t++){p.parentElement.children[t].classList.remove("active")}p.classList.add("active")});for(var h=0;h<this.itemClass.length;h++)p.classList.add(this.itemClass[h]);this.borderless&&p.classList.add("b-a-0"),this.onClick&&dom.bind(p,"click",this.onClick),p.style.paddingLeft="16px",p.style.paddingRight="16px",p.style.paddingTop="8px",p.style.paddingBottom="8px",p.style.display="flex",p.style.alignItems="center",this.onFilter&&(p.style.borderLeftWidth="0",p.style.borderRightWidth="0",p.style.borderBottomWidth="0");var f=this.create(a,d,p);if(f.style.width="100%",this.onCheck){for(var m=dom.element('\n        <input class="pointer checkbox color-info is-outline mr-2" type="checkbox">\n      '),g=0;g<this.selections.length;g++)if(this.compare(this.selections[g],d)){m.setAttribute("checked",!0);break}dom.bind(m,"change",function(){i.onCheck(this.checked,dom.model(this),this)}),dom.model(m,d),p.appendChild(m)}if(p.appendChild(f),this.slidingActions.length>0){this.actionElements=[];for(var v=0;v<this.slidingActions.length;v++){var y=this.slidingActions[v];y.width=parseInt(y.width||64),p.appendChild(y.create())}dom.bind(p,"touchstart",function(e){n.touchStartX=e.touches[0].screenX,n.touchStartY=e.touches[0].screenY}),dom.bind(p,"touchmove",function(e){n.touchMoveX=e.touches[0].screenX,n.touchMoveY=e.touches[0].screenY;var t=n.touchStartX-n.touchMoveX,i=n.touchStartY-n.touchMoveY;if(!(Math.abs(t)<30||Math.abs(i)>30))if(t>0)for(var r=t/n.slidingActions.length,a=1;a<p.children.length;a++){var o=p.children[a].getBoundingClientRect();o.width>=n.slidingActions[a-1].width||(r>=n.slidingActions[a-1].width&&(r=n.slidingActions[a-1].width),p.children[a].style.minWidth=r+"px",p.children[a].style.display="")}else{t=-t/10;for(var s=t/n.slidingActions.length,d=1;d<p.children.length;d++){var l=p.children[d].getBoundingClientRect(),c=l.width-s;c=c<=5?0:c,0==c?(p.children[d].style.width="0",p.children[d].style.minWidth="unset"):p.children[d].style.minWidth=c+"px"}}}),dom.bind(p,"touchend",function(e){n.touchendX=e.changedTouches[0].screenX,n.touchendY=e.changedTouches[0].screenY;var t=n.touchStartX-n.touchendX,i=n.touchStartY-n.touchendY;Math.abs(t)<30||Math.abs(i)>30||(t>=30?n.expandSlidingActions(p):n.collapseSlidingActions(p))})}if(this.idField&&p.setAttribute("data-list-item-id",d[this.idField]),dom.model(p,d),"number"==typeof t?t<0?r.insertBefore(p,r.children[r.children.length+t]):r.insertBefore(p,r.children[t]):r.appendChild(p),this.onRemove){var b=dom.element('\n        <a class="btn text-danger float-right font-18" style="padding: 0; margin-left: auto;">\n          <i class="fas fa-times" style=""></i>\n        </a>\n      ');dom.bind(b,"click",function(e){e.stopPropagation(),i.onRemove(this.parentElement,dom.model(this.parentElement))}),dom.model(b,d),p.appendChild(b)}this.onReorder?this.setReorderable(p):this.draggable&&(p.setAttribute("draggable","true"),p.addEventListener("dragover",function(e){e.preventDefault()}),p.addEventListener("dragstart",function(e){}))}},ListView.prototype.setLocal=function(e){if(!e||0==e.length)return this.contentContainer.innerHTML="",void(this.emptyHtml&&(this.contentContainer.innerHTML=this.emptyHtml));this.contentContainer.innerHTML="";var t=dom.find("ul",this.contentContainer);if(null==t){var n=dom.create("ul","list-group","full-width");this.borderless&&n.classList.add("b-a-0");var i=dom.create("div"),r=this.height-37;i.style.height=r+"px",i.style.overflowY="auto",i.style.border="1px solid rgba(0, 0, 0, 0.125)",i.style.borderTop="",i.appendChild(n),this.contentContainer.appendChild(i)}else t.innerHTML="";var a,o=_createForOfIteratorHelper(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;this.append(s)}}catch(e){o.e(e)}finally{o.f()}},ListView.prototype.replace=function(e){for(var t=this.container.querySelector("ul"),n=0;n<t.children.length;n++){var i=t.children[n];if(dom.model(i)[this.idField]===e[this.idField]){dom.model(i,e),i.innerHTML="",i.appendChild(this.create(n,e));break}}},ListView.prototype.search=function(e){
for(var t=this.container.querySelector("ul"),n=0;n<t.children.length;n++){var i=t.children[n];-1!=i.innerText.indexOf(e)?i.style.display="":i.style.display="none"}},ListView.prototype.setReorderable=function(e){var t=this,n=dom.find("ul",this.container);n.addEventListener("dragover",function(e){e.preventDefault()}),n.ondrop=function(e){t.onReorder&&t.onReorder(dom.model(t.draggingElement),t.getItemIndex(t.draggingElement),t.draggingElementOriginalIndex),t.draggingElement.style.opacity="",t.draggingElement=null,t.clonedDraggingElement=null},e.setAttribute("draggable","true"),e.ondragover=function(e){var n=dom.ancestor(e.target,"li"),i=n.parentElement;if(n!=t.draggingElement){var r=t.getItemIndex(n);r<t.draggingElementIndex?i.insertBefore(t.draggingElement,n):r>t.draggingElementIndex&&(null==n.nextElementSibling?i.appendChild(t.draggingElement):i.insertBefore(t.draggingElement,n.nextElementSibling)),t.draggingElementIndex=r,e.preventDefault()}},e.ondragstart=function(e){var n=dom.ancestor(e.target,"li"),i=(n.parentElement,e.layerX,e.layerY);i=e.target.offsetTop+i,t.clonedDraggingElement=n.cloneNode(!0),t.draggingElement=n,t.draggingElement.style.opacity="0.3",t.draggingElementIndex=t.getItemIndex(n),t.draggingElementOriginalIndex=t.draggingElementIndex,e.dataTransfer.setData("id",n.getAttribute("data-list-item-id")),e.dataTransfer.setData("y",i)}},ListView.prototype.getItemIndex=function(e){for(var t=e.parentElement,n=0;n<t.children.length;n++)if(e==t.children[n])return n},ListView.prototype.setHeight=function(e){this.container.querySelector("ul").style.height=e+"px"},ListView.prototype.activate=function(e){for(var t=this.container.querySelector("ul"),n=0;n<t.children.length;n++)t.children[n].classList.remove("active");e.classList.add("active")},ListView.prototype.getCheckedValues=function(){if(!this.onCheck)return[];var e,t=this.container.querySelectorAll("input.checkbox"),n=[],i=_createForOfIteratorHelper(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(!0===r.checked){var a=dom.ancestor(r,"li");n.push(dom.model(a))}}}catch(e){i.e(e)}finally{i.f()}return n},ListView.prototype.expandSlidingActions=function(e){var t=this;if(!(e.children[1].getBoundingClientRect().width>=this.slidingActions[0].width.width)){var n=function(e){for(var n=1;n<e.children.length;n++){var i=e.children[n],r=i.getBoundingClientRect();r.width+5>=t.slidingActions[n-1].width?(i.style.minWidth=t.slidingActions[n-1].width+"px",clearInterval(t.interval4SlidingActions)):i.style.minWidth=r.width+5+"px"}};this.interval4SlidingActions=setInterval(function(){n(e)},5)}},ListView.prototype.collapseSlidingActions=function(e){var t=this;e.children[1].getBoundingClientRect().width<=0||(this.interval4SlidingActions=setInterval(function(){for(var n=1;n<e.children.length;n++){var i=e.children[n],r=i.getBoundingClientRect();r.width-5<=0?(i.style.width="0",i.style.minWidth="unset",i.style.display="none",clearInterval(t.interval4SlidingActions)):i.style.minWidth=r.width-5+"px"}},10))},ListView.prototype.subscribe=function(e,t){},Wizard.prototype.render=function(e,t){this.container=dom.find(e),this.body=dom.find("div.tab-content",this.root);for(var n=dom.find("div.steps",this.root),i=0;i<this.steps.length;i++){var r=this.steps[i],a=dom.element('\n      <div class="step" widget-on-render="" data-step="'.concat(i,'" style="cursor: pointer;">\n        <div class="content">\n          <div class="title"></div>\n          <div class="description"></div>\n        </div>\n      </div>\n    '));r.index=i,r.active&&(this.current=r),null==this.current&&a.classList.add("completed"),dom.find("div.title",a).innerHTML=r.title,dom.find("div.description",a).innerHTML=r.description,n.appendChild(a)}this.container.appendChild(this.root),this.display(this.current)},Wizard.prototype.display=function(e){var t=this,n=dom.find('div.step[data-step="'+e.index+'"]',this.root);n.classList.remove("completed"),n.classList.add("active");for(var i=!1,r=0;r<this.body.children.length;r++){var a=this.body.children[r];a.getAttribute("data-page-url")==e.url?(i=!0,a.classList.add("active")):a.classList.remove("active")}if(!i){var o=dom.create("div","tab-pane","active");this.body.appendChild(o),ajax.view({url:e.url,page:e.page,containerId:o,success:function(n){t.body.children[t.body.children.length-1].setAttribute("data-page-url",e.url)}})}},Wizard.prototype.commit=function(){var e=dom.find("div.step.active",this.root),t=parseInt(e.getAttribute("data-step"));e.classList.remove("active"),e.classList.add("completed"),this.display(this.steps[t+1])},Wizard.prototype.rollback=function(){var e=dom.find("div.step.active",this.container),t=parseInt(e.getAttribute("data-step"));e.classList.remove("active"),this.display(this.steps[t-1])},Chat.MESSAGE_TYPE_TEXT="TEXT",Chat.MESSAGE_TYPE_IMAGE="IMAGE",Chat.MESSAGE_TYPE_AUDIO="AUDIO",Chat.MESSAGE_TYPE_VIDEO="VIDEO",Chat.MESSAGE_TYPE_PATIENT="PATIENT",Chat.MESSAGE_TYPE_CUSTOM="CUSTOM",Chat.MESSAGE_STATUS_UNREAD="01",Chat.MESSAGE_STATUS_READ="02",Chat.MESSAGE_STATUS_REVOKE="90",Chat.prototype.init=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,a,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onInit();case 2:return n=this,this.scheduleName=t,i=this.userId+"@"+this.userType,e.next=7,xhr.promise({url:this.host+"/api/v3/common/script/tim/user_signature",params:{userId:i}});case 7:r=e.sent,a={SDKAppID:r.appId},this.tim=TIM.create(a),this.tim.setLogLevel(1),this.tim.registerPlugin({"tim-upload-plugin":TIMUploadPlugin}),this.tim.login({userID:i,userSig:r.signature}),this.tim.on(TIM.EVENT.SDK_READY,function(e){}),this.tim.on(TIM.EVENT.MESSAGE_RECEIVED,function(e){for(var t=0;t<e.data.length;t++){var n=e.data[t],i=Chat.MESSAGE_TYPE_TEXT,r=null;"TIMCustomElem"===n.type?(r=JSON.parse(n.payload.data).messageContent,r.imagepath?i=Chat.MESSAGE_TYPE_IMAGE:r.audiopath?i=Chat.MESSAGE_TYPE_AUDIO:r.archiveId&&(i=Chat.MESSAGE_TYPE_PATIENT)):r=n.payload.text,o.onMessageReceived({senderId:n.conversationID.substring(3),messageTime:moment(1e3*e.data[t].time).format("YYYY-MM-DD HH:mm"),messageType:i,messageContent:r})}});case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),Chat.prototype.getConversations=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,i,r,a,o,s,d,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId}});case 2:for(t=e.sent,n={},i=0;i<t.length;i++)r=t[i],a=r.senderId+"#"+r.senderType,n[a]?(o=n[a],o.createTime=r.createTime,o.messages.push(r)):(s={messages:[]},n[a]=s,s.id=a,s.createTime=r.createTime,s.name=r.senderType,s.senderId=r.senderId,s.senderType=r.senderType,s.messages.push(r));d=[];for(l in n)d.push(n[l]);return e.abrupt("return",d);case 8:case"end":return e.stop()}},e,this)})),Chat.prototype.fetchMessages=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i){var r,a,o,s,d,l,c,u,p,h,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,a="",a=t>this.userId?t+"&"+this.userId:this.userId+"&"+t,e.next=5,xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{conversationId:a,_order_by:"messageTime asc"}});case 5:for(o=e.sent,s=[],d=null,l=0;l<o.length;l++)c=o[l],u=moment(c.createTime).format("YYYY-MM-DD HH:mm"),u!=d&&(d=u,s.push({createTime:u,groupingMessages:[{direction:c.senderId==this.userId?"outgoing":"incoming",messages:[]}]})),p=s[s.length-1],h=p.groupingMessages[p.groupingMessages.length-1],f="",f=c.senderId==this.userId?"outgoing":"incoming",h.direction===f?h.messages.push(c):p.groupingMessages.push({direction:f,messages:[c]});return e.abrupt("return",s);case 10:case"end":return e.stop()}},e,this)}));return function(t,n,i){return e.apply(this,arguments)}}(),Chat.prototype.fetchUnreadMessages=function(){var e=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId,receiverType:this.userType}}).then(function(t){e.onUnreadMessages(t)})},Chat.prototype.sendMessage=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i,r,a){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=a||this.userId+"&"+t,"string"==typeof r&&(r=r.replace("\\","\\\\")),e.abrupt("return",xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/save",params:{conversationId:a,senderId:this.userId,senderType:this.userType,receiverId:t,receiverType:n,messageType:i,messageTime:"now",messageContent:r,createTime:"now",status:Chat.MESSAGE_STATUS_UNREAD,"||stdbiz/pim/conversation/merge":{conversationId:a,conversationName:a,unreadCount:1,lastConversationTime:"now"}}}));case 3:case"end":return e.stop()}},e,this)}));return function(t,n,i,r,a){return e.apply(this,arguments)}}(),Chat.prototype.sendTextMessage=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i,r){var a,o,s,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t+"@"+n,o=this,e.next=4,this.sendMessage(t,n,Chat.MESSAGE_TYPE_TEXT,i,r);case 4:return s=e.sent,d=this.tim.createTextMessage({to:a,conversationType:TIM.TYPES.CONV_C2C,payload:{id:s.conversationMessageId,text:i}}),e.abrupt("return",this.tim.sendMessage(d));case 7:case"end":return e.stop()}},e,this)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),Chat.prototype.sendImageMessage=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i,r){var a,o,s,d,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t+"@"+n,o=this,e.next=4,xhr.promise({url:this.host+"/api/v3/common/image",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:i.ext}});case 4:return s=e.sent,e.next=7,this.sendMessage(t,n,Chat.MESSAGE_TYPE_IMAGE,JSON.stringify({imagepath:s.filepath,thumbnail:s.thumbnail}),r);case 7:return d=e.sent,l=this.tim.createCustomMessage({to:a,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_IMAGE,messageContent:{id:d.conversationMessageId,imagepath:s.filepath,thumbnail:s.thumbnail}})}}),e.abrupt("return",this.tim.sendMessage(l));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),Chat.prototype.sendAudioMessage=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i,r){var a,o,s,d,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t+"@"+n,o=this,e.next=4,xhr.promise({url:this.host+"/api/v3/common/audio",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:"ogg"}});case 4:return s=e.sent,e.next=7,this.sendMessage(t,n,Chat.MESSAGE_TYPE_AUDIO,JSON.stringify({audiopath:s.filepath,duration:s.duration}),r);case 7:return d=e.sent,l=this.tim.createCustomMessage({to:a,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_AUDIO,messageContent:{id:d.conversationMessageId,audiopath:s.filepath,duration:s.duration}})}}),e.abrupt("return",this.tim.sendMessage(l));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),Chat.prototype.sendPatientMessage=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i,r){var a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t+"@"+n,e.next=3,this.sendMessage(t,n,Chat.MESSAGE_TYPE_PATIENT,JSON.stringify(i),r);case 3:return o=e.sent,i.id=o.conversationMessageId,s=this.tim.createCustomMessage({to:a,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_PATIENT,messageContent:i})}}),e.abrupt("return",this.tim.sendMessage(s));case 7:case"end":return e.stop()}},e,this)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),Chat.prototype.readMessages=function(e){var t=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{senderId:e,readTime:"now",status:Chat.MESSAGE_STATUS_READ}}).then(function(e){t.onReadMessages(e)})},Chat.prototype.revokeMessage=function(e){var t=this;return xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{messageId:e,status:Chat.MESSAGE_STATUS_REVOKE}}).then(function(n){t.onRevokeMessage(e)})},Chat.prototype.stop=function(){schedule.stop(this.scheduleName)},"undefined"!=typeof module&&(module.exports={Chat:Chat}),"undefined"!=typeof Handlebars&&Handlebars.registerHelper("ifeq",function(e,t,n){return e==t?n.fn(this):n.inverse(this)}),kuit={},kuit.main=function(e){var t=e.url,n=utils.getParameters(e.url);n=_objectSpread(_objectSpread({},n),e.params);var i=e.title||"",r=e.success;xhr.get({url:t,success:function(e){var t=document.createRange(),a=t.createContextualFragment(e);document.body.innerHTML="",document.body.appendChild(a),r&&r(i,a,n)}})},kuit.view=function(e){for(var t=dom.find("#container"),n=0;n<t.children.length;n++){var i=t.children[n].getAttribute("page-id");window[i].destroy&&window[i].destroy()}t.innerHTML="";var r=e.url,a=utils.getParameters(e.url);a=_objectSpread(_objectSpread({},a),e.params);var o=e.title||"",s=e.success;xhr.get({url:r,success:function(e){var n=null;t&&(n=utils.append(t,e,!1)),s&&s(o,n,a);var i=dom.element('\n        <li class="active">'.concat(o,"</li>\n      "));pageMain.navPage.innerHTML="",pageMain.navPage.appendChild(i),window[n.id].show(a),setTimeout(function(){i.classList.add("in"),window[n.id].page.classList.add("in")},100)}})},kuit.stack=function(e){var t=dom.find("#container"),n=e.url,i=utils.getParameters(e.url);i=_objectSpread(_objectSpread({},i),e.params);for(var r=e.title||"",a=e.success,o=0;o<t.children.length;o++){var s=t.children[o];"DIV"==s.tagName&&"true"!=s.getAttribute("data-stack-back")&&(s.style.display="none")}xhr.get({url:n,success:function(e){var n=null;t&&(n=utils.append(t,e,!1)),a&&a(r,n,i);for(var o=0;o<pageMain.navPage.children.length;o++){var s=pageMain.navPage.children[o],d=s.innerText;s.innerText="";var l=dom.element('<a href="#">'+d+"</a>");s.appendChild(l),s.removeAttribute("class"),dom.bind(l,"click",kuit.switch),s.style.transform="unset"}var c=dom.element('\n        <li class="active">'.concat(r,"</li>\n      "));pageMain.navPage.appendChild(c),setTimeout(function(){c.classList.add("in"),t.children[t.children.length-1].classList.add("out"),window[n.id].page.classList.add("in")},100),window[n.id].show(i)}})},kuit.switch=function(e){for(var t=dom.find("#container"),n=dom.ancestor(e.target,"li"),i=Array.prototype.slice.call(pageMain.navPage.children),r=i.indexOf(n),a=t.children.length-1;a>r;a--){var o=t.children[a],s=o.getAttribute("page-id");window[s].destroy&&window[s].destroy(),i[a].remove(),o.remove()}var d=n.innerText;n.classList.add("active"),n.innerHTML=d,t.children[r].style.display=""},kuit.rightbar=function(e){var t=dom.find(".rightbar"),n=dom.find("#overlay");t.classList.remove("out"),t.classList.add("in"),n.style.display="",n.onclick=function(e){t.classList.remove("in"),t.classList.add("out"),n.style.display="none"};var i=e.url;ajax.view({url:i,containerId:t,success:function(){e.success&&e.success()}})};
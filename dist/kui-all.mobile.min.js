function asyncGeneratorStep(e,t,n,i,r,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function asyncGeneratorStep(e,t,n,i,r,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,n,i,r,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function asyncGeneratorStep(e,t,n,i,r,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}function ListView(e){this.url=e.url,this.usecase=e.usecase,this.params=e.params||{},this.lazy=!0===e.lazy,this.hoverable=!1!==e.hoverable,this.activateable=!0===e.activateable,this.itemClass=e.itemClass||[],this.slidingActions=e.slidingActions||[],this.emptyHtml=e.emptyHtml||'\n    <div class="d-flex flex-wrap mt-2">\n      <img class="m-auto" src="/img/nodata.png" width="60%">\n      <div style="flex-basis: 100%; height: 0;"></div>\n      <div class="text-muted m-auto mt-2" style="font-weight: bold;">没有任何数据</div>\n    </div>\n  ',this.idField=e.idField,this.compare=e.compare||function(e,t){return!1},this.selections=e.selections||[],this.local=e.local||[],this.create=e.create||function(e,t){},this.complete=e.complete,this.draggable=!0===e.draggable,this.start=e.start||0,this.limit=e.limit||-1,this.borderless=e.borderless||!1,this.height=e.height,this.tooltip=e.tooltip,this.required=e.required||!1,this.onRemove=e.onRemove,this.onReorder=e.onReorder,this.onCheck=e.onCheck,this.onSelect=e.onSelect,this.onFilter=e.onFilter,this.onAdd=e.onAdd,this.onSearch=e.onSearch,this.onClick=e.onClick,this.observableItems=new rxjs.Observable}function asyncGeneratorStep(e,t,n,i,r,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}function GridView(e){this.columnCount=e.columnCount||2,this.local=e.local||[],this.url=e.url,this.params=e.params||{},this.create=e.create,this.error=e.error||function(e){}}function Timeline(e){this.url=e.url,this.params=e.params||{},this.data=e.data||[],this.fnTitle=e.title||function(e,t){return""},this.fnSubtitle=e.subtitle||function(e,t){return""},this.fnContent=e.content||function(e,t){return""},this.onComplete=e.onComplete}function Tabs(e){this.navigator=dom.find(e.navigatorId),this.navigator.classList.add("d-flex","align-items-center"),this.content=dom.find(e.contentId),this.tabActiveClass=e.tabActiveClass,this.tabs=e.tabs,this.lazy=!1!==e.lazy,this.autoClear=!0===e.autoClear}function DataSheet(e){this.columns=e.columns,this.columnCount=this.getColumnCount(this.columns),this.rowHeaderWidth=e.rowHeaderWidth||150,this.rowHeaders=e.rowHeaders,this.rowCount=this.getRowCount(this.rowHeaders),this.readonly=!0===e.readonly,this.totalColumns=[];for(var t=0;t<this.columns.length;t++){var n=this.columns[t];n.totalable&&this.totalColumns.push(n)}this.onCellClicked=e.onCellClicked,this.onRowHeaderClicked=e.onRowHeaderClicked,this.rowHeaderColumnCount=this.getRowHeaderColumnCount(this.rowHeaders),this.colHeaderColumnCount=this.getColumnHeaderColumnCount(this.columns),this.rowHeaderRowCount=this.getRowHeaderRowCount(this.rowHeaders),this.colHeaderRowCount=this.getColumnHeaderRowCount(this.columns),this.matrixColumn=[],this.matrixRowHeader=[],this.buildColumnMatrix(this.columns,this.matrixColumn,0),this.buildRowHeaderMatrix(this.rowHeaders,this.matrixRowHeader,0)}function asyncGeneratorStep(e,t,n,i,r,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}function Chat(e){this.host=e.host||"",this.userId=e.userId,this.userType=e.userType,this.getConversations=e.getConversations,this.onInit=e.onInit||_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),this.onSendTextMessage=e.onSendTextMessage,this.onSendImageMessage=e.onSendImageMessage,this.onSendAudioMessage=e.onSendAudioMessage,this.onSendVideoMessage=e.onSendVideoMessage,this.onSendCustomMessage=e.onSendCustomMessage,this.onRevokeMessage=e.onRevokeMessage||function(e){},this.onMessageReceived=e.onMessageReceived,this.onUnreadMessages=e.onUnreadMessages||function(e){},this.onReadMessages=e.onReadMessages||function(e){}}function Sparkline(e){this.color=e.color||"black",this.type=e.type||"line",this.data=e.data||[]}function MobileWizard(e){this.topic=e.topic,this.steps=e.steps||[],this.root=dom.element('\n    <div style="width: 100%">\n      <div class="wizard-progress">\n      </div>\n      <div class="wizard-content">\n      </div>\n    </div>\n  ')}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function asyncGeneratorStep(e,t,n,i,r,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}function MobileForm(e){this.fields=e.fields,this.readonly=e.readonly||!1,this.saveOpt=e.save,this.readOpt=e.read}function Numpad(e){this.unit=e.unit||"",this.regex=e.regex||/.*/,this.success=e.success||function(e){},this.type=e.type||"decimal"}function asyncGeneratorStep(e,t,n,i,r,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}function DistrictPicker(e){this.unit=e.unit||"",this.regex=e.regex||/.*/,this.success=e.success||function(e){},this.selections=e.selections||{}}function Calendar(e){this.today=moment(new Date),this.currentMonth=moment(this.today).startOf("month"),this.currentIndex=1}function asyncGeneratorStep(e,t,n,i,r,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}function CascadePicker(e){this.success=e.success||function(e){},this.selections=e.selections||{},this.levels=e.levels}function ActionSheet(e){this.title=e.title||"",this.actions=e.actions||[]}function Weekdays(e){e=e||{},this.today=moment(new Date),this.days=e.days||14}function PopupRuler(e){this.unit=e.unit||"",this.regex=e.regex||/.*/,this.success=e.success||function(e){},this.type=e.type||"decimal",this.value=e.value,this.range=e.range}function asyncGeneratorStep(e,t,n,i,r,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){function o(e){asyncGeneratorStep(s,i,r,o,a,"next",e)}function a(e){asyncGeneratorStep(s,i,r,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}xhr={},xhr.request=function(e,t){var n=e.url,i=e.data||e.params||{},r=e.type||"json",o=e.success,a=e.error,s=utils.getParameters(e.url);i=_objectSpread(_objectSpread({},s),i),window&&window.user&&(i._current_user=window.user.userId);var l=e.usecase||"",d=new XMLHttpRequest;d.onload=function(){var e=d.responseText;if("json"==r)try{e=JSON.parse(e)}catch(t){return void(a&&a(e))}4==d.readyState&&"200"==d.status?o&&o(e):a&&a(e)},d.onerror=function(){a&&a({error:{code:-500,message:"网络访问错误！"}})},d.ontimeout=function(){a&&a({error:{code:-501,message:"网络请求超时！"}})},d.open(t,n,!0),d.setRequestHeader("Content-Type","application/json"),d.setRequestHeader("usecase",l),"undefined"!=typeof APPTOKEN&&d.setRequestHeader("apptoken",APPTOKEN),window.user?d.setRequestHeader("_current_user",window.user.userId):d.setRequestHeader("_current_user","unauthorized user"),i?d.send(JSON.stringify(i)):d.send(null)},xhr.get=function(e){var t=e.url,n=(e.data,e.success),i=e.error,r=new XMLHttpRequest;r.open("GET",t,!0),r.onload=function(){var e=r.responseText;4==r.readyState&&"200"==r.status?n&&n(e):i&&i(e)},r.send(null)},xhr.post=function(e){var t=e.url;"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.request(e,"POST")},xhr.put=function(e){xhr.request(e,"PUT")},xhr.delete=function(e){xhr.request(e,"DELETE")},xhr.connect=function(e){xhr.request(e,"CONNECT")},xhr.upload=function(e){var t=e.url,n=e.data||e.params,i=e.type||"json",r=e.success,o=e.error,a=new FormData;for(var s in n)a.append(s,n[s]);a.append("file",e.file);var l=new XMLHttpRequest;l.onload=function(){var e=l.responseText;if("json"==i)try{e=JSON.parse(e)}catch(t){return void(o&&o(e))}4==l.readyState&&"200"==l.status?r&&r(e):o&&o(e)},e.progress&&(l.onprogress=function(t){e.progress(t.loaded,t.total)}),l.onerror=function(){o&&o({error:{code:-500,message:"网络访问错误！"}})},l.ontimeout=function(){o&&o({error:{code:-501,message:"网络请求超时！"}})},l.open("POST",t,!0),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),l.send(a)},xhr.asyncUpload=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var i=t.url,r=t.data||t.params,o=t.type||"json",a=(t.success,t.error),s=new FormData;for(var l in r)s.append(l,r[l]);s.append("file",t.file);var d=new XMLHttpRequest;d.onload=function(){var t=d.responseText;if("json"==o)try{t=JSON.parse(t)}catch(e){return void(a&&a(t))}4==d.readyState&&"200"==d.status?e(t):a&&e(t)},t.progress&&(d.onprogress=function(e){t.progress(e.loaded,e.total)}),d.onerror=function(){a&&a({error:{code:-500,message:"网络访问错误！"}})},d.ontimeout=function(){a&&a({error:{code:-501,message:"网络请求超时！"}})},d.open("POST",i,!0),"undefined"!=typeof APPTOKEN&&d.setRequestHeader("apptoken",APPTOKEN),d.send(s)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),xhr.chain=function(e){if(0!=e.length){var t=e[0],n=t.success,i=function(t){n(t),xhr.chain(e.slice(1))};xhr.promise(t,i)}},xhr.asyncGet=function(e,t){return new Promise(function(n,i){e.success=function(e){n(e)},e.error=t,xhr.get(e)})},xhr.promise=function(e,t){return new Promise(function(n,i){e.success=function(e){if(e.error)return void(t?t(e.error):dialog.error(e.error.message));n(e.data)},e.error=t||function(){n({error:{code:"500",message:"网络异常"}})},xhr.post(e)})},xhr.longpromise=function(e,t){var n=e.container||dom.find("#container"),i=e.tooltip||"操作处理中...",r=dom.element('\n    <div class="page-loading hide">\n      <div class="ring">'.concat(i,"\n        <span></span>\n      </div>\n    </div>\n  "));return n.appendChild(r),r.classList.remove("hide"),new Promise(function(n,i){e.success=function(e){if(e.error)return setTimeout(function(){r.classList.add("hide"),r.remove()},600),dialog.error(e.error.message),void(t&&t(e.error));setTimeout(function(){r.classList.add("hide"),r.remove()},1200),n(e.data)},e.error=t,xhr.post(e)})},xhr.download=function(e){var t=new XMLHttpRequest;t.open("POST",e.url,!0),t.responseType="arraybuffer",t.onload=function(){if(200===this.status){var n="",i=t.getResponseHeader("Content-Disposition");if(i&&-1!==i.indexOf("attachment")){var r=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,o=r.exec(i);null!=o&&o[1]&&(n=o[1].replace(/['"]/g,""))}var a=t.getResponseHeader("Content-Type"),s=new Blob([this.response],{type:a});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(s,n);else{var l=window.URL||window.webkitURL,d=l.createObjectURL(s),c=document.createElement("a");void 0===c.download?window.location=d:(c.href=d,c.download=e.filename||"下载的文件",document.body.appendChild(c),c.click()),setTimeout(function(){l.revokeObjectURL(d)},100)}}},t.setRequestHeader("Content-type","application/json"),"undefined"!=typeof APPTOKEN&&t.setRequestHeader("apptoken",APPTOKEN),t.send(JSON.stringify(e.params||{}))},xhr.asyncRequest=function(e,t){var n=e.url,i=e.data||e.params,r=e.type||"json",o=e.usecase||"";return new Promise(function(e,a){if(n){var s=new XMLHttpRequest;s.timeout=1e4,s.onload=function(){var t=s.responseText;if("json"==r)try{t=JSON.parse(t)}catch(e){return console.log(e),void a(e)}4==s.readyState&&"200"==s.status?e(t):a(t)},s.onerror=function(){a({error:{code:-500,message:"网络访问错误！"}})},s.ontimeout=function(){a({error:{code:-501,message:"网络请求超时！"}})},s.open(t,n,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("usecase",o),"undefined"!=typeof APPTOKEN&&s.setRequestHeader("apptoken",APPTOKEN),i?s.send(JSON.stringify(i)):s.send(null)}})},xhr.asyncPost=function(e){var t=e.url;return"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.asyncRequest(e,"POST")},"undefined"!=typeof module&&(module.exports={xhr:xhr});var ajax={};ajax.save=function(e){for(var t=e.url||"",n=e.form,i=e.button,r=e.success,o=n.validate(),a="",s=0;s<o.length;s++)a+=o[s].message+"<br>";if(""!=a)return void dialog.error(a);i&&i.prop("disabled",!0);var l=n.formdata();$.ajax({url:t,data:l,method:"POST",dataType:"json",success:function(e){if(void 0!==e.error)return dialog.error("保存信息出错！"),void(i&&i.prop("disabled",!1));dialog.success("保存信息成功！"),void 0!==r&&r(e),i&&i.prop("disabled",!1)},error:function(){dialog.error("系统异常！"),i&&i.prop("disabled",!1)}})},ajax.post=function(e){var t=utils.getParameters(e.url),n=_objectSpread(_objectSpread({},t),e.data);$.ajax({url:e.url,data:n,method:"POST",dataType:"json",success:function(t){void 0!==e.success&&e.success(t)}})},ajax.get=function(e){$.ajax({url:e.url,data:e.data,dataType:"json",success:function(t){void 0!==e.success&&e.success(t)}})},ajax.text=function(e,t,n){$.ajax({url:e,data:t,success:function(e){void 0!==n&&n(e)}})},ajax.view=function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();var t=e.url,n=!1;n=void 0===e.empty||e.empty;var i=e.page;t&&0==t.indexOf(":")&&(i=t.substring(1),t=null);var r=utils.getParameters(e.url),o=_objectSpread(_objectSpread({},r),e.params),a=e.title||"",s=e.containerId,l=e.success,d=null;if("string"==typeof s?null==(d=document.getElementById(s.trim()))&&(d=document.querySelector(s.trim())):d=s,void 0===o&&(o={}),window.parameters)for(var c in o)window.parameters[c]=o[c];window._current_view&&(window._current_view.destroy&&window._current_view.destroy(),delete window._current_view),t?xhr.get({url:t,success:function(e){var t=null;d&&(t=utils.append(d,e,n)),t&&t.id&&window[t.id]&&window[t.id].show&&!l&&(window[t.id].show(r),window._current_view=window[t.id]),l&&l(a,t,r)}}):i&&xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:i},success:function(e){var t=e.data.script;t||(t='<div class="full-width full-height d-flex"><img src="img/under-construction.jpeg" class="m-auto full-width"></div>');var i=null;d&&(i=utils.append(d,t,n)),l&&l(a,i,r)}})},ajax.append=function(e){function t(){m.querySelectorAll("div[data-url]").forEach(function(e){e.classList.remove("show"),e.classList.add("hide","fade","fadeIn")}),a.querySelectorAll("a.active").forEach(function(e){e.classList.remove("active")}),s.querySelectorAll("a.active").forEach(function(e){e.classList.remove("active")})}function n(e){dom.find("a",e).classList.add("pointer"),dom.find("a",e).classList.remove("nav-link"),dom.find("a",e).classList.add("dropdown-item"),dom.find("i",e).classList.remove("ml-1"),dom.find("i",e).classList.add("float-right"),0==s.children.length?s.appendChild(e):s.insertBefore(e,s.children[0])}function i(e){dom.find("a",e).classList.add("nav-link"),dom.find("a",e).classList.remove("dropdown-item"),dom.find("i",e).classList.add("ml-1"),dom.find("i",e).classList.remove("float-right"),a.appendChild(e)}function r(e,r){if(""!=e&&null!=a){var d=dom.element('\n      <li class="nav-item">\n        <a class="nav-link head-link">\n          <span></span>\n          <i class="fas fa-times-circle ml-1"></i>\n        </a>\n      </li>\n    ');dom.find("a",d).setAttribute("data-url",r),dom.bind(dom.find("i",d),"click",function(e){e.preventDefault(),e.stopPropagation();var t=e.target.parentElement,n=m.querySelector('div[data-url="'+t.getAttribute("data-url")+'"]');if(n&&n.remove(),e.target.parentElement.parentElement.remove(),m.querySelectorAll("div[data-url]").length>0&&a.children[0].click(),s.children.length>0){var r=s.children[0];r.remove(),i(r)}}),dom.bind(dom.find("a",d),"click",function(e){var n=dom.ancestor(e.target,"a");n.classList.contains("active")||(t(),n.classList.add("active"),o(h.getAttribute("data-url")))});var c=!1;if(a.querySelectorAll("li").forEach(function(t){dom.find("span",t).innerText==e&&(c=!0,dom.find("a",t).classList.add("active"))}),!c){if(0==l)a.appendChild(d);else if(l+1>MAX_HEAD_LINK_COUNT){var u=dom.find("li:last-child",a);u.remove(),n(u)}a.insertBefore(d,a.children[0]);var p=dom.find("span",d),h=dom.find("a",d);h.classList.add("active"),p.innerText=e}}}function o(e){m.querySelectorAll("div[data-url]").forEach(function(e){e.classList.remove("show"),e.classList.add("hide")});var t=m.querySelector('div[data-url="'+e+'"]');if(null!=t){t.classList.remove("hide"),setTimeout(function(){t.classList.add("show")},150);var n=dom.find('a[data-url="'+e+'"]',a);return null!=n?void n.classList.add("active"):void dom.find('a[data-url="'+e+'"]',s).classList.add("active")}xhr.get({url:e,success:function(t){var n=utils.getParameters(e),i=utils.append(m,t,!1);i.id&&window[i.id]&&window[i.id].show&&window[i.id].show(n);for(var o=m.children.length-1;o>=0&&!function(){var t=m.children[o];if("DIV"==t.tagName)return t.setAttribute("data-url",e),setTimeout(function(){t.classList.add("show")},150),1}();o--);r(c,e),h&&h(c,t)}})}"undefined"!=typeof schedule&&e.clear&&schedule.stop();var a=dom.find("#tabsMain"),s=dom.find("#tabsOthers");if(null==a)return void ajax.view(e);var l=a.children.length,d=e.url,c=e.title||"",u=e.containerId,p=e.params,h=e.success,m=null;if("string"==typeof u?null==(m=document.getElementById(u.trim()))&&(m=document.querySelector(u.trim())):m=u,void 0===p&&(p={}),window.parameters)for(var f in p)window.parameters[f]=p[f];t();var v=m.querySelector('div[data-url="'+d+'"]');if(null!=v){v.classList.remove("hide"),setTimeout(function(){v.classList.add("show")},150);var g=dom.find('a[data-url="'+d+'"]',a);return null!=g?void g.classList.add("active"):void dom.find('a[data-url="'+d+'"]',s).classList.add("active")}if(0==d.indexOf(":")){var y=d.substring(1);xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:y},success:function(e){var t=e.data.script;utils.append(m,t,!1);for(var n=m.children.length-1;n>=0&&!function(){var e=m.children[n];if("DIV"==e.tagName)return e.setAttribute("data-url",d),setTimeout(function(){e.classList.add("show")},150),1}();n--);r(c,d),stdbiz.render(y,m.querySelector('[data-url="'+d+'"]'),{})}})}else o(d)},ajax.shade=function(e){"undefined"!=typeof schedule&&schedule.stop();var t=e.url,n=e.success,i=document.querySelector(".page.full");null!=i&&i.parentElement.remove(),-1===t.indexOf(":")?xhr.get({url:t,success:function(t){var i=utils.append(document.body,t);n&&n(e.title||"",i)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:t.substring(1)},success:function(t){var i=t.data.script,r=utils.append(document.body,i);n&&n(e.title||"",r)}})},ajax.shade2=function(e){"undefined"!=typeof schedule&&schedule.stop();var t=e.url,n=e.success;xhr.get({url:t,success:function(t){var i=utils.append(document.body,t);n&&n(e.title||"",i)}})},ajax.overlay=function(e){"undefined"!=typeof schedule&&schedule.stop();var t=e.url,n=e.html,i=e.success,r=document.querySelector(".page.overlay");if(null!=r&&r.parentElement.remove(),t)xhr.get({url:t,success:function(t){var n=utils.append(document.body,t);i&&i(e.title||"",n)}});else{var o=utils.append(document.body,n);i&&i(e.title||"",o)}},ajax.stack=function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();var t=e.pageId,n=e.params,i=dom.find(e.containerId);void 0===n&&(n={});for(var r=!1,o=0;o<i.children.length;o++){var a=i.children[o];"DIV"==a.tagName&&"true"!=a.getAttribute("data-stack-back")&&(a.classList.remove("show"),a.classList.add("hide"),a.id==t&&(a.classList.remove("hide"),a.classList.add("show"),r=!0))}r||(e.empty=!1,ajax.view(e));var s=dom.find("div[data-stack-back]",i);null==s&&(s=dom.element('\n    <div data-stack-back="true" class="pointer">\n      <i class="fas fa-angle-left font-32" style="margin-top: 12px;"></i>\n    </div>\n  '),s.style.position="fixed",s.style.width="60px",s.style.height="60px",s.style.bottom="40px",s.style.right="40px",s.style.backgroundColor="#0C9",s.style.color="#fff",s.style.borderRadius="50px",s.style.textAlign="center",s.style.boxShadow="2px 2px 3px #999",s.style.zIndex="99",dom.bind(s,"click",function(e){s.remove(),ajax.unstack({containerId:i})}),i.appendChild(s))},ajax.unstack=function(e){var t=dom.find(e.containerId);t.children[t.children.length-1].remove();var n=t.children[t.children.length-1];n.classList.remove("hide"),n.classList.add("show")},ajax.template=function(e){var t=e.url,n=e.usecase,i=e.containerId,r=e.templateId,o=e.data,a=e.success;xhr.post({url:t,usecase:n,data:o,success:function(e){if(i){var t=document.getElementById(r).innerHTML,n=Handlebars.compile(t),o=n(e);document.getElementById(i).innerHTML=o}a&&a(e)}})},ajax.dialog=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,o,a,s,l,d,c,u,p,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.title||"",i=t.url,r=t.html,o=t.params||{},a=t.success,s=t.end,l=!1!==t.shadeClose,d=!0===t.allowClose,c=t.width||"80%",u=t.height||"",p=t.offset||"auto",window.parameters)for(h in o)window.parameters[h]=o[h];if(!i){e.next=16;break}return e.next=15,xhr.asyncGet({url:i});case 15:r=e.sent;case 16:layer.open({type:1,offset:p,title:n,closeBtn:!0===d?1:0,shade:.5,shadeClose:l,area:[c,u],content:r,success:function(e,t){var i=document.querySelector(".layui-layer-content");i.style.overflow="hidden",""!=n&&(i.style.height="calc(100% - 42px);"),a&&a()},end:s||function(){}});case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),ajax.video=function(e,t,n,i){layer.open({type:2,title:!1,closeBtn:1,shade:[0],area:[n+"px",i+"px"],offset:"rb",anim:2,content:[e,"no"]})},ajax.svg=function(e,t,n,i){void 0===n&&(n={}),$.ajax({url:e,data:n,success:function(e){t.empty();var n=(new XMLSerializer).serializeToString(e.documentElement);t.html(n),i&&i(e)}})},ajax.upload=function(e){var t=e.data;void 0===t&&(t={});var n=new FormData;for(var i in t)n.append(i,t[i]);$.ajax({url:e.url,data:n,method:"POST",cache:!1,contentType:!1,processData:!1,xhr:function(){
var t=$.ajaxSettings.xhr();return t.upload&&e.progress&&t.upload.addEventListener("progress",function(t){t.lengthComputable&&e.progress&&e.progress(t.total,t.loaded)},!1),t},success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},ajax.sidebar=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,o,a,s,l,d,c,u,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=dom.find(t.containerId),i=t.success||function(e,t){},r=dom.find("[widget-id=right-bar]"),o=t.allowClose||!1,null!=r&&r.remove(),r=dom.element('\n    <div widget-id="right-bar" style="position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: transparent; z-index: 999999;">\n      <div class="right-bar fade show">\n        <div class="modal-dialog" role="document">\n          <div class="modal-content">\n            <div class="card-header pl-3">\n              <h5 class="modal-title"></h5>\n              <button type="button" class="close text-danger position-relative">\n                <i class="fas fa-times"></i>\n              </button>\n            </div>\n            <div class="modal-body" style="overflow-y: auto;"></div>\n            <div style="position: absolute; bottom: 24px; left: 0; width: 100%; height: 48px; border-top: 1px solid lightgrey; background: white; display:none; z-index: 99999999;">\n              <div widget-id="right-bar-bottom" class="mh-10 mt-2" style="float: right;"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  '),!0===t.showBottom&&(dom.find(".modal-body",r).style.marginBottom="48px",dom.find("[widget-id=right-bar-bottom]",r).parentElement.style.display=""),r.addEventListener("click",function(e){"right-bar"===e.target.getAttribute("widget-id")&&(r.children[0].classList.remove("in"),r.children[0].classList.add("out"),setTimeout(function(){r.remove()},300))}),n.appendChild(r),t.url&&0==t.url.indexOf(":")&&(t.page=t.url.substring(1),t.url=null),a="",!t.url){e.next=17;break}return e.next=14,xhr.asyncGet({url:t.url});case 14:a=e.sent,e.next=18;break;case 17:t.html&&(a=t.html);case 18:dom.find(".modal-title",r).innerHTML=t.title||"",dom.find(".modal-body",r).innerHTML="",o||t.close||dom.find("button.close",r).classList.add("hidden"),!0===o&&(s=dom.find("button.close",r),l=dom.find(".card-header",r),d=s.getBoundingClientRect(),c=l.getBoundingClientRect(),u=(c.height-d.height)/2,s.style.top=u+"px",s.style.right=u+"px"),dom.find("button.close",r).addEventListener("click",function(){r.children[0].classList.add("out"),r.remove(),t.close&&t.close()}),p=utils.append(dom.find(".modal-body",r),a),i&&i(t.title||"",p),setTimeout(function(){r.children[0].classList.remove("out"),r.children[0].classList.add("in")},300);case 26:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),ajax.bottombar=function(e){var t=dom.find(e.containerId),n=e.success||function(){},i=dom.find(".bottom-bar",t),r=e.allowClose||!1;null!=i&&i.remove(),i=dom.element('\n    <div class="bottom-bar fade show">\n      <div class="modal-dialog" role="document">\n        <div class="modal-content">\n          <div class="card-header pt-2 pb-2">\n            <button type="button" class="close text-danger">\n              <i class="fas fa-times"></i>\n            </button>\n            <h5 class="modal-title"></h5>\n          </div>\n          <div class="modal-body" style="overflow-y: auto"></div>\n        </div>\n      </div>\n    </div>\n  '),t.appendChild(i);var o=i.parentElement.clientWidth,a=parseInt(window.getComputedStyle(i.parentElement,null).getPropertyValue("padding-left")),s=parseInt(window.getComputedStyle(i.parentElement,null).getPropertyValue("padding-right"));i.style.width=o-s-a+"px",e.url?xhr.get({url:e.url,success:function(t){dom.find(".modal-title",i).innerHTML=e.title||"",r||e.close||dom.find("button.close",i).classList.add("hidden"),dom.find("button.close",i).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),e.close&&e.close()}),utils.append(dom.find(".modal-body",i),t),n&&n(t),setTimeout(function(){i.classList.remove("out"),i.classList.add("in")},200)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:e.page},success:function(t){var o=t.data.script;utils.append(dom.find(".modal-body",i),o),dom.find(".modal-title",i).innerHTML=e.title,r||e.close||dom.find("button.close",i).classList.add("hidden"),dom.find("button.close",i).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),e.close&&e.close()}),n&&n(t),setTimeout(function(){i.classList.remove("out"),i.classList.add("in")},200)}})},ajax.tabs=function(e){function t(e,t,n,i){ajax.view({url:t,containerId:e,success:function(){window[n]&&window[n].show(i)}})}var n=document.querySelector(e.containerId),i=e.tabs,r=(e.closeable,dom.create("ul","nav","nav-tabs")),o=dom.create("div","tab-content"),a=dom.create("div","float-right"),s=dom.create("button","btn","btn-link");a.appendChild(s),dom.bind(s,"click",function(){var e=dom.find("li.active link",this.parentElement.parentElement),n=e.getAttribute("data-model-url"),i=e.getAttribute("data-model-page"),r=JSON.parse("data-model-data");t(dom.find("div.tab-content div[data-model-url='"+n+"']",this.parentElement.parentElement),n,i,r)});for(var l=0;l<i.length;l++)!function(){var e=i[l],n=dom.create("li","nav-item"),a=dom.create("a","nav-link");0==l&&a.classList.add("active"),a.setAttribute("data-model-url",e.url),a.setAttribute("data-model-data",JSON.stringify(e.data||{})),a.setAttribute("data-model-page",e.page),a.innerHTML=e.title,dom.bind(a,"click",function(){if(!this.classList.contains("active")){dom.find("a.active",this.parentElement.parentElement.parentElement).classList.remove("active"),dom.find("div.active",this.parentElement.parentElement.parentElement).classList.remove("active");var e=a.getAttribute("data-model-url"),n=JSON.parse(a.getAttribute("data-model-data")),i=a.getAttribute("data-model-page"),r=dom.find("div.tab-content div[data-model-url='"+e+"']",this.parentElement.parentElement.parentElement);this.classList.add("active"),r.classList.add("active"),""===r.innerHTML.trim()&&t(r,e,i,n)}}),n.appendChild(a),r.appendChild(n);var s=dom.create("div","tab-pane");0==l&&(s.classList.add("active"),t(s,e.url,e.page,e.data)),s.setAttribute("data-model-url",e.url),o.append(s)}();n.appendChild(a),n.appendChild(r),n.appendChild(o)},ajax.download=function(e,t){fetch(e).then(function(e){return e.blob()}).then(function(e){var n=document.createElement("a"),i=window.URL.createObjectURL(e);n.href=i,n.download=t+".docx",n.click(),window.URL.revokeObjectURL(i),n.remove()})},ajax.upload=function(e){var t=dom.create("input");t.setAttribute("type","file"),t.setAttribute("accept",e.accept||"*"),t.style.display="none",t.onchange=function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function n(i){var r,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.files[0],n.next=3,xhr.asyncUpload({url:"/api/v3/common/upload",params:{directoryKey:e.directoryKey},file:r});case 3:o=n.sent,e.success&&e.success(o);case 5:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}(),t.click()};var dom={};dom.closeRightBar=function(){var e=dom.find("div[widget-id=right-bar]");null!=e&&(e.children[0].classList.add("out"),setTimeout(function(){e.remove()},300))},dom.slideInFromRight=function(e,t){e.classList.remove("out"),e.classList.add("in"),setTimeout(function(){e.style.right="0"},300),t&&(t.style.display="")},dom.slideOutToRight=function(e,t,n){e.classList.contains("in")&&(e.classList.contains("out")||(e.classList.remove("in"),e.classList.add("out"),setTimeout(function(){e.style.right=t},300),n&&(n.style.display="none")))},dom.slideInFromLeft=function(e,t){e.classList.remove("out"),e.classList.add("in"),setTimeout(function(){e.style.left="0"},300),t&&(t.style.display="")},dom.slideOutToLeft=function(e,t,n){e.classList.contains("in")&&(e.classList.contains("out")||(e.classList.remove("in"),e.classList.add("out"),setTimeout(function(){e.style.left=t},300),n&&(n.style.display="none")))},dom.toggle=function(e,t){if(Array.isArray(t))for(var n=0;n<t.length;n++)dom.toggle(e,t[n]);else t.classList.contains(e)?t.classList.remove(e):t.classList.add(e)},dom.exclusive=function(e,t,n){var i,r=n.querySelectorAll(t.tagName+"."+e),o=_createForOfIteratorHelper(r);try{for(o.s();!(i=o.n()).done;){i.value.classList.remove(e)}}catch(e){o.e(e)}finally{o.f()}t.classList.add(e)},dom.delayTo=function(e){clearTimeout(dom.timeoutDelayTo),dom.timeoutDelayTo=setTimeout(function(){},600)},dom.value=function(e,t){var n=document.querySelector(e);return t?void(n.value=t):n.value.trim()},dom.empty=function(e){var t=document.querySelector(e);t.value?t.value="":t.innerHTML=""},dom.valid=function(e){var t=document.querySelector(e);return void 0!==t.value&&null!=t.value&&""!=t.value.trim()},dom.create=function(e){for(var t=Array.prototype.slice.call(arguments,1),n=document.createElement(e),i=0;i<t.length;i++)n.classList.add(t[i]);return n},dom.fix=function(e){var t=null;t="string"==typeof e?document.querySelector(e):e;var n=t.getBoundingClientRect(),i=n.left,r=n.top,o=(n.width,n.height),a=(parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-top"))),s=parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-bottom")),l=(parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-top")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-bottom")),t.parentElement.parentElement),d=l.getBoundingClientRect(),c=parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-left"));parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-top")),parseInt(window.getComputedStyle(l,null).getPropertyValue("padding-bottom"));return t.style.position="absolute",t.style.top=r-d.top+"px",t.style.left=i-d.left+"px",t.style.width="calc(100% - "+2*c+"px )",{top:r-d.top,left:i-d.left,width:d.width-2*c,height:o+a+s}},dom.find=function(e,t){if(t=t||document,"string"!=typeof e)return e;var n=t.querySelectorAll(e);return 0==n.length?null:1==n.length?n[0]:n},dom.ancestor=function(e,t,n){var i=null;if(n=n||"",null==(i="string"==typeof e?document.querySelector(e):e))return null;t=t.toUpperCase();var r=i;if(""==n)for(;null!=r&&r.tagName!=t;)r=r.parentElement;else for(;null!=r&&(r.tagName!=t||!r.classList.contains(n));)r=r.parentElement;return r},dom.element=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},dom.bind=function(e,t,n){var i=null;null!=(i="string"==typeof e?document.querySelector(e):e)&&i&&i.addEventListener(t,n)},dom.model=function(e,t){var n=null;if(n="string"==typeof e?document.querySelector(e):e,void 0===t){var i={};return Array.prototype.slice.call(n.attributes).forEach(function(e){if(0==e.name.indexOf("data-model-"))if(0==e.value.indexOf("{"))try{i[utils.nameVar(e.name.slice("data-model-".length))]=JSON.parse(e.value)}catch(t){i[utils.nameVar(e.name.slice("data-model-".length))]=e.value}else i[utils.nameVar(e.name.slice("data-model-".length))]=e.value}),i}var r=Array.prototype.slice.call(arguments,2);if(0==r.length)for(var o in t)0!=o.indexOf("||")&&0!=o.indexOf("//")&&0!=o.indexOf(">>")&&("object"===_typeof(t[o])?n.setAttribute(utils.nameAttr(o),JSON.stringify(t[o])):n.setAttribute(utils.nameAttr(o),t[o]));else for(var a=0;a<r.length;a++){var s=r[a];0!=s.indexOf("||")&&0!=s.indexOf("//")&&0!=s.indexOf(">>")&&("object"===_typeof(t[s])?n.setAttribute(utils.nameAttr(s),JSON.stringify(t[s])):n.setAttribute(utils.nameAttr(s),t[s]))}},dom.collect=function(e,t){for(var n=[],i=document.querySelectorAll(e),r=0;r<i.length;r++){var o={};if(Array.isArray(t))for(var a=0;a<t.length;a++)o[t[a]]=i[r].getAttribute(utils.nameAttr(t[a]));else o[t]=i.getAttribute(utils.nameAttr(t[j]));n.push(o)}return n},dom.propagate=function(e,t,n,i){var r=i(t);if(Array.isArray(n))for(var o=0;o<n.length;o++)r.setAttribute(utils.nameAttr(n[o]),t[n[o]]);else r.setAttribute(utils.nameAttr(n),t[n]);e.appendChild(r)},dom.toggle2=function(e,t){for(var n=document.querySelectorAll(e),i=0;i<n.length;i++){n[i].addEventListener("click",function(){for(var e=this.getAttribute("data-toggle"),n=e.split(">>"),i=n[0].split("+"),r=n[1].split("+"),o=!1,a=0;a<i.length;a++){var s=i[a].trim();if(0==s.indexOf("."))o=this.classList.contains(s.substring(1));else{o=null!=this.querySelector(s)}}if(o){for(var l=0;l<r.length;l++){var d=r[l].trim();if(0===d.indexOf("."))this.classList.add(d.substring(1));else{this.querySelector(d.substring(0,d.indexOf("."))).classList.add(d.substring(d.indexOf(".")+1))}}for(var c=0;c<i.length;c++){var u=i[c].trim();if(0==u.indexOf("."))this.classList.remove(u.substring(1));else{this.querySelector(u).classList.remove(u.substring(u.indexOf(".")+1))}}}else{for(var p=0;p<i.length;p++){var h=i[p].trim();if(0==h.indexOf("."))this.classList.add(h.substring(1));else{this.querySelector(h.substring(0,h.indexOf("."))).classList.add(h.substring(h.indexOf(".")+1))}}for(var m=0;m<r.length;m++){var f=r[m].trim();if(0==f.indexOf("."))this.classList.remove(f.substring(1));else{this.querySelector(f).classList.remove(f.substring(f.indexOf(".")+1))}}t&&resovle(this)}})}},dom.switch=function(e,t){for(var n=dom.find(e),i=n.getAttribute("data-switch"),r=i.split("+"),o=n.querySelectorAll(r[0]),a=0;a<o.length;a++)!function(){var e=o[a];e.onclick=function(i){for(var o=n.querySelectorAll(r[0]),a=0;a<o.length;a++)o[a].classList.remove(r[1].substring(1));e.classList.add(r[1].substring(1)),t&&t(e)}}()},dom.tabs=function(e){var t=dom.find(e);if(null!=t)for(var n=t.getAttribute("data-tab-active-class"),i=0;i<t.children.length;i++)!function(){var e=t.children[i];e.addEventListener("click",function(i){for(var r=0;r<t.children.length;r++){t.children[r].classList.remove(n)}e.classList.add(n)})}()},dom.top=function(e){var t=null;if(null==(t="string"==typeof e?document.querySelector(e):e))return 0;var n=t.offsetTop;return void 0!==t.offsetParent&&(n+=dom.top(t.offsetParent)),n},dom.formdata=function(e,t){var n=null;if(n="string"==typeof e?document.querySelector(e):e,void 0===t){for(var i={},r={},o=n.querySelectorAll("input"),a=0;a<o.length;a++){var s=o[a],l=s.name,d=s.type,c=s.value;"text"==d||"number"==d||"password"==d||"hidden"==d?(i[l]=null,""!=c?-1!=l.indexOf("[]")?i[l]=[c]:i[l]=c:i[l]=""):"radio"==d?s.checked&&(i[l]=c):"checkbox"==d&&(void 0===r[l]&&(r[l]=0),s.checked&&(void 0===i[l]&&(r[l]=0,i[l]=[]),i[l].push(c)),r[l]+=1)}for(var u=n.querySelectorAll("select"),p=0;p<u.length;p++){var h=u[p],m=h.name;i[m]=null,-1!=h.selectedIndex?-1!=m.indexOf("[]")?i[m]=[h.value]:i[m]=h.value:i[m]=""}for(var f=n.querySelectorAll("textarea"),v=0;v<f.length;v++){var g=f[v],y=g.name;i[y]=null,i[y]=g.value}for(var b in r)-1==b.indexOf("[]")&&1==r[b]&&i[b]&&(i[b]=i[b][0]);for(var w in i)"string"==typeof i[w]&&0==i[w].indexOf("${")&&(i[w]=i[i[w].substring(2,i[w].length-1)]);return i}var x=function(e,t,n){var i=dom.find("[name='"+t+"']",e);if(null!=i){if(i.length>1&&"radio"==i[0].type){i.forEach(function(e,t){e.value===n?e.checked=!0:e.checked=!1})}"INPUT"==i.tagName?"check"==i.type||(i.value=n||""):"SELECT"==i.tagName?$("select[name='"+t+"']").val(n).trigger("change"):"TEXTAREA"==i.tagName&&(i.innerHTML=n)}};for(var C in t)if("object"===_typeof(t[C]))for(var S in t[C])x(n,C+"."+S,t[C][S]);else x(n,C,t[C])},dom.setAttribute=function(e,t,n){for(var i=document.querySelectorAll(e),r=0;r<i.length;r++)i[r][t]=n},dom.removeAttribute=function(e,t){for(var n=document.querySelectorAll(e),i=0;i<n.length;i++)n[i].removeAttribute(t)},dom.enable=function(e){for(var t=document.querySelectorAll(e),n=0;n<t.length;n++)t[n].disabled=!1},dom.disable=function(e){var t;t="string"==typeof e?document.querySelectorAll(e):e;for(var n=0;n<t.length;n++)t[n].disabled=!0},dom.index=function(e,t,n){var i;if(i="string"==typeof e?dom.find(e):e,n);else for(var r=i.getAttribute(t),o=i.parentElement.querySelectorAll(i.tagName),a=0;a<o.length;a++){var s=o[a],l=s.getAttribute(t);if(r==l)return a}return-1},dom.elementAt=function(e,t,n){for(var i=document.querySelectorAll(e),r=0;r<i.length;r++){var o=i[r];if(n==o.getAttribute(t))return{index:r,element:o}}return null},dom.elementAtTree=function(e,t,n,i,r){for(var o=document.querySelectorAll(e),a=0,s=0;s<o.length;s++){var l=o[s],d=l.getAttribute(t);if(r==l.getAttribute(n)&&(a++,i==d))return{index:a,element:l}}},dom.stack=function(e,t,n,i){var r=dom.create("a","btn","btn-link"),o=dom.create("i","fas","fa-caret-right","mr-1");r.appendChild(o),dom.bind(r,"click",function(){var o=dom.find("i",r);o.classList.contains("fa-caret-right")?(e.container.querySelectorAll("i.fa-caret-down").forEach(function(e){e.classList.remove("fa-caret-down"),e.classList.add("fa-caret-right")}),o.classList.remove("fa-caret-right"),o.classList.add("fa-caret-down"),e.stack(n,function(e){e.parentElement.classList.add("fade","fadeIn"),e.style.paddingLeft="50px",e.style.paddingRight="50px",setTimeout(function(){e.parentElement.classList.add("show")},200),i(e)})):(o.classList.remove("fa-caret-down"),o.classList.add("fa-caret-right"),t.parentElement.nextSibling.remove())})},dom.inner=function(e){var t=e.clientHeight,n=e.clientWidth,i=getComputedStyle(e);return{height:t-parseInt(i.paddingTop)-parseInt(i.paddingBottom),width:n-parseInt(i.paddingLeft)-parseInt(i.paddingLeft)}},dom.outer=function(e){var t=e.clientHeight,n=e.clientWidth,i=getComputedStyle(e);return{height:t+parseInt(i.marginTop)+parseInt(i.borderTop)+parseInt(i.marginBottom)+parseInt(i.borderBottom),width:n+parseInt(i.marginLeft)+parseInt(i.borderLeft)+parseInt(i.marginRight)+parseInt(i.borderRight)}},dom.height=function(e,t,n){t=t||0,void 0===n&&(n=dom.find("#container")),n=n||document.body;var i=null;i="string"==typeof e?document.querySelector(e):e;var r=dom.top(i),o=getComputedStyle(n,null),a=(parseInt(o.getPropertyValue("padding-top")),parseInt(o.getPropertyValue("padding-bottom")));o=getComputedStyle(i,null);parseInt(o.getPropertyValue("border-top-width")),parseInt(o.getPropertyValue("border-bottom-width"));i.style.marginBottom="0px",i.style.height=n.clientHeight-r-t-a+"px",i.style.overflowY="auto"},dom.height2=function(e,t,n){t=t||0,void 0===n&&(n=dom.find("#container")),n=n||document.body;var i=null;i="string"==typeof e?document.querySelector(e):e;var r=(dom.top(i),getComputedStyle(n,null)),o=parseInt(r.getPropertyValue("padding-top")),a=parseInt(r.getPropertyValue("padding-bottom"));r=getComputedStyle(i,null);var s=parseInt(r.getPropertyValue("border-top-width")),l=parseInt(r.getPropertyValue("border-bottom-width")),d=parseInt(r.getPropertyValue("border-top-width")),c=parseInt(r.getPropertyValue("border-bottom-width"));i.style.marginBottom="0px";var u=n.getBoundingClientRect();i.style.height=u.height-o-a-s-l-d-c-t+"px",i.style.overflowY="auto"},dom.autoheight=function(e,t,n){n=n||0;var i=dom.find(e);if(null!=i){t=t||document.body;var r=t.getBoundingClientRect(),o=r.height;t===document.body&&(o=window.innerHeight);for(var a=i.parentElement,s=(a.getBoundingClientRect(),i.getBoundingClientRect()),l=(parseInt(a.offsetTop),s.top-r.top),d=0;a!==t;){var c=getComputedStyle(a);d+=parseInt(c.paddingBottom),d+=parseInt(c.marginBottom),d+=parseInt(c.borderBottomWidth),a=a.parentElement}var u=getComputedStyle(i);d+=parseInt(u.borderBottomWidth),i.style.height=o-d-n-l+"px",i.style.overflowY="auto"}},dom.templatize=function(e,t){var n=Handlebars.compile(e),i=n(t);return dom.element(i)},dom.render=function(e,t,n){function i(e,t){var n=dom.find("[value='"+t+"']",e);null!=n&&(n.checked=!0)}function r(e,t,r){var o=dom.find("[name='"+t+"']",e);if(null!=o){"DIV"===o.nodeName&&n?r&&i(o,r):"INPUT"==o.tagName?"radio"==o.type||(o.value=r):"SPAN"==o.tagName?r&&(o.innerHTML=r):"SELECT"==o.tagName&&$("select[name='"+t+"']").val(r).trigger("change")}}var o=null;o="string"==typeof e?document.querySelector(e):e;for(var a in t)if("object"===_typeof(t[a]))for(var s in t[a])r(o,a+"."+s,t[a][s]);else r(o,a,t[a])},dom.popup=function(e,t){var n=dom.create("div","full-width","full-height","position-absolute");return n.style.background="transparent",dom.bind(n,"click",function(e){n.remove(),t.remove()}),document.body.appendChild(n),e.appendChild(t),n},dom.html=function(e){var t=dom.element("<div></div>");return t.appendChild(e),t.innerHTML},dom.init=function(e,t){if(t){var n=t.getAttribute("name");n&&""!=n||(n=t.getAttribute("widget-id")),n&&""!=n&&(e[n]=t);var i=t.getAttribute("widget-model-tooltip");i&&""!=i&&tippy(t,{content:i});for(var r=0;r<t.children.length;r++){var o=t.children[r];dom.init(e,o)}}},dom.makeUpload=function(e,t,n,i){t.onchange=function(e){t.files&&0!=t.files.length&&xhr.upload({url:"/api/v3/common/upload",params:_objectSpread(_objectSpread({},n),{},{file:t.files[0]}),success:function(e){e.data&&(e=e.data),i(e.webpath)}})},e.onclick=function(e){t.click()}},dom.exists=function(e,t,n){for(var i=0;i<e.length;i++){var r=e[i];if(dom.model(r)[n]===t[n])return!0}return!1},dom.getDataFromChildren=function(e,t,n){for(var i=[],r=e.querySelectorAll(t),o=0;o<r.length;o++){var a=r[o];if(void 0===n)i.push(dom.model(a));else if(Array.isArray(n)){for(var s={},l=0;l<n.length;l++)s[n[l]]=a.getAttribute(n[l]);i.push(s)}else if("string"==typeof n){var d={};d[n]=a.getAttribute(n),i.push(d)}}return i},utils={},utils.append=function(e,t,n){var i=dom.create("div");i.style.height="100%",i.style.width="100%",n=n||!1;var r=document.createRange(),o=r.createContextualFragment(t);!1!==n&&(e.innerHTML=""),e.appendChild(i),i.appendChild(o);var a=dom.find("[id^=page]",i);return a?i.setAttribute("page-id",a.id):i.setAttribute("page-id","page.not.in.database"),{id:a?a.id:"",container:i}},utils.message=function(e){if(e||0!=e.length){for(var t="",n=0;n<e.length;n++)t+=e[n].message+"<br>";return t}},utils.prompt=function(e){if(e||0!=e.length)for(var t=0;t<e.length;t++)$(e[t].element).addClass("is-invalid")},utils.render=function(e,t,n){var i=document.getElementById(t).innerHTML,r=Handlebars.compile(i),o=r(n);document.getElementById(e).innerHTML=o},utils.assemble=function(e,t){if("object"===_typeof(e))for(var n in e){var i=e[n];"object"===_typeof(i)&&(e[n+"Id"]=i.id),"id"==n?e[t+"Id"]=i:"name"==n&&(e[t+"Name"]=i)}},utils.in=function(e){var t=e.split(" "),n=null,i=[];1==t.length?(n=document.getElementById(e),i.push(n)):(n=document.getElementById(t[0]),i=n.querySelectorAll(t[1]));for(var r=0;r<i.length;r++)n=i[r],n.addEventListener("animationend",function(){this.classList.remove("animated","fadeIn"),this.style.display="",this.removeEventListener("animationend",function(){}),this.removeEventListener("animationstart",function(){})}),n.classList.remove("fadeOut","hide"),n.classList.add("animated","fadeIn","show")},utils.out=function(e){var t=e.split(" "),n=null,i=[];1==t.length?(n=document.getElementById(e),i.push(n)):(n=document.getElementById(t[0]),i=n.querySelectorAll(t[1]));for(var r=0;r<i.length;r++)n=i[r],n.addEventListener("animationend",function(){this.classList.remove("animated","fadeOut"),this.removeEventListener("animationend",function(){})}),n.classList.remove("fadeIn","show"),n.classList.add("animated","fadeOut","hide")},utils.nameAttr=function(e){for(var t=[],n="",i=0;i<e.length;i++){var r=e.charAt(i);r==r.toUpperCase()?(t.push(n),n="",n+=r.toLowerCase()):n+=r}return""!=n&&t.push(n),"data-model-"+t.join("-")},utils.nameVar=function(e,t){if(t=t||"-",-1==e.indexOf(t))return e;for(var n=e.split(t),i="",r=0;r<n.length;r++){var o=n[r];i+=0==r?o:o.charAt(0).toUpperCase()+o.slice(1)}return i},utils.camelcase=function(e,t){if(-1==e.indexOf(t))return e;for(var n=e.split(t),i="",r=0;r<n.length;r++){var o=n[r];i+=0==r?o:o.charAt(0).toUpperCase()+o.slice(1)}return i},utils.pascalcase=function(e,t){if(-1==e.indexOf(t))return e.charAt(0).toUpperCase()+e.slice(1);for(var n=e.split(t),i="",r=0;r<n.length;r++){var o=n[r];i+=o.charAt(0).toUpperCase()+o.slice(1)}return i},utils.clone=function(e,t){e=e||{};for(var n in e)t[n]=e[n]},utils.get=function(e){for(var t=Array.prototype.slice.call(arguments,1),n={},i=0;i<t.length;i++)n[t[i]]=e[t[i]];return n},utils.isEmpty=function(e){var t=0;for(var n in e)t++;return 0==t},utils.isBlank=function(e){var t=0;for(var n in e)null!=e[n]&&""!==e[n]&&t++;return 0==t},utils.getParameter=function(e,t){t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),i=n.exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},utils.getParameters=function(e){if(-1==e.indexOf("?"))return{};var t={};e=e.substring(e.indexOf("?")+1);for(var n=e.split("&"),i=0;i<n.length;i++){var r=n[i].split("=");if(1==r.length)return{};t[r[0].trim()]=decodeURIComponent(r[1].trim())}return t},utils.isExisting=function(e,t,n){for(var i=0;i<e.length;i++)if(e[i][n]===t[n])return!0;return!1},utils.textSize=function(e,t){var n=document.createElement("canvas"),i=n.getContext("2d");i.font=t;var r=i.measureText(e);return n.remove(),{width:r.width,height:r.height}},utils.base64=function(e){return new Promise(function(t,n){var i=new FileReader;i.readAsDataURL(e),i.onload=function(){return t(i.result)},i.onerror=n})},utils.randomId=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyz",n=t.length,i=0,r=0;r<2;r++){for(i=0;i<6;)e+=t.charAt(Math.floor(Math.random()*n)),i+=1;e+="_"}return e.substring(0,e.length-1)},utils.camelcaseAttribute=function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),"id"!=t&&"name"!=t&&"type"!=t||(t=e+"_"+t),utils.camelcase(t,"_")},utils.nameAttribute=function(e,t,n){n=n||"";var i="",r="";return n.startsWith("&")&&(i=n.substring(1,n.indexOf("(")),r=n.substring(n.indexOf("(")+1,n.indexOf(")"))),e=e.toLowerCase(),t=t.toLowerCase(),""!==i&&(t=t===i?i+"_"+r:t+"_"+i+"_"+r),"id"!=t&&"name"!=t&&"type"!=t||(t=e+"_"+t),t},utils.safeValue=function(e,t){if(!e)return"";for(var n=t.split("."),i=e,r=0;r<n.length;r++)if(!(i=i[n[r]]))return"";return i||""},utils.safeSet=function(e,t,n){if(n){for(var i=t.split("."),r=e,o=0;o<i.length;o++)o==i.length-1?r[i[o]]=n:(void 0===e[i[o]]&&(e[i[o]]={}),r=e[i[o]]);return e}},utils.merge=function(e,t){var n=_objectSpread({},e);for(var i in t){var r=t[i],o=_typeof(r);"string"===o||"number"===o||"boolean"===o?n[i]=r:"object"===o&&(n[i]=utils.merge(n[i],r))}return n},"undefined"==typeof dialog&&(dialog={}),dialog.alert=function(e){layer.open({type:0,icon:0,offset:"150px",shade:0,shadeClose:!0,title:"警告",content:e})},dialog.info=function(e){layer.open({type:0,offset:"150px",shade:0,shadeClose:!0,title:"信息",content:e})},dialog.info2=function(e){layer.open({type:0,offset:"100px",shade:.3,shadeClose:!0,title:"信息",content:e})},dialog.error=function(e){e=e.replaceAll("\n","<br>"),layer.open({type:0,icon:2,offset:"150px",shade:0,shadeClose:!0,title:"错误",content:e})},dialog.success=function(e,t){t?layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e,btn:["确定","确定并返回"],yes:function(e,t){layer.close(e)},btn2:function(e,n){layer.close(e),t()}}):layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e})},dialog.confirm=function(e,t){layer.confirm(e,{title:"确认",btn:["确定","取消"]},function(e,n){var i=dom.formdata(n[0]);layer.close(e),t(i)},function(){})},dialog.view=function(e){var t=e.title,n=e.url;$(document.body);$("#dialogApplication").length&&$("#dialogApplication").remove();var i=[];e.save&&i.push({text:"保存",class:"btn-save",onClicked:e.save}),$.ajax({url:n,success:function(n){var r=Handlebars.compile('<div class="modal fade fadeIn show" id="dialogApplication">  <div class="modal-dialog modal-dialog-centered">    <div class="modal-content">      <div class="modal-header">        <h4 class="modal-title">{{title}}</h4>        <button type="button" class="close" data-dismiss="modal">&times;</button>      </div>      <div id="dialogApplicationBody" class="modal-body">{{{body}}}</div>      <div class="modal-footer">        {{#each buttons}}        <button type="button" class="btn {{class}}" data-dismiss="modal">{{text}}</button>        {{/each}}        <button type="button" class="btn btn-close" data-dismiss="modal">关闭</button>      </div>    </div>  </div></div>'),o=r({title:t,body:n,buttons:i});$(document.body).append(o),e.success&&e.success({onClosed:e.onClosed}),$("#dialogApplication").modal("show")}})},dialog.select=function(e){ajax.view({url:e.url,success:function(t){layer.open({type:0,icon:1,offset:"150px",shade:.5,shadeClose:!0,title:e.title,content:t})}})},dialog.simplelist=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xhr.promise({url:t.url,params:t.params||{}});case 2:for(n=e.sent,i=dom.element('\n    <div>\n      <ul class="list-group"></ul>\n    </div>\n  '),r=dom.find("ul",i),o=0;o<n.length;o++)a=n[o],s=dom.create("li","list-group-item","list-group-item-action"),dom.model(s,a),s.innerText=a[t.fields.text],r.appendChild(s);layer.open({type:0,closeBtn:1,btn:[],shade:.5,shadeClose:!0,title:"",content:i.innerHTML,success:function(e,n){e.get(0).querySelectorAll("li").forEach(function(e,n){dom.bind(e,"click",function(e){layer.close(layer.index);var n=dom.model(e.target);t.onAccept(n)})})}});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),dialog.html=function(e){layer.open({type:0,closeBtn:1,offset:"150px",shade:.5,area:[e.width||"50%",""],shadeClose:!0,title:e.title||"&nbsp;",content:e.html,btn:["确定","关闭"],success:function(t,n){e.load&&e.load(t,n)},yes:function(t,n){var i=dom.find("div.layui-layer-content",n[0]);1==i.children.length?e.success(i.children[0]):e.success(i.children),layer.close(t)},btn1:function(){}})},dialog.iframe=function(e){layer.open({title:e.title,type:2,area:[e.width,e.height],content:e.url,resize:!1,maxmin:!0,shade:!1,success:e.success||function(e,t){}})},ListView.prototype.fetch=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},t=t||{},utils.clone(this.params,n),utils.clone(t,n),i=this,!this.url){e.next=13;break}return this.data=this.data||{},this.data.start=this.start,this.data.limit=this.limit,e.next=11,xhr.promise({url:this.url,params:n});case 11:r=e.sent,Array.prototype.push.apply(i.local,r);case 13:0==i.local.length?this.emptyHtml&&(this.contentContainer.innerHTML=this.emptyHtml):i.append(this.local);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),ListView.prototype.render=function(e,t){var n=this;this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="";var i=this.height-37;if(this.onFilter){
var r=dom.element('\n      <div class="input-group position-sticky" style="top: 0; left: 0; z-index: 10;">\n        <div class="input-group-prepend">\n          <span class="input-group-text" style="border-bottom-left-radius: unset;">\n            <i class="fas fa-search"></i>\n          </span>\n        </div>\n        <input class="form-control" placeholder="搜索..."  style="border-bottom-right-radius: unset;">\n        <div class="input-group-append">\n          <span class="input-group-text pointer text-primary" style="border-bottom-right-radius: unset;">\n            <i class="fas fa-plus"></i>\n          </span>\n          <span class="input-group-text" style="border-bottom-right-radius: unset;">\n            <i class="fas fa-question icon-general"></i>\n          </span>\n          <span class="input-group-text" style="border-bottom-right-radius: unset;">\n            <i class="fas fa-asterisk icon-required"></i>\n          </span>\n        </div>\n      </div>\n    '),o=dom.find("input",r);dom.bind(o,"input",function(e){clearTimeout(n.delayToSearch),n.delayToSearch=setTimeout(function(){n.onFilter(n,o.value)},500)}),this.required||r.children[2].children[2].remove(),this.tooltip||r.children[2].children[1].remove(),this.onAdd||r.children[2].children[0].remove(),0==r.children[2].children.length&&r.children[2].remove(),this.container.appendChild(r)}this.contentContainer=dom.create("div","full-width");var a=dom.create("ul","list-group","full-width","overflow-hidden");if(this.borderless&&a.classList.add("b-a-0"),this.onFilter){var s=dom.create("div");s.style.height=i+"px",s.style.overflowY="auto",s.style.border="1px solid rgba(0, 0, 0, 0.125)",s.style.borderTop="",s.appendChild(a),this.contentContainer.appendChild(s)}else this.contentContainer.appendChild(a);this.container.appendChild(this.contentContainer),!1!==t&&!0!==this.lazy&&this.reload()},ListView.prototype.reload=function(e){e=e||{},dom.find("ul",this.container).innerHTML="",this.start=0,this.url&&(this.local=[]),this.fetch(e)},ListView.prototype.load=function(){this.start=this.local.length,this.fetch()},ListView.prototype.remove=function(e){if(this.idField)for(var t=dom.find("ul",this.container),n=0;n<t.children.length;n++){var i=t.children[n],r=dom.model(i);r[this.idField]===e[this.idField]&&i.remove()}},ListView.prototype.append=function(e,t){var n=this,i=this,r=this.container.querySelector("ul");null==r&&(this.container.innerHTML="",r=dom.create("ul","list-group","full-width"),this.container.appendChild(r));var o=r.querySelectorAll("li").length;if(Array.isArray(e)){for(var a=e,s=0;s<a.length;s++)this.append(a[s]);i.complete&&i.complete(e)}else{var l=e;if(this.idField)for(var d=0;d<r.children.length;d++){var c=r.children[d],u=dom.model(c);if(u[this.idField]===l[this.idField])return}var p=dom.create("li","list-group-item");!1!==this.hoverable&&p.classList.add("list-group-item-action"),!0===this.activateable&&dom.bind(p,"click",function(e){for(var t=0;t<p.parentElement.children.length;t++){p.parentElement.children[t].classList.remove("active")}p.classList.add("active")});for(var h=0;h<this.itemClass.length;h++)p.classList.add(this.itemClass[h]);this.borderless&&p.classList.add("b-a-0"),this.onClick&&dom.bind(p,"click",this.onClick),p.style.paddingLeft="16px",p.style.paddingRight="16px",p.style.paddingTop="8px",p.style.paddingBottom="8px",p.style.display="flex",p.style.alignItems="center",this.onFilter&&(p.style.borderLeftWidth="0",p.style.borderRightWidth="0",p.style.borderBottomWidth="0");var m=this.create(o,l,p);if(m.style.width="100%",this.onCheck){for(var f=dom.element('\n        <input class="pointer checkbox color-info is-outline mr-2" type="checkbox">\n      '),v=0;v<this.selections.length;v++)if(this.compare(this.selections[v],l)){f.setAttribute("checked",!0);break}dom.bind(f,"change",function(){i.onCheck(this.checked,dom.model(this),this)}),dom.model(f,l),p.appendChild(f)}if(p.appendChild(m),this.slidingActions.length>0){this.actionElements=[];for(var g=0;g<this.slidingActions.length;g++){var y=this.slidingActions[g];y.width=parseInt(y.width||64),p.appendChild(y.create())}dom.bind(p,"touchstart",function(e){n.touchStartX=e.touches[0].screenX,n.touchStartY=e.touches[0].screenY}),dom.bind(p,"touchmove",function(e){n.touchMoveX=e.touches[0].screenX,n.touchMoveY=e.touches[0].screenY;var t=n.touchStartX-n.touchMoveX,i=n.touchStartY-n.touchMoveY;if(!(Math.abs(t)<30||Math.abs(i)>30))if(t>0)for(var r=t/n.slidingActions.length,o=1;o<p.children.length;o++){var a=p.children[o].getBoundingClientRect();a.width>=n.slidingActions[o-1].width||(r>=n.slidingActions[o-1].width&&(r=n.slidingActions[o-1].width),p.children[o].style.minWidth=r+"px",p.children[o].style.display="")}else{t=-t/10;for(var s=t/n.slidingActions.length,l=1;l<p.children.length;l++){var d=p.children[l].getBoundingClientRect(),c=d.width-s;c=c<=5?0:c,0==c?(p.children[l].style.width="0",p.children[l].style.minWidth="unset"):p.children[l].style.minWidth=c+"px"}}}),dom.bind(p,"touchend",function(e){n.touchendX=e.changedTouches[0].screenX,n.touchendY=e.changedTouches[0].screenY;var t=n.touchStartX-n.touchendX,i=n.touchStartY-n.touchendY;Math.abs(t)<30||Math.abs(i)>30||(t>=30?n.expandSlidingActions(p):n.collapseSlidingActions(p))})}if(this.idField&&p.setAttribute("data-list-item-id",l[this.idField]),dom.model(p,l),"number"==typeof t?t<0?r.insertBefore(p,r.children[r.children.length+t]):r.insertBefore(p,r.children[t]):r.appendChild(p),this.onRemove){var b=dom.element('\n        <a class="btn text-danger float-right font-18" style="padding: 0; margin-left: auto;">\n          <i class="fas fa-times" style=""></i>\n        </a>\n      ');dom.bind(b,"click",function(e){e.stopPropagation(),i.onRemove(this.parentElement,dom.model(this.parentElement))}),dom.model(b,l),p.appendChild(b)}this.onReorder?this.setReorderable(p):this.draggable&&(p.setAttribute("draggable","true"),p.addEventListener("dragover",function(e){e.preventDefault()}),p.addEventListener("dragstart",function(e){}))}},ListView.prototype.setLocal=function(e){if(!e||0==e.length)return this.contentContainer.innerHTML="",void(this.emptyHtml&&(this.contentContainer.innerHTML=this.emptyHtml));this.contentContainer.innerHTML="";var t=dom.find("ul",this.contentContainer);if(null==t){var n=dom.create("ul","list-group","full-width");this.borderless&&n.classList.add("b-a-0");var i=dom.create("div"),r=this.height-37;i.style.height=r+"px",i.style.overflowY="auto",i.style.border="1px solid rgba(0, 0, 0, 0.125)",i.style.borderTop="",i.appendChild(n),this.contentContainer.appendChild(i)}else t.innerHTML="";var o,a=_createForOfIteratorHelper(e);try{for(a.s();!(o=a.n()).done;){var s=o.value;this.append(s)}}catch(e){a.e(e)}finally{a.f()}},ListView.prototype.replace=function(e){for(var t=this.container.querySelector("ul"),n=0;n<t.children.length;n++){var i=t.children[n];if(dom.model(i)[this.idField]===e[this.idField]){dom.model(i,e),i.innerHTML="",i.appendChild(this.create(n,e));break}}},ListView.prototype.search=function(e){for(var t=this.container.querySelector("ul"),n=0;n<t.children.length;n++){var i=t.children[n];-1!=i.innerText.indexOf(e)?i.style.display="":i.style.display="none"}},ListView.prototype.setReorderable=function(e){var t=this,n=dom.find("ul",this.container);n.addEventListener("dragover",function(e){e.preventDefault()}),n.ondrop=function(e){t.onReorder&&t.onReorder(dom.model(t.draggingElement),t.getItemIndex(t.draggingElement),t.draggingElementOriginalIndex),t.draggingElement.style.opacity="",t.draggingElement=null,t.clonedDraggingElement=null},e.setAttribute("draggable","true"),e.ondragover=function(e){var n=dom.ancestor(e.target,"li"),i=n.parentElement;if(n!=t.draggingElement){var r=t.getItemIndex(n);r<t.draggingElementIndex?i.insertBefore(t.draggingElement,n):r>t.draggingElementIndex&&(null==n.nextElementSibling?i.appendChild(t.draggingElement):i.insertBefore(t.draggingElement,n.nextElementSibling)),t.draggingElementIndex=r,e.preventDefault()}},e.ondragstart=function(e){var n=dom.ancestor(e.target,"li"),i=(n.parentElement,e.layerX,e.layerY);i=e.target.offsetTop+i,t.clonedDraggingElement=n.cloneNode(!0),t.draggingElement=n,t.draggingElement.style.opacity="0.3",t.draggingElementIndex=t.getItemIndex(n),t.draggingElementOriginalIndex=t.draggingElementIndex,e.dataTransfer.setData("id",n.getAttribute("data-list-item-id")),e.dataTransfer.setData("y",i)}},ListView.prototype.getItemIndex=function(e){for(var t=e.parentElement,n=0;n<t.children.length;n++)if(e==t.children[n])return n},ListView.prototype.setHeight=function(e){this.container.querySelector("ul").style.height=e+"px"},ListView.prototype.activate=function(e){for(var t=this.container.querySelector("ul"),n=0;n<t.children.length;n++)t.children[n].classList.remove("active");e.classList.add("active")},ListView.prototype.getCheckedValues=function(){if(!this.onCheck)return[];var e,t=this.container.querySelectorAll("input.checkbox"),n=[],i=_createForOfIteratorHelper(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(!0===r.checked){var o=dom.ancestor(r,"li");n.push(dom.model(o))}}}catch(e){i.e(e)}finally{i.f()}return n},ListView.prototype.expandSlidingActions=function(e){var t=this;if(!(e.children[1].getBoundingClientRect().width>=this.slidingActions[0].width.width)){var n=function(e){for(var n=1;n<e.children.length;n++){var i=e.children[n],r=i.getBoundingClientRect();r.width+5>=t.slidingActions[n-1].width?(i.style.minWidth=t.slidingActions[n-1].width+"px",clearInterval(t.interval4SlidingActions)):i.style.minWidth=r.width+5+"px"}};this.interval4SlidingActions=setInterval(function(){n(e)},5)}},ListView.prototype.collapseSlidingActions=function(e){var t=this;e.children[1].getBoundingClientRect().width<=0||(this.interval4SlidingActions=setInterval(function(){for(var n=1;n<e.children.length;n++){var i=e.children[n],r=i.getBoundingClientRect();r.width-5<=0?(i.style.width="0",i.style.minWidth="unset",i.style.display="none",clearInterval(t.interval4SlidingActions)):i.style.minWidth=r.width-5+"px"}},10))},ListView.prototype.subscribe=function(e,t){},GridView.prototype.fetch=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.url){e.next=2;break}return e.abrupt("return",this.local);case 2:return e.next=4,xhr.promise({url:this.url,params:this.params},t);case 4:return n=e.sent,n&&(this.local=n),e.abrupt("return",this.local);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),GridView.prototype.root=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,i,r,o,a,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=dom.element('\n    <div class="row mx-0">\n    </div>\n  '),n=24/this.columnCount,n<10&&(n="0"+n),i=0;i<this.columnCount;i++)r=dom.element('<div class="col-24-'.concat(n,'"></div>')),t.appendChild(r);return o=0,e.next=7,this.fetch();case 7:for(this.local=e.sent,a=0;a<this.local.length;a++)s=this.local[a],l=this.create(a,s),o=a%this.columnCount,t.children[o].appendChild(l);return e.abrupt("return",t);case 10:case"end":return e.stop()}},e,this)})),GridView.prototype.render=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.container=dom.find(t),e.t0=this.container,e.next=4,this.root();case 4:e.t1=e.sent,e.t0.appendChild.call(e.t0,e.t1);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),GridView.prototype.appendElement=function(e){for(var t=0;t<this.columnCount;t++);},Timeline.prototype.createTile=function(e,t){var n=dom.element('\n    <li class="timeline-item">\n      <div class="time"></div>\n      <div class="small text-muted"></div>\n      <p></p>\n    </li>\n  '),i=n.children[0],r=n.children[1],o=n.children[2];if(this.fnTitle){var a=this.fnTitle(e,t);void 0===a?i.innerHTML="":"string"==typeof a||"number"==typeof a?i.innerHTML=a:i.appendChild(a)}if(this.fnSubtitle){var s=this.fnSubtitle(e,t);void 0===s?r.innerHTML="":"string"==typeof s||"number"==typeof s?r.innerHTML=s:r.appendChild(s)}if(this.fnContent){var l=this.fnContent(e,t);void 0===l?o.innerHTML="":"string"==typeof l||"number"==typeof l?o.innerHTML=l:o.appendChild(l)}return n},Timeline.prototype.render=function(e,t){var n=this;this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="",t=t||{};var i=dom.create("ul","timeline-simple");this.container.appendChild(i);var r={};if(utils.clone(this.params,r),utils.clone(t,r),this.url)xhr.post({url:this.url,params:r,success:function(e){if(e.data)for(var t=e.data,r=0;r<t.length;r++)i.appendChild(n.createTile(t[r],r))}});else for(var o=0;o<n.data.length;o++)i.appendChild(n.createTile(n.data[o],o));n.onComplete&&n.onComplete()},Tabs.prototype.loadPage=function(e,t,n,i){var r=dom.find('div[data-tab-content-id="'.concat(e,'"]'));null==r?(r=dom.templatize('<div data-tab-content-id="{{id}}"></div>',{id:e}),this.content.appendChild(r)):r.innerHTML="",void 0!==t&&ajax.view({url:t,containerId:r,success:i||function(){}}),!0===n&&(r.style.display="none")},Tabs.prototype.reload=function(e){for(var t=this,n=0,i=this.navigator.children[n],r=1;r<this.navigator.children.length;r++){var o=this.navigator.children[r];if(o.classList.contains(this.tabActiveClass)){n=r-1,i=o;break}}this.loadPage(i.getAttribute("data-tab-id"),i.getAttribute("data-tab-url"),!1,function(e){t.tabs[n].success(e)})},Tabs.prototype.render=function(){var e=this,t=this;this.content&&(this.content.innerHTML=""),this.navigator.innerHTML="",this.slider=dom.element('<div class="slider position-absolute"></div>'),this.navigator.appendChild(this.slider),this.tabs.forEach(function(n,i){n.style=n.style||"padding: 0 16px;",n.style?n.style=n.style:n.style+="min-width: "+(16*n.text.length+32)+"px;text-align: center;";var r=dom.templatize('\n      <div class="nav-item font-weight-bold mr-0 pointer" style="{{style}}"\n           data-tab-url="{{{url}}}"\n           data-tab-id="{{{id}}}" >{{{text}}}</div>\n    ',n);t.navigator.appendChild(r),dom.bind(r,"click",function(i){if(!r.classList.contains(t.tabActiveClass)){for(var o=0;o<t.navigator.children.length;o++){t.navigator.children[o].classList.remove(t.tabActiveClass)}if(t.content)for(var a=0;a<t.content.children.length;a++)t.content.children[a].style.display="none";t.activate(r),!0===e.autoClear&&(e.content.innerHTML="");var s=dom.find('div[data-tab-content-id="'+r.getAttribute("data-tab-id")+'"]',t.content);if(null!=s)s.style.display="";else if(n.onClicked)n.onClicked(i);else{var l=r.getAttribute("data-tab-id"),d=r.getAttribute("data-tab-url");t.loadPage(l,d,!1,n.success)}}}),!0===t.lazy?0==i&&(t.activate(r),n.onClicked?n.onClicked():t.loadPage(n.id,n.url,!1,n.success)):0==i?(t.activate(r),n.onClicked?n.onClicked():t.loadPage(n.id,n.url,!1,n.success)):n.onClicked?n.onClicked():t.loadPage(n.id,n.url,!0,n.success)})},Tabs.prototype.activate=function(e){e.classList.add(this.tabActiveClass),this.slider.style.width=e.clientWidth+"px",this.slider.style.left=e.offsetLeft+"px"},DataSheet.prototype.root=function(e){e=e||{};var t=this;this.table=dom.create("table","table","table-bordered");var n=dom.create("thead");this.tbody=dom.create("tbody");var i=dom.create("tr"),r=dom.create("th");r.style.borderBottomWidth="0",r.style.width=this.rowHeaderWidth+"px",n.appendChild(i),this.table.appendChild(n),this.table.appendChild(this.tbody);for(var o=0;o<this.columns.length;o++){var a=this.columns[o];r=dom.create("th","text-center"),r.style.borderBottomWidth="0",r.innerHTML=a.title,i.appendChild(r)}for(var s=0;s<this.rowCount;s++){var l=this.rowHeaders[s],d=dom.create("tr"),c=dom.create("td");c.innerHTML=l.title,c.style.fontWeight="bold",d.appendChild(c);for(var u=0;u<this.columnCount;u++){var p=this.columns[u];c=dom.create("td"),c.style.textAlign="right",c.style.padding="6px 12px",c.setAttribute("data-ds-format",p.format||""),c.setAttribute("data-ds-row",s),c.setAttribute("data-ds-column",u),c.addEventListener("focus",function(){}),e[l.title]&&e[l.title][p.title]?c.innerHTML=e[l.title][p.title]:c.innerHTML="",c.addEventListener("keyup",function(e){var n=this,i=parseInt(n.getAttribute("data-ds-row")),r=parseInt(n.getAttribute("data-ds-column")),o=null;if(13==e.keyCode)o=n;else if(37==e.keyCode){if(0==r)return;o=t.getCell(i,r-1)}else if(38==e.keyCode){if(0==i)return;o=t.getCell(i-1,r)}else if(39==e.keyCode){if(r==t.columnCount-1)return;o=t.getCell(i,r+1)}else if(40==e.keyCode){if(i==t.rowCount-1)return;o=t.getCell(i+1,r)}t.totalize(),null!=o&&(n.blur(),o.focus(),document.execCommand("selectAll",!1,null))}),d.appendChild(c)}this.tbody.appendChild(d)}if(this.totalColumns.length>0){var h=dom.create("tr"),m=dom.create("td");m.innerHTML="合计",m.style.fontWeight="bold",h.appendChild(m);for(var f=0;f<this.columnCount;f++)m=dom.create("td"),h.appendChild(m);this.tbody.appendChild(h)}return this.totalize(),this.table},DataSheet.prototype.getCell=function(e,t){for(var n=dom.find("tbody",this.table),i=null,r=0;r<n.children.length;r++){var o=n.children[r];if(r==e){for(var a=1;a<o.children.length;a++)if(a-1==t){i=o.children[a];break}break}}return i},DataSheet.prototype.render=function(e,t){var n=this;this.container=dom.find(e),this.container.innerHTML="";for(var i=dom.element('\n    <table class="table table-bordered">\n      <thead></thead>\n      <tbody></tbody>\n    </table>\n  '),r=dom.find("thead",i),o=dom.find("tbody",i),a=(this.rowHeaderRowCount,this.colHeaderRowCount,[]),s=0;s<this.colHeaderRowCount;s++){var l=dom.create("tr");a.push(l),r.appendChild(l)}for(var d=0;d<this.colHeaderRowCount;d++)for(var c=a[d],u=0;u<this.colHeaderColumnCount;u++){var p=this.matrixColumn[d][u];if(null!=p){var h=dom.create("th","text-center");h.style="border-bottom-width: 1px;",h.setAttribute("colspan",this.getSpanColumnCount(p)),h.innerHTML=p.title,c.appendChild(h)}}for(var m=0;m<this.rowHeaderRowCount;m++){for(var f=dom.create("tr"),v=0;v<this.rowHeaderColumnCount;v++)!function(){var e=n.matrixRowHeader[_j3][m];if(null==e)return 1;var t=dom.create("td");t.style="vertical-align: middle;",t.setAttribute("rowspan",n.getSpanRowCount(e)),t.innerHTML="<strong>"+e.title+"</strong>",n.onRowHeaderClicked&&(t.onclick=function(e){var i=Array.prototype.slice.call(t.parentElement.children);n.onRowHeaderClicked(t,i.indexOf(t))}),f.appendChild(t)}();for(var g=0;g<this.colHeaderColumnCount-this.rowHeaderColumnCount;g++)!function(){var e=dom.create("td");e.style.textAlign="right",e.style.padding="6px 12px",n.onCellClicked&&(e.onclick=function(t){var i=Array.prototype.slice.call(e.parentElement.children);n.onCellClicked(e,i.indexOf(e))}),f.appendChild(e)}();o.appendChild(f)}this.container.appendChild(i)},DataSheet.prototype.getValues=function(){for(var e={},t=0;t<this.rowHeaders.length;t++){var n=this.rowHeaders[t];e[n.title]={};for(var i=0;i<this.columns.length;i++){var r=this.columns[i];e[n.title][r.title]=this.tbody.rows[t].cells[i+1].innerText.trim()}}return e},DataSheet.prototype.totalize=function(){if(0!=this.totalColumns.length)for(var e=this.tbody.children[this.tbody.children.length-1],t=0;t<this.columns.length;t++){var n=this.columns[t];if(!0===n.totalable){for(var i=0,r=!1,o=0;o<this.rowHeaders.length;o++){var a=parseFloat(this.tbody.rows[o].cells[t+1].innerText.trim());isNaN(a)||(i+=a,r=!0)}isNaN(i)||!0!==r||(e.cells[t+1].innerText=i.toFixed(2))}}},DataSheet.prototype.buildColumnMatrix=function(e,t,n){if(e){var i;t[n]?i=t[n]:(i=[],t.push(i));for(var r=0;r<e.length;r++){var o=e[r];i.push(o);for(var a=this.getSpanColumnCount(o),s=1;s<a;s++)i.push(null);this.buildColumnMatrix(o.children,t,n+1)}}},DataSheet.prototype.buildRowHeaderMatrix=function(e,t,n){if(e){var i;t[n]?i=t[n]:(i=[],t.push(i));for(var r=0;r<e.length;r++){var o=e[r];i.push(o);for(var a=this.getSpanRowCount(o),s=1;s<a;s++)i.push(null);this.buildRowHeaderMatrix(o.children,t,n+1)}}},DataSheet.prototype.getSpanColumnCount=function(e){var t=0;if(!e.children||0==e.children.length)return 1;for(var n=0;n<e.children.length;n++)t+=this.getSpanColumnCount(e.children[n]);return t},DataSheet.prototype.getSpanRowCount=function(e){return e.children&&0!=e.children.length?e.children.length:1},DataSheet.prototype.getRowCount=function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];t+=1,i.children&&(t+=this.getRowCount(i.children))}return t},DataSheet.prototype.getColumnCount=function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];t+=1,i.children&&(t+=this.getColumnCount(i.children))}return t},DataSheet.prototype.getColumnHeaderRowCount=function(e){for(var t=1,n=0;n<e.length;n++){var i=1,r=e[n];r.children&&(i+=this.getColumnHeaderRowCount(r.children)),i>t&&(t=i)}return t},DataSheet.prototype.getRowHeaderRowCount=function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];i.children?t+=this.getRowHeaderRowCount(i.children):t+=1}return t},DataSheet.prototype.getColumnHeaderColumnCount=function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];i.children?t+=this.getColumnHeaderColumnCount(i.children):t+=1}return t},DataSheet.prototype.getRowHeaderColumnCount=function(e){for(var t=1,n=0;n<e.length;n++){var i=1,r=e[n];r.children&&(i+=this.getRowHeaderColumnCount(r.children)),i>t&&(t=i)}return t},Chat.MESSAGE_TYPE_TEXT="TEXT",Chat.MESSAGE_TYPE_IMAGE="IMAGE",Chat.MESSAGE_TYPE_AUDIO="AUDIO",Chat.MESSAGE_TYPE_VIDEO="VIDEO",Chat.MESSAGE_TYPE_PATIENT="PATIENT",Chat.MESSAGE_TYPE_CUSTOM="CUSTOM",Chat.MESSAGE_STATUS_UNREAD="01",Chat.MESSAGE_STATUS_READ="02",Chat.MESSAGE_STATUS_REVOKE="90",Chat.prototype.init=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,o,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onInit();case 2:return n=this,this.scheduleName=t,i=this.userId+"@"+this.userType,e.next=7,xhr.promise({url:this.host+"/api/v3/common/script/tim/user_signature",params:{userId:i}});case 7:r=e.sent,o={SDKAppID:r.appId},this.tim=TIM.create(o),this.tim.setLogLevel(1),this.tim.registerPlugin({"tim-upload-plugin":TIMUploadPlugin}),this.tim.login({userID:i,userSig:r.signature}),this.tim.on(TIM.EVENT.SDK_READY,function(e){}),this.tim.on(TIM.EVENT.MESSAGE_RECEIVED,function(e){for(var t=0;t<e.data.length;t++){var n=e.data[t],i=Chat.MESSAGE_TYPE_TEXT,r=null;"TIMCustomElem"===n.type?(r=JSON.parse(n.payload.data).messageContent,r.imagepath?i=Chat.MESSAGE_TYPE_IMAGE:r.audiopath?i=Chat.MESSAGE_TYPE_AUDIO:r.archiveId&&(i=Chat.MESSAGE_TYPE_PATIENT)):r=n.payload.text,a.onMessageReceived({senderId:n.conversationID.substring(3),messageTime:moment(1e3*e.data[t].time).format("YYYY-MM-DD HH:mm"),messageType:i,messageContent:r})}});case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),Chat.prototype.getConversations=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,i,r,o,a,s,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId}});case 2:for(t=e.sent,n={},i=0;i<t.length;i++)r=t[i],o=r.senderId+"#"+r.senderType,n[o]?(a=n[o],a.createTime=r.createTime,a.messages.push(r)):(s={messages:[]},n[o]=s,s.id=o,s.createTime=r.createTime,s.name=r.senderType,s.senderId=r.senderId,s.senderType=r.senderType,s.messages.push(r));l=[];for(d in n)l.push(n[d]);return e.abrupt("return",l);case 8:case"end":return e.stop()}},e,this)})),Chat.prototype.fetchMessages=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i){var r,o,a,s,l,d,c,u,p,h,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,o="",o=t>this.userId?t+"&"+this.userId:this.userId+"&"+t,e.next=5,xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{conversationId:o,_order_by:"messageTime asc"}});case 5:for(a=e.sent,s=[],l=null,d=0;d<a.length;d++)c=a[d],u=moment(c.createTime).format("YYYY-MM-DD HH:mm"),u!=l&&(l=u,s.push({createTime:u,groupingMessages:[{direction:c.senderId==this.userId?"outgoing":"incoming",messages:[]}]})),p=s[s.length-1],h=p.groupingMessages[p.groupingMessages.length-1],m="",m=c.senderId==this.userId?"outgoing":"incoming",h.direction===m?h.messages.push(c):p.groupingMessages.push({direction:m,messages:[c]});return e.abrupt("return",s);case 10:case"end":return e.stop()}},e,this)}));return function(t,n,i){return e.apply(this,arguments)}}(),Chat.prototype.fetchUnreadMessages=function(){var e=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId,receiverType:this.userType}}).then(function(t){e.onUnreadMessages(t)})},Chat.prototype.sendMessage=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i,r,o){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=o||this.userId+"&"+t,"string"==typeof r&&(r=r.replace("\\","\\\\")),e.abrupt("return",xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/save",params:{conversationId:o,senderId:this.userId,senderType:this.userType,receiverId:t,receiverType:n,messageType:i,messageTime:"now",messageContent:r,createTime:"now",status:Chat.MESSAGE_STATUS_UNREAD,"||stdbiz/pim/conversation/merge":{conversationId:o,conversationName:o,unreadCount:1,lastConversationTime:"now"}}}));case 3:case"end":return e.stop()}},e,this)}));return function(t,n,i,r,o){return e.apply(this,arguments)}}(),Chat.prototype.sendTextMessage=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i,r){var o,a,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t+"@"+n,a=this,e.next=4,this.sendMessage(t,n,Chat.MESSAGE_TYPE_TEXT,i,r);case 4:return s=e.sent,l=this.tim.createTextMessage({to:o,conversationType:TIM.TYPES.CONV_C2C,payload:{id:s.conversationMessageId,text:i}}),e.abrupt("return",this.tim.sendMessage(l));case 7:case"end":return e.stop()}},e,this)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),Chat.prototype.sendImageMessage=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i,r){var o,a,s,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t+"@"+n,a=this,e.next=4,xhr.promise({url:this.host+"/api/v3/common/image",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:i.ext}});case 4:return s=e.sent,e.next=7,this.sendMessage(t,n,Chat.MESSAGE_TYPE_IMAGE,JSON.stringify({imagepath:s.filepath,thumbnail:s.thumbnail}),r);case 7:return l=e.sent,d=this.tim.createCustomMessage({to:o,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_IMAGE,messageContent:{id:l.conversationMessageId,imagepath:s.filepath,thumbnail:s.thumbnail}})}}),e.abrupt("return",this.tim.sendMessage(d));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),Chat.prototype.sendAudioMessage=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i,r){var o,a,s,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t+"@"+n,a=this,e.next=4,xhr.promise({url:this.host+"/api/v3/common/audio",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:"ogg"}});case 4:return s=e.sent,e.next=7,this.sendMessage(t,n,Chat.MESSAGE_TYPE_AUDIO,JSON.stringify({audiopath:s.filepath,duration:s.duration}),r);case 7:return l=e.sent,d=this.tim.createCustomMessage({to:o,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_AUDIO,messageContent:{id:l.conversationMessageId,audiopath:s.filepath,duration:s.duration}})}}),e.abrupt("return",this.tim.sendMessage(d));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),Chat.prototype.sendPatientMessage=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i,r){var o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t+"@"+n,e.next=3,this.sendMessage(t,n,Chat.MESSAGE_TYPE_PATIENT,JSON.stringify(i),r);case 3:return a=e.sent,i.id=a.conversationMessageId,s=this.tim.createCustomMessage({to:o,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_PATIENT,messageContent:i})}}),e.abrupt("return",this.tim.sendMessage(s));case 7:case"end":return e.stop()}},e,this)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),Chat.prototype.readMessages=function(e){var t=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{senderId:e,readTime:"now",status:Chat.MESSAGE_STATUS_READ}}).then(function(e){t.onReadMessages(e)})},Chat.prototype.revokeMessage=function(e){var t=this;return xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{messageId:e,status:Chat.MESSAGE_STATUS_REVOKE}}).then(function(n){t.onRevokeMessage(e)})},Chat.prototype.stop=function(){schedule.stop(this.scheduleName)},"undefined"!=typeof module&&(module.exports={Chat:Chat}),Sparkline.PADDING=3,Sparkline.prototype.render=function(e){this.container=dom.find(e);for(var t=this.container.getBoundingClientRect(),n=t.width,i=t.height,r=0,o=0,a=0;a<this.data.length;a++){var s=parseFloat(this.data[a]);0==r&&(r=s),r>s&&(r=s),o<s&&(o=s)}var l=document.createElement("canvas");l.width=n,l.height=i,this.container.appendChild(l);var d=l.getContext("2d"),c=window.devicePixelRatio||1;l.width=t.width*c,l.height=t.height*c,l.style="width: 100%; height: 100%;",d.scale(c,c),"line"==this.type?this.line(d,o,r,n,i):"bar"==this.type&&this.bar(d,o,r,n,i),this.container.appendChild(l)},Sparkline.prototype.line=function(e,t,n,i,r){var o=Math.abs(t-n),a=(r-2*Sparkline.PADDING)/o,s=i/(this.data.length-1);e.strokeStyle=this.color,e.lineWidth=3,e.beginPath();for(var l=0;l<this.data.length;l++){var d=l*s,c=r-(this.data[l]-n)*a-Sparkline.PADDING;0==l?e.moveTo(d,c):e.lineTo(d,c)}e.stroke()},Sparkline.prototype.bar=function(e,t,n,i,r){var o=(Math.abs(t-n),(r-2*Sparkline.PADDING)/t),a=i/this.data.length-Sparkline.PADDING;e.fillStyle=this.color,e.lineWidth=0,e.beginPath();for(var s=0;s<this.data.length;s++){var l=(a+Sparkline.PADDING)*s,d=r-Sparkline.PADDING-this.data[s]*o;e.rect(l.toFixed(0),d.toFixed(0),a.toFixed(0),(this.data[s]*o).toFixed(0)),e.fill()}},ruler={initPlugin:function(e){function t(e){e-=25,m.clearRect(0,0,d,r.height),r.background&&(m.fillStyle=r.background,m.fillRect(0,0,h.width,r.height));for(var t=0;t<r.maxScale;t++)m.beginPath(),m.save(),m.strokeStyle=r.minicolor?r.minicolor:"#F6F6F6",m.lineWidth=1,m.lineCap="round",m.moveTo(c*t-e*c,0),m.lineTo(c*t-e*c,Math.floor(.3*r.height)),t%5==0&&(m.strokeStyle=r.color?r.color:"#999",m.lineTo(c*t-e*c,Math.floor(.35*r.height))),t%10==0&&(m.strokeStyle=r.color?r.color:"#666",m.lineTo(c*t-e*c,Math.floor(.52*r.height))),m.stroke(),m.restore(),m.closePath();m.beginPath(),m.font="14px Arial",m.fillStyle=r.color?r.color:"#333",m.textAlign="center",m.textBaseline="middle",u.forEach(function(t,n){m.fillText(t.toString(),c*n*10-e*c,Math.floor(.78*r.height))}),m.closePath(),m.beginPath(),m.save(),m.strokeStyle=r.markColor,m.lineWidth=2,m.lineCap="round",m.moveTo(d/2,0),m.lineTo(d/2,Math.floor(.52*r.height)),m.stroke(),m.restore(),m.closePath()}function n(){if((g=Math.floor((v-f)/(d/50)))===y)return!1;y=g,l=b+g,(l>=r.maxScale||l<=0)&&(l=l>=r.maxScale?r.maxScale:0),t(l),r.isConstant&&e.success&&e.success(l)}function i(){l>s?b=l=l>s?s:l:l<a&&(b=l=l<a?a:l),t(l),e.success&&e.success(l)}var r={el:e.el,height:e.height||60,maxScale:e.maxScale||200,startValue:e.startValue||0,region:e.region||!1,background:e.background||!1,color:e.color||!1,markColor:e.markColor||"#FFCC33",
isConstant:e.isConstant||!1,minicolor:e.minicolor||"#f6f6f6",scale:e.scale||1,point:e.point||0};if(!r.el)return console.warn("没有容器元素的参数"),!1;var o=e.el;o.style.height=r.height<50?"50px":r.height+"px",r.maxScale=r.maxScale<50?50:r.maxScale,r.startValue>r.maxScale&&(r.startValue=r.maxScale);var a=0,s=r.maxScale;r.region&&(a=Math.floor(r.region[0]),s=Math.floor(r.region[1]));for(var l=r.startValue,d=o.offsetWidth,c=d/50,u=[],p=0;p<=r.maxScale;p+=10)u.push((p/r.scale).toFixed(r.point));var h=o.getElementsByTagName("canvas")[0];h||(h=document.createElement("canvas"),h.width=d,h.height=r.height,o.appendChild(h));var m=h.getContext("2d");window.devicePixelRatio&&(h.width=window.devicePixelRatio*d,h.height=window.devicePixelRatio*r.height,m.scale(window.devicePixelRatio,window.devicePixelRatio)),window.devicePixelRatio&&(h.style.transform="scale("+1/window.devicePixelRatio+")",h.style.transformOrigin="left top"),t(l);var f=0,v=0,g=0,y=0,b=l;if(!h)return!1;h.addEventListener("touchstart",function(e){f=e.targetTouches[0].pageX},!1),h.addEventListener("touchmove",function(e){v=e.targetTouches[0].pageX,n()},!1),h.addEventListener("touchend",function(e){b=l,i()},!1);var w=!1;h.addEventListener("mousedown",function(e){w=!0,f=e.layerX},!1),h.addEventListener("mousemove",function(e){if(!w)return!1;v=e.layerX,n()},!1),h.addEventListener("mouseup",function(e){b=l,w=!1,i()},!1),h.addEventListener("mouseleave",function(e){w&&(b=l,w=!1,i())},!1)}},MobileWizard.prototype.render=function(e,t){this.container=dom.find(e),this.content=dom.find("div.wizard-content",this.root);for(var n=dom.find("div.wizard-progress",this.root),i=0;i<this.steps.length;i++){var r=this.steps[i],o=i+1,a=dom.element('\n      <div class="step-'.concat(o,'" widget-on-render="" data-step="').concat(i,'" style="cursor: pointer;">\n        <strong class="title"></strong>\n      </div>\n    '));r.index=i,a.style.width=100/this.steps.length+"%",!0===r.active&&(this.current=r),dom.find("strong.title",a).innerHTML=r.title,n.appendChild(a)}this.container.appendChild(this.root),this.display(this.current)},MobileWizard.prototype.display=function(e){var t=dom.find('div[data-step="'+e.index+'"]',this.root);t.classList.remove("completed"),t.classList.add("active"),e.onClicked||kuim.navigateWidget(e.url,this.content,{wizard:this})},MobileWizard.prototype.commit=function(e){var t=dom.find("div.active",this.root),n=parseInt(t.getAttribute("data-step"));t.classList.remove("active"),t.classList.add("completed"),this.display(this.steps[n+1])},MobileWizard.prototype.rollback=function(){var e=dom.find("div.step.active",this.container),t=parseInt(e.getAttribute("data-step"));e.classList.remove("active"),this.display(this.steps[t-1])},MobileForm.prototype.render=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.innerHTML="",e.next=3,this.root();case 3:n=e.sent,t.appendChild(n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),MobileForm.prototype.root=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,i,r,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=dom.element('\n    <div class="form form-horizontal"></div>\n  '),n=0;case 2:if(!(n<this.fields.length)){e.next=40;break}if(i=this.fields[n],r=null,"date"!==i.input){e.next=9;break}r=this.buildDate(i),e.next=36;break;case 9:if("time"!==i.input){e.next=13;break}r=this.buildTime(i),e.next=36;break;case 13:if("bool"!==i.input){e.next=17;break}r=this.buildSwitch(i),e.next=36;break;case 17:if("radio"!==i.input){e.next=23;break}return e.next=20,this.buildRadio(i);case 20:r=e.sent,e.next=36;break;case 23:if("check"!==i.input){e.next=29;break}return e.next=26,this.buildCheck(i);case 26:r=e.sent,e.next=36;break;case 29:if("select"!==i.input){e.next=35;break}return e.next=32,this.buildSelect(i);case 32:r=e.sent,e.next=36;break;case 35:"hidden"===i.input?r=dom.templatize('\n        <input type="hidden" name="{{name}}">\n      ',i):"mobile"===i.input?r=this.buildMobile(i):"id"===i.input?r=this.buildId(i):"district"===i.input?r=this.buildDistrict(i):"ruler"===i.input?r=this.buildRuler(i):"images"===i.input?r=this.buildImages(i):"longtext"===i.input?(r=dom.templatize('\n        <div class="form-group row">\n          <label class="col-form-label col-24-06">{{title}}</label>\n          <div class="col-24-18">\n            <textarea type="text" name="{{name}}" class="form-control" placeholder="请填写"></textarea>\n          </div>\n        </div>\n      ',i),!0===this.readonly&&(dom.find("textarea",r).setAttribute("placeholder",""),dom.find("textarea",r).setAttribute("readonly",!0))):"icon"===i.input?(r=dom.templatize('\n        <div class="form-group row">\n          <label class="col-form-label col-24-06">{{title}}</label>\n          <div class="col-24-18"></div>\n        </div>\n      ',i),o=i.create(i.value),r.children[1].appendChild(o)):"icons"===i.input?(r=dom.templatize('\n        <div class="form-group row">\n          <label class="col-form-label col-24-06">{{title}}</label>\n          <div class="col-24-18"></div>\n        </div>\n      ',i),a=i.create(i.value),r.children[1].appendChild(a)):"rating"===i.input?(r=dom.templatize('\n        <div class="form-group row">\n          <label class="col-form-label col-24-06">{{title}}</label>\n          <div class="col-24-18"></div>\n        </div>\n      ',i),s=i.create(i.value),r.children[1].appendChild(s)):(r=dom.templatize('\n        <div class="form-group row">\n          <label class="col-form-label col-24-06">{{title}}</label>\n          <div class="col-24-18 d-flex">\n            <input type="text" name="{{name}}" class="form-control" placeholder="请填写">\n            {{#if unit}}\n            <span class="ml-auto text-muted small mr-2 mt-2">{{unit}}</span>\n            {{/if}}\n          </div>\n        </div>\n      ',i),!0===this.readonly&&(dom.find("input",r).setAttribute("placeholder",""),dom.find("input",r).setAttribute("readonly",!0)));case 36:t.appendChild(r);case 37:n++,e.next=2;break;case 40:return e.abrupt("return",t);case 41:case"end":return e.stop()}},e,this)})),MobileForm.prototype.buildDate=function(e){var t=dom.templatize('\n    <div class="form-group row">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 d-flex">\n        <input type="text" class="form-control" readonly placeholder="请选择...">\n        <input type="hidden" name="{{name}}">\n        <span class="ml-auto material-icons font-16 position-relative" style="top: 5px; left: -2px;">calendar_today</span>\n      </div>\n    </div>\n  ',e);return!0===this.readonly?(t.querySelectorAll("input")[0].setAttribute("placeholder",""),t):(dom.bind(t,"click",function(t){new Rolldate({title:e.title,confirm:function(e){var n=dom.ancestor(t.target,"div","col-24-18");dom.find("input[type=text]",n).value=moment(e).format("YYYY年MM月DD日"),dom.find("input[type=hidden]",n).value=moment(e).format("YYYY-MM-DD HH:mm:ss")}}).show()}),t)},MobileForm.prototype.buildTime=function(e){var t=dom.templatize('\n    <div class="form-group row">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 d-flex">\n        <input type="text" class="form-control" readonly placeholder="请选择...">\n        <input type="hidden" name="{{name}}">\n        <span class="ml-auto material-icons font-16 position-relative" style="top: 5px; left: -2px;">schedule</span>\n      </div>\n    </div>\n  ',e);return!0===this.readonly?(t.querySelectorAll("input")[0].setAttribute("placeholder",""),t):(dom.bind(t,"click",function(t){new Rolldate({title:e.title,confirm:function(e){var n=dom.ancestor(t.target,"div","col-24-18");dom.find("input[type=text]",n).value=moment(e).format("YYYY年MM月DD日"),dom.find("input[type=hidden]",n).value=moment(e).format("YYYY-MM-DD HH:mm:ss")}}).show()}),t)},MobileForm.prototype.buildSwitch=function(e){return dom.templatize('\n    <div class="form-group row">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 d-flex pr-3 pl-3">\n        <label class="c-switch c-switch-label c-switch-pill c-switch-info mt-1" style="min-width: 48px;">\n        <input class="c-switch-input" value="T" name="{{name}}" type="checkbox">\n        <span class="c-switch-slider" data-checked="是" data-unchecked="否"></span>\n      </label>\n      </div>\n    </div>\n  ',e)},MobileForm.prototype.buildRadio=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=dom.templatize('\n    <div class="form-group row">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 input-group pr-3 pl-3"></div>\n    </div>\n  ',t),!0!==this.readonly){e.next=4;break}return n.children[1].innerText=t.text||"",e.abrupt("return",n);case 4:i=_createForOfIteratorHelper(t.options.values);try{for(i.s();!(r=i.n()).done;)o=r.value,o.checked=o.checked||!1,a=dom.templatize('\n      <div class="form-check form-check-inline">\n        <input name="{{name}}" value="{{value}}" {{#if checked}}checked{{/if}} type="radio" class="form-check-input radio color-primary is-outline">\n        <label class="form-check-label" for="">{{text}}</label>\n      </div>\n    ',_objectSpread(_objectSpread({},o),{},{name:t.name})),n.children[1].appendChild(a)}catch(e){i.e(e)}finally{i.f()}return e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),MobileForm.prototype.buildCheck=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=dom.templatize('\n    <div class="form-group row">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 input-group pr-3 pl-3"></div>\n    </div>\n  ',t),!0!==this.readonly){e.next=4;break}return n.children[1].innerText=t.text||"",e.abrupt("return",n);case 4:i=_createForOfIteratorHelper(t.options.values);try{for(i.s();!(r=i.n()).done;)o=r.value,o.checked=o.checked||!1,a=dom.templatize('\n      <div class="form-check form-check-inline">\n        <input name="{{name}}" value="{{value}}" {{#if checked}}checked{{/if}} type="checkbox" class="form-check-input checkbox color-primary is-outline">\n        <label class="form-check-label" for="">{{text}}</label>\n      </div>\n    ',_objectSpread(_objectSpread({},o),{},{name:t.name})),n.children[1].appendChild(a)}catch(e){i.e(e)}finally{i.f()}return e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),MobileForm.prototype.buildSelect=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=dom.templatize('\n    <div class="form-group row">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 d-flex">\n        <input type="text" class="form-control" readonly placeholder="请选择...">\n        <input type="hidden" name="{{name}}">\n        <span class="ml-auto material-icons font-20 position-relative" style="top: 3px;">expand_more</span>\n      </div>\n    </div>\n  ',t),!0!==this.readonly){e.next=4;break}return n.querySelectorAll("input")[0].setAttribute("placeholder",""),e.abrupt("return",n);case 4:if((i=t.values)||!t.url){e.next=12;break}return r=[],e.next=9,xhr.promise({url:t.url,params:{}});case 9:for(r=e.sent,i=[],o=0;o<r.length;o++)i.push({text:r[o][t.textField],value:r[o][t.valueField]});case 12:return dom.bind(n,"click",function(e){new Rolldate({title:t.title,format:"oo",values:i,confirm:function(t){var n=dom.ancestor(e.target,"div","col-24-18");dom.find("input[type=text]",n).value=t.text,dom.find("input[type=hidden]",n).value=t.value}}).show()}),e.abrupt("return",n);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),MobileForm.prototype.buildMobile=function(e){var t=dom.templatize('\n    <div class="form-group row">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 d-flex">\n        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请输入...">\n      </div>\n    </div>\n  ',e),n=dom.find("input",t);return!0===this.readonly?(n.setAttribute("placeholder",""),t):(dom.bind(t,"click",function(e){new Numpad({type:"mobile",success:function(e){n.value=e}}).show(document.body)}),t)},MobileForm.prototype.buildId=function(e){var t=dom.templatize('\n    <div class="form-group row">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 d-flex">\n        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请输入...">\n      </div>\n    </div>\n  ',e),n=dom.find("input",t);return!0===this.readonly?(n.setAttribute("placeholder",""),t):(dom.bind(t,"click",function(e){new Numpad({type:"id",success:function(e){n.value=e}}).show(document.body)}),t)},MobileForm.prototype.buildDistrict=function(e){var t=dom.templatize('\n    <div class="form-group row">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 d-flex">\n        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请选择...">\n        <span class="ml-auto material-icons font-20 position-relative" style="top: 3px;">expand_more</span>\n      </div>\n    </div>\n  ',e),n=dom.find("input",t);return!0===this.readonly?(n.setAttribute("placeholder",""),t):(dom.bind(t,"click",function(e){new DistrictPicker({type:"id",success:function(e){var t="";e.province&&(t+=e.province.chineseDistrictName),e.city&&(t+=" "+e.city.chineseDistrictName),e.county&&(t+=" "+e.county.chineseDistrictName),e.town&&(t+=" "+e.town.chineseDistrictName),n.value=t,n.setAttribute("data-value",JSON.stringify(e))}}).show(document.body)}),t)},MobileForm.prototype.buildRuler=function(e){var t=dom.templatize('\n    <div class="form-group row">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 d-flex">\n        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请选择...">\n        {{#if unit}}\n        <span class="ml-auto text-muted small mr-2 mt-2">{{unit}}</span>\n        {{/if}}\n        <span class="ml-auto material-icons font-20 position-relative" style="top: 3px;">straighten</span>\n      </div>\n    </div>\n  ',e),n=dom.find("input",t);return!0===this.readonly?(n.setAttribute("placeholder",""),t):(dom.bind(t,"click",function(e){}),t)},MobileForm.prototype.buildImages=function(e){return dom.templatize('\n    <div class="form-group row pb-2">\n      <label class="col-form-label col-24-06">{{title}}</label>\n      <div class="col-24-18 d-flex">\n        <div class="d-flex align-items-center justify-content-center" \n             style="height: 80px; width: 80px; border: 1px solid #eee;">\n          <i class="fas fa-plus" style="color: #bbb;"></i>\n        </div>\n      </div>\n    </div>\n  ',e)},Numpad.prototype.root=function(){var e=this,t=dom.templatize('\n    <div class="popup-container">\n      <div class="popup-mask"></div>\n      <div class="popup-bottom numpad in">\n        <div class="popup-title">\n          <button class="cancel">取消</button>\n          <span class="value"></span>\n          <span class="unit">{{unit}}</span>\n          <button class="confirm">确认</button>\n        </div>\n        <div class="d-flex flex-wrap full-width">\n          <div class="col-24-08" style="line-height: 48px;">\n            <button class="number">1</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px;">\n            <button class="number">2</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px;">\n            <button class="number">3</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px;">\n            <button class="number">4</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px;">\n            <button class="number">5</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px;">\n            <button class="number">6</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px;">\n            <button class="number">7</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px;">\n            <button class="number">8</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px;">\n            <button class="number">9</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px;">\n            <button widget-id="buttonSpecial" class="number">.</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px;">\n            <button class="number">0</button>\n          </div>\n          <div class="col-24-08" style="line-height: 48px; font-size: 24px;">\n            <button class="number">\n              <i class="fas fa-backspace" style="font-size: 20px;"></i>\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',this);this.bottom=dom.find(".popup-bottom",t);var n=dom.find(".popup-mask",t),i=dom.find(".confirm",t),r=dom.find(".cancel",t),o=dom.find(".value",t),a=dom.find("[widget-id=buttonSpecial]",t);"id"==this.type?(a.innerText="X",this.regex=/^.{0,18}$/):"mobile"==this.type&&(a.remove(),this.regex=/^.{0,11}$/);for(var s=t.querySelectorAll(".number"),l=0;l<s.length;l++){var d=s[l];dom.bind(d,"click",function(t){var n=o.innerText,i=t.currentTarget.innerText;if(""==i){if(""===n)return;n=n.substr(0,n.length-1)}else e.regex.test(n+i)&&(n+=i);o.innerText=n})}return dom.bind(n,"click",function(t){t.stopPropagation(),t.preventDefault(),e.close()}),dom.bind(r,"click",function(t){e.close()}),dom.bind(i,"click",function(t){e.success(o.innerText),e.close()}),t},Numpad.prototype.show=function(e){e.appendChild(this.root())},Numpad.prototype.close=function(){var e=this;this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(function(){e.bottom.parentElement.remove()},300)},DistrictPicker.prototype.root=function(){var e=this,t=dom.templatize('\n    <div class="popup-container">\n      <div class="popup-mask"></div>\n      <div class="popup-bottom district-picker">\n        <div class="popup-title">\n          <button class="cancel">取消</button>\n          <span class="value"></span>\n          <span class="unit">{{unit}}</span>\n          <button class="confirm">确认</button>\n        </div>\n        <div class="bottom-dialog-body">\n          <div style="padding: 4px 16px">\n            <div class="d-flex" style="line-height: 40px;">\n              <strong widget-id="widgetProvince" class="font-16">选择省份</strong>\n              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>\n            </div>\n            <div class="d-flex" style="line-height: 40px;">\n              <strong widget-id="widgetCity" class="font-16">选择城市</strong>\n              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>\n            </div>\n            <div class="d-flex" style="line-height: 40px;">\n              <strong widget-id="widgetCounty" class="font-16">选择区县</strong>\n              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>\n            </div>\n            <div class="d-flex" style="line-height: 40px;">\n              <strong widget-id="widgetTown" class="font-16">选择街道/乡镇</strong>\n              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>\n            </div>\n          </div>\n          <div style="border-top: 1px solid var(--color-divider);"></div>\n          <ul widget-id="widgetDistrict" class="list-group" style="height: 240px; overflow-y: auto;">\n          </ul>\n        </div>\n      </div>\n    </div>\n  ',this);this.bottom=dom.find(".popup-bottom",t),this.district=dom.find("[widget-id=widgetDistrict]",t),this.province=dom.find("[widget-id=widgetProvince]",t),this.city=dom.find("[widget-id=widgetCity]",t),this.county=dom.find("[widget-id=widgetCounty]",t),this.town=dom.find("[widget-id=widgetTown]",t);var n=dom.find(".popup-mask",t),i=dom.find(".confirm",t),r=dom.find(".cancel",t);dom.find(".value",t);dom.bind(n,"click",function(t){e.close()}),dom.bind(r,"click",function(t){e.close()}),this.selections.province&&(this.province.setAttribute("data-model-chinese-district-code",this.selections.province.chineseDistrictCode),this.province.innerText=this.selections.province.chineseDistrictName),this.selections.city&&(this.city.setAttribute("data-model-chinese-district-code",this.selections.city.chineseDistrictCode),this.city.innerText=this.selections.city.chineseDistrictName),this.selections.county&&(this.county.setAttribute("data-model-chinese-district-code",this.selections.county.chineseDistrictCode),this.county.innerText=this.selections.county.chineseDistrictName),this.selections.town&&(this.town.setAttribute("data-model-chinese-district-code",this.selections.town.chineseDistrictCode),this.town.innerText=this.selections.town.chineseDistrictName),dom.bind(i,"click",function(t){var n={},i=e.province.getAttribute("data-model-chinese-district-code"),r=e.city.getAttribute("data-model-chinese-district-code"),o=e.county.getAttribute("data-model-chinese-district-code"),a=e.town.getAttribute("data-model-chinese-district-code");""!=i&&(n.province={chineseDistrictCode:i,chineseDistrictName:e.province.innerText}),""!=r&&(n.city={chineseDistrictCode:r,chineseDistrictName:e.city.innerText}),""!=o&&(n.county={chineseDistrictCode:o,chineseDistrictName:e.county.innerText}),""!=a&&(n.town={chineseDistrictCode:a,chineseDistrictName:e.town.innerText}),e.success(n),e.close()});var o=function(t){var n=dom.ancestor(t.target,"div"),i=dom.find("strong",n),r=i.getAttribute("data-model-chinese-district-code");9==r.length?e.renderDistrict(r.substr(0,6)):e.renderDistrict(r.substr(0,r.length-2))};return dom.bind(this.province.parentElement,"click",function(e){o(e)}),dom.bind(this.city.parentElement,"click",function(e){o(e)}),dom.bind(this.county.parentElement,"click",function(e){o(e)}),dom.bind(this.town.parentElement,"click",function(e){o(e)}),setTimeout(function(){e.bottom.classList.add("in")},50),t},DistrictPicker.prototype.renderDistrict=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,o,a,s,l=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,i=null,t){e.next=13;break}n="\n      and length(chndistcd) = 2\n    ",i=this.province,this.city.setAttribute("data-model-chinese-district-code",""),this.city.innerText="选择城市",this.county.setAttribute("data-model-chinese-district-code",""),this.county.innerText="选择区县",this.town.setAttribute("data-model-chinese-district-code",""),this.town.innerText="选择街道/乡镇",e.next=35;break;case 13:if(2!=t.length){e.next=22;break}n="\n      and length(chndistcd) = 4 and substring(chndistcd, 1, 2) = '".concat(t,"'\n    "),i=this.city,this.county.setAttribute("data-model-chinese-district-code",""),this.county.innerText="选择区县",this.town.setAttribute("data-model-chinese-district-code",""),this.town.innerText="选择街道/乡镇",e.next=35;break;case 22:if(4!=t.length){e.next=29;break}n="\n      and length(chndistcd) = 6 and substring(chndistcd, 1, 4) = '".concat(t,"'\n    "),i=this.county,this.town.setAttribute("data-model-chinese-district-code",""),this.town.innerText="选择街道/乡镇",e.next=35;break;case 29:if(6!=t.length){e.next=34;break}n="\n      and length(chndistcd) = 9 and substring(chndistcd, 1, 6) = '".concat(t,"'\n    "),i=this.town,e.next=35;break;case 34:return e.abrupt("return");case 35:return e.next=37,xhr.promise({url:"/api/v3/common/script/stdbiz/gb/chinese_district/find",params:{_and_condition:n,_order_by:"convert(chndistnm using gbk) asc"}});case 37:for(r=e.sent,this.district.innerHTML="",o=0;o<r.length;o++)a=r[o],s=dom.templatize('\n      <li class="list-group-item">{{chineseDistrictName}}</li>\n    ',a),dom.model(s,a),dom.bind(s,"click",function(e){var t=dom.ancestor(e.target,"li"),n=dom.model(t);i.innerText=n.chineseDistrictName,i.setAttribute("data-model-chinese-district-code",n.chineseDistrictCode),l.renderDistrict(n.chineseDistrictCode)}),this.district.appendChild(s);case 40:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),DistrictPicker.prototype.show=function(e){e.appendChild(this.root()),this.renderDistrict()},DistrictPicker.prototype.close=function(){var e=this;this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(function(){e.bottom.parentElement.remove()},300)},Calendar.prototype.root=function(){var e=this,t=dom.templatize('\n    <div class="calendar">\n      <div class="title"></div>\n      <div class="weekdays" style="position: sticky; top: 0;z-index: 10;">\n        <div class="weekday">日</div>\n        <div class="weekday">一</div>\n        <div class="weekday">二</div>\n        <div class="weekday">三</div>\n        <div class="weekday">四</div>\n        <div class="weekday">五</div>\n        <div class="weekday">六</div>\n      </div>\n      <div class="swiper">\n        <div class="swiper-wrapper">\n          <div class="prev swiper-slide"></div>\n          <div class="curr swiper-slide"></div>\n          <div class="next swiper-slide"></div>\n        </div>\n      </div>\n    </div>\n  ',{});this.widgetSwiper=dom.find(".swiper",t),this.title=dom.find(".title",t);var n=dom.find(".prev",t),i=dom.find(".curr",t),r=dom.find(".next",t);return this.renderMonth(n,moment(this.currentMonth).subtract(1,"months").startOf("month")),this.renderMonth(i,this.currentMonth),this.renderMonth(r,moment(this.currentMonth).add(1,"months").startOf("month")),new Swiper(this.widgetSwiper,{speed:400,initialSlide:this.currentIndex,loop:!0}).on("slideChange",function(n){0==n.realIndex?1==e.currentIndex?e.currentMonth=moment(e.currentMonth).subtract(1,"months"):2==e.currentIndex&&(e.currentMonth=moment(e.currentMonth).add(1,"months")):1==n.realIndex?0==e.currentIndex?e.currentMonth=moment(e.currentMonth).add(1,"months"):2==e.currentIndex&&(e.currentMonth=moment(e.currentMonth).subtract(1,"months")):2==n.realIndex&&(0==e.currentIndex?e.currentMonth=moment(e.currentMonth).subtract(1,"months"):1==e.currentIndex&&(e.currentMonth=moment(e.currentMonth).add(1,"months"))),e.currentIndex=n.realIndex;var i=moment(e.currentMonth).subtract(1,"months"),r=moment(e.currentMonth).add(1,"months"),o=null,a=null;0==e.currentIndex?(o=t.querySelectorAll(".next"),a=t.querySelectorAll(".curr")):1==e.currentIndex?(o=t.querySelectorAll(".prev"),a=t.querySelectorAll(".next")):2==e.currentIndex&&(o=t.querySelectorAll(".curr"),a=t.querySelectorAll(".prev"));for(var s=0;s<o.length;s++)e.renderMonth(o[s],i);for(var l=0;l<a.length;l++)e.renderMonth(a[l],r)}),t},Calendar.prototype.renderMonth=function(e,t){var n=t.startOf("month").day(),i=t.daysInMonth();e.innerHTML="";for(var r=null,o=0;o<i+n;o++){o%7==0&&(r=dom.create("div","dates"));var a=dom.element('<div class="date"></div>'),s=o-n+1;o>=n&&(a.innerHTML=s);var l=t.format("YYYY-MM-")+(s<10?"0"+s:s);l==this.today.format("YYYY-MM-DD")&&a.classList.add("today"),a.setAttribute("data-calendar-date",l),r.appendChild(a),o%7==6&&(e.appendChild(r),r=null)}null!=r&&e.appendChild(r);for(var d=7-(i+n)%7,c=0;c<d;c++){var u=dom.element('<div class="date"></div>');e.appendChild(u)}this.title.innerText=this.currentMonth.format("YYYY年MM月")},Calendar.prototype.stylizeDates=function(e,t,n){var i=dom.find(".dates.curr",this.root);if(Array.isArray(t)){for(var r=0;r<t.length;r++)for(var o=0;o<i.children.length;o++)if(moment(t[r]).format("YYYY-MM-DD")==i.children[o].getAttribute("data-calendar-date")){i.children[o].style=e;break}}else{t=moment(t).format("YYYY-MM-DD"),n=moment(n).format("YYYY-MM-DD");for(var a=0;a<i.children.length;a++){var s=i.children[a].getAttribute("data-calendar-date");s>=t&&s<=n&&(i.children[a].style=e)}}},Calendar.prototype.render=function(e,t){this.root=this.root();var n=dom.find(e);n.innerHTML="",n.appendChild(this.root)},CascadePicker.prototype.root=function(){var e=this,t=dom.templatize('\n    <div class="popup-container">\n      <div class="popup-mask"></div>\n      <div class="popup-bottom district-picker">\n        <div class="popup-title">\n          <button class="cancel">取消</button>\n          <span class="value"></span>\n          <span class="unit">{{unit}}</span>\n          <button class="confirm">确认</button>\n        </div>\n        <div>\n          <div widget-id="widgetLevel" style="padding: 4px 16px">\n          </div>\n          <div style="border-top: 1px solid var(--color-divider);"></div>\n          <ul widget-id="widgetValue" class="list-group" style="height: 240px; overflow-y: auto;">\n          </ul>\n        </div>\n      </div>\n    </div>\n  ',this);this.bottom=dom.find(".popup-bottom",t),this.widgetLevel=dom.find("[widget-id=widgetLevel]",t),this.widgetValue=dom.find("[widget-id=widgetValue]",t);for(var n=dom.find(".popup-mask",t),i=dom.find(".confirm",t),r=dom.find(".cancel",t),o=function(t){var n=dom.ancestor(t.target,"div"),i=dom.find("strong",n),r=parseInt(i.getAttribute("data-cascade-level")),o=(i.getAttribute("data-cascade-value"),i.getAttribute("data-cascade-name"),null),a=dom.find('[data-cascade-level="'+(r-1)+'"]',e.widgetLevel);if(null!=a){var s=a.getAttribute("data-cascade-value"),l=a.getAttribute("data-cascade-name");o={},o[l]=s}e.renderValue(r,o);for(var d=r+1;d<e.levels.length;d++){var c=dom.find('[data-cascade-level="'+d+'"]',e.widgetLevel);c.setAttribute("data-cascade-value",""),c.innerText=e.levels[d].placeholder}},a=0;a<this.levels.length;a++){var s=dom.templatize('\n      <div class="d-flex" style="line-height: 40px;">\n        <strong data-cascade-level="'.concat(a,'" data-cascade-name="{{name}}" class="font-16">{{placeholder}}</strong>\n        <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>\n      </div>\n    '),this.levels[a]);this.widgetLevel.appendChild(s),dom.bind(s,"click",function(e){o(e)})}return dom.bind(n,"click",function(t){e.close()}),dom.bind(r,"click",function(t){e.close()}),dom.bind(i,"click",function(t){for(var n=dom.find("strong",e.widgetLevel),i={},r=0;r<n.length;r++){var o=n[r],a=dom.model(o);i[o.getAttribute("data-cascade-name")]=a}e.success(i),e.close()}),setTimeout(function(){e.bottom.classList.add("in")},50),t},CascadePicker.prototype.renderValue=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i){var r,o,a,s,l,d,c=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(r=dom.find('[data-cascade-level="'+t+'"]',this.widgetLevel))){e.next=3;break}return e.abrupt("return");case 3:if(o=this.levels[t],this.widgetValue.innerHTML="",o.url){e.next=7;break}return e.abrupt("return");case 7:return n="function"==typeof o.params?o.params(n):o.params,e.next=10,xhr.promise({url:o.url,params:n});case 10:for(a=e.sent,s=0;s<a.length;s++)l={value:a[s][o.fields.value],text:a[s][o.fields.text]},d=dom.templatize('\n      <li class="list-group-item" data-cascade-value="{{value}}">{{text}}</li>\n    ',l),dom.model(d,a[s]),dom.bind(d,"click",function(e){var n=dom.ancestor(e.target,"li"),i=dom.model(n);r.innerText=i[o.fields.text],r.setAttribute("data-cascade-value",i[o.fields.value]),dom.model(r,i);var a={};a[o.fields.value]=i[o.fields.value],c.renderValue(t+1,a,i)}),this.widgetValue.appendChild(d);case 12:case"end":return e.stop()}},e,this)}));return function(t,n,i){
return e.apply(this,arguments)}}(),CascadePicker.prototype.show=function(e){e.appendChild(this.root()),this.renderValue(0)},CascadePicker.prototype.close=function(){var e=this;this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(function(){e.bottom.parentElement.remove()},300)},ActionSheet.prototype.root=function(){var e=this,t=dom.templatize('\n    <div class="popup-container">\n      <div class="popup-mask"></div>\n      <div class="popup-bottom" style="background: transparent;">\n        <div class="action-sheet">\n          <div class="title">{{title}}</div>\n          <div class="actions"></div>\n          <div class="cancel">取消</div>\n        </div>\n      </div>\n    </div>\n  ',this);this.bottom=dom.find(".popup-bottom",t);var n=dom.find(".cancel",t),i=dom.find(".popup-mask",t),r=dom.find(".actions",t);dom.bind(i,"click",function(t){e.close()}),dom.bind(n,"click",function(t){e.close()});for(var o=0;o<this.actions.length;o++)!function(t){var n=dom.templatize('\n      <div class="action">{{text}}</div>\n    ',e.actions[t]);dom.bind(n,"click",function(n){e.close(),e.actions[t].onClick(n)}),t==e.actions.length-1&&n.classList.add("last"),r.appendChild(n)}(o);return this.bottom.classList.add("in"),setTimeout(function(){e.bottom.style.bottom="0"},300),t},ActionSheet.prototype.show=function(e){e.appendChild(this.root())},ActionSheet.prototype.close=function(){var e=this;this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(function(){e.bottom.parentElement.remove()},300)},Weekdays.prototype.root=function(){for(var e=this,t=dom.templatize('\n    <div class="swiper weekly">\n      <div class="swiper-wrapper">\n      </div>\n    </div>\n  ',{}),n=dom.find(".swiper-wrapper",t),i=0;i<this.days;i++)!function(){var r=moment(e.today).add(i,"days"),o=r.day();o=1==o?"一":2==o?"二":3==o?"三":4==o?"四":5==o?"五":6==o?"六":"日";var a=dom.element('<div class="swiper-slide d-flex" style="width: calc(100% / 7)"></div>'),s=dom.templatize('\n      <div class="weekday pb-2" data-date="{{fulldate}}">\n        <span class="day">{{day}}</span>\n        <span class="date">{{date}}</span>\n      </div>\n    ',{day:o,date:r.format("DD"),fulldate:r.format("YYYY-MM-DD")});0==i&&s.classList.add("active"),a.appendChild(s),n.appendChild(a),dom.bind(s,"click",function(e){t.querySelectorAll(".weekday").forEach(function(e){e.classList.remove("active")}),s.classList.add("active")})}();new Swiper(t,{speed:400,slidesPerView:7,loop:!1});return t},Weekdays.prototype.render=function(e){dom.find(e).appendChild(this.root())},PopupRuler.prototype.root=function(){var e=this,t=dom.templatize('\n    <div class="popup-container">\n      <div class="popup-mask"></div>\n      <div class="popup-bottom in">\n        <div class="popup-title">\n          <button class="cancel">取消</button>\n          <span class="value"></span>\n          <span class="unit">{{unit}}</span>\n          <button class="confirm">确认</button>\n        </div>\n        <div class="popup-content" style="height: 200px; width: 100%;"></div>\n      </div>\n    </div>\n  ',this);this.bottom=dom.find(".popup-bottom",t);var n=dom.find(".popup-mask",t),i=dom.find(".confirm",t),r=dom.find(".cancel",t),o=dom.find(".value",t);return dom.bind(n,"click",function(t){t.stopPropagation(),t.preventDefault(),e.close()}),dom.bind(r,"click",function(t){e.close()}),dom.bind(i,"click",function(t){e.success(o.innerText),e.close()}),t},PopupRuler.prototype.show=function(e){var t=this.root();e.appendChild(t);var n=dom.find(".popup-content",t),i=dom.find(".value",t);i.innerText=this.value,ruler.initPlugin({el:n,startValue:this.value,maxScale:this.range[1],region:[this.range[0],this.range[1]],background:"#fff",color:"#E0E0E0",markColor:"#73B17B",isConstant:!0,success:function(e){i.innerText=e}})},PopupRuler.prototype.close=function(){var e=this;this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(function(){e.bottom.parentElement.remove()},300)},"undefined"!=typeof Handlebars&&Handlebars.registerHelper("ifeq",function(e,t,n){return e==t?n.fn(this):n.inverse(this)}),"undefined"==typeof kuim&&(kuim={}),kuim={routedPages:[],presentPageObj:null},kuim.navigateTo=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n,i){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(kuim.delayToLoad),void 0===i&&(i=!1),r=document.querySelector("main"),kuim.presentPageObj&&(kuim.presentPageObj.page.classList.remove("in"),kuim.presentPageObj.page.classList.add("out")),kuim.delayToLoad=setTimeout(_asyncToGenerator(regeneratorRuntime.mark(function e(){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return kuim.presentPageObj&&(kuim.presentPageObj.page.parentElement.style.display="none"),kuim.presentPageObj&&!1!==i&&(kuim.presentPageObj.page.parentElement.remove(),kuim.presentPageObj.destroy&&kuim.presentPageObj.destroy(),delete kuim.presentPageObj),e.next=4,xhr.asyncGet({url:t+(-1==t.indexOf("?")?"?":"&")+(new Date).getTime()},"GET");case 4:o=e.sent,kuim.reload(r,t,o,n);case 6:case"end":return e.stop()}},e)})),400);case 5:case"end":return e.stop()}},e)}));return function(t,n,i){return e.apply(this,arguments)}}(),kuim.navigateWidget=function(e,t,n){clearTimeout(kuim.delayToLoad),kuim.delayToLoad=setTimeout(function(){t.children[0]&&(t.children[0].classList.remove("in"),t.children[0].classList.add("out")),setTimeout(_asyncToGenerator(regeneratorRuntime.mark(function i(){var r;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t.innerHTML="",i.next=3,xhr.asyncGet({url:e},"GET");case 3:r=i.sent,kuim.replace(t,e,r,n);case 5:case"end":return i.stop()}},i)})),400)},200)},kuim.navigateBack=function(e){clearTimeout(kuim.delayToLoad),kuim.delayToLoad=setTimeout(function(){var e=document.querySelector("main"),t=e.children[e.children.length-2];kuim.presentPageObj.page.classList.remove("in"),kuim.presentPageObj.page.classList.add("out"),setTimeout(function(){kuim.presentPageObj.page.parentElement.remove(),kuim.presentPageObj.destroy&&kuim.presentPageObj.destroy(),delete kuim.presentPageObj,t.style.display="",kuim.presentPageObj=window[t.getAttribute("kuim-page-id")],kuim.presentPageObj.page.classList.remove("out"),kuim.presentPageObj.page.classList.add("in"),kuim.setTitleAndIcon(t.getAttribute("kuim-page-title"),t.getAttribute("kuim-page-icon"))},400)},200)};kuim.reload=function(e,t,n,i){i=i||{};var r=dom.element('<div style="height: 100%; width: 100%;"></div>'),o=document.createRange(),a=o.createContextualFragment(n);r.appendChild(a);var s=dom.find("[id^=page]",r),l=s.getAttribute("id");e.appendChild(r),r.setAttribute("kuim-page-id",l),r.setAttribute("kuim-page-url",t),i.title&&(r.setAttribute("kuim-page-title",i.title),r.setAttribute("kuim-page-icon",i.icon||"")),kuim.presentPageObj=window[l],kuim.presentPageObj.page.classList.add("in");var d=utils.getParameters(t);kuim.presentPageObj.show(d),kuim.setTitleAndIcon(i.title,i.icon),i.success&&i.success()},kuim.replace=function(e,t,n,i){i=i||{};var r=dom.element('<div style="height: 100%; width: 100%;"></div>'),o=document.createRange(),a=o.createContextualFragment(n);e.appendChild(a);var s=dom.find("[id^=page]",e),l=s.getAttribute("id");i.title&&(r.setAttribute("kuim-page-title",i.title),r.setAttribute("kuim-page-icon",i.icon||"")),s.classList.add("in");var d=utils.getParameters(t);window[l].show(d);for(var c in i)window[l][c]=i[c];i.success&&i.success()},kuim.setTitleAndIcon=function(e,t){var n=dom.find(".bottom-navigator");dom.find("header h1.title").innerText=e;var i=dom.find("header div.left");t?(i.innerHTML=t,null!=n&&(n.style.display=""),i.onclick=function(e){}):(i.innerHTML='<i class="fas fa-arrow-left button icon"></i>',null!=n&&(n.style.display="none"),i.onclick=function(e){kuim.navigateBack()})},kuim.select=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,i,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xhr.promise({url:t.url,params:t.params||{}});case 2:for(n=e.sent,i=[],r=0;r<n.length;r++)o=n[r],i.push({id:o[t.fieldId||"id"],value:o[t.fieldName||"value"]});new MobileSelect({trigger:t.trigger,title:t.title,wheels:[{data:i}],callback:function(e,n){t.onSelected&&t.onSelected(n[0])}});case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),kuim.tabs=function(e){for(var t=dom.find(e.container),n=dom.element('\n    <div class="nav nav-tabs mt-0"></div>\n  '),i=dom.element('\n    <div class="swiper">\n      <div class="swiper-wrapper">\n      </div>\n    </div>\n  '),r=e.tabs,o=0;o<r.length;o++)!function(e){var t=r[e],o=dom.templatize('\n      <div class="nav-item font-weight-bold mr-0" \n           style="padding: 0 16px; line-height: 36px; text-align: center; flex: 1;">{{title}}</div>\n    ',t);n.appendChild(o),0==e&&o.classList.add("active-bg-info"),dom.bind(o,"click",function(t){a.slideTo(e,400,!0)});var s=dom.templatize('\n      <div class="swiper-slide full-width"></div>\n    ',t);t.render?t.render(s,t.params||{}):s.innerHTML='<img src="https://via.placeholder.com/240x150">',i.children[0].appendChild(s)}(o);t.appendChild(n),t.appendChild(i);var a=new Swiper(i,{direction:"horizontal",loop:!1});a.on("slideChange",function(e){for(var t=e.activeIndex,i=0;i<n.children.length;i++)n.children[i].classList.remove("active-bg-info");n.children[t].classList.add("active-bg-info")})},kuim.wizard=function(e){for(var t=dom.find(e.container),n=dom.element('\n    <div class="wizard"></div>\n  '),i=dom.element('\n    <div class="swiper">\n      <div class="swiper-wrapper">\n      </div>\n    </div>\n  '),r=e.steps,o=0;o<r.length;o++)!function(e){var t=r[e];t.index=e+1;var o=dom.templatize('\n      <div class="wizard-step">\n        <div class="wizard-dot">\n          <div class="wizard-connector-left"></div>\n          <div class="wizard-number">{{index}}</div>\n          <div class="wizard-connector-right"></div>\n        </div>\n      </div>\n    ',t);n.appendChild(o),dom.bind(o,"click",function(t){o.classList.contains("wizard-step-completed")&&a.slideTo(e,400,!0)});var s=dom.templatize('\n      <div class="swiper-slide full-width"></div>\n    ',t);t.render?t.render(s,t.params||{}):s.innerHTML='<img src="https://via.placeholder.com/240x150">',i.children[0].appendChild(s)}(o);t.appendChild(n),t.appendChild(i);var a=new Swiper(i,{direction:"horizontal",loop:!1});return a.on("slideChange",function(e){for(var t=e.activeIndex,i=0;i<n.children.length;i++)n.children[i].classList.remove("wizard-step-completed");for(var r=0;r<t;r++)n.children[r].classList.add("wizard-step-completed")}),a.on("sliderMove",function(e,t){}),a},kuim.overlay=function(){},kuim.success=function(e,t){var n=dom.templatize('\n    <div class="toast">\n      <i class="far fa-check-circle font-36"></i>\n      <div class="font-18 mt-2">'.concat(e,"</div>\n    </div>\n  "));document.body.appendChild(n),setTimeout(function(){n.classList.add("show")},50),setTimeout(function(){n.classList.remove("show"),setTimeout(function(){n.remove(),t&&t()},500)},1e3)},kuim.error=function(e,t){var n=dom.templatize('\n    <div class="toast">\n      <i class="far fa-times-circle font-36"></i>\n      <div class="font-18 mt-2">'.concat(e,"</div>\n    </div>\n  "));document.body.appendChild(n),setTimeout(function(){n.classList.add("show")},50),setTimeout(function(){n.classList.remove("show"),setTimeout(function(){n.remove(),t&&t()},500)},1e3)},kuim.loading=function(e){if(null==document.getElementById("__widgetLoading")){var t=dom.templatize('\n    <div id="__widgetLoading" style="background: rgba(0,0,0,0.3); position: absolute; top: 0; left: 0; \n                z-index: 9999; height: 100%; width: 100%; display: flex; color: white">\n      <div class="m-auto" style="text-align: center;">\n        <i class="fas fa-spinner fa-spin font-36"></i>\n        <div class="font-18 mt-2">数据加载中</div>\n      </div>          \n    </div>\n  ');document.body.appendChild(t),setTimeout(function(){e&&e(t)},300)}},kuim.dialog=function(e){var t=e.confirm,n=e.cancel,i=e.content,r=dom.element('\n    <div style="background: rgba(0,0,0,0.3); position: absolute; top: 0; left: 0; \n                z-index: 9999; height: 100%; width: 100%; display: flex;">\n      <div class="dialog m-auto" \n           style="width: 88%; min-height: 400px; position: relative;\n                  background: var(--color-white);">\n        <div class="dialog-body">'.concat(i,'</div>\n        <div class="dialog-footer" \n             style="font-size: 24px; font-weight: bold; position: absolute;\n                    width: 100%; height: 56px; bottom: 0; display: table;">\n          <button style="background: var(--color-error); width: 50%; display: inline-table;\n                         color: var(--color-text-primary-dark); border: none; \n                         line-height: 56px;">取  消</button>\n          <button style="background: var(--color-primary); width: 50%; display: inline-table;\n                         color: var(--color-text-primary-dark); border: none; \n                         line-height: 56px;">确  定</button>\n        </div>\n      </div>\n    </div>\n  ')),o=r.querySelectorAll("button");dom.bind(o[0],"click",function(e){r.remove(),n&&n()}),dom.bind(o[1],"click",function(e){r.remove(),t&&t()}),document.body.appendChild(r)},pStart={x:0,y:0},pStop={x:0,y:0},kuim.swipeStart=function(e){if(void 0!==e.targetTouches){var t=e.targetTouches[0];pStart.x=t.screenX,pStart.y=t.screenY}else pStart.x=e.screenX,pStart.y=e.screenY},kuim.swipeEnd=function(e){if(void 0!==e.changedTouches){var t=e.changedTouches[0];pStop.x=t.screenX,pStop.y=t.screenY}else pStop.x=e.screenX,pStop.y=e.screenY},kuim.swipeCheck=function(){var e=pStart.y-pStop.y,t=pStart.x-pStop.x;return kuim.isPullDown(e,t)},kuim.isPullDown=function(e,t){return e<0&&(Math.abs(t)<=100&&Math.abs(e)>=300||Math.abs(t)/Math.abs(e)<=.3&&e>=60)},document.addEventListener("touchstart",kuim.swipeStart,!1),document.addEventListener("touchend",function(e){if(kuim.swipeEnd(e),kuim.swipeCheck()){kuim.presentPageObj.page.getBoundingClientRect();if(kuim.presentPageObj&&kuim.presentPageObj.pullToRefresh){kuim.presentPageObj.page.getBoundingClientRect().top>=0&&kuim.loading(function(e){kuim.presentPageObj.pullToRefresh(e)})}}},!1);
xhr={},xhr.request=function(e,t){let n=e.url,l=e.data||e.params||{},i=e.type||"json",o=e.success,a=e.error;l={...utils.getParameters(e.url),...l};let s=e.usecase||"",d=new XMLHttpRequest;d.timeout=1e4,d.onload=function(){let e=d.responseText;if("json"==i)try{e=JSON.parse(e)}catch(t){return void(a&&a(e))}4==d.readyState&&"200"==d.status?o&&o(e):a&&a(e)},d.onerror=function(){a&&a({error:{code:-500,message:"网络访问错误！"}})},d.ontimeout=function(){a&&a({error:{code:-501,message:"网络请求超时！"}})},d.open(t,n,!0),d.setRequestHeader("Content-Type","application/json"),d.setRequestHeader("usecase",s),"undefined"!=typeof APPTOKEN&&d.setRequestHeader("apptoken",APPTOKEN),l?d.send(JSON.stringify(l)):d.send(null)},xhr.get=function(e){let t=e.url,n=(e.data,e.success),l=e.error,i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){let e=i.responseText;4==i.readyState&&"200"==i.status?n&&n(e):l&&l(e)},i.send(null)},xhr.post=function(e){let t=e.url;"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.request(e,"POST")},xhr.put=function(e){xhr.request(e,"PUT")},xhr.delete=function(e){xhr.request(e,"DELETE")},xhr.connect=function(e){xhr.request(e,"CONNECT")},xhr.upload=function(e){let t=e.url,n=e.data||e.params,l=e.type||"json",i=e.success,o=e.error,a=new FormData;for(let e in n)a.append(e,n[e]);a.append("file",e.file);let s=new XMLHttpRequest;s.timeout=1e4,s.onload=function(){let e=s.responseText;if("json"==l)try{e=JSON.parse(e)}catch(t){return void(o&&o(e))}4==s.readyState&&"200"==s.status?i&&i(e):o&&o(e)},e.progress&&(s.onprogress=function(t){e.progress(t.loaded,t.total)}),s.onerror=function(){o&&o({error:{code:-500,message:"网络访问错误！"}})},s.ontimeout=function(){o&&o({error:{code:-501,message:"网络请求超时！"}})},s.open("POST",t,!0),"undefined"!=typeof APPTOKEN&&s.setRequestHeader("apptoken",APPTOKEN),s.send(a)},xhr.chain=function(e){if(0==e.length)return;let t=e[0],n=t.success;xhr.promise(t,function(t){n(t),xhr.chain(e.slice(1))})},xhr.promise=function(e,t){return new Promise(function(n,l){e.success=function(e){if(e.error)return dialog.error(e.error.message),void(t&&t(e.error));n(e.data)},e.error=t,xhr.post(e)})},xhr.download=function(e){let t=new XMLHttpRequest;t.open("POST",e.url,!0),t.responseType="arraybuffer",t.onload=function(){if(200===this.status){let o="",a=t.getResponseHeader("Content-Disposition");if(a&&-1!==a.indexOf("attachment")){let e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(a);null!=e&&e[1]&&(o=e[1].replace(/['"]/g,""))}let s=t.getResponseHeader("Content-Type"),d=new Blob([this.response],{type:s});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(d,o);else{var n=window.URL||window.webkitURL,l=n.createObjectURL(d),i=document.createElement("a");void 0===i.download?window.location=l:(i.href=l,i.download=e.filename||"下载的文件",document.body.appendChild(i),i.click()),setTimeout(function(){n.revokeObjectURL(l)},100)}}},t.setRequestHeader("Content-type","application/json"),"undefined"!=typeof APPTOKEN&&t.setRequestHeader("apptoken",APPTOKEN),t.send(JSON.stringify(e.params||{}))},xhr.asyncRequest=function(e,t){let n=e.url,l=e.data||e.params,i=e.type||"json",o=e.usecase||"";return new Promise((e,a)=>{if(n){let s=new XMLHttpRequest;s.timeout=1e4,s.onload=function(){let t=s.responseText;if("json"==i)try{t=JSON.parse(t)}catch(e){return console.log(e),void a(e)}4==s.readyState&&"200"==s.status?e(t):a(t)},s.onerror=function(){a({error:{code:-500,message:"网络访问错误！"}})},s.ontimeout=function(){a({error:{code:-501,message:"网络请求超时！"}})},s.open(t,n,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("usecase",o),"undefined"!=typeof APPTOKEN&&s.setRequestHeader("apptoken",APPTOKEN),l?s.send(JSON.stringify(l)):s.send(null)}})},xhr.asyncPost=function(e){let t=e.url;return"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.asyncRequest(e,"POST")},"undefined"!=typeof module&&(module.exports={xhr:xhr});var ajax={save:function(e){for(var t=e.url||"",n=e.form,l=e.button,i=e.success,o=n.validate(),a="",s=0;s<o.length;s++)a+=o[s].message+"<br>";if(""==a){l&&l.prop("disabled",!0);var d=n.formdata();$.ajax({url:t,data:d,method:"POST",dataType:"json",success:function(e){if(void 0!==e.error)return dialog.error("保存信息出错！"),void(l&&l.prop("disabled",!1));dialog.success("保存信息成功！"),void 0!==i&&i(e),l&&l.prop("disabled",!1)},error:function(){dialog.error("系统异常！"),l&&l.prop("disabled",!1)}})}else dialog.error(a)},post:function(e){let t={...utils.getParameters(e.url),...e.data};$.ajax({url:e.url,data:t,method:"POST",dataType:"json",success:function(t){void 0!==e.success&&e.success(t)}})},get:function(e){$.ajax({url:e.url,data:e.data,dataType:"json",success:function(t){void 0!==e.success&&e.success(t)}})},text:function(e,t,n){$.ajax({url:e,data:t,success:function(e){void 0!==n&&n(e)}})},view:function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();let t=e.url,n=!1;n=void 0===e.empty||e.empty;let l=e.page;t&&0==t.indexOf(":")&&(l=t.substring(1),t=null);let i=utils.getParameters(e.url),o={...i,...e.params},a=e.title||"",s=e.containerId,d=e.success,r=null;if("string"==typeof s?null==(r=document.getElementById(s.trim()))&&(r=document.querySelector(s.trim())):r=s,void 0===o&&(o={}),window.parameters)for(let e in o)window.parameters[e]=o[e];t?xhr.get({url:t,success:function(t){let l=null;r&&(l=utils.append(r,t,n)),d&&d(a,l,i),!0!==e.initiative&&utils.isEmpty(i)||window[l.id].show(i)}}):l&&xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:l},success:function(e){let t=e.data.script;t||(t='<div class="full-width full-height d-flex"><img src="img/under-construction.jpeg" class="m-auto full-width"></div>');let l=null;r&&(l=utils.append(r,t,n)),d&&d(a,l,i)}})}};ajax.append=function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();let t=dom.find("#tabsMain"),n=dom.find("#tabsOthers");if(null==t)return void ajax.view(e);let l=t.children.length,i=e.url,o=e.title||"",a=e.containerId,s=e.params,d=e.success,r=null;if("string"==typeof a?null==(r=document.getElementById(a.trim()))&&(r=document.querySelector(a.trim())):r=a,void 0===s&&(s={}),window.parameters)for(let e in s)window.parameters[e]=s[e];u();let c=r.querySelector('div[data-url="'+i+'"]');if(null!=c){c.classList.remove("hide"),setTimeout(function(){c.classList.add("show")},150);let e=dom.find('a[data-url="'+i+'"]',t);return null!=e?void e.classList.add("active"):void dom.find('a[data-url="'+i+'"]',n).classList.add("active")}function u(){r.querySelectorAll("div[data-url]").forEach(e=>{e.classList.remove("show"),e.classList.add("hide","fade","fadeIn")}),t.querySelectorAll("a.active").forEach(e=>{e.classList.remove("active")}),n.querySelectorAll("a.active").forEach(e=>{e.classList.remove("active")})}function f(e,i){if(""==e||null==t)return;let o=dom.element('\n      <li class="nav-item">\n        <a class="nav-link head-link">\n          <span></span>\n          <i class="fas fa-times-circle ml-1"></i>\n        </a>\n      </li>\n    ');dom.find("a",o).setAttribute("data-url",i),dom.bind(dom.find("i",o),"click",e=>{e.preventDefault(),e.stopPropagation();let l=e.target.parentElement,i=r.querySelector('div[data-url="'+l.getAttribute("data-url")+'"]');if(i&&i.remove(),e.target.parentElement.parentElement.remove(),r.querySelectorAll("div[data-url]").length>0&&t.children[0].click(),n.children.length>0){let e=n.children[0];e.remove(),function(e){dom.find("a",e).classList.add("nav-link"),dom.find("a",e).classList.remove("dropdown-item"),dom.find("i",e).classList.add("ml-1"),dom.find("i",e).classList.remove("float-right"),t.appendChild(e)}(e)}}),dom.bind(dom.find("a",o),"click",e=>{let t=dom.ancestor(e.target,"a");t.classList.contains("active")||(u(),t.classList.add("active"),m(d.getAttribute("data-url")))});let a=!1;if(t.querySelectorAll("li").forEach(t=>{dom.find("span",t).innerText==e&&(a=!0,dom.find("a",t).classList.add("active"))}),a)return;if(0==l)t.appendChild(o);else if(l+1>MAX_HEAD_LINK_COUNT){let e=dom.find("li:last-child",t);e.remove(),function(e){dom.find("a",e).classList.add("pointer"),dom.find("a",e).classList.remove("nav-link"),dom.find("a",e).classList.add("dropdown-item"),dom.find("i",e).classList.remove("ml-1"),dom.find("i",e).classList.add("float-right"),0==n.children.length?n.appendChild(e):n.insertBefore(e,n.children[0])}(e)}t.insertBefore(o,t.children[0]);let s=dom.find("span",o),d=dom.find("a",o);d.classList.add("active"),s.innerText=e}function m(e){r.querySelectorAll("div[data-url]").forEach(e=>{e.classList.remove("show"),e.classList.add("hide")});let l=r.querySelector('div[data-url="'+e+'"]');if(null!=l){l.classList.remove("hide"),setTimeout(function(){l.classList.add("show")},150);let i=dom.find('a[data-url="'+e+'"]',t);return null!=i?void i.classList.add("active"):void dom.find('a[data-url="'+e+'"]',n).classList.add("active")}xhr.get({url:e,success:function(t){utils.append(r,t,!1);for(let t=r.children.length-1;t>=0;t--){let n=r.children[t];if("DIV"==n.tagName){n.setAttribute("data-url",e),setTimeout(function(){n.classList.add("show")},150);break}}f(o,e),d&&d(o,t)}})}if(0==i.indexOf(":")){let e=i.substring(1);xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:e},success:function(t){let n=t.data.script;utils.append(r,n,!1);for(let e=r.children.length-1;e>=0;e--){let t=r.children[e];if("DIV"==t.tagName){t.setAttribute("data-url",i),setTimeout(function(){t.classList.add("show")},150);break}}f(o,i),stdbiz.render(e,r.querySelector('[data-url="'+i+'"]'),{})}})}else m(i)},ajax.shade=function(e){"undefined"!=typeof schedule&&schedule.stop();let t=e.url,n=e.success,l=document.querySelector(".page.full");null!=l&&l.parentElement.remove(),-1===t.indexOf(":")?xhr.get({url:t,success:function(t){let l=utils.append(document.body,t);n&&n(e.title||"",l)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:t.substring(1)},success:function(t){let l=t.data.script,i=utils.append(document.body,l);n&&n(e.title||"",i)}})},ajax.stack=function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();let t=e.pageId,n=e.params,l=dom.find(e.containerId);void 0===n&&(n={});let i=!1;for(let e=0;e<l.children.length;e++){let n=l.children[e];"DIV"==n.tagName&&"true"!=n.getAttribute("data-stack-back")&&(n.classList.remove("show"),n.classList.add("hide"),n.id==t&&(n.classList.remove("hide"),n.classList.add("show"),i=!0))}i||(e.empty=!1,ajax.view(e));let o=dom.find("div[data-stack-back]",l);null==o&&((o=dom.element('\n    <div data-stack-back="true" class="pointer">\n      <i class="fas fa-angle-left font-32" style="margin-top: 12px;"></i>\n    </div>\n  ')).style.position="fixed",o.style.width="60px",o.style.height="60px",o.style.bottom="40px",o.style.right="40px",o.style.backgroundColor="#0C9",o.style.color="#fff",o.style.borderRadius="50px",o.style.textAlign="center",o.style.boxShadow="2px 2px 3px #999",o.style.zIndex="99",dom.bind(o,"click",e=>{o.remove(),ajax.unstack({containerId:l})}),l.appendChild(o))},ajax.unstack=function(e){let t=dom.find(e.containerId);t.children[t.children.length-1].remove();let n=t.children[t.children.length-1];n.classList.remove("hide"),n.classList.add("show")},ajax.template=function(e){let t=e.url,n=e.usecase,l=e.containerId,i=e.templateId,o=e.data,a=e.success;xhr.post({url:t,usecase:n,data:o,success:function(e){if(l){var t=document.getElementById(i).innerHTML,n=Handlebars.compile(t)(e);document.getElementById(l).innerHTML=n}a&&a(e)}})},ajax.dialog=function(e){let t=e.title||"",n=e.url||"",l=e.params||{},i=e.success,o=e.end,a=!1!==e.shadeClose,s=!0===e.allowClose,d=e.width||"80%",r=e.height||"",c=e.offset||"auto";if(window.parameters)for(var u in l)window.parameters[u]=l[u];$.ajax({url:n,data:l,async:!0,success:function(e){layer.open({type:1,offset:c,title:t,closeBtn:!0===s?1:0,shade:.3,shadeClose:a,area:[d,r],content:e,success:function(e,t){document.querySelector(".layui-layer-content").style+="; overflow: hidden;",i&&i()},end:o||function(){}})}})},ajax.video=function(e,t,n,l){layer.open({type:2,title:!1,closeBtn:1,shade:[0],area:[n+"px",l+"px"],offset:"rb",anim:2,content:[e,"no"]})},ajax.svg=function(e,t,n,l){void 0===n&&(n={}),$.ajax({url:e,data:n,success:function(e){t.empty();var n=(new XMLSerializer).serializeToString(e.documentElement);t.html(n),l&&l(e)}})},ajax.upload=function(e){let t=e.data;void 0===t&&(t={});let n=new FormData;for(let e in t)n.append(e,t[e]);$.ajax({url:e.url,data:n,method:"POST",cache:!1,contentType:!1,processData:!1,xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&e.progress&&t.upload.addEventListener("progress",function(t){t.lengthComputable&&e.progress&&e.progress(t.total,t.loaded)},!1),t},success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},ajax.sidebar=function(e){let t=dom.find(e.containerId),n=e.success||function(e,t){},l=dom.find("[widget-id=right-bar]"),i=e.allowClose||!1;null!=l&&l.remove(),l=dom.element('\n    <div widget-id="right-bar" style="position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: transparent; z-index: 999999;">\n      <div class="right-bar fade show">\n        <div class="modal-dialog" role="document">\n          <div class="modal-content">\n            <div class="card-header pl-3">\n              <h5 class="modal-title"></h5>\n              <button type="button" class="close text-danger">\n                <i class="fas fa-times"></i>\n              </button>\n            </div>\n            <div class="modal-body" style="overflow-y: auto;"></div>\n            <div style="position: absolute; bottom: 24px; left: 0; width: 100%; height: 48px; border-top: 1px solid lightgrey; background: white; display:none;">\n              <div widget-id="right-bar-bottom" class="mh-10 mt-2" style="float: right;"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  '),!0===e.showBottom&&(dom.find(".modal-body",l).style.marginBottom="36px",dom.find("[widget-id=right-bar-bottom]",l).parentElement.style.display=""),l.addEventListener("click",e=>{"right-bar"===e.target.getAttribute("widget-id")&&(l.children[0].classList.remove("in"),l.children[0].classList.add("out"),setTimeout(function(){l.remove()},300))}),t.appendChild(l),0==e.url.indexOf(":")&&(e.page=e.url.substring(1),e.url=null),e.url?xhr.get({url:e.url,success:function(t){dom.find(".modal-title",l).innerHTML=e.title||"",dom.find(".modal-body",l).innerHTML="",i||e.close||dom.find("button.close",l).classList.add("hidden"),dom.find("button.close",l).addEventListener("click",function(){l.children[0].classList.add("out"),l.remove(),e.close&&e.close()});let o=utils.append(dom.find(".modal-body",l),t);n&&n(e.title||"",o),setTimeout(function(){l.children[0].classList.remove("out"),l.children[0].classList.add("in")},300)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",params:{customWindowId:e.page},success:function(t){let o=t.data.script;dom.find(".modal-body",l).innerHTML="";let a=utils.append(dom.find(".modal-body",l),o);dom.find(".modal-title",l).innerHTML=e.title||"&nbsp;",i||e.close||dom.find("button.close",l).classList.add("hidden"),dom.find("button.close",l).addEventListener("click",function(){dom.find(".right-bar").classList.add("out"),setTimeout(function(){l.remove()},300),e.close&&e.close()}),n&&n(e.title||"",a),setTimeout(function(){l.children[0].classList.remove("out"),l.children[0].classList.add("in")},300)}})},ajax.bottombar=function(e){let t=dom.find(e.containerId),n=e.success||function(){},l=dom.find(".bottom-bar",t),i=e.allowClose||!1;null!=l&&l.remove(),l=dom.element('\n    <div class="bottom-bar fade show">\n      <div class="modal-dialog" role="document">\n        <div class="modal-content">\n          <div class="card-header pt-2 pb-2">\n            <button type="button" class="close text-danger">\n              <i class="fas fa-times"></i>\n            </button>\n            <h5 class="modal-title"></h5>\n          </div>\n          <div class="modal-body" style="overflow-y: auto"></div>\n        </div>\n      </div>\n    </div>\n  '),t.appendChild(l);let o=l.parentElement.clientWidth,a=parseInt(window.getComputedStyle(l.parentElement,null).getPropertyValue("padding-left")),s=parseInt(window.getComputedStyle(l.parentElement,null).getPropertyValue("padding-right"));l.style.width=o-s-a+"px",e.url?xhr.get({url:e.url,success:function(t){dom.find(".modal-title",l).innerHTML=e.title||"",i||e.close||dom.find("button.close",l).classList.add("hidden"),dom.find("button.close",l).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),e.close&&e.close()}),utils.append(dom.find(".modal-body",l),t),n&&n(t),setTimeout(function(){l.classList.remove("out"),l.classList.add("in")},200)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:e.page},success:function(t){let o=t.data.script;utils.append(dom.find(".modal-body",l),o),dom.find(".modal-title",l).innerHTML=e.title,i||e.close||dom.find("button.close",l).classList.add("hidden"),dom.find("button.close",l).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),e.close&&e.close()}),n&&n(t),setTimeout(function(){l.classList.remove("out"),l.classList.add("in")},200)}})},ajax.tabs=function(e){let t=document.querySelector(e.containerId),n=e.tabs,l=(e.closeable,dom.create("ul","nav","nav-tabs")),i=dom.create("div","tab-content"),o=dom.create("div","float-right"),a=dom.create("button","btn","btn-link");function s(e,t,n,l){ajax.view({url:t,containerId:e,success:function(){window[n]&&window[n].show(l)}})}o.appendChild(a),dom.bind(a,"click",function(){let e=dom.find("li.active link",this.parentElement.parentElement),t=e.getAttribute("data-model-url"),n=e.getAttribute("data-model-page"),l=JSON.parse("data-model-data");s(dom.find("div.tab-content div[data-model-url='"+t+"']",this.parentElement.parentElement),t,n,l)});for(let e=0;e<n.length;e++){let t=n[e],o=dom.create("li","nav-item"),a=dom.create("a","nav-link");0==e&&a.classList.add("active"),a.setAttribute("data-model-url",t.url),a.setAttribute("data-model-data",JSON.stringify(t.data||{})),a.setAttribute("data-model-page",t.page),a.innerHTML=t.title,dom.bind(a,"click",function(){if(this.classList.contains("active"))return;dom.find("a.active",this.parentElement.parentElement.parentElement).classList.remove("active"),dom.find("div.active",this.parentElement.parentElement.parentElement).classList.remove("active");let e=a.getAttribute("data-model-url"),t=JSON.parse(a.getAttribute("data-model-data")),n=a.getAttribute("data-model-page"),l=dom.find("div.tab-content div[data-model-url='"+e+"']",this.parentElement.parentElement.parentElement);this.classList.add("active"),l.classList.add("active"),""===l.innerHTML.trim()&&s(l,e,n,t)}),o.appendChild(a),l.appendChild(o);let d=dom.create("div","tab-pane");0==e&&(d.classList.add("active"),s(d,t.url,t.page,t.data)),d.setAttribute("data-model-url",t.url),i.append(d)}t.appendChild(o),t.appendChild(l),t.appendChild(i)},"undefined"==typeof dialog&&(dialog={}),dialog.alert=function(e){layer.open({type:0,icon:0,offset:"150px",shade:0,shadeClose:!0,title:"警告",content:e})},dialog.info=function(e){layer.open({type:0,offset:"150px",shade:0,shadeClose:!0,title:"信息",content:e})},dialog.info2=function(e){layer.open({type:0,offset:"100px",shade:.3,shadeClose:!0,title:"信息",content:e})},dialog.error=function(e){layer.open({type:0,icon:2,offset:"150px",shade:0,shadeClose:!0,title:"错误",content:e})},dialog.success=function(e,t){t?layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e,btn:["确定","确定并返回"],yes:function(e,t){layer.close(e)},btn2:function(e,n){layer.close(e),t()}}):layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e})},dialog.confirm=function(e,t){layer.confirm(e,{title:"确认",btn:["确定","取消"]},function(e){layer.close(e),t()},function(){})},dialog.view=function(e){let t=e.title,n=e.url;$(document.body);$("#dialogApplication").length&&$("#dialogApplication").remove();let l=[];e.save&&l.push({text:"保存",class:"btn-save",success:e.save}),$.ajax({url:n,success:function(e){let n=Handlebars.compile('<div class="modal fade" id="dialogApplication">  <div class="modal-dialog modal-dialog-centered">    <div class="modal-content">      <div class="modal-header">        <h4 class="modal-title">{{title}}</h4>        <button type="button" class="close" data-dismiss="modal">&times;</button>      </div>      <div id="dialogApplicationBody" class="modal-body">{{body}}</div>      <div class="modal-footer">        {{#each buttons}}        <button type="button" class="btn {{class}}" data-dismiss="modal">{{text}}</button>        {{/each}}        <button type="button" class="btn btn-close" data-dismiss="modal">关闭</button>      </div>    </div>  </div></div>')({title:t,body:e,buttons:l});$(document.body).append(n),$("#dialogApplication").modal("show")}})},dialog.select=function(e){ajax.view({url:e.url,success:function(t){layer.open({type:0,icon:1,offset:"150px",shade:.5,shadeClose:!0,title:e.title,content:t})}})},dialog.simplelist=async function(e){let t=await xhr.promise({url:e.url,params:e.params||{}}),n=dom.element('\n    <div>\n      <ul class="list-group"></ul>\n    </div>\n  '),l=dom.find("ul",n);for(let n=0;n<t.length;n++){let i=t[n],o=dom.create("li","list-group-item","list-group-item-action");dom.model(o,i),o.innerText=i[e.fields.text],l.appendChild(o)}layer.open({type:0,closeBtn:1,btn:[],shade:.5,shadeClose:!0,title:"",content:n.innerHTML,success:function(t,n){t.get(0).querySelectorAll("li").forEach((t,n)=>{dom.bind(t,"click",t=>{layer.close(layer.index);let n=dom.model(t.target);e.onAccept(n)})})}})},dialog.html=function(e){layer.open({type:0,closeBtn:1,offset:"150px",shade:.5,area:["50%",""],shadeClose:!0,title:e.title||"&nbsp;",content:e.html,btn:["确定","关闭"],success:function(t,n){e.load&&e.load(t,n)},yes:function(t){layer.close(t),e.success()},btn1:function(){}})},dialog.iframe=function(e){layer.open({title:e.title,type:2,area:[e.width,e.height],content:e.url,resize:!1,maxmin:!0,shade:!1,success:e.success||function(e,t){}})};var dom={value:function(e,t){const n=document.querySelector(e);if(!t)return n.value.trim();n.value=t},empty:function(e){const t=document.querySelector(e);t.value?t.value="":t.innerHTML=""},valid:function(e){const t=document.querySelector(e);return void 0!==t.value&&null!=t.value&&""!=t.value.trim()},create:function(e){let t=Array.prototype.slice.call(arguments,1),n=document.createElement(e);for(let e=0;e<t.length;e++)n.classList.add(t[e]);return n},fix:function(e){let t=null,n=(t="string"==typeof e?document.querySelector(e):e).getBoundingClientRect(),l=n.left,i=n.top,o=(n.width,n.height),a=(parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-top"))),s=parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-bottom")),d=(parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-top")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-bottom")),t.parentElement.parentElement),r=d.getBoundingClientRect(),c=parseInt(window.getComputedStyle(d,null).getPropertyValue("padding-left"));parseInt(window.getComputedStyle(d,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(d,null).getPropertyValue("padding-top")),parseInt(window.getComputedStyle(d,null).getPropertyValue("padding-bottom"));return t.style.position="absolute",t.style.top=i-r.top+"px",t.style.left=l-r.left+"px",t.style.width="calc(100% - "+2*c+"px )",{top:i-r.top,left:l-r.left,width:r.width-2*c,height:o+a+s}},find:function(e,t){if(t=t||document,"string"!=typeof e)return e;let n=t.querySelectorAll(e);return 0==n.length?null:1==n.length?n[0]:n},ancestor:function(e,t,n){let l=null;if(n=n||"",null==(l="string"==typeof e?document.querySelector(e):e))return null;t=t.toUpperCase();let i=l;if(""==n)for(;null!=i&&i.tagName!=t;)i=i.parentElement;else for(;null!=i&&(i.tagName!=t||!i.classList.contains(n));)i=i.parentElement;return i},element:function(e){let t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},bind:function(e,t,n){let l=null;null!=(l="string"==typeof e?document.querySelector(e):e)&&l&&l.addEventListener(t,n)},model:function(e,t){let n=null;if(n="string"==typeof e?document.querySelector(e):e,void 0===t){let e={};return Array.prototype.slice.call(n.attributes).forEach(function(t){if(0==t.name.indexOf("data-model-"))if(0==t.value.indexOf("{"))try{e[utils.nameVar(t.name.slice("data-model-".length))]=JSON.parse(t.value)}catch(n){e[utils.nameVar(t.name.slice("data-model-".length))]=t.value}else e[utils.nameVar(t.name.slice("data-model-".length))]=t.value}),e}{let e=Array.prototype.slice.call(arguments,2);if(0==e.length)for(const e in t)0!=e.indexOf("||")&&0!=e.indexOf("//")&&0!=e.indexOf(">>")&&("object"==typeof t[e]?n.setAttribute(utils.nameAttr(e),JSON.stringify(t[e])):n.setAttribute(utils.nameAttr(e),t[e]));else for(let l=0;l<e.length;l++){let i=e[l];0!=i.indexOf("||")&&0!=i.indexOf("//")&&0!=i.indexOf(">>")&&("object"==typeof t[i]?n.setAttribute(utils.nameAttr(i),JSON.stringify(t[i])):n.setAttribute(utils.nameAttr(i),t[i]))}}},collect:function(e,t){let n=[],l=document.querySelectorAll(e);for(let e=0;e<l.length;e++){let i={};if(Array.isArray(t))for(let n=0;n<t.length;n++)i[t[n]]=l[e].getAttribute(utils.nameAttr(t[n]));else i[t]=l.getAttribute(utils.nameAttr(t[j]));n.push(i)}return n},propagate:function(e,t,n,l){let i=l(t);if(Array.isArray(n))for(let e=0;e<n.length;e++)i.setAttribute(utils.nameAttr(n[e]),t[n[e]]);else i.setAttribute(utils.nameAttr(n),t[n]);e.appendChild(i)},toggle:function(e,t){let n=document.querySelectorAll(e);for(let e=0;e<n.length;e++){n[e].addEventListener("click",function(){let e=this.getAttribute("data-toggle").split(">>"),n=e[0].split("+"),l=e[1].split("+"),i=!1;for(let e=0;e<n.length;e++){let t=n[e].trim();if(0==t.indexOf("."))i=this.classList.contains(t.substring(1));else{i=null!=this.querySelector(t)}}if(i){for(let e=0;e<l.length;e++){let t=l[e].trim();if(0===t.indexOf("."))this.classList.add(t.substring(1));else{this.querySelector(t.substring(0,t.indexOf("."))).classList.add(t.substring(t.indexOf(".")+1))}}for(let e=0;e<n.length;e++){let t=n[e].trim();if(0==t.indexOf("."))this.classList.remove(t.substring(1));else{this.querySelector(t).classList.remove(t.substring(t.indexOf(".")+1))}}}else{for(let e=0;e<n.length;e++){let t=n[e].trim();if(0==t.indexOf("."))this.classList.add(t.substring(1));else{this.querySelector(t.substring(0,t.indexOf("."))).classList.add(t.substring(t.indexOf(".")+1))}}for(let e=0;e<l.length;e++){let t=l[e].trim();if(0==t.indexOf("."))this.classList.remove(t.substring(1));else{this.querySelector(t).classList.remove(t.substring(t.indexOf(".")+1))}}t&&resovle(this)}})}},switch:function(e,t){let n=dom.find(e),l=n.getAttribute("data-switch").split("+"),i=n.querySelectorAll(l[0]);for(let e=0;e<i.length;e++){let o=i[e];o.addEventListener("click",function(){let e=n.querySelectorAll(l[0]);for(let t=0;t<e.length;t++)e[t].classList.remove(l[1].substring(1));o.classList.add(l[1].substring(1)),t&&t(o)})}},tabs:function(e){let t=dom.find(e);if(null==t)return;let n=t.getAttribute("data-tab-active-class");for(let e=0;e<t.children.length;e++){let l=t.children[e];l.addEventListener("click",e=>{for(let e=0;e<t.children.length;e++){t.children[e].classList.remove(n)}l.classList.add(n)})}},top:function(e){let t=null;if(null==(t="string"==typeof e?document.querySelector(e):e))return 0;let n=t.offsetTop;return void 0!==t.offsetParent&&(n+=dom.top(t.offsetParent)),n},formdata:function(e,t){let n=null;if(n="string"==typeof e?document.querySelector(e):e,void 0===t){let e={},t={},l=n.querySelectorAll("input");for(let n=0;n<l.length;n++){let i=l[n],o=i.name,a=i.type,s=i.value;"text"==a||"number"==a||"password"==a||"hidden"==a?(e[o]=null,""!=s?-1!=o.indexOf("[]")?e[o]=[s]:e[o]=s:e[o]=""):"radio"==a?i.checked&&(e[o]=s):"checkbox"==a&&(void 0===t[o]&&(t[o]=0),i.checked&&(void 0===e[o]&&(t[o]=0,e[o]=[]),e[o].push(s)),t[o]+=1)}let i=n.querySelectorAll("select");for(let t=0;t<i.length;t++){let n=i[t],l=n.name;e[l]=null,-1!=n.selectedIndex?-1!=l.indexOf("[]")?e[l]=[n.value]:e[l]=n.value:e[l]=""}let o=n.querySelectorAll("textarea");for(let t=0;t<o.length;t++){let n=o[t],l=n.name;e[l]=null,e[l]=n.value}for(let n in t)-1==n.indexOf("[]")&&1==t[n]&&e[n]&&(e[n]=e[n][0]);for(let t in e)"string"==typeof e[t]&&0==e[t].indexOf("${")&&(e[t]=e[e[t].substring(2,e[t].length-1)]);return e}{function l(e,t,n){let l=dom.find("[name='"+t+"']",e);null!=l&&("INPUT"==l.tagName?"check"==l.type||(l.value=n||""):"SELECT"==l.tagName&&$("select[name='"+t+"']").val(n).trigger("change"))}for(let e in t)if("object"==typeof t[e])for(let i in t[e])l(n,e+"."+i,t[e][i]);else l(n,e,t[e])}},setAttribute:function(e,t,n){let l=document.querySelectorAll(e);for(let e=0;e<l.length;e++)l[e][t]=n},removeAttribute:function(e,t){let n=document.querySelectorAll(e);for(let e=0;e<n.length;e++)n[e].removeAttribute(t)},enable:function(e){let t=document.querySelectorAll(e);for(let e=0;e<t.length;e++)t[e].disabled=!1},disable:function(e){let t;t="string"==typeof e?document.querySelectorAll(e):e;for(let e=0;e<t.length;e++)t[e].disabled=!0},index:function(e,t,n){let l;if(l="string"==typeof e?dom.find(e):e,n);else{let e=l.getAttribute(t),n=l.parentElement.querySelectorAll(l.tagName);for(let l=0;l<n.length;l++){if(e==n[l].getAttribute(t))return l}}return-1},elementAt:function(e,t,n){let l=document.querySelectorAll(e);for(let e=0;e<l.length;e++){let i=l[e];if(n==i.getAttribute(t))return{index:e,element:i}}return null},elementAtTree:function(e,t,n,l,i){let o=document.querySelectorAll(e),a=0;for(let e=0;e<o.length;e++){let s=o[e],d=s.getAttribute(t);if(i==s.getAttribute(n)&&(a++,l==d))return{index:a,element:s}}},stack:function(e,t,n,l){let i=dom.create("a","btn","btn-link"),o=dom.create("i","fas","fa-caret-right","mr-1");i.appendChild(o),dom.bind(i,"click",function(){let o=dom.find("i",i);o.classList.contains("fa-caret-right")?(e.container.querySelectorAll("i.fa-caret-down").forEach(e=>{e.classList.remove("fa-caret-down"),e.classList.add("fa-caret-right")}),o.classList.remove("fa-caret-right"),o.classList.add("fa-caret-down"),e.stack(n,function(e){e.parentElement.classList.add("fade","fadeIn"),e.style.paddingLeft="50px",e.style.paddingRight="50px",setTimeout(function(){e.parentElement.classList.add("show")},200),l(e)})):(o.classList.remove("fa-caret-down"),o.classList.add("fa-caret-right"),t.parentElement.nextSibling.remove())})},inner:function(e){let t=e.clientHeight,n=e.clientWidth,l=getComputedStyle(e);return{height:t-parseInt(l.paddingTop)-parseInt(l.paddingBottom),width:n-parseInt(l.paddingLeft)-parseInt(l.paddingLeft)}},outer:function(e){let t=e.clientHeight,n=e.clientWidth,l=getComputedStyle(e);return{height:t+parseInt(l.marginTop)+parseInt(l.borderTop)+parseInt(l.marginBottom)+parseInt(l.borderBottom),width:n+parseInt(l.marginLeft)+parseInt(l.borderLeft)+parseInt(l.marginRight)+parseInt(l.borderRight)}},height:function(e,t,n){t=t||0,void 0===n&&(n=dom.find("#container")),n=n||document.body;let l=null;l="string"==typeof e?document.querySelector(e):e;let i=dom.top(l),o=getComputedStyle(n,null),a=(parseInt(o.getPropertyValue("padding-top")),parseInt(o.getPropertyValue("padding-bottom")));o=getComputedStyle(l,null);parseInt(o.getPropertyValue("border-top-width")),parseInt(o.getPropertyValue("border-bottom-width"));l.style.marginBottom="0px",l.style.height=n.clientHeight-i-t-a+"px",l.style.overflowY="auto"},templatize:function(e,t){let n=Handlebars.compile(e)(t);return dom.element(n)}};dom.render=function(e,t,n){let l=null;function i(e,t,l){let i=dom.find("[name='"+t+"']",e);null!=i&&("DIV"===i.nodeName&&n?l&&function(e,t){let n=dom.find("[value='"+t+"']",e);null!=n&&(n.checked=!0)}(i,l):"INPUT"==i.tagName?"radio"==i.type||(i.value=l):"SPAN"==i.tagName?l&&(i.innerHTML=l):"SELECT"==i.tagName&&$("select[name='"+t+"']").val(l).trigger("change"))}l="string"==typeof e?document.querySelector(e):e;for(let e in t)if("object"==typeof t[e])for(let n in t[e])i(l,e+"."+n,t[e][n]);else i(l,e,t[e])},dom.popup=function(e,t){let n=dom.create("div","full-width","full-height","position-absolute");return n.style.background="transparent",dom.bind(n,"click",e=>{n.remove(),t.remove()}),document.body.appendChild(n),e.appendChild(t),n},dom.html=function(e){let t=dom.element("<div></div>");return t.appendChild(e),t.innerHTML};let utils={append:function(e,t,n){let l=dom.create("div");l.style.height="100%",l.style.width="100%",n=n||!1;let i=document.createRange().createContextualFragment(t);n&&(e.innerHTML=""),e.appendChild(l),l.appendChild(i);let o=dom.find("[id^=page]",l);return o?l.setAttribute("page-id",o.id):l.setAttribute("page-id","page.not.in.database"),{id:o?o.id:"",container:l}},message:function(e){if(!e&&0==e.length)return;let t="";for(let n=0;n<e.length;n++)t+=e[n].message+"<br>";return t},prompt:function(e){if(e||0!=e.length)for(let t=0;t<e.length;t++)$(e[t].element).addClass("is-invalid")},render:function(e,t,n){let l=document.getElementById(t).innerHTML,i=Handlebars.compile(l)(n);document.getElementById(e).innerHTML=i},assemble:function(e,t){if("object"==typeof e)for(let n in e){let l=e[n];"object"==typeof l&&(e[n+"Id"]=l.id),"id"==n?e[t+"Id"]=l:"name"==n&&(e[t+"Name"]=l)}},in:function(e){let t=e.split(" "),n=null,l=[];1==t.length?(n=document.getElementById(e),l.push(n)):l=(n=document.getElementById(t[0])).querySelectorAll(t[1]);for(let e=0;e<l.length;e++)(n=l[e]).addEventListener("animationend",function(){this.classList.remove("animated","fadeIn"),this.style.display="",this.removeEventListener("animationend",function(){}),this.removeEventListener("animationstart",function(){})}),n.classList.remove("fadeOut","hide"),n.classList.add("animated","fadeIn","show")},out:function(e){let t=e.split(" "),n=null,l=[];1==t.length?(n=document.getElementById(e),l.push(n)):l=(n=document.getElementById(t[0])).querySelectorAll(t[1]);for(let e=0;e<l.length;e++)(n=l[e]).addEventListener("animationend",function(){this.classList.remove("animated","fadeOut"),this.removeEventListener("animationend",function(){})}),n.classList.remove("fadeIn","show"),n.classList.add("animated","fadeOut","hide")},nameAttr:function(e){const t=[];let n="";for(let l=0;l<e.length;l++){let i=e.charAt(l);i==i.toUpperCase()?(t.push(n),n="",n+=i.toLowerCase()):n+=i}return""!=n&&t.push(n),"data-model-"+t.join("-")},nameVar:function(e){if(-1==e.indexOf("-"))return e;const t=e.split("-");let n="";for(let e=0;e<t.length;e++){const l=t[e];n+=0==e?l:l.charAt(0).toUpperCase()+l.slice(1)}return n},clone:function(e,t){e=e||{};for(let n in e)t[n]=e[n]},get:function(e){let t=Array.prototype.slice.call(arguments,1),n={};for(let l=0;l<t.length;l++)n[t[l]]=e[t[l]];return n},isEmpty:function(e){let t=0;for(let n in e)t++;return 0==t},isBlank:function(e){let t=0;for(let n in e)null!=e[n]&&""!==e[n]&&t++;return 0==t},getParameter:function(e,t){t=t.replace(/[\[\]]/g,"\\$&");let n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},getParameters:function(e){if(-1==e.indexOf("?"))return{};let t={},n=(e=e.substring(e.indexOf("?")+1)).split("&");for(let e=0;e<n.length;e++){let l=n[e].split("=");t[l[0].trim()]=decodeURIComponent(l[1].trim())}return t},isExisting:(e,t,n)=>{for(let l=0;l<e.length;l++)if(e[l][n]===t[n])return!0;return!1}};
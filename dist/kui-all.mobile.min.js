xhr={request:function(e,t){var i=e.url,n=e.data||e.params||{};let s=e.type||"json",o=e.success,a=e.error;n={...utils.getParameters(e.url),...n},e=e.usecase||"";let l=new XMLHttpRequest;l.timeout=1e4,l.onload=function(){let t=l.responseText;if("json"==s)try{t=JSON.parse(t)}catch(e){return void(a&&a(t))}4==l.readyState&&"200"==l.status?o&&o(t):a&&a(t)},l.onerror=function(){a&&a({error:{code:-500,message:"网络访问错误！"}})},l.ontimeout=function(){a&&a({error:{code:-501,message:"网络请求超时！"}})},l.open(t,i,!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("usecase",e),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),window.user?l.setRequestHeader("_current_user",window.user.userId):l.setRequestHeader("_current_user","unauthorized user"),l.send(JSON.stringify(n))},get:function(e){var t=e.url;e.data;let i=e.success,n=e.error,s=new XMLHttpRequest;s.open("GET",t,!0),s.onload=function(){var e=s.responseText;4==s.readyState&&"200"==s.status?i&&i(e):n&&n(e)},s.send(null)},post:function(e){let t=e.url;"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.request(e,"POST")},put:function(e){xhr.request(e,"PUT")},delete:function(e){xhr.request(e,"DELETE")},connect:function(e){xhr.request(e,"CONNECT")},upload:function(t){var e,i=t.url,n=t.data||t.params;let s=t.type||"json",o=t.success,a=t.error,l=new FormData;for(e in n)l.append(e,n[e]);l.append("file",t.file);let r=new XMLHttpRequest;r.timeout=1e4,r.onload=function(){let t=r.responseText;if("json"==s)try{t=JSON.parse(t)}catch(e){return void(a&&a(t))}4==r.readyState&&"200"==r.status?o&&o(t):a&&a(t)},t.progress&&(r.onprogress=function(e){t.progress(e.loaded,e.total)}),r.onerror=function(){a&&a({error:{code:-500,message:"网络访问错误！"}})},r.ontimeout=function(){a&&a({error:{code:-501,message:"网络请求超时！"}})},r.open("POST",i,!0),"undefined"!=typeof APPTOKEN&&r.setRequestHeader("apptoken",APPTOKEN),r.send(l)},chain:function(i){if(0!=i.length){var e=i[0];let t=e.success;xhr.promise(e,function(e){t(e),xhr.chain(i.slice(1))})}},asyncGet:function(i,n){return new Promise(function(t,e){i.success=function(e){t(e)},i.error=n,xhr.get(i)})},promise:function(i,n){return new Promise(function(t,e){i.success=function(e){e.error?n?n(e.error):dialog.error(e.error.message):t(e.data)},i.error=n,xhr.post(i)})},longpromise:function(i,n){let e=i.container||dom.find("#container");var t=i.tooltip||"操作处理中...";let s=dom.element(`
    <div class="page-loading hide">
      <div class="ring">${t}
        <span></span>
      </div>
    </div>
  `);return e.appendChild(s),s.classList.remove("hide"),new Promise(function(t,e){i.success=function(e){if(e.error)return setTimeout(()=>{s.classList.add("hide"),s.remove()},600),dialog.error(e.error.message),void(n&&n(e.error));setTimeout(()=>{s.classList.add("hide"),s.remove()},1200),t(e.data)},i.error=n,xhr.post(i)})},download:function(o){let a=new XMLHttpRequest;a.open("POST",o.url,!0),a.responseType="arraybuffer",a.onload=function(){if(200===this.status){let i="",n=a.getResponseHeader("Content-Disposition");if(n&&-1!==n.indexOf("attachment")){let e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,t=e.exec(n);null!=t&&t[1]&&(i=t[1].replace(/['"]/g,""))}var e,t,s=a.getResponseHeader("Content-Type"),s=new Blob([this.response],{type:s});void 0!==window.navigator.msSaveBlob?window.navigator.msSaveBlob(s,i):(e=window.URL||window.webkitURL,t=e.createObjectURL(s),void 0===(s=document.createElement("a")).download?window.location=t:(s.href=t,s.download=o.filename||"下载的文件",document.body.appendChild(s),s.click()),setTimeout(function(){e.revokeObjectURL(t)},100))}},a.setRequestHeader("Content-type","application/json"),"undefined"!=typeof APPTOKEN&&a.setRequestHeader("apptoken",APPTOKEN),a.send(JSON.stringify(o.params||{}))},asyncRequest:function(e,s){let o=e.url,a=e.data||e.params,l=e.type||"json",r=e.usecase||"";return new Promise((i,n)=>{if(o){let t=new XMLHttpRequest;t.timeout=1e4,t.onload=function(){let e=t.responseText;if("json"==l)try{e=JSON.parse(e)}catch(e){return console.log(e),void n(e)}(4==t.readyState&&"200"==t.status?i:n)(e)},t.onerror=function(){n({error:{code:-500,message:"网络访问错误！"}})},t.ontimeout=function(){n({error:{code:-501,message:"网络请求超时！"}})},t.open(s,o,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("usecase",r),"undefined"!=typeof APPTOKEN&&t.setRequestHeader("apptoken",APPTOKEN),a?t.send(JSON.stringify(a)):t.send(null)}})},asyncPost:function(e){let t=e.url;return"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.asyncRequest(e,"POST")}},"undefined"!=typeof module&&(module.exports={xhr:xhr});var ajax={save:function(e){for(var t=e.url||"",i=e.form,n=e.button,s=e.success,o=i.validate(),a="",l=0;l<o.length;l++)a+=o[l].message+"<br>";""==a?(n&&n.prop("disabled",!0),i=i.formdata(),$.ajax({url:t,data:i,method:"POST",dataType:"json",success:function(e){if(void 0!==e.error)return dialog.error("保存信息出错！"),void(n&&n.prop("disabled",!1));dialog.success("保存信息成功！"),void 0!==s&&s(e),n&&n.prop("disabled",!1)},error:function(){dialog.error("系统异常！"),n&&n.prop("disabled",!1)}})):dialog.error(a)},post:function(t){var e={...utils.getParameters(t.url),...t.data};$.ajax({url:t.url,data:e,method:"POST",dataType:"json",success:function(e){void 0!==t.success&&t.success(e)}})},get:function(t){$.ajax({url:t.url,data:t.data,dataType:"json",success:function(e){void 0!==t.success&&t.success(e)}})},text:function(e,t,i){$.ajax({url:e,data:t,success:function(e){void 0!==i&&i(e)}})},view:function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();let t=e.url,n=!1;n=void 0===e.empty||e.empty;let i=e.page;t&&0==t.indexOf(":")&&(i=t.substring(1),t=null);let s=utils.getParameters(e.url),o={...s,...e.params},a=e.title||"",l=e.containerId,r=e.success,d=null;if("string"==typeof l?(d=document.getElementById(l.trim()),null==d&&(d=document.querySelector(l.trim()))):d=l,void 0===o&&(o={}),window.parameters)for(var c in o)window.parameters[c]=o[c];t?xhr.get({url:t,success:function(e){let t=null;d&&(t=utils.append(d,e,n)),t.id&&window[t.id].show(s),r&&r(a,t,s)}}):i&&xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:i},success:function(e){let t=e.data.script;t=t||'<div class="full-width full-height d-flex"><img src="img/under-construction.jpeg" class="m-auto full-width"></div>';let i=null;d&&(i=utils.append(d,t,n)),r&&r(a,i,s)}})}};ajax.append=function(r){"undefined"!=typeof schedule&&r.clear&&schedule.stop();let d=dom.find("#tabsMain"),c=dom.find("#tabsOthers");if(null!=d){let a=d.children.length,i=r.url,s=r.title||"",e=r.containerId,t=r.params,o=r.success,l=null;if("string"==typeof e?(l=document.getElementById(e.trim()),null==l&&(l=document.querySelector(e.trim()))):l=e,void 0===t&&(t={}),window.parameters)for(var u in t)window.parameters[u]=t[u];h();let n=l.querySelector('div[data-url="'+i+'"]');if(null!=n){n.classList.remove("hide"),setTimeout(function(){n.classList.add("show")},150);let e=dom.find('a[data-url="'+i+'"]',d);return null!=e?void e.classList.add("active"):void dom.find('a[data-url="'+i+'"]',c).classList.add("active")}if(0==i.indexOf(":")){let t=i.substring(1);xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:t},success:function(e){e=e.data.script;utils.append(l,e,!1);for(let t=l.children.length-1;0<=t;t--){let e=l.children[t];if("DIV"==e.tagName){e.setAttribute("data-url",i),setTimeout(function(){e.classList.add("show")},150);break}}p(s,i),stdbiz.render(t,l.querySelector('[data-url="'+i+'"]'),{})}})}else m(i);function h(){l.querySelectorAll("div[data-url]").forEach(e=>{e.classList.remove("show"),e.classList.add("hide","fade","fadeIn")}),d.querySelectorAll("a.active").forEach(e=>{e.classList.remove("active")}),c.querySelectorAll("a.active").forEach(e=>{e.classList.remove("active")})}function p(t,i){if(""==t||null==d)return;var e=dom.element(`
      <li class="nav-item">
        <a class="nav-link head-link">
          <span></span>
          <i class="fas fa-times-circle ml-1"></i>
        </a>
      </li>
    `);dom.find("a",e).setAttribute("data-url",i),dom.bind(dom.find("i",e),"click",t=>{t.preventDefault(),t.stopPropagation();let e=t.target.parentElement,i=l.querySelector('div[data-url="'+e.getAttribute("data-url")+'"]');if(i&&i.remove(),t.target.parentElement.parentElement.remove(),0<l.querySelectorAll("div[data-url]").length&&d.children[0].click(),0<c.children.length){let e=c.children[0];e.remove(),t=e,dom.find("a",t).classList.add("nav-link"),dom.find("a",t).classList.remove("dropdown-item"),dom.find("i",t).classList.add("ml-1"),dom.find("i",t).classList.remove("float-right"),d.appendChild(t)}}),dom.bind(dom.find("a",e),"click",e=>{let t=dom.ancestor(e.target,"a");t.classList.contains("active")||(h(),t.classList.add("active"),m(o.getAttribute("data-url")))});let n=!1;if(d.querySelectorAll("li").forEach(e=>{dom.find("span",e).innerText==t&&(n=!0,dom.find("a",e).classList.add("active"))}),n)return;if(0==a)d.appendChild(e);else if(a+1>MAX_HEAD_LINK_COUNT){let e=dom.find("li:last-child",d);e.remove(),i=e,dom.find("a",i).classList.add("pointer"),dom.find("a",i).classList.remove("nav-link"),dom.find("a",i).classList.add("dropdown-item"),dom.find("i",i).classList.remove("ml-1"),dom.find("i",i).classList.add("float-right"),0==c.children.length?c.appendChild(i):c.insertBefore(i,c.children[0])}d.insertBefore(e,d.children[0]);let s=dom.find("span",e),o=dom.find("a",e);o.classList.add("active"),s.innerText=t}function m(n){l.querySelectorAll("div[data-url]").forEach(e=>{e.classList.remove("show"),e.classList.add("hide")});let t=l.querySelector('div[data-url="'+n+'"]');if(null!=t){t.classList.remove("hide"),setTimeout(function(){t.classList.add("show")},150);let e=dom.find('a[data-url="'+n+'"]',d);return null!=e?void e.classList.add("active"):void dom.find('a[data-url="'+n+'"]',c).classList.add("active")}xhr.get({url:n,success:function(e){var t=utils.getParameters(n),i=utils.append(l,e,!1);i.id&&window[i.id].show(t);for(let t=l.children.length-1;0<=t;t--){let e=l.children[t];if("DIV"==e.tagName){e.setAttribute("data-url",n),setTimeout(function(){e.classList.add("show")},150);break}}p(s,n),o&&o(s,e)}})}}else ajax.view(r)},ajax.shade=function(t){"undefined"!=typeof schedule&&schedule.stop();let e=t.url,i=t.success,n=document.querySelector(".page.full");null!=n&&n.parentElement.remove(),-1===e.indexOf(":")?xhr.get({url:e,success:function(e){e=utils.append(document.body,e);i&&i(t.title||"",e)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:e.substring(1)},success:function(e){e=e.data.script,e=utils.append(document.body,e);i&&i(t.title||"",e)}})},ajax.stack=function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();var i=e.pageId,t=e.params;let n=dom.find(e.containerId);let s=!1;for(let t=0;t<n.children.length;t++){let e=n.children[t];"DIV"==e.tagName&&"true"!=e.getAttribute("data-stack-back")&&(e.classList.remove("show"),e.classList.add("hide"),e.id==i&&(e.classList.remove("hide"),e.classList.add("show"),s=!0))}s||(e.empty=!1,ajax.view(e));let o=dom.find("div[data-stack-back]",n);null==o&&(o=dom.element(`
    <div data-stack-back="true" class="pointer">
      <i class="fas fa-angle-left font-32" style="margin-top: 12px;"></i>
    </div>
  `),o.style.position="fixed",o.style.width="60px",o.style.height="60px",o.style.bottom="40px",o.style.right="40px",o.style.backgroundColor="#0C9",o.style.color="#fff",o.style.borderRadius="50px",o.style.textAlign="center",o.style.boxShadow="2px 2px 3px #999",o.style.zIndex="99",dom.bind(o,"click",e=>{o.remove(),ajax.unstack({containerId:n})}),n.appendChild(o))},ajax.unstack=function(e){e=dom.find(e.containerId);let t=e.children[e.children.length-1];t.remove();let i=e.children[e.children.length-1];i.classList.remove("hide"),i.classList.add("show")},ajax.template=function(e){var t=e.url,i=e.usecase;let n=e.containerId,s=e.templateId;var o=e.data;let a=e.success;xhr.post({url:t,usecase:i,data:o,success:function(e){var t;n&&(t=document.getElementById(s).innerHTML,t=Handlebars.compile(t)(e),document.getElementById(n).innerHTML=t),a&&a(e)}})},ajax.dialog=function(e){let t=e.title||"";var i=e.url||"",n=e.params||{};let s=e.success,o=e.end,a=!1!==e.shadeClose,l=!0===e.allowClose,r=e.width||"80%",d=e.height||"",c=e.offset||"auto";if(window.parameters)for(var u in n)window.parameters[u]=n[u];$.ajax({url:i,data:n,async:!0,success:function(e){layer.open({type:1,offset:c,title:t,closeBtn:!0==l?1:0,shade:.3,shadeClose:a,area:[r,d],content:e,success:function(e,t){let i=document.querySelector(".layui-layer-content");i.style+="; overflow: hidden;",s&&s()},end:o||function(){}})}})},ajax.video=function(e,t,i,n){layer.open({type:2,title:!1,closeBtn:1,shade:[0],area:[i+"px",n+"px"],offset:"rb",anim:2,content:[e,"no"]})},ajax.svg=function(e,i,t,n){void 0===t&&(t={}),$.ajax({url:e,data:t,success:function(e){i.empty();var t=(new XMLSerializer).serializeToString(e.documentElement);i.html(t),n&&n(e)}})},ajax.upload=function(t){let e=t.data;void 0===e&&(e={});let i=new FormData;for(var n in e)i.append(n,e[n]);$.ajax({url:t.url,data:i,method:"POST",cache:!1,contentType:!1,processData:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&t.progress&&e.upload.addEventListener("progress",function(e){e.lengthComputable&&t.progress&&t.progress(e.total,e.loaded)},!1),e},success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},ajax.sidebar=function(t){let e=dom.find(t.containerId),i=t.success||function(e,t){},n=dom.find("[widget-id=right-bar]"),s=t.allowClose||!1;null!=n&&n.remove(),n=dom.element(`
    <div widget-id="right-bar" style="position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: transparent; z-index: 999999;">
      <div class="right-bar fade show">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="card-header pl-3">
              <h5 class="modal-title"></h5>
              <button type="button" class="close text-danger">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="modal-body" style="overflow-y: auto;"></div>
            <div style="position: absolute; bottom: 24px; left: 0; width: 100%; height: 48px; border-top: 1px solid lightgrey; background: white; display:none;">
              <div widget-id="right-bar-bottom" class="mh-10 mt-2" style="float: right;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `),!0===t.showBottom&&(dom.find(".modal-body",n).style.marginBottom="36px",dom.find("[widget-id=right-bar-bottom]",n).parentElement.style.display=""),n.addEventListener("click",e=>{"right-bar"===e.target.getAttribute("widget-id")&&(n.children[0].classList.remove("in"),n.children[0].classList.add("out"),setTimeout(function(){n.remove()},300))}),e.appendChild(n),0==t.url.indexOf(":")&&(t.page=t.url.substring(1),t.url=null),t.url?xhr.get({url:t.url,success:function(e){dom.find(".modal-title",n).innerHTML=t.title||"",dom.find(".modal-body",n).innerHTML="",s||t.close||dom.find("button.close",n).classList.add("hidden"),dom.find("button.close",n).addEventListener("click",function(){n.children[0].classList.add("out"),n.remove(),t.close&&t.close()});e=utils.append(dom.find(".modal-body",n),e);i&&i(t.title||"",e),setTimeout(function(){n.children[0].classList.remove("out"),n.children[0].classList.add("in")},300)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",params:{customWindowId:t.page},success:function(e){e=e.data.script;dom.find(".modal-body",n).innerHTML="";e=utils.append(dom.find(".modal-body",n),e);dom.find(".modal-title",n).innerHTML=t.title||"&nbsp;",s||t.close||dom.find("button.close",n).classList.add("hidden"),dom.find("button.close",n).addEventListener("click",function(){dom.find(".right-bar").classList.add("out"),setTimeout(function(){n.remove()},300),t.close&&t.close()}),i&&i(t.title||"",e),setTimeout(function(){n.children[0].classList.remove("out"),n.children[0].classList.add("in")},300)}})},ajax.bottombar=function(i){let e=dom.find(i.containerId),n=i.success||function(){},s=dom.find(".bottom-bar",e),o=i.allowClose||!1;null!=s&&s.remove(),s=dom.element(`
    <div class="bottom-bar fade show">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="card-header pt-2 pb-2">
            <button type="button" class="close text-danger">
              <i class="fas fa-times"></i>
            </button>
            <h5 class="modal-title"></h5>
          </div>
          <div class="modal-body" style="overflow-y: auto"></div>
        </div>
      </div>
    </div>
  `),e.appendChild(s);var t=s.parentElement.clientWidth,a=parseInt(window.getComputedStyle(s.parentElement,null).getPropertyValue("padding-left")),l=parseInt(window.getComputedStyle(s.parentElement,null).getPropertyValue("padding-right"));s.style.width=t-l-a+"px",i.url?xhr.get({url:i.url,success:function(e){dom.find(".modal-title",s).innerHTML=i.title||"",o||i.close||dom.find("button.close",s).classList.add("hidden"),dom.find("button.close",s).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),i.close&&i.close()}),utils.append(dom.find(".modal-body",s),e),n&&n(e),setTimeout(function(){s.classList.remove("out"),s.classList.add("in")},200)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:i.page},success:function(e){var t=e.data.script;utils.append(dom.find(".modal-body",s),t),dom.find(".modal-title",s).innerHTML=i.title,o||i.close||dom.find("button.close",s).classList.add("hidden"),dom.find("button.close",s).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),i.close&&i.close()}),n&&n(e),setTimeout(function(){s.classList.remove("out"),s.classList.add("in")},200)}})},ajax.tabs=function(e){let t=document.querySelector(e.containerId);var n=e.tabs;e.closeable;let o=dom.create("ul","nav","nav-tabs"),a=dom.create("div","tab-content"),i=dom.create("div","float-right");e=dom.create("button","btn","btn-link");function l(e,t,i,n){ajax.view({url:t,containerId:e,success:function(){window[i]&&window[i].show(n)}})}i.appendChild(e),dom.bind(e,"click",function(){let e=dom.find("li.active link",this.parentElement.parentElement);var t=e.getAttribute("data-model-url"),i=e.getAttribute("data-model-page"),n=JSON.parse("data-model-data");l(dom.find("div.tab-content div[data-model-url='"+t+"']",this.parentElement.parentElement),t,i,n)});for(let i=0;i<n.length;i++){var r=n[i];let e=dom.create("li","nav-item"),s=dom.create("a","nav-link");0==i&&s.classList.add("active"),s.setAttribute("data-model-url",r.url),s.setAttribute("data-model-data",JSON.stringify(r.data||{})),s.setAttribute("data-model-page",r.page),s.innerHTML=r.title,dom.bind(s,"click",function(){if(!this.classList.contains("active")){dom.find("a.active",this.parentElement.parentElement.parentElement).classList.remove("active"),dom.find("div.active",this.parentElement.parentElement.parentElement).classList.remove("active");var t=s.getAttribute("data-model-url"),i=JSON.parse(s.getAttribute("data-model-data")),n=s.getAttribute("data-model-page");let e=dom.find("div.tab-content div[data-model-url='"+t+"']",this.parentElement.parentElement.parentElement);this.classList.add("active"),e.classList.add("active"),""===e.innerHTML.trim()&&l(e,t,n,i)}}),e.appendChild(s),o.appendChild(e);let t=dom.create("div","tab-pane");0==i&&(t.classList.add("active"),l(t,r.url,r.page,r.data)),t.setAttribute("data-model-url",r.url),a.append(t)}t.appendChild(i),t.appendChild(o),t.appendChild(a)};var dom={value:function(e,t){const i=document.querySelector(e);if(!t)return i.value.trim();i.value=t},empty:function(e){const t=document.querySelector(e);t.value?t.value="":t.innerHTML=""},valid:function(e){const t=document.querySelector(e);return void 0!==t.value&&null!=t.value&&""!=t.value.trim()},create:function(e){var t=Array.prototype.slice.call(arguments,1);let i=document.createElement(e);for(let e=0;e<t.length;e++)i.classList.add(t[e]);return i},fix:function(e){let t=null;t="string"==typeof e?document.querySelector(e):e;var i=t.getBoundingClientRect(),n=i.left,s=i.top,o=(i.width,i.height),a=(parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-top"))),l=parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-bottom"));parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-top")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-bottom"));let r=t.parentElement.parentElement;e=r.getBoundingClientRect(),i=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"));parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-top")),parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-bottom"));return t.style.position="absolute",t.style.top=s-e.top+"px",t.style.left=n-e.left+"px",t.style.width="calc(100% - "+2*i+"px )",{top:s-e.top,left:n-e.left,width:e.width-2*i,height:o+a+l}},find:function(e,t){if(t=t||document,"string"!=typeof e)return e;e=t.querySelectorAll(e);return 0==e.length?null:1==e.length?e[0]:e},ancestor:function(e,t,i){let n=null;if(i=i||"",n="string"==typeof e?document.querySelector(e):e,null==n)return null;t=t.toUpperCase();let s=n;if(""==i)for(;null!=s&&s.tagName!=t;)s=s.parentElement;else for(;null!=s&&(s.tagName!=t||!s.classList.contains(i));)s=s.parentElement;return s},element:function(e){let t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},bind:function(e,t,i){let n=null;n="string"==typeof e?document.querySelector(e):e,null!=n&&n&&n.addEventListener(t,i)},model:function(e,i){let n=null;if(n="string"==typeof e?document.querySelector(e):e,void 0===i){let i={};return Array.prototype.slice.call(n.attributes).forEach(function(t){if(0==t.name.indexOf("data-model-"))if(0==t.value.indexOf("{"))try{i[utils.nameVar(t.name.slice("data-model-".length))]=JSON.parse(t.value)}catch(e){i[utils.nameVar(t.name.slice("data-model-".length))]=t.value}else i[utils.nameVar(t.name.slice("data-model-".length))]=t.value}),i}var s=Array.prototype.slice.call(arguments,2);if(0==s.length)for(const t in i)0!=t.indexOf("||")&&0!=t.indexOf("//")&&0!=t.indexOf(">>")&&("object"==typeof i[t]?n.setAttribute(utils.nameAttr(t),JSON.stringify(i[t])):n.setAttribute(utils.nameAttr(t),i[t]));else for(let t=0;t<s.length;t++){let e=s[t];0!=e.indexOf("||")&&0!=e.indexOf("//")&&0!=e.indexOf(">>")&&("object"==typeof i[e]?n.setAttribute(utils.nameAttr(e),JSON.stringify(i[e])):n.setAttribute(utils.nameAttr(e),i[e]))}},collect:function(e,n){let s=[],o=document.querySelectorAll(e);for(let i=0;i<o.length;i++){let t={};if(Array.isArray(n))for(let e=0;e<n.length;e++)t[n[e]]=o[i].getAttribute(utils.nameAttr(n[e]));else t[n]=o.getAttribute(utils.nameAttr(n[j]));s.push(t)}return s},propagate:function(e,t,i,n){let s=n(t);if(Array.isArray(i))for(let e=0;e<i.length;e++)s.setAttribute(utils.nameAttr(i[e]),t[i[e]]);else s.setAttribute(utils.nameAttr(i),t[i]);e.appendChild(s)},toggle:function(e,o){var i=document.querySelectorAll(e);for(let t=0;t<i.length;t++){let e=i[t];e.addEventListener("click",function(){let e=this.getAttribute("data-toggle"),t=e.split(">>"),i=t[0].split("+"),n=t[1].split("+"),s=!1;for(let t=0;t<i.length;t++){let e=i[t].trim();s=0==e.indexOf(".")?this.classList.contains(e.substring(1)):null!=this.querySelector(e)}if(s){for(let e=0;e<n.length;e++){let t=n[e].trim();if(0===t.indexOf("."))this.classList.add(t.substring(1));else{let e=this.querySelector(t.substring(0,t.indexOf(".")));e.classList.add(t.substring(t.indexOf(".")+1))}}for(let e=0;e<i.length;e++){let t=i[e].trim();if(0==t.indexOf("."))this.classList.remove(t.substring(1));else{let e=this.querySelector(t);e.classList.remove(t.substring(t.indexOf(".")+1))}}}else{for(let e=0;e<i.length;e++){let t=i[e].trim();if(0==t.indexOf("."))this.classList.add(t.substring(1));else{let e=this.querySelector(t.substring(0,t.indexOf(".")));e.classList.add(t.substring(t.indexOf(".")+1))}}for(let e=0;e<n.length;e++){let t=n[e].trim();if(0==t.indexOf("."))this.classList.remove(t.substring(1));else{let e=this.querySelector(t);e.classList.remove(t.substring(t.indexOf(".")+1))}}o&&resovle(this)}})}},switch:function(e,i){let n=dom.find(e),t=n.getAttribute("data-switch"),s=t.split("+");var o=n.querySelectorAll(s[0]);for(let t=0;t<o.length;t++){let e=o[t];e.addEventListener("click",function(){let t=n.querySelectorAll(s[0]);for(let e=0;e<t.length;e++)t[e].classList.remove(s[1].substring(1));e.classList.add(s[1].substring(1)),i&&i(e)})}},tabs:function(e){let n=dom.find(e);if(null!=n){let i=n.getAttribute("data-tab-active-class");for(let e=0;e<n.children.length;e++){let t=n.children[e];t.addEventListener("click",e=>{for(let t=0;t<n.children.length;t++){let e=n.children[t];e.classList.remove(i)}t.classList.add(i)})}}},top:function(e){let t=null;if(t="string"==typeof e?document.querySelector(e):e,null==t)return 0;let i=t.offsetTop;return void 0!==t.offsetParent&&(i+=dom.top(t.offsetParent)),i},formdata:function(e,t){let s=null;if(s="string"==typeof e?document.querySelector(e):e,void 0===t){let i={},n={};var o=s.querySelectorAll("input");for(let t=0;t<o.length;t++){var a=o[t];let e=a.name;var l=a.type,r=a.value;"text"==l||"number"==l||"password"==l||"hidden"==l?(i[e]=null,""!=r?-1!=e.indexOf("[]")?i[e]=[r]:i[e]=r:i[e]=""):"radio"==l?a.checked&&(i[e]=r):"checkbox"==l&&(void 0===n[e]&&(n[e]=0),a.checked&&(void 0===i[e]&&(n[e]=0,i[e]=[]),i[e].push(r)),n[e]+=1)}var d=s.querySelectorAll("select");for(let t=0;t<d.length;t++){var c=d[t];let e=c.name;i[e]=null,-1!=c.selectedIndex?-1!=e.indexOf("[]")?i[e]=[c.value]:i[e]=c.value:i[e]=""}var u,h,p=s.querySelectorAll("textarea");for(let e=0;e<p.length;e++){var m=p[e],f=m.name;i[f]=null,i[f]=m.value}for(u in n)-1==u.indexOf("[]")&&1==n[u]&&i[u]&&(i[u]=i[u][0]);for(h in i)"string"==typeof i[h]&&0==i[h].indexOf("${")&&(i[h]=i[i[h].substring(2,i[h].length-1)]);return i}function i(e,t,i){let n=dom.find("[name='"+t+"']",e);null!=n&&("INPUT"==n.tagName?"check"==n.type||(n.value=i||""):"SELECT"==n.tagName&&$("select[name='"+t+"']").val(i).trigger("change"))}for(var n in t)if("object"==typeof t[n])for(var g in t[n])i(s,n+"."+g,t[n][g]);else i(s,n,t[n])},setAttribute:function(e,t,i){let n=document.querySelectorAll(e);for(let e=0;e<n.length;e++)n[e][t]=i},removeAttribute:function(e,t){let i=document.querySelectorAll(e);for(let e=0;e<i.length;e++)i[e].removeAttribute(t)},enable:function(e){let t=document.querySelectorAll(e);for(let e=0;e<t.length;e++)t[e].disabled=!1},disable:function(e){let t;t="string"==typeof e?document.querySelectorAll(e):e;for(let e=0;e<t.length;e++)t[e].disabled=!0},index:function(e,i,t){let n;if(n="string"==typeof e?dom.find(e):e,!t){var s=n.getAttribute(i),o=n.parentElement.querySelectorAll(n.tagName);for(let t=0;t<o.length;t++){let e=o[t];if(s==e.getAttribute(i))return t}}return-1},elementAt:function(e,i,n){var s=document.querySelectorAll(e);for(let t=0;t<s.length;t++){let e=s[t];if(n==e.getAttribute(i))return{index:t,element:e}}return null},elementAtTree:function(e,i,n,s,o){var a=document.querySelectorAll(e);let l=0;for(let t=0;t<a.length;t++){let e=a[t];var r=e.getAttribute(i),d=e.getAttribute(n);if(o==d&&(l++,s==r))return{index:l,element:e}}},stack:function(t,i,n,s){let o=dom.create("a","btn","btn-link");var e=dom.create("i","fas","fa-caret-right","mr-1");o.appendChild(e),dom.bind(o,"click",function(){let e=dom.find("i",o);e.classList.contains("fa-caret-right")?(t.container.querySelectorAll("i.fa-caret-down").forEach(e=>{e.classList.remove("fa-caret-down"),e.classList.add("fa-caret-right")}),e.classList.remove("fa-caret-right"),e.classList.add("fa-caret-down"),t.stack(n,function(e){e.parentElement.classList.add("fade","fadeIn"),e.style.paddingLeft="50px",e.style.paddingRight="50px",setTimeout(function(){e.parentElement.classList.add("show")},200),s(e)})):(e.classList.remove("fa-caret-down"),e.classList.add("fa-caret-right"),i.parentElement.nextSibling.remove())})},inner:function(e){var t=e.clientHeight,i=e.clientWidth,e=getComputedStyle(e);return{height:t-parseInt(e.paddingTop)-parseInt(e.paddingBottom),width:i-parseInt(e.paddingLeft)-parseInt(e.paddingLeft)}},outer:function(e){var t=e.clientHeight,i=e.clientWidth,e=getComputedStyle(e);return{height:t+parseInt(e.marginTop)+parseInt(e.borderTop)+parseInt(e.marginBottom)+parseInt(e.borderBottom),width:i+parseInt(e.marginLeft)+parseInt(e.borderLeft)+parseInt(e.marginRight)+parseInt(e.borderRight)}},height:function(e,t,i){t=t||0,i=(i=void 0===i?dom.find("#container"):i)||document.body;let n=null;n="string"==typeof e?document.querySelector(e):e;var s=dom.top(n);let o=getComputedStyle(i,null);parseInt(o.getPropertyValue("padding-top"));e=parseInt(o.getPropertyValue("padding-bottom"));o=getComputedStyle(n,null);parseInt(o.getPropertyValue("border-top-width")),parseInt(o.getPropertyValue("border-bottom-width"));n.style.marginBottom="0px",n.style.height=i.clientHeight-s-t-e+"px",n.style.overflowY="auto"},height2:function(e,t,i){t=t||0,i=(i=void 0===i?dom.find("#container"):i)||document.body;let n=null;n="string"==typeof e?document.querySelector(e):e;dom.top(n);let s=getComputedStyle(i,null);var o=parseInt(s.getPropertyValue("padding-top")),a=parseInt(s.getPropertyValue("padding-bottom"));s=getComputedStyle(n,null);var l=parseInt(s.getPropertyValue("border-top-width")),r=parseInt(s.getPropertyValue("border-bottom-width")),d=parseInt(s.getPropertyValue("border-top-width")),e=parseInt(s.getPropertyValue("border-bottom-width"));n.style.marginBottom="0px";i=i.getBoundingClientRect();n.style.height=i.height-o-a-l-r-d-e-t+"px",n.style.overflowY="auto"},templatize:function(e,t){let i=Handlebars.compile(e);t=i(t);return dom.element(t)}};dom.render=function(e,t,s){let i=null;function n(e,t,i){let n=dom.find("[name='"+t+"']",e);null!=n&&("DIV"===n.nodeName&&s?i&&function(e,t){let i=dom.find("[value='"+t+"']",e);null!=i&&(i.checked=!0)}(n,i):"INPUT"==n.tagName?"radio"==n.type||(n.value=i):"SPAN"==n.tagName?i&&(n.innerHTML=i):"SELECT"==n.tagName&&$("select[name='"+t+"']").val(i).trigger("change"))}for(var o in i="string"==typeof e?document.querySelector(e):e,t)if("object"==typeof t[o])for(var a in t[o])n(i,o+"."+a,t[o][a]);else n(i,o,t[o])},dom.popup=function(e,t){let i=dom.create("div","full-width","full-height","position-absolute");return i.style.background="transparent",dom.bind(i,"click",e=>{i.remove(),t.remove()}),document.body.appendChild(i),e.appendChild(t),i},dom.html=function(e){let t=dom.element("<div></div>");return t.appendChild(e),t.innerHTML},dom.init=function(t,i){if(i){let e=i.getAttribute("name");e&&""!=e||(e=i.getAttribute("widget-id")),e&&""!=e&&(t[e]=i);for(let e=0;e<i.children.length;e++){var n=i.children[e];dom.init(t,n)}}};let utils={};function ListView(e){this.url=e.url,this.usecase=e.usecase,this.params=e.params||{},this.lazy=!0===e.lazy,this.hoverable=!1!==e.hoverable,this.activateable=!0===e.activateable,this.itemClass=e.itemClass||[],this.emptyHtml=e.emptyHtml,this.idField=e.idField,this.compare=e.compare||function(e,t){return!1},this.selections=e.selections||[],this.local=e.local||[],this.create=e.create||function(e,t){},this.complete=e.complete,this.draggable=!0===e.draggable,this.start=e.start||0,this.limit=e.limit||-1,this.borderless=e.borderless||!1,this.height=e.height,this.tooltip=e.tooltip,this.required=e.required||!1,this.onRemove=e.onRemove,this.onReorder=e.onReorder,this.onCheck=e.onCheck,this.onSelect=e.onSelect,this.onFilter=e.onFilter,this.onAdd=e.onAdd,this.onSearch=e.onSearch,this.onClick=e.onClick,this.observableItems=new rxjs.Observable}function Timeline(e){this.url=e.url,this.params=e.params||{},this.data=e.data||[],this.fnTitle=e.title||function(e,t){return""},this.fnSubtitle=e.subtitle||function(e,t){return""},this.fnContent=e.content||function(e,t){return""},this.onComplete=e.onComplete}function Tabs(e){this.navigator=dom.find(e.navigatorId),this.content=dom.find(e.contentId),this.tabActiveClass=e.tabActiveClass,this.tabs=e.tabs,this.lazy=!1!==e.lazy,this.autoClear=!0===e.autoClear}function DataSheet(e){this.columns=e.columns,this.columnCount=this.getColumnCount(this.columns),this.rowHeaderWidth=e.rowHeaderWidth||150,this.rowHeaders=e.rowHeaders,this.rowCount=this.getRowCount(this.rowHeaders),this.readonly=!0===e.readonly,this.totalColumns=[];for(let e=0;e<this.columns.length;e++){var t=this.columns[e];t.totalable&&this.totalColumns.push(t)}this.onCellClicked=e.onCellClicked,this.onRowHeaderClicked=e.onRowHeaderClicked,this.rowHeaderColumnCount=this.getRowHeaderColumnCount(this.rowHeaders),this.colHeaderColumnCount=this.getColumnHeaderColumnCount(this.columns),this.rowHeaderRowCount=this.getRowHeaderRowCount(this.rowHeaders),this.colHeaderRowCount=this.getColumnHeaderRowCount(this.columns),this.matrixColumn=[],this.matrixRowHeader=[],this.buildColumnMatrix(this.columns,this.matrixColumn,0),this.buildRowHeaderMatrix(this.rowHeaders,this.matrixRowHeader,0)}function Chat(e){this.host=e.host||"",this.userId=e.userId,this.userType=e.userType,this.getConversations=e.getConversations,this.onInit=e.onInit||async function(){},this.onSendTextMessage=e.onSendTextMessage,this.onSendImageMessage=e.onSendImageMessage,this.onSendAudioMessage=e.onSendAudioMessage,this.onSendVideoMessage=e.onSendVideoMessage,this.onSendCustomMessage=e.onSendCustomMessage,this.onRevokeMessage=e.onRevokeMessage||function(e){},this.onMessageReceived=e.onMessageReceived,this.onUnreadMessages=e.onUnreadMessages||function(e){},this.onReadMessages=e.onReadMessages||function(e){}}function MobileWizard(e){this.topic=e.topic,this.steps=e.steps||[],this.root=dom.element(`
    <div style="width: 100%">
      <div class="wizard-progress">
      </div>
      <div class="wizard-content">
      </div>
    </div>
  `)}function MobileForm(e){this.fields=e.fields,this.readonly=e.readonly||!1,this.saveOpt=e.save,this.readOpt=e.read}function Numpad(e){this.unit=e.unit||"",this.regex=e.regex||/.*/,this.success=e.success||function(e){},this.type=e.type||"decimal"}function DistrictPicker(e){this.unit=e.unit||"",this.regex=e.regex||/.*/,this.success=e.success||function(e){},this.selections=e.selections||{}}function Calendar(e){this.today=moment(new Date),this.currentMonth=moment(this.today).startOf("month"),this.currentIndex=1}function CascadePicker(e){this.success=e.success||function(e){},this.selections=e.selections||{},this.levels=e.levels}function ActionSheet(e){this.title=e.title||"",this.actions=e.actions||[]}function Weekdays(e){e=e||{},this.today=moment(new Date),this.days=e.days||14}utils.append=function(e,t,i){let n=dom.create("div");n.style.height="100%",n.style.width="100%",i=i||!1;let s=document.createRange();t=s.createContextualFragment(t);!1!==i&&(e.innerHTML=""),e.appendChild(n),n.appendChild(t);t=dom.find("[id^=page]",n);return t?n.setAttribute("page-id",t.id):n.setAttribute("page-id","page.not.in.database"),{id:t?t.id:"",container:n}},utils.message=function(i){if(i||0!=i.length){let t="";for(let e=0;e<i.length;e++)t+=i[e].message+"<br>";return t}},utils.prompt=function(t){if(t||0!=t.length)for(let e=0;e<t.length;e++)$(t[e].element).addClass("is-invalid")},utils.render=function(e,t,i){t=document.getElementById(t).innerHTML;let n=Handlebars.compile(t);i=n(i);let s=document.getElementById(e);s.innerHTML=i},utils.assemble=function(e,t){if("object"==typeof e)for(var i in e){var n=e[i];"object"==typeof n&&(e[i+"Id"]=n.id),"id"==i?e[t+"Id"]=n:"name"==i&&(e[t+"Name"]=n)}},utils.in=function(e){var t=e.split(" ");let i=null,n=[];1==t.length?(i=document.getElementById(e),n.push(i)):(i=document.getElementById(t[0]),n=i.querySelectorAll(t[1]));for(let e=0;e<n.length;e++)i=n[e],i.addEventListener("animationend",function(){this.classList.remove("animated","fadeIn"),this.style.display="",this.removeEventListener("animationend",function(){}),this.removeEventListener("animationstart",function(){})}),i.classList.remove("fadeOut","hide"),i.classList.add("animated","fadeIn","show")},utils.out=function(e){var t=e.split(" ");let i=null,n=[];1==t.length?(i=document.getElementById(e),n.push(i)):(i=document.getElementById(t[0]),n=i.querySelectorAll(t[1]));for(let e=0;e<n.length;e++)i=n[e],i.addEventListener("animationend",function(){this.classList.remove("animated","fadeOut"),this.removeEventListener("animationend",function(){})}),i.classList.remove("fadeIn","show"),i.classList.add("animated","fadeOut","hide")},utils.nameAttr=function(i){const n=[];let s="";for(let t=0;t<i.length;t++){let e=i.charAt(t);e==e.toUpperCase()?(n.push(s),s="",s+=e.toLowerCase()):s+=e}return""!=s&&n.push(s),"data-model-"+n.join("-")},utils.nameVar=function(t){if(-1==t.indexOf("-"))return t;var i=t.split("-");let n="";for(let e=0;e<i.length;e++){const t=i[e];0==e?n+=t:n+=t.charAt(0).toUpperCase()+t.slice(1)}return n},utils.camelcase=function(t,e){if(-1==t.indexOf(e))return t;var i=t.split(e);let n="";for(let e=0;e<i.length;e++){const t=i[e];0==e?n+=t:n+=t.charAt(0).toUpperCase()+t.slice(1)}return n},utils.pascalcase=function(t,e){if(-1==t.indexOf(e))return t.charAt(0).toUpperCase()+t.slice(1);var i=t.split(e);let n="";for(let e=0;e<i.length;e++){const t=i[e];n+=t.charAt(0).toUpperCase()+t.slice(1)}return n},utils.clone=function(e,t){for(var i in e=e||{})t[i]=e[i]},utils.get=function(t){var i=Array.prototype.slice.call(arguments,1);let n={};for(let e=0;e<i.length;e++)n[i[e]]=t[i[e]];return n},utils.isEmpty=function(e){let t=0;for(var i in e)t++;return 0==t},utils.isBlank=function(e){let t=0;for(var i in e)null!=e[i]&&""!==e[i]&&t++;return 0==t},utils.getParameter=function(e,t){t=t.replace(/[\[\]]/g,"\\$&");let i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),n=i.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},utils.getParameters=function(e){if(-1==e.indexOf("?"))return{};let i={},n=(e=e.substring(e.indexOf("?")+1)).split("&");for(let t=0;t<n.length;t++){let e=n[t].split("=");if(1==e.length)return{};i[e[0].trim()]=decodeURIComponent(e[1].trim())}return i},utils.isExisting=(t,i,n)=>{for(let e=0;e<t.length;e++)if(t[e][n]===i[n])return!0;return!1},"undefined"==typeof dialog&&(dialog={}),dialog.alert=function(e){layer.open({type:0,icon:0,offset:"150px",shade:0,shadeClose:!0,title:"警告",content:e})},dialog.info=function(e){layer.open({type:0,offset:"150px",shade:0,shadeClose:!0,title:"信息",content:e})},dialog.info2=function(e){layer.open({type:0,offset:"100px",shade:.3,shadeClose:!0,title:"信息",content:e})},dialog.error=function(e){e=e.replaceAll("\n","<br>"),layer.open({type:0,icon:2,offset:"150px",shade:0,shadeClose:!0,title:"错误",content:e})},dialog.success=function(e,i){i?layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e,btn:["确定","确定并返回"],yes:function(e,t){layer.close(e)},btn2:function(e,t){layer.close(e),i()}}):layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e})},dialog.confirm=function(e,t){layer.confirm(e,{title:"确认",btn:["确定","取消"]},function(e){layer.close(e),t()},function(){})},dialog.view=function(e){let i=e.title;var t=e.url;$(document.body);$("#dialogApplication").length&&$("#dialogApplication").remove();let n=[];e.save&&n.push({text:"保存",class:"btn-save",success:e.save}),$.ajax({url:t,success:function(e){let t=Handlebars.compile('<div class="modal fade" id="dialogApplication">  <div class="modal-dialog modal-dialog-centered">    <div class="modal-content">      <div class="modal-header">        <h4 class="modal-title">{{title}}</h4>        <button type="button" class="close" data-dismiss="modal">&times;</button>      </div>      <div id="dialogApplicationBody" class="modal-body">{{body}}</div>      <div class="modal-footer">        {{#each buttons}}        <button type="button" class="btn {{class}}" data-dismiss="modal">{{text}}</button>        {{/each}}        <button type="button" class="btn btn-close" data-dismiss="modal">关闭</button>      </div>    </div>  </div></div>');e=t({title:i,body:e,buttons:n});$(document.body).append(e),$("#dialogApplication").modal("show")}})},dialog.select=function(t){ajax.view({url:t.url,success:function(e){layer.open({type:0,icon:1,offset:"150px",shade:.5,shadeClose:!0,title:t.title,content:e})}})},dialog.simplelist=async function(i){var n=await xhr.promise({url:i.url,params:i.params||{}}),e=dom.element(`
    <div>
      <ul class="list-group"></ul>
    </div>
  `);let s=dom.find("ul",e);for(let t=0;t<n.length;t++){var o=n[t];let e=dom.create("li","list-group-item","list-group-item-action");dom.model(e,o),e.innerText=o[i.fields.text],s.appendChild(e)}layer.open({type:0,closeBtn:1,btn:[],shade:.5,shadeClose:!0,title:"",content:e.innerHTML,success:function(e,t){e.get(0).querySelectorAll("li").forEach((e,t)=>{dom.bind(e,"click",e=>{layer.close(layer.index);e=dom.model(e.target);i.onAccept(e)})})}})},dialog.html=function(i){layer.open({type:0,closeBtn:1,offset:"150px",shade:.5,area:["50%",""],shadeClose:!0,title:i.title||"&nbsp;",content:i.html,btn:["确定","关闭"],success:function(e,t){i.load&&i.load(e,t)},yes:function(e){layer.close(e),i.success()},btn1:function(){}})},dialog.iframe=function(e){layer.open({title:e.title,type:2,area:[e.width,e.height],content:e.url,resize:!1,maxmin:!0,shade:!1,success:e.success||function(e,t){}})},ListView.prototype.fetch=async function(e){var t={};e=e||{},utils.clone(this.params,t),utils.clone(e,t);this.url&&(this.data=this.data||{},this.data.start=this.start,this.data.limit=this.limit,t=await xhr.promise({url:this.url,params:t}),Array.prototype.push.apply(this.local,t)),0==this.local.length?this.emptyHtml&&(this.container.innerHTML=this.emptyHtml):this.append(this.local)},ListView.prototype.render=function(t,e){this.container="string"==typeof t?document.querySelector(t):t,this.container.innerHTML="";t=this.height-37;if(this.onFilter){let e=dom.element(`
      <div class="input-group position-sticky" style="top: 0; left: 0; z-index: 10;">
        <div class="input-group-prepend">
          <span class="input-group-text" style="border-bottom-left-radius: unset;">
            <i class="fas fa-search"></i>
          </span>
        </div>
        <input class="form-control" placeholder="搜索..."  style="border-bottom-right-radius: unset;">
        <div class="input-group-append">
          <span class="input-group-text pointer text-primary" style="border-bottom-right-radius: unset;">
            <i class="fas fa-plus"></i>
          </span>
          <span class="input-group-text" style="border-bottom-right-radius: unset;">
            <i class="fas fa-question icon-general"></i>
          </span>
          <span class="input-group-text" style="border-bottom-right-radius: unset;">
            <i class="fas fa-asterisk icon-required"></i>
          </span>
        </div>
      </div>
    `),t=dom.find("input",e);dom.bind(t,"input",e=>{clearTimeout(this.delayToSearch),this.delayToSearch=setTimeout(()=>{this.onFilter(this,t.value)},500)}),this.required||e.children[2].children[2].remove(),this.tooltip||e.children[2].children[1].remove(),this.onAdd||e.children[2].children[0].remove(),0==e.children[2].children.length&&e.children[2].remove(),this.container.appendChild(e)}let i=dom.create("ul","list-group","full-width");if(this.borderless&&i.classList.add("b-a-0"),this.onFilter){let e=dom.create("div");e.style.height=t+"px",e.style.overflowY="auto",e.style.border="1px solid rgba(0, 0, 0, 0.125)",e.style.borderTop="",e.appendChild(i),this.container.appendChild(e)}else this.container.appendChild(i);!1!==e&&!0!==this.lazy&&this.reload()},ListView.prototype.reload=function(e){e=e||{};let t=dom.find("ul",this.container);t.innerHTML="",this.start=0,this.url&&(this.local=[]),this.fetch(e)},ListView.prototype.load=function(){this.start=this.local.length,this.fetch()},ListView.prototype.remove=function(i){if(this.idField){var n=dom.find("ul",this.container);for(let t=0;t<n.children.length;t++){let e=n.children[t];dom.model(e)[this.idField]===i[this.idField]&&e.remove()}}},ListView.prototype.append=function(e,t){let n=this,s=this.container.querySelector("ul");var o=s.querySelectorAll("li").length;if(Array.isArray(e)){var i=e;for(let e=0;e<i.length;e++)this.append(i[e]);n.complete&&n.complete(e)}else{var a=e;if(this.idField)for(let e=0;e<s.children.length;e++){var l=s.children[e];if(dom.model(l)[this.idField]===a[this.idField])return}let i=dom.create("li","list-group-item");!1!==this.hoverable&&i.classList.add("list-group-item-action"),!0===this.activateable&&dom.bind(i,"click",e=>{for(let t=0;t<i.parentElement.children.length;t++){let e=i.parentElement.children[t];e.classList.remove("active")}i.classList.add("active")});for(let e=0;e<this.itemClass.length;e++)i.classList.add(this.itemClass[e]);this.borderless&&i.classList.add("b-a-0"),this.onClick&&dom.bind(i,"click",this.onClick),i.style.paddingLeft="16px",i.style.paddingRight="16px",i.style.paddingTop="8px",i.style.paddingBottom="8px",i.style.display="flex",i.style.alignItems="center",this.onFilter&&(i.style.borderLeftWidth="0",i.style.borderRightWidth="0",i.style.borderBottomWidth="0");o=this.create(o,a,i);if(this.onCheck){let t=dom.element(`
        <input class="pointer checkbox color-info is-outline mr-2" type="checkbox">
      `);for(let e=0;e<this.selections.length;e++)if(this.compare(this.selections[e],a)){t.setAttribute("checked",!0);break}dom.bind(t,"change",function(){n.onCheck(this.checked,dom.model(this),this)}),dom.model(t,a),i.appendChild(t)}i.appendChild(o),this.idField&&i.setAttribute("data-list-item-id",a[this.idField]),dom.model(i,a),"number"==typeof t?t<0?s.insertBefore(i,s.children[s.children.length+t]):s.insertBefore(i,s.children[t]):s.appendChild(i),this.onRemove&&(t=dom.element(`
        <a class="btn text-danger float-right font-18" style="padding: 0; margin-left: auto;">
          <i class="fas fa-times" style=""></i>
        </a>
      `),dom.bind(t,"click",function(e){e.stopPropagation(),n.onRemove(this.parentElement,dom.model(this.parentElement))}),dom.model(t,a),i.appendChild(t)),this.onReorder?this.setReorderable(i):this.draggable&&(i.setAttribute("draggable","true"),i.addEventListener("dragover",function(e){e.preventDefault()}),i.addEventListener("dragstart",function(e){}))}},ListView.prototype.replace=function(i){var n=this.container.querySelector("ul");for(let t=0;t<n.children.length;t++){let e=n.children[t];if(dom.model(e)[this.idField]===i[this.idField]){dom.model(e,i),e.innerHTML="",e.appendChild(this.create(t,i));break}}},ListView.prototype.search=function(i){var n=this.container.querySelector("ul");for(let t=0;t<n.children.length;t++){let e=n.children[t];-1!=e.innerText.indexOf(i)?e.style.display="":e.style.display="none"}},ListView.prototype.setReorderable=function(e){let t=dom.find("ul",this.container);t.addEventListener("dragover",function(e){e.preventDefault()}),t.ondrop=e=>{this.onReorder&&this.onReorder(dom.model(this.draggingElement),this.getItemIndex(this.draggingElement),this.draggingElementOriginalIndex),this.draggingElement.style.opacity="",this.draggingElement=null,this.clonedDraggingElement=null},e.setAttribute("draggable","true"),e.ondragover=e=>{var t,i=dom.ancestor(e.target,"li");let n=i.parentElement;i!=this.draggingElement&&((t=this.getItemIndex(i))<this.draggingElementIndex?n.insertBefore(this.draggingElement,i):t>this.draggingElementIndex&&(null==i.nextElementSibling?n.appendChild(this.draggingElement):n.insertBefore(this.draggingElement,i.nextElementSibling)),this.draggingElementIndex=t,e.preventDefault())},e.ondragstart=e=>{let t=dom.ancestor(e.target,"li");t.parentElement,e.layerX;var i=e.layerY,i=e.target.offsetTop+i;this.clonedDraggingElement=t.cloneNode(!0),console.log(this.clonedDraggingElement),this.draggingElement=t,this.draggingElement.style.opacity="0.3",this.draggingElementIndex=this.getItemIndex(t),this.draggingElementOriginalIndex=this.draggingElementIndex,e.dataTransfer.setData("id",t.getAttribute("data-list-item-id")),e.dataTransfer.setData("y",i)}},ListView.prototype.getItemIndex=function(t){var i=t.parentElement;for(let e=0;e<i.children.length;e++)if(t==i.children[e])return e},ListView.prototype.setHeight=function(e){let t=this.container.querySelector("ul");t.style.height=e+"px"},ListView.prototype.activate=function(e){let t=this.container.querySelector("ul");for(let e=0;e<t.children.length;e++)t.children[e].classList.remove("active");e.classList.add("active")},ListView.prototype.subscribe=function(e,t){},Timeline.prototype.createTile=function(e,t){var i,n=dom.element(`
    <li class="timeline-item">
      <div class="time"></div>
      <div class="small text-muted"></div>
      <p></p>
    </li>
  `);let s=n.children[0],o=n.children[1],a=n.children[2];return this.fnTitle&&(void 0===(i=this.fnTitle(e,t))?s.innerHTML="":"string"==typeof i||"number"==typeof i?s.innerHTML=i:s.appendChild(i)),this.fnSubtitle&&(void 0===(i=this.fnSubtitle(e,t))?o.innerHTML="":"string"==typeof i||"number"==typeof i?o.innerHTML=i:o.appendChild(i)),this.fnContent&&(void 0===(t=this.fnContent(e,t))?a.innerHTML="":"string"==typeof t||"number"==typeof t?a.innerHTML=t:a.appendChild(t)),n},Timeline.prototype.render=function(e,t){let i=this;this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="",t=t||{};let n=dom.create("ul","timeline-simple");this.container.appendChild(n);e={};if(utils.clone(this.params,e),utils.clone(t,e),this.url)xhr.post({url:this.url,params:e,success:function(e){if(e.data){var t=e.data;console.log(t);for(let e=0;e<t.length;e++)n.appendChild(i.createTile(t[e],e))}}});else for(let e=0;e<i.data.length;e++)n.appendChild(i.createTile(i.data[e],e));i.onComplete&&i.onComplete()},Tabs.prototype.loadPage=function(e,t,i,n){let s=dom.templatize('<div data-tab-content-id="{{id}}"></div>',{id:e});ajax.view({url:t,containerId:s,success:n||function(){}}),!0===i&&(s.style.display="none"),this.content.appendChild(s)},Tabs.prototype.render=function(){let a=this;this.content.innerHTML="",this.navigator.innerHTML="",this.slider=dom.element('<div class="slider"></div>'),this.navigator.appendChild(this.slider),this.tabs.forEach((s,e)=>{s.style=s.style||"padding: 0 16px;";let o=dom.templatize(`
      <div class="nav-item font-weight-bold mr-0 pointer" style="{{style}}"
           data-tab-url="{{{url}}}"
           data-tab-id="{{{id}}}" >{{{text}}}</div>
    `,s);a.navigator.appendChild(o),dom.bind(o,"click",t=>{if(!o.classList.contains(a.tabActiveClass)){for(let t=0;t<a.navigator.children.length;t++){let e=a.navigator.children[t];e.classList.remove(a.tabActiveClass)}for(let e=0;e<a.content.children.length;e++)a.content.children[e].style.display="none";a.activate(o),!0===this.autoClear&&(this.content.innerHTML="");let e=dom.find("div[data-tab-content-id="+o.getAttribute("data-tab-id")+"]",a.content);var i,n;null!=e?e.style.display="":(i=o.getAttribute("data-tab-id"),n=o.getAttribute("data-tab-url"),s.onClicked?s.onClicked(t):a.loadPage(i,n,!1,s.success))}}),!0===a.lazy?0==e&&(a.activate(o),s.onClicked?s.onClicked(ev):a.loadPage(s.id,s.url,!1,s.success)):0==e?(a.activate(o),s.onClicked?s.onClicked(ev):a.loadPage(s.id,s.url,!1,s.success)):s.onClicked?s.onClicked(ev):a.loadPage(s.id,s.url,!0,s.success)})},Tabs.prototype.activate=function(e){e.classList.add(this.tabActiveClass),this.slider.style.width=e.clientWidth+"px",this.slider.style.left=e.offsetLeft+"px"},DataSheet.prototype.root=function(s){s=s||{};let o=this;this.table=dom.create("table","table","table-bordered");let e=dom.create("thead");this.tbody=dom.create("tbody");let t=dom.create("tr"),i=dom.create("th");i.style.borderBottomWidth="0",i.style.width=this.rowHeaderWidth+"px",e.appendChild(t),this.table.appendChild(e),this.table.appendChild(this.tbody);for(let e=0;e<this.columns.length;e++){var n=this.columns[e];i=dom.create("th","text-center"),i.style.borderBottomWidth="0",i.innerHTML=n.title,t.appendChild(i)}for(let n=0;n<this.rowCount;n++){var a=this.rowHeaders[n];let t=dom.create("tr"),i=dom.create("td");i.innerHTML=a.title,i.style.fontWeight="bold",t.appendChild(i);for(let e=0;e<this.columnCount;e++){var l=this.columns[e];i=dom.create("td"),i.style.textAlign="right",i.style.padding="6px 12px",i.setAttribute("data-ds-format",l.format||""),i.setAttribute("data-ds-row",n),i.setAttribute("data-ds-column",e),i.addEventListener("focus",function(){}),s[a.title]&&s[a.title][l.title]?i.innerHTML=s[a.title][l.title]:i.innerHTML="",i.addEventListener("keyup",function(e){var t=parseInt(this.getAttribute("data-ds-row")),i=parseInt(this.getAttribute("data-ds-column"));let n=null;if(13==e.keyCode)n=this;else if(37==e.keyCode){if(0==i)return;n=o.getCell(t,i-1)}else if(38==e.keyCode){if(0==t)return;n=o.getCell(t-1,i)}else if(39==e.keyCode){if(i==o.columnCount-1)return;n=o.getCell(t,i+1)}else if(40==e.keyCode){if(t==o.rowCount-1)return;n=o.getCell(t+1,i)}o.totalize(),null!=n&&(this.blur(),n.focus(),document.execCommand("selectAll",!1,null))}),t.appendChild(i)}this.tbody.appendChild(t)}if(0<this.totalColumns.length){let t=dom.create("tr"),i=dom.create("td");i.innerHTML="合计",i.style.fontWeight="bold",t.appendChild(i);for(let e=0;e<this.columnCount;e++)i=dom.create("td"),t.appendChild(i);this.tbody.appendChild(t)}return this.totalize(),this.table},DataSheet.prototype.getCell=function(t,i){var n=dom.find("tbody",this.table);let s=null;for(let e=0;e<n.children.length;e++){var o=n.children[e];if(e==t){for(let e=1;e<o.children.length;e++)if(e-1==i){s=o.children[e];break}break}}return s},DataSheet.prototype.render=function(e,t){this.container=dom.find(e),this.container.innerHTML="";e=dom.element(`
    <table class="table table-bordered">
      <thead></thead>
      <tbody></tbody>
    </table>
  `);let i=dom.find("thead",e),n=dom.find("tbody",e);this.rowHeaderRowCount,this.colHeaderRowCount;let s=[];for(let e=0;e<this.colHeaderRowCount;e++){var o=dom.create("tr");s.push(o),i.appendChild(o)}for(let i=0;i<this.colHeaderRowCount;i++){let t=s[i];for(let e=0;e<this.colHeaderColumnCount;e++){var a=this.matrixColumn[i][e];if(null!=a){let e=dom.create("th","text-center");e.style="border-bottom-width: 1px;",e.setAttribute("colspan",this.getSpanColumnCount(a)),e.innerHTML=a.title,t.appendChild(e)}}}for(let i=0;i<this.rowHeaderRowCount;i++){let t=dom.create("tr");for(let e=0;e<this.rowHeaderColumnCount;e++){var l=this.matrixRowHeader[e][i];if(null!=l){let i=dom.create("td");i.style="vertical-align: middle;",i.setAttribute("rowspan",this.getSpanRowCount(l)),i.innerHTML="<strong>"+l.title+"</strong>",this.onRowHeaderClicked&&(i.onclick=e=>{let t=Array.prototype.slice.call(i.parentElement.children);this.onRowHeaderClicked(i,t.indexOf(i))}),t.appendChild(i)}}for(let e=0;e<this.colHeaderColumnCount-this.rowHeaderColumnCount;e++){let i=dom.create("td");i.style.textAlign="right",i.style.padding="6px 12px",this.onCellClicked&&(i.onclick=e=>{let t=Array.prototype.slice.call(i.parentElement.children);this.onCellClicked(i,t.indexOf(i))}),t.appendChild(i)}n.appendChild(t)}this.container.appendChild(e)},DataSheet.prototype.getValues=function(){let i={};for(let t=0;t<this.rowHeaders.length;t++){var n=this.rowHeaders[t];i[n.title]={};for(let e=0;e<this.columns.length;e++){var s=this.columns[e];i[n.title][s.title]=this.tbody.rows[t].cells[e+1].innerText.trim()}}return i},DataSheet.prototype.totalize=function(){if(0!=this.totalColumns.length){let e=this.tbody.children[this.tbody.children.length-1];for(let n=0;n<this.columns.length;n++)if(!0===this.columns[n].totalable){let t=0,i=!1;for(let e=0;e<this.rowHeaders.length;e++){var s=parseFloat(this.tbody.rows[e].cells[n+1].innerText.trim());isNaN(s)||(t+=s,i=!0)}isNaN(t)||!0!==i||(e.cells[n+1].innerText=t.toFixed(2))}}},DataSheet.prototype.buildColumnMatrix=function(i,n,s){if(i){let t;n[s]?t=n[s]:(t=[],n.push(t));for(let e=0;e<i.length;e++){var o=i[e];t.push(o);var a=this.getSpanColumnCount(o);for(let e=1;e<a;e++)t.push(null);this.buildColumnMatrix(o.children,n,s+1)}}},DataSheet.prototype.buildRowHeaderMatrix=function(i,n,s){if(i){let t;n[s]?t=n[s]:(t=[],n.push(t));for(let e=0;e<i.length;e++){var o=i[e];t.push(o);var a=this.getSpanRowCount(o);for(let e=1;e<a;e++)t.push(null);this.buildRowHeaderMatrix(o.children,n,s+1)}}},DataSheet.prototype.getSpanColumnCount=function(t){let i=0;if(!t.children||0==t.children.length)return 1;for(let e=0;e<t.children.length;e++)i+=this.getSpanColumnCount(t.children[e]);return i},DataSheet.prototype.getSpanRowCount=function(e){return e.children&&0!=e.children.length?e.children.length:1},DataSheet.prototype.getRowCount=function(t){let i=0;for(let e=0;e<t.length;e++){var n=t[e];i+=1,n.children&&(i+=this.getRowCount(n.children))}return i},DataSheet.prototype.getColumnCount=function(t){let i=0;for(let e=0;e<t.length;e++){var n=t[e];i+=1,n.children&&(i+=this.getColumnCount(n.children))}return i},DataSheet.prototype.getColumnHeaderRowCount=function(i){let n=1;for(let t=0;t<i.length;t++){let e=1;var s=i[t];s.children&&(e+=this.getColumnHeaderRowCount(s.children)),e>n&&(n=e)}return n},DataSheet.prototype.getRowHeaderRowCount=function(t){let i=0;for(let e=0;e<t.length;e++){var n=t[e];n.children?i+=this.getRowHeaderRowCount(n.children):i+=1}return i},DataSheet.prototype.getColumnHeaderColumnCount=function(t){let i=0;for(let e=0;e<t.length;e++){var n=t[e];n.children?i+=this.getColumnHeaderColumnCount(n.children):i+=1}return i},DataSheet.prototype.getRowHeaderColumnCount=function(i){let n=1;for(let t=0;t<i.length;t++){let e=1;var s=i[t];s.children&&(e+=this.getRowHeaderColumnCount(s.children)),e>n&&(n=e)}return n},Chat.MESSAGE_TYPE_TEXT="TEXT",Chat.MESSAGE_TYPE_IMAGE="IMAGE",Chat.MESSAGE_TYPE_AUDIO="AUDIO",Chat.MESSAGE_TYPE_VIDEO="VIDEO",Chat.MESSAGE_TYPE_PATIENT="PATIENT",Chat.MESSAGE_TYPE_CUSTOM="CUSTOM",Chat.MESSAGE_STATUS_UNREAD="01",Chat.MESSAGE_STATUS_READ="02",Chat.MESSAGE_STATUS_REVOKE="90",Chat.prototype.init=async function(e){await this.onInit();this.scheduleName=e;var t=this.userId+"@"+this.userType,i=await xhr.promise({url:this.host+"/api/v3/common/script/tim/user_signature",params:{userId:t}}),e={SDKAppID:i.appId};this.tim=TIM.create(e),this.tim.setLogLevel(1),this.tim.registerPlugin({"tim-upload-plugin":TIMUploadPlugin}),this.tim.login({userID:t,userSig:i.signature}),this.tim.on(TIM.EVENT.SDK_READY,function(e){}),this.tim.on(TIM.EVENT.MESSAGE_RECEIVED,s=>{for(let n=0;n<s.data.length;n++){let e=s.data[n],t=Chat.MESSAGE_TYPE_TEXT,i=null;"TIMCustomElem"===e.type?(i=JSON.parse(e.payload.data).messageContent,i.imagepath?t=Chat.MESSAGE_TYPE_IMAGE:i.audiopath?t=Chat.MESSAGE_TYPE_AUDIO:i.archiveId&&(t=Chat.MESSAGE_TYPE_PATIENT)):i=e.payload.text,this.onMessageReceived({senderId:e.conversationID.substring(3),messageTime:moment(1e3*s.data[n].time).format("YYYY-MM-DD HH:mm"),messageType:t,messageContent:i})}})},Chat.prototype.getConversations=async function(){var e,t=await xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId}});let i={};for(let e=0;e<t.length;e++){var n=t[e],s=n.senderId+"#"+n.senderType;if(i[s]){let e=i[s];e.createTime=n.createTime,e.messages.push(n)}else{let e={messages:[]};i[s]=e,e.id=s,e.createTime=n.createTime,e.name=n.senderType,e.senderId=n.senderId,e.senderType=n.senderType,e.messages.push(n)}}let o=[];for(e in i)o.push(i[e]);return o},Chat.prototype.fetchMessages=async function(e,t,i){let n="";n=e>this.userId?e+"&"+this.userId:this.userId+"&"+e;var s=await xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{conversationId:n,_order_by:"messageTime asc"}});let o=[],a=null;for(let n=0;n<s.length;n++){var l=s[n],r=moment(l.createTime).format("YYYY-MM-DD HH:mm");r!=a&&(a=r,o.push({createTime:r,groupingMessages:[{direction:l.senderId==this.userId?"outgoing":"incoming",messages:[]}]}));let e=o[o.length-1],t=e.groupingMessages[e.groupingMessages.length-1],i="";i=l.senderId==this.userId?"outgoing":"incoming",t.direction===i?t.messages.push(l):e.groupingMessages.push({direction:i,messages:[l]})}return o},Chat.prototype.fetchUnreadMessages=function(){let t=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId,receiverType:this.userType}}).then(e=>{t.onUnreadMessages(e)})},Chat.prototype.sendMessage=async function(e,t,i,n,s){return s=s||this.userId+"&"+e,"string"==typeof n&&(n=n.replace("\\","\\\\")),xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/save",params:{conversationId:s,senderId:this.userId,senderType:this.userType,receiverId:e,receiverType:t,messageType:i,messageTime:"now",messageContent:n,createTime:"now",status:Chat.MESSAGE_STATUS_UNREAD,"||stdbiz/pim/conversation/merge":{conversationId:s,conversationName:s,unreadCount:1,lastConversationTime:"now"}}})},Chat.prototype.sendTextMessage=async function(e,t,i,n){var s=e+"@"+t,n=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_TEXT,i,n),i=this.tim.createTextMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{id:n.conversationMessageId,text:i}});return this.tim.sendMessage(i)},Chat.prototype.sendImageMessage=async function(e,t,i,n){var s=e+"@"+t,i=await xhr.promise({url:this.host+"/api/v3/common/image",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:i.ext}}),n=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_IMAGE,JSON.stringify({imagepath:i.filepath,thumbnail:i.thumbnail}),n),i=this.tim.createCustomMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_IMAGE,messageContent:{id:n.conversationMessageId,imagepath:i.filepath,thumbnail:i.thumbnail}})}});return this.tim.sendMessage(i)},Chat.prototype.sendAudioMessage=async function(e,t,i,n){var s=e+"@"+t,i=await xhr.promise({url:this.host+"/api/v3/common/audio",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:"ogg"}}),n=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_AUDIO,JSON.stringify({audiopath:i.filepath,duration:i.duration}),n),i=this.tim.createCustomMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_AUDIO,messageContent:{id:n.conversationMessageId,audiopath:i.filepath,duration:i.duration}})}});return this.tim.sendMessage(i)},Chat.prototype.sendPatientMessage=async function(e,t,i,n){var s=e+"@"+t,n=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_PATIENT,JSON.stringify(i),n);i.id=n.conversationMessageId;i=this.tim.createCustomMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_PATIENT,messageContent:i})}});return this.tim.sendMessage(i)},Chat.prototype.readMessages=function(e){let t=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{senderId:e,readTime:"now",status:Chat.MESSAGE_STATUS_READ}}).then(e=>{t.onReadMessages(e)})},Chat.prototype.revokeMessage=function(t){return xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{messageId:t,status:Chat.MESSAGE_STATUS_REVOKE}}).then(e=>{this.onRevokeMessage(t)})},Chat.prototype.stop=function(){schedule.stop(this.scheduleName)},"undefined"!=typeof module&&(module.exports={Chat:Chat}),MobileWizard.prototype.render=function(e,t){this.container=dom.find(e),this.content=dom.find("div.wizard-content",this.root);let n=dom.find("div.wizard-progress",this.root);for(let i=0;i<this.steps.length;i++){let e=this.steps[i];var s=i+1;let t=dom.element(`
      <div class="step-${s}" widget-on-render="" data-step="${i}" style="cursor: pointer;">
        <strong class="title"></strong>
      </div>
    `);e.index=i,t.style.width=100/this.steps.length+"%",!0===e.active&&(this.current=e),dom.find("strong.title",t).innerHTML=e.title,n.appendChild(t)}this.container.appendChild(this.root),this.display(this.current)},MobileWizard.prototype.display=function(e){let t=dom.find('div[data-step="'+e.index+'"]',this.root);t.classList.remove("completed"),t.classList.add("active"),kuim.navigateWidget(e.url,this.content,{wizard:this})},MobileWizard.prototype.commit=function(e){let t=dom.find("div.active",this.root);var i=parseInt(t.getAttribute("data-step"));t.classList.remove("active"),t.classList.add("completed"),this.display(this.steps[i+1])},MobileWizard.prototype.rollback=function(){let e=dom.find("div.step.active",this.container);var t=parseInt(e.getAttribute("data-step"));e.classList.remove("active"),this.display(this.steps[t-1])},MobileForm.prototype.render=async function(e){var t=await this.root();e.appendChild(t)},MobileForm.prototype.root=async function(){let i=dom.element(`
    <div class="form form-horizontal"></div>
  `);for(let t=0;t<this.fields.length;t++){var n=this.fields[t];let e=null;e="date"===n.input?this.buildDate(n):"select"===n.input?await this.buildSelect(n):"hidden"===n.input?dom.templatize(`
        <input type="hidden" name="{{name}}">
      `,n):"mobile"===n.input?this.buildMobile(n):"id"===n.input?this.buildId(n):"district"===n.input?this.buildDistrict(n):dom.templatize(`
        <div class="form-group row">
          <label class="col-form-label col-24-06">{{title}}</label>
          <div class="col-24-18">
            <input type="text" name="{{name}}" class="form-control" placeholder="请填写">
          </div>
        </div>
      `,n),i.appendChild(e)}return i},MobileForm.prototype.buildDate=function(e){e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" class="form-control" readonly placeholder="请选择...">
        <input type="hidden" name="{{name}}">
        <span class="ml-auto material-icons font-16 position-relative" style="top: 5px; left: -2px;">calendar_today</span>
      </div>
    </div>
  `,e);return dom.bind(e,"click",i=>{let e=new Rolldate({confirm:e=>{var t=dom.ancestor(i.target,"div","col-24-18");dom.find("input[type=text]",t).value=moment(e).format("YYYY年MM月DD日"),dom.find("input[type=hidden]",t).value=moment(e).format("YYYY-MM-DD HH:mm:ss")}});e.show()}),e},MobileForm.prototype.buildSelect=async function(t){var e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" class="form-control" readonly placeholder="请选择...">
        <input type="hidden" name="{{name}}">
        <span class="ml-auto material-icons font-20 position-relative" style="top: 3px;">expand_more</span>
      </div>
    </div>
  `,t);let n=t.values;if(!n&&t.url){var i=await xhr.promise({url:t.url,params:{}});n=[];for(let e=0;e<i.length;e++)n.push({text:i[e][t.textField],value:i[e][t.valueField]})}return dom.bind(e,"click",i=>{let e=new Rolldate({format:"oo",values:n,confirm:e=>{var t=dom.ancestor(i.target,"div","col-24-18");console.log(t),dom.find("input[type=text]",t).value=e.text,dom.find("input[type=hidden]",t).value=e.value}});e.show()}),e},MobileForm.prototype.buildMobile=function(e){e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请输入...">
      </div>
    </div>
  `,e);let t=dom.find("input",e);return dom.bind(e,"click",e=>{new Numpad({type:"mobile",success:e=>{t.value=e}}).show(document.body)}),e},MobileForm.prototype.buildId=function(e){e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请输入...">
      </div>
    </div>
  `,e);let t=dom.find("input",e);return dom.bind(e,"click",e=>{new Numpad({type:"id",success:e=>{t.value=e}}).show(document.body)}),e},MobileForm.prototype.buildDistrict=function(e){e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请选择...">
      </div>
    </div>
  `,e);let i=dom.find("input",e);return dom.bind(e,"click",e=>{new DistrictPicker({type:"id",success:e=>{let t="";e.province&&(t+=e.province.chineseDistrictName),e.city&&(t+=" "+e.city.chineseDistrictName),e.county&&(t+=" "+e.county.chineseDistrictName),e.town&&(t+=" "+e.town.chineseDistrictName),i.value=t,i.setAttribute("data-value",JSON.stringify(e))}}).show(document.body)}),e},Numpad.prototype.root=function(){let e=dom.templatize(`
    <div class="popup-container">
      <div class="popup-mask"></div>
      <div class="popup-bottom numpad">
        <div class="popup-title">
          <button class="cancel">取消</button>
          <span class="value"></span>
          <span class="unit">{{unit}}</span>
          <button class="confirm">确认</button>
        </div>
        <div class="d-flex flex-wrap full-width">
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">1</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">2</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">3</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">4</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">5</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">6</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">7</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">8</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">9</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button widget-id="buttonSpecial" class="number">.</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">0</button>
          </div>
          <div class="col-24-08" style="line-height: 48px; font-size: 24px;">
            <button class="number">
              <i class="fas fa-backspace" style="font-size: 20px;"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  `,this);this.bottom=dom.find(".popup-bottom",e);var t=dom.find(".popup-mask",e),i=dom.find(".confirm",e),n=dom.find(".cancel",e);let s=dom.find(".value",e),o=dom.find("[widget-id=buttonSpecial]",e);"id"==this.type?(o.innerText="X",this.regex=/^.{0,18}$/):"mobile"==this.type&&(o.remove(),this.regex=/^.{0,11}$/);var a=e.querySelectorAll(".number");for(let e=0;e<a.length;e++){var l=a[e];dom.bind(l,"click",e=>{let t=s.innerText;e=e.currentTarget.innerText;if(""==e){if(""===t)return;t=t.substr(0,t.length-1)}else this.regex.test(t+e)&&(t+=e);s.innerText=t})}return dom.bind(t,"click",e=>{this.close()}),dom.bind(n,"click",e=>{this.close()}),dom.bind(i,"click",e=>{this.success(s.innerText),this.close()}),setTimeout(()=>{this.bottom.classList.add("in")},50),e},Numpad.prototype.show=function(e){e.appendChild(this.root())},Numpad.prototype.close=function(){this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(()=>{this.bottom.parentElement.remove()},300)},DistrictPicker.prototype.root=function(){var e=dom.templatize(`
    <div class="popup-container">
      <div class="popup-mask"></div>
      <div class="popup-bottom district-picker">
        <div class="popup-title">
          <button class="cancel">取消</button>
          <span class="value"></span>
          <span class="unit">{{unit}}</span>
          <button class="confirm">确认</button>
        </div>
        <div class="bottom-dialog-body">
          <div style="padding: 4px 16px">
            <div class="d-flex" style="line-height: 40px;">
              <strong widget-id="widgetProvince" class="font-16">选择省份</strong>
              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>
            </div>
            <div class="d-flex" style="line-height: 40px;">
              <strong widget-id="widgetCity" class="font-16">选择城市</strong>
              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>
            </div>
            <div class="d-flex" style="line-height: 40px;">
              <strong widget-id="widgetCounty" class="font-16">选择区县</strong>
              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>
            </div>
            <div class="d-flex" style="line-height: 40px;">
              <strong widget-id="widgetTown" class="font-16">选择街道/乡镇</strong>
              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>
            </div>
          </div>
          <div style="border-top: 1px solid var(--color-divider);"></div>
          <ul widget-id="widgetDistrict" class="list-group" style="height: 240px; overflow-y: auto;">
          </ul>
        </div>
      </div>
    </div>
  `,this);this.bottom=dom.find(".popup-bottom",e),this.district=dom.find("[widget-id=widgetDistrict]",e),this.province=dom.find("[widget-id=widgetProvince]",e),this.city=dom.find("[widget-id=widgetCity]",e),this.county=dom.find("[widget-id=widgetCounty]",e),this.town=dom.find("[widget-id=widgetTown]",e);var t=dom.find(".popup-mask",e),i=dom.find(".confirm",e),n=dom.find(".cancel",e);dom.find(".value",e);dom.bind(t,"click",e=>{this.close()}),dom.bind(n,"click",e=>{this.close()}),this.selections.province&&(this.province.setAttribute("data-model-chinese-district-code",this.selections.province.chineseDistrictCode),this.province.innerText=this.selections.province.chineseDistrictName),this.selections.city&&(this.city.setAttribute("data-model-chinese-district-code",this.selections.city.chineseDistrictCode),this.city.innerText=this.selections.city.chineseDistrictName),this.selections.county&&(this.county.setAttribute("data-model-chinese-district-code",this.selections.county.chineseDistrictCode),this.county.innerText=this.selections.county.chineseDistrictName),this.selections.town&&(this.town.setAttribute("data-model-chinese-district-code",this.selections.town.chineseDistrictCode),this.town.innerText=this.selections.town.chineseDistrictName),dom.bind(i,"click",e=>{let t={};var i=this.province.getAttribute("data-model-chinese-district-code"),n=this.city.getAttribute("data-model-chinese-district-code"),s=this.county.getAttribute("data-model-chinese-district-code"),o=this.town.getAttribute("data-model-chinese-district-code");""!=i&&(t.province={chineseDistrictCode:i,chineseDistrictName:this.province.innerText}),""!=n&&(t.city={chineseDistrictCode:n,chineseDistrictName:this.city.innerText}),""!=s&&(t.county={chineseDistrictCode:s,chineseDistrictName:this.county.innerText}),""!=o&&(t.town={chineseDistrictCode:o,chineseDistrictName:this.town.innerText}),this.success(t),this.close()});let s=e=>{e=dom.ancestor(e.target,"div");let t=dom.find("strong",e),i=t.getAttribute("data-model-chinese-district-code");9==i.length?this.renderDistrict(i.substr(0,6)):this.renderDistrict(i.substr(0,i.length-2))};return dom.bind(this.province.parentElement,"click",e=>{s(e)}),dom.bind(this.city.parentElement,"click",e=>{s(e)}),dom.bind(this.county.parentElement,"click",e=>{s(e)}),dom.bind(this.town.parentElement,"click",e=>{s(e)}),setTimeout(()=>{this.bottom.classList.add("in")},50),e},DistrictPicker.prototype.renderDistrict=async function(e){let t=null,i=null;if(e)if(2==e.length)t=`
      and length(chndistcd) = 4 and substring(chndistcd, 1, 2) = '${e}'
    `,i=this.city,this.county.setAttribute("data-model-chinese-district-code",""),this.county.innerText="选择区县",this.town.setAttribute("data-model-chinese-district-code",""),this.town.innerText="选择街道/乡镇";else if(4==e.length)t=`
      and length(chndistcd) = 6 and substring(chndistcd, 1, 4) = '${e}'
    `,i=this.county,this.town.setAttribute("data-model-chinese-district-code",""),this.town.innerText="选择街道/乡镇";else{if(6!=e.length)return;t=`
      and length(chndistcd) = 9 and substring(chndistcd, 1, 6) = '${e}'
    `,i=this.town}else t=`
      and length(chndistcd) = 2
    `,i=this.province,this.city.setAttribute("data-model-chinese-district-code",""),this.city.innerText="选择城市",this.county.setAttribute("data-model-chinese-district-code",""),this.county.innerText="选择区县",this.town.setAttribute("data-model-chinese-district-code",""),this.town.innerText="选择街道/乡镇";var n=await xhr.promise({url:"/api/v3/common/script/stdbiz/gb/chinese_district/find",params:{_and_condition:t,_order_by:"convert(chndistnm using gbk) asc"}});this.district.innerHTML="";for(let e=0;e<n.length;e++){var s=n[e],o=dom.templatize(`
      <li class="list-group-item">{{chineseDistrictName}}</li>
    `,s);dom.model(o,s),dom.bind(o,"click",e=>{e=dom.ancestor(e.target,"li"),e=dom.model(e);i.innerText=e.chineseDistrictName,i.setAttribute("data-model-chinese-district-code",e.chineseDistrictCode),this.renderDistrict(e.chineseDistrictCode)}),this.district.appendChild(o)}},DistrictPicker.prototype.show=function(e){e.appendChild(this.root()),this.renderDistrict()},DistrictPicker.prototype.close=function(){this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(()=>{this.bottom.parentElement.remove()},300)},Calendar.prototype.root=function(){let o=dom.templatize(`
    <div class="calendar">
      <div class="title"></div>
      <div class="weekdays">
        <div class="weekday">日</div>
        <div class="weekday">一</div>
        <div class="weekday">二</div>
        <div class="weekday">三</div>
        <div class="weekday">四</div>
        <div class="weekday">五</div>
        <div class="weekday">六</div>
      </div>
      <div class="swiper">
        <div class="swiper-wrapper">
          <div class="dates prev swiper-slide"></div>
          <div class="dates curr swiper-slide"></div>
          <div class="dates next swiper-slide"></div>
        </div>
      </div>
    </div>
  `,{});this.widgetSwiper=dom.find(".swiper",o),this.title=dom.find(".title",o);var e=dom.find(".dates.prev",o),t=dom.find(".dates.curr",o),i=dom.find(".dates.next",o);this.renderMonth(e,moment(this.currentMonth).subtract(1,"months").startOf("month")),this.renderMonth(t,this.currentMonth),this.renderMonth(i,moment(this.currentMonth).add(1,"months").startOf("month"));let n=new Swiper(this.widgetSwiper,{speed:400,initialSlide:this.currentIndex,loop:!0});return n.on("slideChange",e=>{0==e.realIndex?1==this.currentIndex?this.currentMonth=moment(this.currentMonth).subtract(1,"months"):2==this.currentIndex&&(this.currentMonth=moment(this.currentMonth).add(1,"months")):1==e.realIndex?0==this.currentIndex?this.currentMonth=moment(this.currentMonth).add(1,"months"):2==this.currentIndex&&(this.currentMonth=moment(this.currentMonth).subtract(1,"months")):2==e.realIndex&&(0==this.currentIndex?this.currentMonth=moment(this.currentMonth).subtract(1,"months"):1==this.currentIndex&&(this.currentMonth=moment(this.currentMonth).add(1,"months"))),this.currentIndex=e.realIndex;var t=moment(this.currentMonth).subtract(1,"months"),i=moment(this.currentMonth).add(1,"months");let n=null,s=null;0==this.currentIndex?(n=o.querySelectorAll(".dates.next"),s=o.querySelectorAll(".dates.curr")):1==this.currentIndex?(n=o.querySelectorAll(".dates.prev"),s=o.querySelectorAll(".dates.next")):2==this.currentIndex&&(n=o.querySelectorAll(".dates.curr"),s=o.querySelectorAll(".dates.prev"));for(let e=0;e<n.length;e++)this.renderMonth(n[e],t);for(let e=0;e<s.length;e++)this.renderMonth(s[e],i)}),o},Calendar.prototype.renderMonth=function(i,n){var s=n.startOf("month").day(),e=n.daysInMonth();i.innerHTML="";for(let t=0;t<e+s;t++){let e=dom.element('<div class="date"></div>');var o=t-s+1;t>=s&&(e.innerHTML=o);o=n.format("YYYY-MM-")+(o<10?"0"+o:o);o==this.today.format("YYYY-MM-DD")&&e.classList.add("today"),e.setAttribute("data-calendar-date",o),i.appendChild(e)}var t=7-(e+s)%7;for(let e=0;e<t;e++){var a=dom.element('<div class="date"></div>');i.appendChild(a)}this.title.innerText=this.currentMonth.format("YYYY年MM月")},Calendar.prototype.stylizeDates=function(i,n,t){let s=dom.find(".dates.curr",this.root);if(Array.isArray(n)){for(let t=0;t<n.length;t++)for(let e=0;e<s.children.length;e++)if(moment(n[t]).format("YYYY-MM-DD")==s.children[e].getAttribute("data-calendar-date")){s.children[e].style=i;break}}else{n=moment(n).format("YYYY-MM-DD"),t=moment(t).format("YYYY-MM-DD");for(let e=0;e<s.children.length;e++){var o=s.children[e].getAttribute("data-calendar-date");n<=o&&o<=t&&(s.children[e].style=i)}}},Calendar.prototype.render=function(e,t){this.root=this.root();let i=dom.find(e);i.appendChild(this.root)},CascadePicker.prototype.root=function(){var e=dom.templatize(`
    <div class="popup-container">
      <div class="popup-mask"></div>
      <div class="popup-bottom district-picker">
        <div class="popup-title">
          <button class="cancel">取消</button>
          <span class="value"></span>
          <span class="unit">{{unit}}</span>
          <button class="confirm">确认</button>
        </div>
        <div>
          <div widget-id="widgetLevel" style="padding: 4px 16px">
          </div>
          <div style="border-top: 1px solid var(--color-divider);"></div>
          <ul widget-id="widgetValue" class="list-group" style="height: 240px; overflow-y: auto;">
          </ul>
        </div>
      </div>
    </div>
  `,this);this.bottom=dom.find(".popup-bottom",e),this.widgetLevel=dom.find("[widget-id=widgetLevel]",e),this.widgetValue=dom.find("[widget-id=widgetValue]",e);var t=dom.find(".popup-mask",e),i=dom.find(".confirm",e),n=dom.find(".cancel",e);let s=e=>{var t=dom.ancestor(e.target,"div");let i=dom.find("strong",t);var n=parseInt(i.getAttribute("data-cascade-level"));i.getAttribute("data-cascade-value"),i.getAttribute("data-cascade-name");let s=null,o=dom.find('[data-cascade-level="'+(n-1)+'"]',this.widgetLevel);null!=o&&(e=o.getAttribute("data-cascade-value"),t=o.getAttribute("data-cascade-name"),s={},s[t]=e),this.renderValue(n,s);for(let t=n+1;t<this.levels.length;t++){let e=dom.find('[data-cascade-level="'+t+'"]',this.widgetLevel);e.setAttribute("data-cascade-value",""),e.innerText=this.levels[t].placeholder}};for(let e=0;e<this.levels.length;e++){var o=dom.templatize(`
      <div class="d-flex" style="line-height: 40px;">
        <strong data-cascade-level="${e}" data-cascade-name="{{name}}" class="font-16">{{placeholder}}</strong>
        <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>
      </div>
    `,this.levels[e]);this.widgetLevel.appendChild(o),dom.bind(o,"click",e=>{s(e)})}return dom.bind(t,"click",e=>{this.close()}),dom.bind(n,"click",e=>{this.close()}),dom.bind(i,"click",e=>{var i=dom.find("strong",this.widgetLevel);let n={};for(let t=0;t<i.length;t++){let e=i[t];var s=dom.model(e);n[e.getAttribute("data-cascade-name")]=s}this.success(n),this.close()}),setTimeout(()=>{this.bottom.classList.add("in")},50),e},CascadePicker.prototype.renderValue=async function(n,e,t){let s=dom.find('[data-cascade-level="'+n+'"]',this.widgetLevel);if(null!=s){let i=this.levels[n];if(this.widgetValue.innerHTML="",i.url){e="function"==typeof i.params?i.params(e):i.params;var o=await xhr.promise({url:i.url,params:e});for(let e=0;e<o.length;e++){var a={value:o[e][i.fields.value],text:o[e][i.fields.text]},a=dom.templatize(`
      <li class="list-group-item" data-cascade-value="{{value}}">{{text}}</li>
    `,a);dom.model(a,o[e]),dom.bind(a,"click",e=>{e=dom.ancestor(e.target,"li"),e=dom.model(e);s.innerText=e[i.fields.text],s.setAttribute("data-cascade-value",e[i.fields.value]),dom.model(s,e);let t={};t[i.fields.value]=e[i.fields.value],this.renderValue(n+1,t,e)}),this.widgetValue.appendChild(a)}}}},CascadePicker.prototype.show=function(e){e.appendChild(this.root()),this.renderValue(0)},CascadePicker.prototype.close=function(){this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(()=>{this.bottom.parentElement.remove()},300)},ActionSheet.prototype.root=function(){var e=dom.templatize(`
    <div class="popup-container">
      <div class="popup-mask"></div>
      <div class="popup-bottom" style="background: transparent;">
        <div class="action-sheet">
          <div class="title">{{title}}</div>
          <div class="actions"></div>
          <div class="cancel">取消</div>
        </div>
      </div>
    </div>
  `,this);this.bottom=dom.find(".popup-bottom",e);var t=dom.find(".cancel",e),i=dom.find(".popup-mask",e);let n=dom.find(".actions",e);dom.bind(i,"click",e=>{this.close()}),dom.bind(t,"click",e=>{this.close()});for(let t=0;t<this.actions.length;t++){let e=dom.templatize(`
      <div class="action">{{text}}</div>
    `,this.actions[t]);dom.bind(e,"click",e=>{this.close(),this.actions[t].onClick(e)}),t==this.actions.length-1&&e.classList.add("last"),n.appendChild(e)}return setTimeout(()=>{this.bottom.classList.add("in")},50),e},ActionSheet.prototype.show=function(e){e.appendChild(this.root())},ActionSheet.prototype.close=function(){this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(()=>{this.bottom.parentElement.remove()},300)},Weekdays.prototype.root=function(){let o=dom.templatize(`
    <div class="swiper weekly">
      <div class="swiper-wrapper">
      </div>
    </div>
  `,{}),a=dom.find(".swiper-wrapper",o);for(let s=0;s<this.days;s++){let e=moment(this.today).add(s,"days"),t=e.day();t=1==t?"一":2==t?"二":3==t?"三":4==t?"四":5==t?"五":6==t?"六":"日";let i=dom.element('<div class="swiper-slide d-flex" style="width: calc(100% / 7)"></div>'),n=dom.templatize(`
      <div class="weekday pb-2" data-date="{{fulldate}}">
        <span class="day">{{day}}</span>
        <span class="date">{{date}}</span>
      </div>
    `,{day:t,date:e.format("DD"),fulldate:e.format("YYYY-MM-DD")});0==s&&n.classList.add("active"),i.appendChild(n),a.appendChild(i),dom.bind(n,"click",e=>{let t=o.querySelectorAll(".weekday");t.forEach(e=>{e.classList.remove("active")}),n.classList.add("active")})}new Swiper(o,{speed:400,slidesPerView:7,loop:!1});return o},Weekdays.prototype.render=function(e){let t=dom.find(e);t.appendChild(this.root())},Handlebars.registerHelper("ifeq",function(e,t,i){return e==t?i.fn(this):i.inverse(this)}),"undefined"==typeof kuim&&(kuim={}),kuim={routedPages:[],presentPageObj:null,navigateTo:async function(i,n,s){clearTimeout(kuim.delayToLoad),kuim.delayToLoad=setTimeout(()=>{void 0===s&&(s=!1);let t=document.querySelector("main");kuim.presentPageObj&&(kuim.presentPageObj.page.classList.remove("in"),kuim.presentPageObj.page.classList.add("out")),setTimeout(async()=>{kuim.presentPageObj&&(kuim.presentPageObj.page.parentElement.style.display="none"),kuim.presentPageObj&&!1!==s&&(kuim.presentPageObj.page.parentElement.remove(),kuim.presentPageObj.destroy&&kuim.presentPageObj.destroy(),delete kuim.presentPageObj);var e=await xhr.asyncGet({url:i},"GET");kuim.reload(t,i,e,n)},400)},200)},navigateWidget:function(t,i,n){clearTimeout(kuim.delayToLoad),kuim.delayToLoad=setTimeout(()=>{i.children[0]&&(i.children[0].classList.remove("in"),i.children[0].classList.add("out")),setTimeout(async()=>{i.innerHTML="";var e=await xhr.asyncGet({url:t},"GET");kuim.replace(i,t,e,n)},400)},200)},navigateBack:function(e){clearTimeout(kuim.delayToLoad),kuim.delayToLoad=setTimeout(()=>{var e=document.querySelector("main");let t=e.children[e.children.length-2];kuim.presentPageObj.page.classList.remove("in"),kuim.presentPageObj.page.classList.add("out"),setTimeout(()=>{kuim.presentPageObj.page.parentElement.remove(),kuim.presentPageObj.destroy&&kuim.presentPageObj.destroy(),delete kuim.presentPageObj,t.style.display="",kuim.presentPageObj=window[t.getAttribute("kuim-page-id")],kuim.presentPageObj.page.classList.remove("out"),kuim.presentPageObj.page.classList.add("in"),kuim.setTitleAndIcon(t.getAttribute("kuim-page-title"),t.getAttribute("kuim-page-icon"))},400)},200)},reload:function(e,t,i,n){n=n||{};let s=dom.element('<div style="height: 100%; width: 100%;"></div>'),o=document.createRange();i=o.createContextualFragment(i);s.appendChild(i);let a=dom.find("[id^=page]",s);i=a.getAttribute("id");e.appendChild(s),s.setAttribute("kuim-page-id",i),s.setAttribute("kuim-page-url",t),n.title&&(s.setAttribute("kuim-page-title",n.title),s.setAttribute("kuim-page-icon",n.icon||"")),kuim.presentPageObj=window[i],kuim.presentPageObj.page.classList.add("in");t=utils.getParameters(t);kuim.presentPageObj.show(t),kuim.setTitleAndIcon(n.title,n.icon),n.success&&n.success()},replace:function(e,t,i,n){n=n||{};let s=dom.element('<div style="height: 100%; width: 100%;"></div>'),o=document.createRange();i=o.createContextualFragment(i);e.appendChild(i);let a=dom.find("[id^=page]",e);var l=a.getAttribute("id");n.title&&(s.setAttribute("kuim-page-title",n.title),s.setAttribute("kuim-page-icon",n.icon||"")),a.classList.add("in");var r,t=utils.getParameters(t);for(r in window[l].show(t),n)window[l][r]=n[r];n.success&&n.success()},setTitleAndIcon:function(e,t){let i=dom.find(".bottom-navigator"),n=dom.find("header h1.title");n.innerText=e;let s=dom.find("header div.left");t?(s.innerHTML=t,i.style.display="",s.onclick=e=>{}):(s.innerHTML='<i class="fas fa-arrow-left text-white button icon"></i>',i.style.display="none",s.onclick=e=>{kuim.navigateBack()})},select:async function(i){var t=await xhr.promise({url:i.url,params:i.params||{}});let n=[];for(let e=0;e<t.length;e++){var s=t[e];n.push({id:s[i.fieldId||"id"],value:s[i.fieldName||"value"]})}new MobileSelect({trigger:i.trigger,title:i.title,wheels:[{data:n}],callback:(e,t)=>{i.onSelected&&i.onSelected(t[0])}})},tabs:function(e){let t=dom.find(e.container),s=dom.element(`
    <div class="nav nav-tabs mt-0"></div>
  `),o=dom.element(`
    <div class="swiper">
      <div class="swiper-wrapper">
      </div>
    </div>
  `);var a=e.tabs;for(let n=0;n<a.length;n++){let e=a[n],t=dom.templatize(`
      <div class="nav-item font-weight-bold mr-0" 
           style="padding: 0 16px; line-height: 36px; text-align: center; flex: 1;">{{title}}</div>
    `,e);s.appendChild(t),0==n&&t.classList.add("active-bg-info"),dom.bind(t,"click",e=>{l.slideTo(n,400,!0)});let i=dom.templatize(`
      <div class="swiper-slide full-width"></div>
    `,e);e.render?e.render(i,e.params||{}):i.innerHTML='<img src="https://via.placeholder.com/240x150">',o.children[0].appendChild(i)}t.appendChild(s),t.appendChild(o);let l=new Swiper(o,{direction:"horizontal",loop:!1});l.on("slideChange",function(e){e=e.activeIndex;for(let e=0;e<s.children.length;e++)s.children[e].classList.remove("active-bg-info");s.children[e].classList.add("active-bg-info")})},wizard:function(e){let t=dom.find(e.container),s=dom.element(`
    <div class="wizard"></div>
  `),o=dom.element(`
    <div class="swiper">
      <div class="swiper-wrapper">
      </div>
    </div>
  `);var a=e.steps;for(let n=0;n<a.length;n++){let e=a[n];e.index=n+1;let t=dom.templatize(`
      <div class="wizard-step">
        <div class="wizard-dot">
          <div class="wizard-connector-left"></div>
          <div class="wizard-number">{{index}}</div>
          <div class="wizard-connector-right"></div>
        </div>
      </div>
    `,e);s.appendChild(t),dom.bind(t,"click",e=>{t.classList.contains("wizard-step-completed")&&l.slideTo(n,400,!0)});let i=dom.templatize(`
      <div class="swiper-slide full-width"></div>
    `,e);e.render?e.render(i,e.params||{}):i.innerHTML='<img src="https://via.placeholder.com/240x150">',o.children[0].appendChild(i)}t.appendChild(s),t.appendChild(o);let l=new Swiper(o,{direction:"horizontal",loop:!1});return l.on("slideChange",e=>{var t=e.activeIndex;for(let e=0;e<s.children.length;e++)s.children[e].classList.remove("wizard-step-completed");for(let e=0;e<t;e++)s.children[e].classList.add("wizard-step-completed")}),l.on("sliderMove",(e,t)=>{}),l},overlay:function(){},success:function(e,t){let i=dom.templatize(`
    <div class="toast">
      <i class="far fa-check-circle font-36"></i>
      <div class="font-18 mt-2">${e}</div>
    </div>
  `);document.body.appendChild(i),setTimeout(()=>{i.classList.add("show")},50),setTimeout(()=>{i.classList.remove("show"),setTimeout(()=>{i.remove(),t&&t()},500)},1e3)},error:function(e,t){let i=dom.templatize(`
    <div class="toast">
      <i class="far fa-times-circle font-36"></i>
      <div class="font-18 mt-2">${e}</div>
    </div>
  `);document.body.appendChild(i),setTimeout(()=>{i.classList.add("show")},50),setTimeout(()=>{i.classList.remove("show"),setTimeout(()=>{i.remove(),t&&t()},500)},1e3)}};
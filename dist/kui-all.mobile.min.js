xhr={request:function(e,t){var i=e.url,n=e.data||e.params||{};let o=e.type||"json",s=e.success,l=e.error;n={...utils.getParameters(e.url),...n},e=e.usecase||"";let a=new XMLHttpRequest;a.timeout=1e4,a.onload=function(){let t=a.responseText;if("json"==o)try{t=JSON.parse(t)}catch(e){return void(l&&l(t))}4==a.readyState&&"200"==a.status?s&&s(t):l&&l(t)},a.onerror=function(){l&&l({error:{code:-500,message:"网络访问错误！"}})},a.ontimeout=function(){l&&l({error:{code:-501,message:"网络请求超时！"}})},a.open(t,i,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("usecase",e),"undefined"!=typeof APPTOKEN&&a.setRequestHeader("apptoken",APPTOKEN),window.user?a.setRequestHeader("_current_user",window.user.userId):a.setRequestHeader("_current_user","unauthorized user"),a.send(JSON.stringify(n))},get:function(e){var t=e.url;e.data;let i=e.success,n=e.error,o=new XMLHttpRequest;o.open("GET",t,!0),o.onload=function(){var e=o.responseText;4==o.readyState&&"200"==o.status?i&&i(e):n&&n(e)},o.send(null)},post:function(e){let t=e.url;"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.request(e,"POST")},put:function(e){xhr.request(e,"PUT")},delete:function(e){xhr.request(e,"DELETE")},connect:function(e){xhr.request(e,"CONNECT")},upload:function(t){var e,i=t.url,n=t.data||t.params;let o=t.type||"json",s=t.success,l=t.error,a=new FormData;for(e in n)a.append(e,n[e]);a.append("file",t.file);let r=new XMLHttpRequest;r.timeout=1e4,r.onload=function(){let t=r.responseText;if("json"==o)try{t=JSON.parse(t)}catch(e){return void(l&&l(t))}4==r.readyState&&"200"==r.status?s&&s(t):l&&l(t)},t.progress&&(r.onprogress=function(e){t.progress(e.loaded,e.total)}),r.onerror=function(){l&&l({error:{code:-500,message:"网络访问错误！"}})},r.ontimeout=function(){l&&l({error:{code:-501,message:"网络请求超时！"}})},r.open("POST",i,!0),"undefined"!=typeof APPTOKEN&&r.setRequestHeader("apptoken",APPTOKEN),r.send(a)},asyncUpload:async function(d){return new Promise(function(e,t){var i=d.url,n=d.data||d.params;let o=d.type||"json";d.success;let s=d.error,l=new FormData;for(var a in n)l.append(a,n[a]);l.append("file",d.file);let r=new XMLHttpRequest;r.timeout=1e4,r.onload=function(){let t=r.responseText;if("json"==o)try{t=JSON.parse(t)}catch(e){return void(s&&s(t))}(4==r.readyState&&"200"==r.status||s)&&e(t)},d.progress&&(r.onprogress=function(e){d.progress(e.loaded,e.total)}),r.onerror=function(){s&&s({error:{code:-500,message:"网络访问错误！"}})},r.ontimeout=function(){s&&s({error:{code:-501,message:"网络请求超时！"}})},r.open("POST",i,!0),"undefined"!=typeof APPTOKEN&&r.setRequestHeader("apptoken",APPTOKEN),r.send(l)})},chain:function(i){if(0!=i.length){var e=i[0];let t=e.success;xhr.promise(e,function(e){t(e),xhr.chain(i.slice(1))})}},asyncGet:function(i,n){return new Promise(function(t,e){i.success=function(e){t(e)},i.error=n,xhr.get(i)})},promise:function(i,n){return new Promise(function(t,e){i.success=function(e){e.error?n?n(e.error):dialog.error(e.error.message):t(e.data)},i.error=n||(()=>{t({error:{code:"500",message:"网络异常"}})}),xhr.post(i)})},longpromise:function(i,n){let e=i.container||dom.find("#container");var t=i.tooltip||"操作处理中...";let o=dom.element(`
    <div class="page-loading hide">
      <div class="ring">${t}
        <span></span>
      </div>
    </div>
  `);return e.appendChild(o),o.classList.remove("hide"),new Promise(function(t,e){i.success=function(e){if(e.error)return setTimeout(()=>{o.classList.add("hide"),o.remove()},600),dialog.error(e.error.message),void(n&&n(e.error));setTimeout(()=>{o.classList.add("hide"),o.remove()},1200),t(e.data)},i.error=n,xhr.post(i)})},download:function(s){let l=new XMLHttpRequest;l.open("POST",s.url,!0),l.responseType="arraybuffer",l.onload=function(){if(200===this.status){let i="",n=l.getResponseHeader("Content-Disposition");if(n&&-1!==n.indexOf("attachment")){let e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,t=e.exec(n);null!=t&&t[1]&&(i=t[1].replace(/['"]/g,""))}var e,t,o=l.getResponseHeader("Content-Type"),o=new Blob([this.response],{type:o});void 0!==window.navigator.msSaveBlob?window.navigator.msSaveBlob(o,i):(e=window.URL||window.webkitURL,t=e.createObjectURL(o),void 0===(o=document.createElement("a")).download?window.location=t:(o.href=t,o.download=s.filename||"下载的文件",document.body.appendChild(o),o.click()),setTimeout(function(){e.revokeObjectURL(t)},100))}},l.setRequestHeader("Content-type","application/json"),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),l.send(JSON.stringify(s.params||{}))},asyncRequest:function(e,o){let s=e.url,l=e.data||e.params,a=e.type||"json",r=e.usecase||"";return new Promise((i,n)=>{if(s){let t=new XMLHttpRequest;t.timeout=1e4,t.onload=function(){let e=t.responseText;if("json"==a)try{e=JSON.parse(e)}catch(e){return console.log(e),void n(e)}(4==t.readyState&&"200"==t.status?i:n)(e)},t.onerror=function(){n({error:{code:-500,message:"网络访问错误！"}})},t.ontimeout=function(){n({error:{code:-501,message:"网络请求超时！"}})},t.open(o,s,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("usecase",r),"undefined"!=typeof APPTOKEN&&t.setRequestHeader("apptoken",APPTOKEN),l?t.send(JSON.stringify(l)):t.send(null)}})},asyncPost:function(e){let t=e.url;return"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.asyncRequest(e,"POST")}},"undefined"!=typeof module&&(module.exports={xhr:xhr});var ajax={save:function(e){for(var t=e.url||"",i=e.form,n=e.button,o=e.success,s=i.validate(),l="",a=0;a<s.length;a++)l+=s[a].message+"<br>";""==l?(n&&n.prop("disabled",!0),i=i.formdata(),$.ajax({url:t,data:i,method:"POST",dataType:"json",success:function(e){if(void 0!==e.error)return dialog.error("保存信息出错！"),void(n&&n.prop("disabled",!1));dialog.success("保存信息成功！"),void 0!==o&&o(e),n&&n.prop("disabled",!1)},error:function(){dialog.error("系统异常！"),n&&n.prop("disabled",!1)}})):dialog.error(l)},post:function(t){var e={...utils.getParameters(t.url),...t.data};$.ajax({url:t.url,data:e,method:"POST",dataType:"json",success:function(e){void 0!==t.success&&t.success(e)}})},get:function(t){$.ajax({url:t.url,data:t.data,dataType:"json",success:function(e){void 0!==t.success&&t.success(e)}})},text:function(e,t,i){$.ajax({url:e,data:t,success:function(e){void 0!==i&&i(e)}})},view:function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();let t=e.url,n=!1;n=void 0===e.empty||e.empty;let i=e.page;t&&0==t.indexOf(":")&&(i=t.substring(1),t=null);let o=utils.getParameters(e.url),s={...o,...e.params},l=e.title||"",a=e.containerId,r=e.success,d=null;if("string"==typeof a?(d=document.getElementById(a.trim()),null==d&&(d=document.querySelector(a.trim()))):d=a,void 0===s&&(s={}),window.parameters)for(var c in s)window.parameters[c]=s[c];t?xhr.get({url:t,success:function(e){let t=null;d&&(t=utils.append(d,e,n)),t&&t.id&&window[t.id]&&window[t.id].show&&!r&&window[t.id].show(o),r&&r(l,t,o)}}):i&&xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:i},success:function(e){let t=e.data.script;t=t||'<div class="full-width full-height d-flex"><img src="img/under-construction.jpeg" class="m-auto full-width"></div>';let i=null;d&&(i=utils.append(d,t,n)),r&&r(l,i,o)}})}};ajax.append=function(r){"undefined"!=typeof schedule&&r.clear&&schedule.stop();let d=dom.find("#tabsMain"),c=dom.find("#tabsOthers");if(null!=d){let l=d.children.length,i=r.url,o=r.title||"",e=r.containerId,t=r.params,s=r.success,a=null;if("string"==typeof e?(a=document.getElementById(e.trim()),null==a&&(a=document.querySelector(e.trim()))):a=e,void 0===t&&(t={}),window.parameters)for(var u in t)window.parameters[u]=t[u];h();let n=a.querySelector('div[data-url="'+i+'"]');if(null!=n){n.classList.remove("hide"),setTimeout(function(){n.classList.add("show")},150);let e=dom.find('a[data-url="'+i+'"]',d);return null!=e?void e.classList.add("active"):void dom.find('a[data-url="'+i+'"]',c).classList.add("active")}if(0==i.indexOf(":")){let t=i.substring(1);xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:t},success:function(e){e=e.data.script;utils.append(a,e,!1);for(let t=a.children.length-1;0<=t;t--){let e=a.children[t];if("DIV"==e.tagName){e.setAttribute("data-url",i),setTimeout(function(){e.classList.add("show")},150);break}}p(o,i),stdbiz.render(t,a.querySelector('[data-url="'+i+'"]'),{})}})}else m(i);function h(){a.querySelectorAll("div[data-url]").forEach(e=>{e.classList.remove("show"),e.classList.add("hide","fade","fadeIn")}),d.querySelectorAll("a.active").forEach(e=>{e.classList.remove("active")}),c.querySelectorAll("a.active").forEach(e=>{e.classList.remove("active")})}function p(t,i){if(""==t||null==d)return;var e=dom.element(`
      <li class="nav-item">
        <a class="nav-link head-link">
          <span></span>
          <i class="fas fa-times-circle ml-1"></i>
        </a>
      </li>
    `);dom.find("a",e).setAttribute("data-url",i),dom.bind(dom.find("i",e),"click",t=>{t.preventDefault(),t.stopPropagation();let e=t.target.parentElement,i=a.querySelector('div[data-url="'+e.getAttribute("data-url")+'"]');if(i&&i.remove(),t.target.parentElement.parentElement.remove(),0<a.querySelectorAll("div[data-url]").length&&d.children[0].click(),0<c.children.length){let e=c.children[0];e.remove(),t=e,dom.find("a",t).classList.add("nav-link"),dom.find("a",t).classList.remove("dropdown-item"),dom.find("i",t).classList.add("ml-1"),dom.find("i",t).classList.remove("float-right"),d.appendChild(t)}}),dom.bind(dom.find("a",e),"click",e=>{let t=dom.ancestor(e.target,"a");t.classList.contains("active")||(h(),t.classList.add("active"),m(s.getAttribute("data-url")))});let n=!1;if(d.querySelectorAll("li").forEach(e=>{dom.find("span",e).innerText==t&&(n=!0,dom.find("a",e).classList.add("active"))}),n)return;if(0==l)d.appendChild(e);else if(l+1>MAX_HEAD_LINK_COUNT){let e=dom.find("li:last-child",d);e.remove(),i=e,dom.find("a",i).classList.add("pointer"),dom.find("a",i).classList.remove("nav-link"),dom.find("a",i).classList.add("dropdown-item"),dom.find("i",i).classList.remove("ml-1"),dom.find("i",i).classList.add("float-right"),0==c.children.length?c.appendChild(i):c.insertBefore(i,c.children[0])}d.insertBefore(e,d.children[0]);let o=dom.find("span",e),s=dom.find("a",e);s.classList.add("active"),o.innerText=t}function m(n){a.querySelectorAll("div[data-url]").forEach(e=>{e.classList.remove("show"),e.classList.add("hide")});let t=a.querySelector('div[data-url="'+n+'"]');if(null!=t){t.classList.remove("hide"),setTimeout(function(){t.classList.add("show")},150);let e=dom.find('a[data-url="'+n+'"]',d);return null!=e?void e.classList.add("active"):void dom.find('a[data-url="'+n+'"]',c).classList.add("active")}xhr.get({url:n,success:function(e){var t=utils.getParameters(n),i=utils.append(a,e,!1);i.id&&window[i.id]&&window[i.id].show&&window[i.id].show(t);for(let t=a.children.length-1;0<=t;t--){let e=a.children[t];if("DIV"==e.tagName){e.setAttribute("data-url",n),setTimeout(function(){e.classList.add("show")},150);break}}p(o,n),s&&s(o,e)}})}}else ajax.view(r)},ajax.shade=function(t){"undefined"!=typeof schedule&&schedule.stop();let e=t.url,i=t.success,n=document.querySelector(".page.full");null!=n&&n.parentElement.remove(),-1===e.indexOf(":")?xhr.get({url:e,success:function(e){e=utils.append(document.body,e);i&&i(t.title||"",e)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:e.substring(1)},success:function(e){e=e.data.script,e=utils.append(document.body,e);i&&i(t.title||"",e)}})},ajax.shade2=function(t){"undefined"!=typeof schedule&&schedule.stop();var e=t.url;let i=t.success;xhr.get({url:e,success:function(e){e=utils.append(document.body,e);i&&i(t.title||"",e)}})},ajax.overlay=function(t){"undefined"!=typeof schedule&&schedule.stop();var e=t.url,i=t.html;let n=t.success,o=document.querySelector(".page.overlay");null!=o&&o.parentElement.remove(),e?xhr.get({url:e,success:function(e){e=utils.append(document.body,e);n&&n(t.title||"",e)}}):(i=utils.append(document.body,i),n&&n(t.title||"",i))},ajax.stack=function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();var i=e.pageId,t=e.params;let n=dom.find(e.containerId);let o=!1;for(let t=0;t<n.children.length;t++){let e=n.children[t];"DIV"==e.tagName&&"true"!=e.getAttribute("data-stack-back")&&(e.classList.remove("show"),e.classList.add("hide"),e.id==i&&(e.classList.remove("hide"),e.classList.add("show"),o=!0))}o||(e.empty=!1,ajax.view(e));let s=dom.find("div[data-stack-back]",n);null==s&&(s=dom.element(`
    <div data-stack-back="true" class="pointer">
      <i class="fas fa-angle-left font-32" style="margin-top: 12px;"></i>
    </div>
  `),s.style.position="fixed",s.style.width="60px",s.style.height="60px",s.style.bottom="40px",s.style.right="40px",s.style.backgroundColor="#0C9",s.style.color="#fff",s.style.borderRadius="50px",s.style.textAlign="center",s.style.boxShadow="2px 2px 3px #999",s.style.zIndex="99",dom.bind(s,"click",e=>{s.remove(),ajax.unstack({containerId:n})}),n.appendChild(s))},ajax.unstack=function(e){e=dom.find(e.containerId);let t=e.children[e.children.length-1];t.remove();let i=e.children[e.children.length-1];i.classList.remove("hide"),i.classList.add("show")},ajax.template=function(e){var t=e.url,i=e.usecase;let n=e.containerId,o=e.templateId;var s=e.data;let l=e.success;xhr.post({url:t,usecase:i,data:s,success:function(e){var t;n&&(t=document.getElementById(o).innerHTML,t=Handlebars.compile(t)(e),document.getElementById(n).innerHTML=t),l&&l(e)}})},ajax.dialog=async function(e){let n=e.title||"";var t=e.url;let i=e.html;var o=e.params||{};let s=e.success;var l=e.end,a=!1!==e.shadeClose,r=!0===e.allowClose,d=e.width||"80%",c=e.height||"",e=e.offset||"auto";if(window.parameters)for(var u in o)window.parameters[u]=o[u];t&&(i=await xhr.asyncGet({url:t})),layer.open({type:1,offset:e,title:n,closeBtn:!0==r?1:0,shade:.5,shadeClose:a,area:[d,c],content:i,success:function(e,t){let i=document.querySelector(".layui-layer-content");i.style.overflow="hidden",""!=n&&(i.style.height="calc(100% - 42px);"),s&&s()},end:l||function(){}})},ajax.video=function(e,t,i,n){layer.open({type:2,title:!1,closeBtn:1,shade:[0],area:[i+"px",n+"px"],offset:"rb",anim:2,content:[e,"no"]})},ajax.svg=function(e,i,t,n){void 0===t&&(t={}),$.ajax({url:e,data:t,success:function(e){i.empty();var t=(new XMLSerializer).serializeToString(e.documentElement);i.html(t),n&&n(e)}})},ajax.upload=function(t){let e=t.data;void 0===e&&(e={});let i=new FormData;for(var n in e)i.append(n,e[n]);$.ajax({url:t.url,data:i,method:"POST",cache:!1,contentType:!1,processData:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&t.progress&&e.upload.addEventListener("progress",function(e){e.lengthComputable&&t.progress&&t.progress(e.total,e.loaded)},!1),e},success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},ajax.sidebar=async function(e){let t=dom.find(e.containerId),i=e.success||function(e,t){},n=dom.find("[widget-id=right-bar]");var o=e.allowClose||!1;null!=n&&n.remove(),n=dom.element(`
    <div widget-id="right-bar" style="position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: transparent; z-index: 999999;">
      <div class="right-bar fade show">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="card-header pl-3">
              <h5 class="modal-title"></h5>
              <button type="button" class="close text-danger">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="modal-body" style="overflow-y: auto;"></div>
            <div style="position: absolute; bottom: 24px; left: 0; width: 100%; height: 48px; border-top: 1px solid lightgrey; background: white; display:none; z-index: 99999999;">
              <div widget-id="right-bar-bottom" class="mh-10 mt-2" style="float: right;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `),!0===e.showBottom&&(dom.find(".modal-body",n).style.marginBottom="48px",dom.find("[widget-id=right-bar-bottom]",n).parentElement.style.display=""),n.addEventListener("click",e=>{"right-bar"===e.target.getAttribute("widget-id")&&(n.children[0].classList.remove("in"),n.children[0].classList.add("out"),setTimeout(function(){n.remove()},300))}),t.appendChild(n),e.url&&0==e.url.indexOf(":")&&(e.page=e.url.substring(1),e.url=null);let s="";e.url?s=await xhr.asyncGet({url:e.url}):e.html&&(s=e.html),dom.find(".modal-title",n).innerHTML=e.title||"",dom.find(".modal-body",n).innerHTML="",o||e.close||dom.find("button.close",n).classList.add("hidden"),dom.find("button.close",n).addEventListener("click",function(){n.children[0].classList.add("out"),n.remove(),e.close&&e.close()});o=utils.append(dom.find(".modal-body",n),s);i&&i(e.title||"",o),setTimeout(function(){n.children[0].classList.remove("out"),n.children[0].classList.add("in")},300)},ajax.bottombar=function(i){let e=dom.find(i.containerId),n=i.success||function(){},o=dom.find(".bottom-bar",e),s=i.allowClose||!1;null!=o&&o.remove(),o=dom.element(`
    <div class="bottom-bar fade show">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="card-header pt-2 pb-2">
            <button type="button" class="close text-danger">
              <i class="fas fa-times"></i>
            </button>
            <h5 class="modal-title"></h5>
          </div>
          <div class="modal-body" style="overflow-y: auto"></div>
        </div>
      </div>
    </div>
  `),e.appendChild(o);var t=o.parentElement.clientWidth,l=parseInt(window.getComputedStyle(o.parentElement,null).getPropertyValue("padding-left")),a=parseInt(window.getComputedStyle(o.parentElement,null).getPropertyValue("padding-right"));o.style.width=t-a-l+"px",i.url?xhr.get({url:i.url,success:function(e){dom.find(".modal-title",o).innerHTML=i.title||"",s||i.close||dom.find("button.close",o).classList.add("hidden"),dom.find("button.close",o).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),i.close&&i.close()}),utils.append(dom.find(".modal-body",o),e),n&&n(e),setTimeout(function(){o.classList.remove("out"),o.classList.add("in")},200)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:i.page},success:function(e){var t=e.data.script;utils.append(dom.find(".modal-body",o),t),dom.find(".modal-title",o).innerHTML=i.title,s||i.close||dom.find("button.close",o).classList.add("hidden"),dom.find("button.close",o).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),i.close&&i.close()}),n&&n(e),setTimeout(function(){o.classList.remove("out"),o.classList.add("in")},200)}})},ajax.tabs=function(e){let t=document.querySelector(e.containerId);var n=e.tabs;e.closeable;let s=dom.create("ul","nav","nav-tabs"),l=dom.create("div","tab-content"),i=dom.create("div","float-right");e=dom.create("button","btn","btn-link");function a(e,t,i,n){ajax.view({url:t,containerId:e,success:function(){window[i]&&window[i].show(n)}})}i.appendChild(e),dom.bind(e,"click",function(){let e=dom.find("li.active link",this.parentElement.parentElement);var t=e.getAttribute("data-model-url"),i=e.getAttribute("data-model-page"),n=JSON.parse("data-model-data");a(dom.find("div.tab-content div[data-model-url='"+t+"']",this.parentElement.parentElement),t,i,n)});for(let i=0;i<n.length;i++){var r=n[i];let e=dom.create("li","nav-item"),o=dom.create("a","nav-link");0==i&&o.classList.add("active"),o.setAttribute("data-model-url",r.url),o.setAttribute("data-model-data",JSON.stringify(r.data||{})),o.setAttribute("data-model-page",r.page),o.innerHTML=r.title,dom.bind(o,"click",function(){if(!this.classList.contains("active")){dom.find("a.active",this.parentElement.parentElement.parentElement).classList.remove("active"),dom.find("div.active",this.parentElement.parentElement.parentElement).classList.remove("active");var t=o.getAttribute("data-model-url"),i=JSON.parse(o.getAttribute("data-model-data")),n=o.getAttribute("data-model-page");let e=dom.find("div.tab-content div[data-model-url='"+t+"']",this.parentElement.parentElement.parentElement);this.classList.add("active"),e.classList.add("active"),""===e.innerHTML.trim()&&a(e,t,n,i)}}),e.appendChild(o),s.appendChild(e);let t=dom.create("div","tab-pane");0==i&&(t.classList.add("active"),a(t,r.url,r.page,r.data)),t.setAttribute("data-model-url",r.url),l.append(t)}t.appendChild(i),t.appendChild(s),t.appendChild(l)},ajax.download=(e,i)=>{fetch(e).then(e=>e.blob()).then(e=>{let t=document.createElement("a");e=window.URL.createObjectURL(e);t.href=e,t.download=i+".docx",t.click(),window.URL.revokeObjectURL(e),t.remove()})},ajax.upload=i=>{let n=dom.create("input");n.setAttribute("type","file"),n.setAttribute("accept",i.accept||"*"),n.style.display="none",n.onchange=async e=>{var t=n.files[0],t=await xhr.asyncUpload({url:"/api/v3/common/upload",params:{directoryKey:i.directoryKey},file:t});i.success&&i.success(t)},n.click()};var dom={};function ListView(e){this.url=e.url,this.usecase=e.usecase,this.params=e.params||{},this.lazy=!0===e.lazy,this.hoverable=!1!==e.hoverable,this.activateable=!0===e.activateable,this.itemClass=e.itemClass||[],this.slidingActions=e.slidingActions||[],this.emptyHtml=e.emptyHtml,this.idField=e.idField,this.compare=e.compare||function(e,t){return!1},this.selections=e.selections||[],this.local=e.local||[],this.create=e.create||function(e,t){},this.complete=e.complete,this.draggable=!0===e.draggable,this.start=e.start||0,this.limit=e.limit||-1,this.borderless=e.borderless||!1,this.height=e.height,this.tooltip=e.tooltip,this.required=e.required||!1,this.onRemove=e.onRemove,this.onReorder=e.onReorder,this.onCheck=e.onCheck,this.onSelect=e.onSelect,this.onFilter=e.onFilter,this.onAdd=e.onAdd,this.onSearch=e.onSearch,this.onClick=e.onClick,this.observableItems=new rxjs.Observable}function GridView(e){this.columnCount=e.columnCount||2,this.local=e.local||[],this.url=e.url,this.params=e.params||{},this.create=e.create,this.error=e.error||function(e){}}function Timeline(e){this.url=e.url,this.params=e.params||{},this.data=e.data||[],this.fnTitle=e.title||function(e,t){return""},this.fnSubtitle=e.subtitle||function(e,t){return""},this.fnContent=e.content||function(e,t){return""},this.onComplete=e.onComplete}function Tabs(e){this.navigator=dom.find(e.navigatorId),this.content=dom.find(e.contentId),this.tabActiveClass=e.tabActiveClass,this.tabs=e.tabs,this.lazy=!1!==e.lazy,this.autoClear=!0===e.autoClear}function DataSheet(e){this.columns=e.columns,this.columnCount=this.getColumnCount(this.columns),this.rowHeaderWidth=e.rowHeaderWidth||150,this.rowHeaders=e.rowHeaders,this.rowCount=this.getRowCount(this.rowHeaders),this.readonly=!0===e.readonly,this.totalColumns=[];for(let e=0;e<this.columns.length;e++){var t=this.columns[e];t.totalable&&this.totalColumns.push(t)}this.onCellClicked=e.onCellClicked,this.onRowHeaderClicked=e.onRowHeaderClicked,this.rowHeaderColumnCount=this.getRowHeaderColumnCount(this.rowHeaders),this.colHeaderColumnCount=this.getColumnHeaderColumnCount(this.columns),this.rowHeaderRowCount=this.getRowHeaderRowCount(this.rowHeaders),this.colHeaderRowCount=this.getColumnHeaderRowCount(this.columns),this.matrixColumn=[],this.matrixRowHeader=[],this.buildColumnMatrix(this.columns,this.matrixColumn,0),this.buildRowHeaderMatrix(this.rowHeaders,this.matrixRowHeader,0)}function Chat(e){this.host=e.host||"",this.userId=e.userId,this.userType=e.userType,this.getConversations=e.getConversations,this.onInit=e.onInit||async function(){},this.onSendTextMessage=e.onSendTextMessage,this.onSendImageMessage=e.onSendImageMessage,this.onSendAudioMessage=e.onSendAudioMessage,this.onSendVideoMessage=e.onSendVideoMessage,this.onSendCustomMessage=e.onSendCustomMessage,this.onRevokeMessage=e.onRevokeMessage||function(e){},this.onMessageReceived=e.onMessageReceived,this.onUnreadMessages=e.onUnreadMessages||function(e){},this.onReadMessages=e.onReadMessages||function(e){}}function Sparkline(e){this.color=e.color||"black",this.type=e.type||"line",this.data=e.data||[]}function MobileWizard(e){this.topic=e.topic,this.steps=e.steps||[],this.root=dom.element(`
    <div style="width: 100%">
      <div class="wizard-progress">
      </div>
      <div class="wizard-content">
      </div>
    </div>
  `)}function MobileForm(e){this.fields=e.fields,this.readonly=e.readonly||!1,this.saveOpt=e.save,this.readOpt=e.read}function Numpad(e){this.unit=e.unit||"",this.regex=e.regex||/.*/,this.success=e.success||function(e){},this.type=e.type||"decimal"}function DistrictPicker(e){this.unit=e.unit||"",this.regex=e.regex||/.*/,this.success=e.success||function(e){},this.selections=e.selections||{}}function Calendar(e){this.today=moment(new Date),this.currentMonth=moment(this.today).startOf("month"),this.currentIndex=1}function CascadePicker(e){this.success=e.success||function(e){},this.selections=e.selections||{},this.levels=e.levels}function ActionSheet(e){this.title=e.title||"",this.actions=e.actions||[]}function Weekdays(e){e=e||{},this.today=moment(new Date),this.days=e.days||14}function PopupRuler(e){this.unit=e.unit||"",this.regex=e.regex||/.*/,this.success=e.success||function(e){},this.type=e.type||"decimal",this.value=e.value,this.range=e.range}dom.slideInFromRight=(e,t)=>{e.classList.remove("out"),e.classList.add("in"),setTimeout(()=>{e.style.right="0"},300),t&&(t.style.display="")},dom.slideOutToRight=(e,t,i)=>{e.classList.contains("in")&&(e.classList.contains("out")||(e.classList.remove("in"),e.classList.add("out"),setTimeout(()=>{e.style.right=t},300),i&&(i.style.display="none")))},dom.delayTo=e=>{clearTimeout(dom.timeoutDelayTo),dom.timeoutDelayTo=setTimeout(()=>{},600)},dom.value=function(e,t){const i=document.querySelector(e);if(!t)return i.value.trim();i.value=t},dom.empty=function(e){const t=document.querySelector(e);t.value?t.value="":t.innerHTML=""},dom.valid=function(e){const t=document.querySelector(e);return void 0!==t.value&&null!=t.value&&""!=t.value.trim()},dom.create=function(e){var t=Array.prototype.slice.call(arguments,1);let i=document.createElement(e);for(let e=0;e<t.length;e++)i.classList.add(t[e]);return i},dom.fix=function(e){let t=null;t="string"==typeof e?document.querySelector(e):e;var i=t.getBoundingClientRect(),n=i.left,o=i.top,s=(i.width,i.height),l=(parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-top"))),a=parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-bottom"));parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-top")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-bottom"));let r=t.parentElement.parentElement;e=r.getBoundingClientRect(),i=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"));parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-top")),parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-bottom"));return t.style.position="absolute",t.style.top=o-e.top+"px",t.style.left=n-e.left+"px",t.style.width="calc(100% - "+2*i+"px )",{top:o-e.top,left:n-e.left,width:e.width-2*i,height:s+l+a}},dom.find=function(e,t){if(t=t||document,"string"!=typeof e)return e;e=t.querySelectorAll(e);return 0==e.length?null:1==e.length?e[0]:e},dom.ancestor=function(e,t,i){let n=null;if(i=i||"",n="string"==typeof e?document.querySelector(e):e,null==n)return null;t=t.toUpperCase();let o=n;if(""==i)for(;null!=o&&o.tagName!=t;)o=o.parentElement;else for(;null!=o&&(o.tagName!=t||!o.classList.contains(i));)o=o.parentElement;return o},dom.element=function(e){let t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},dom.bind=function(e,t,i){let n=null;n="string"==typeof e?document.querySelector(e):e,null!=n&&n&&n.addEventListener(t,i)},dom.model=function(e,i){let n=null;if(n="string"==typeof e?document.querySelector(e):e,void 0===i){let i={};return Array.prototype.slice.call(n.attributes).forEach(function(t){if(0==t.name.indexOf("data-model-"))if(0==t.value.indexOf("{"))try{i[utils.nameVar(t.name.slice("data-model-".length))]=JSON.parse(t.value)}catch(e){i[utils.nameVar(t.name.slice("data-model-".length))]=t.value}else i[utils.nameVar(t.name.slice("data-model-".length))]=t.value}),i}var o=Array.prototype.slice.call(arguments,2);if(0==o.length)for(const t in i)0!=t.indexOf("||")&&0!=t.indexOf("//")&&0!=t.indexOf(">>")&&("object"==typeof i[t]?n.setAttribute(utils.nameAttr(t),JSON.stringify(i[t])):n.setAttribute(utils.nameAttr(t),i[t]));else for(let t=0;t<o.length;t++){let e=o[t];0!=e.indexOf("||")&&0!=e.indexOf("//")&&0!=e.indexOf(">>")&&("object"==typeof i[e]?n.setAttribute(utils.nameAttr(e),JSON.stringify(i[e])):n.setAttribute(utils.nameAttr(e),i[e]))}},dom.collect=function(e,n){let o=[],s=document.querySelectorAll(e);for(let i=0;i<s.length;i++){let t={};if(Array.isArray(n))for(let e=0;e<n.length;e++)t[n[e]]=s[i].getAttribute(utils.nameAttr(n[e]));else t[n]=s.getAttribute(utils.nameAttr(n[j]));o.push(t)}return o},dom.propagate=function(e,t,i,n){let o=n(t);if(Array.isArray(i))for(let e=0;e<i.length;e++)o.setAttribute(utils.nameAttr(i[e]),t[i[e]]);else o.setAttribute(utils.nameAttr(i),t[i]);e.appendChild(o)},dom.toggle=function(e,s){var i=document.querySelectorAll(e);for(let t=0;t<i.length;t++){let e=i[t];e.addEventListener("click",function(){let e=this.getAttribute("data-toggle"),t=e.split(">>"),i=t[0].split("+"),n=t[1].split("+"),o=!1;for(let t=0;t<i.length;t++){let e=i[t].trim();o=0==e.indexOf(".")?this.classList.contains(e.substring(1)):null!=this.querySelector(e)}if(o){for(let e=0;e<n.length;e++){let t=n[e].trim();if(0===t.indexOf("."))this.classList.add(t.substring(1));else{let e=this.querySelector(t.substring(0,t.indexOf(".")));e.classList.add(t.substring(t.indexOf(".")+1))}}for(let e=0;e<i.length;e++){let t=i[e].trim();if(0==t.indexOf("."))this.classList.remove(t.substring(1));else{let e=this.querySelector(t);e.classList.remove(t.substring(t.indexOf(".")+1))}}}else{for(let e=0;e<i.length;e++){let t=i[e].trim();if(0==t.indexOf("."))this.classList.add(t.substring(1));else{let e=this.querySelector(t.substring(0,t.indexOf(".")));e.classList.add(t.substring(t.indexOf(".")+1))}}for(let e=0;e<n.length;e++){let t=n[e].trim();if(0==t.indexOf("."))this.classList.remove(t.substring(1));else{let e=this.querySelector(t);e.classList.remove(t.substring(t.indexOf(".")+1))}}s&&resovle(this)}})}},dom.switch=function(e,n){let o=dom.find(e),t=o.getAttribute("data-switch"),s=t.split("+");var l=o.querySelectorAll(s[0]);for(let e=0;e<l.length;e++){let i=l[e];i.onclick=e=>{let t=o.querySelectorAll(s[0]);for(let e=0;e<t.length;e++)t[e].classList.remove(s[1].substring(1));i.classList.add(s[1].substring(1)),n&&n(i)}}},dom.tabs=function(e){let n=dom.find(e);if(null!=n){let i=n.getAttribute("data-tab-active-class");for(let e=0;e<n.children.length;e++){let t=n.children[e];t.addEventListener("click",e=>{for(let t=0;t<n.children.length;t++){let e=n.children[t];e.classList.remove(i)}t.classList.add(i)})}}},dom.top=function(e){let t=null;if(t="string"==typeof e?document.querySelector(e):e,null==t)return 0;let i=t.offsetTop;return void 0!==t.offsetParent&&(i+=dom.top(t.offsetParent)),i},dom.formdata=function(e,t){let o=null;if(o="string"==typeof e?document.querySelector(e):e,void 0===t){let i={},n={};var s=o.querySelectorAll("input");for(let t=0;t<s.length;t++){var l=s[t];let e=l.name;var a=l.type,r=l.value;"text"==a||"number"==a||"password"==a||"hidden"==a?(i[e]=null,""!=r?-1!=e.indexOf("[]")?i[e]=[r]:i[e]=r:i[e]=""):"radio"==a?l.checked&&(i[e]=r):"checkbox"==a&&(void 0===n[e]&&(n[e]=0),l.checked&&(void 0===i[e]&&(n[e]=0,i[e]=[]),i[e].push(r)),n[e]+=1)}var d=o.querySelectorAll("select");for(let t=0;t<d.length;t++){var c=d[t];let e=c.name;i[e]=null,-1!=c.selectedIndex?-1!=e.indexOf("[]")?i[e]=[c.value]:i[e]=c.value:i[e]=""}var u,h,p=o.querySelectorAll("textarea");for(let e=0;e<p.length;e++){var m=p[e],f=m.name;i[f]=null,i[f]=m.value}for(u in n)-1==u.indexOf("[]")&&1==n[u]&&i[u]&&(i[u]=i[u][0]);for(h in i)"string"==typeof i[h]&&0==i[h].indexOf("${")&&(i[h]=i[i[h].substring(2,i[h].length-1)]);return i}function i(e,t,i){let n=dom.find("[name='"+t+"']",e);if(null!=n){if(1<n.length&&"radio"==n[0].type){let e=n;e.forEach((e,t)=>{e.value===i?e.checked=!0:e.checked=!1})}"INPUT"==n.tagName?"check"==n.type||(n.value=i||""):"SELECT"==n.tagName?$("select[name='"+t+"']").val(i).trigger("change"):"TEXTAREA"==n.tagName&&(n.innerHTML=i)}}for(var n in t)if("object"==typeof t[n])for(var g in t[n])i(o,n+"."+g,t[n][g]);else i(o,n,t[n])},dom.setAttribute=function(e,t,i){let n=document.querySelectorAll(e);for(let e=0;e<n.length;e++)n[e][t]=i},dom.removeAttribute=function(e,t){let i=document.querySelectorAll(e);for(let e=0;e<i.length;e++)i[e].removeAttribute(t)},dom.enable=function(e){let t=document.querySelectorAll(e);for(let e=0;e<t.length;e++)t[e].disabled=!1},dom.disable=function(e){let t;t="string"==typeof e?document.querySelectorAll(e):e;for(let e=0;e<t.length;e++)t[e].disabled=!0},dom.index=function(e,i,t){let n;if(n="string"==typeof e?dom.find(e):e,!t){var o=n.getAttribute(i),s=n.parentElement.querySelectorAll(n.tagName);for(let t=0;t<s.length;t++){let e=s[t];if(o==e.getAttribute(i))return t}}return-1},dom.elementAt=function(e,i,n){var o=document.querySelectorAll(e);for(let t=0;t<o.length;t++){let e=o[t];if(n==e.getAttribute(i))return{index:t,element:e}}return null},dom.elementAtTree=function(e,i,n,o,s){var l=document.querySelectorAll(e);let a=0;for(let t=0;t<l.length;t++){let e=l[t];var r=e.getAttribute(i),d=e.getAttribute(n);if(s==d&&(a++,o==r))return{index:a,element:e}}},dom.stack=function(t,i,n,o){let s=dom.create("a","btn","btn-link");var e=dom.create("i","fas","fa-caret-right","mr-1");s.appendChild(e),dom.bind(s,"click",function(){let e=dom.find("i",s);e.classList.contains("fa-caret-right")?(t.container.querySelectorAll("i.fa-caret-down").forEach(e=>{e.classList.remove("fa-caret-down"),e.classList.add("fa-caret-right")}),e.classList.remove("fa-caret-right"),e.classList.add("fa-caret-down"),t.stack(n,function(e){e.parentElement.classList.add("fade","fadeIn"),e.style.paddingLeft="50px",e.style.paddingRight="50px",setTimeout(function(){e.parentElement.classList.add("show")},200),o(e)})):(e.classList.remove("fa-caret-down"),e.classList.add("fa-caret-right"),i.parentElement.nextSibling.remove())})},dom.inner=function(e){var t=e.clientHeight,i=e.clientWidth,e=getComputedStyle(e);return{height:t-parseInt(e.paddingTop)-parseInt(e.paddingBottom),width:i-parseInt(e.paddingLeft)-parseInt(e.paddingLeft)}},dom.outer=function(e){var t=e.clientHeight,i=e.clientWidth,e=getComputedStyle(e);return{height:t+parseInt(e.marginTop)+parseInt(e.borderTop)+parseInt(e.marginBottom)+parseInt(e.borderBottom),width:i+parseInt(e.marginLeft)+parseInt(e.borderLeft)+parseInt(e.marginRight)+parseInt(e.borderRight)}},dom.height=function(e,t,i){t=t||0,i=(i=void 0===i?dom.find("#container"):i)||document.body;let n=null;n="string"==typeof e?document.querySelector(e):e;var o=dom.top(n);let s=getComputedStyle(i,null);parseInt(s.getPropertyValue("padding-top"));e=parseInt(s.getPropertyValue("padding-bottom"));s=getComputedStyle(n,null);parseInt(s.getPropertyValue("border-top-width")),parseInt(s.getPropertyValue("border-bottom-width"));n.style.marginBottom="0px",n.style.height=i.clientHeight-o-t-e+"px",n.style.overflowY="auto"},dom.height2=function(e,t,i){t=t||0,i=(i=void 0===i?dom.find("#container"):i)||document.body;let n=null;n="string"==typeof e?document.querySelector(e):e;dom.top(n);let o=getComputedStyle(i,null);var s=parseInt(o.getPropertyValue("padding-top")),l=parseInt(o.getPropertyValue("padding-bottom"));o=getComputedStyle(n,null);var a=parseInt(o.getPropertyValue("border-top-width")),r=parseInt(o.getPropertyValue("border-bottom-width")),d=parseInt(o.getPropertyValue("border-top-width")),e=parseInt(o.getPropertyValue("border-bottom-width"));n.style.marginBottom="0px";i=i.getBoundingClientRect();n.style.height=i.height-s-l-a-r-d-e-t+"px",n.style.overflowY="auto"},dom.autoheight=function(e,t,i){i=i||0;let n=dom.find(e);var o=(t=t||document.body).getBoundingClientRect().height;let s=n.parentElement;var l=s.getBoundingClientRect().top;let a=0;for(;s!==t;){var r=getComputedStyle(s);a+=parseInt(r.paddingBottom),a+=parseInt(r.marginBottom),s=s.parentElement}e=parseInt(n.offsetTop);t===document.body?n.style.height=o-a-i-l+"px":(l=getComputedStyle(s),parseInt(l.paddingTop),l=parseInt(l.paddingBottom),n.style.height=o-a-i-e-l+"px"),n.style.overflowY="auto"},dom.templatize=function(e,t){let i=Handlebars.compile(e);t=i(t);return dom.element(t)},dom.render=function(e,t,o){let i=null;function n(e,t,i){let n=dom.find("[name='"+t+"']",e);null!=n&&("DIV"===n.nodeName&&o?i&&function(e,t){let i=dom.find("[value='"+t+"']",e);null!=i&&(i.checked=!0)}(n,i):"INPUT"==n.tagName?"radio"==n.type||(n.value=i):"SPAN"==n.tagName?i&&(n.innerHTML=i):"SELECT"==n.tagName&&$("select[name='"+t+"']").val(i).trigger("change"))}for(var s in i="string"==typeof e?document.querySelector(e):e,t)if("object"==typeof t[s])for(var l in t[s])n(i,s+"."+l,t[s][l]);else n(i,s,t[s])},dom.popup=function(e,t){let i=dom.create("div","full-width","full-height","position-absolute");return i.style.background="transparent",dom.bind(i,"click",e=>{i.remove(),t.remove()}),document.body.appendChild(i),e.appendChild(t),i},dom.html=function(e){let t=dom.element("<div></div>");return t.appendChild(e),t.innerHTML},dom.init=function(t,i){if(i){let e=i.getAttribute("name");e&&""!=e||(e=i.getAttribute("widget-id")),e&&""!=e&&(t[e]=i);var n=i.getAttribute("widget-model-tooltip");n&&""!=n&&tippy(i,{content:n});for(let e=0;e<i.children.length;e++){var o=i.children[e];dom.init(t,o)}}},dom.exists=(t,i,n)=>{for(let e=0;e<t.length;e++){var o=t[e];if(dom.model(o)[n]===i[n])return!0}return!1},utils={append:function(e,t,i){let n=dom.create("div");n.style.height="100%",n.style.width="100%",i=i||!1;let o=document.createRange();t=o.createContextualFragment(t);!1!==i&&(e.innerHTML=""),e.appendChild(n),n.appendChild(t);t=dom.find("[id^=page]",n);return t?n.setAttribute("page-id",t.id):n.setAttribute("page-id","page.not.in.database"),{id:t?t.id:"",container:n}},message:function(i){if(i||0!=i.length){let t="";for(let e=0;e<i.length;e++)t+=i[e].message+"<br>";return t}},prompt:function(t){if(t||0!=t.length)for(let e=0;e<t.length;e++)$(t[e].element).addClass("is-invalid")},render:function(e,t,i){t=document.getElementById(t).innerHTML;let n=Handlebars.compile(t);i=n(i);let o=document.getElementById(e);o.innerHTML=i},assemble:function(e,t){if("object"==typeof e)for(var i in e){var n=e[i];"object"==typeof n&&(e[i+"Id"]=n.id),"id"==i?e[t+"Id"]=n:"name"==i&&(e[t+"Name"]=n)}},in:function(e){var t=e.split(" ");let i=null,n=[];1==t.length?(i=document.getElementById(e),n.push(i)):(i=document.getElementById(t[0]),n=i.querySelectorAll(t[1]));for(let e=0;e<n.length;e++)i=n[e],i.addEventListener("animationend",function(){this.classList.remove("animated","fadeIn"),this.style.display="",this.removeEventListener("animationend",function(){}),this.removeEventListener("animationstart",function(){})}),i.classList.remove("fadeOut","hide"),i.classList.add("animated","fadeIn","show")},out:function(e){var t=e.split(" ");let i=null,n=[];1==t.length?(i=document.getElementById(e),n.push(i)):(i=document.getElementById(t[0]),n=i.querySelectorAll(t[1]));for(let e=0;e<n.length;e++)i=n[e],i.addEventListener("animationend",function(){this.classList.remove("animated","fadeOut"),this.removeEventListener("animationend",function(){})}),i.classList.remove("fadeIn","show"),i.classList.add("animated","fadeOut","hide")},nameAttr:function(i){const n=[];let o="";for(let t=0;t<i.length;t++){let e=i.charAt(t);e==e.toUpperCase()?(n.push(o),o="",o+=e.toLowerCase()):o+=e}return""!=o&&n.push(o),"data-model-"+n.join("-")},nameVar:function(t,e){if(-1==t.indexOf(e=e||"-"))return t;var i=t.split(e);let n="";for(let e=0;e<i.length;e++){const t=i[e];0==e?n+=t:n+=t.charAt(0).toUpperCase()+t.slice(1)}return n},camelcase:function(t,e){if(-1==t.indexOf(e))return t;var i=t.split(e);let n="";for(let e=0;e<i.length;e++){const t=i[e];0==e?n+=t:n+=t.charAt(0).toUpperCase()+t.slice(1)}return n},pascalcase:function(t,e){if(-1==t.indexOf(e))return t.charAt(0).toUpperCase()+t.slice(1);var i=t.split(e);let n="";for(let e=0;e<i.length;e++){const t=i[e];n+=t.charAt(0).toUpperCase()+t.slice(1)}return n},clone:function(e,t){for(var i in e=e||{})t[i]=e[i]},get:function(t){var i=Array.prototype.slice.call(arguments,1);let n={};for(let e=0;e<i.length;e++)n[i[e]]=t[i[e]];return n},isEmpty:function(e){let t=0;for(var i in e)t++;return 0==t},isBlank:function(e){let t=0;for(var i in e)null!=e[i]&&""!==e[i]&&t++;return 0==t},getParameter:function(e,t){t=t.replace(/[\[\]]/g,"\\$&");let i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),n=i.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},getParameters:function(e){if(-1==e.indexOf("?"))return{};let i={},n=(e=e.substring(e.indexOf("?")+1)).split("&");for(let t=0;t<n.length;t++){let e=n[t].split("=");if(1==e.length)return{};i[e[0].trim()]=decodeURIComponent(e[1].trim())}return i},isExisting:(t,i,n)=>{for(let e=0;e<t.length;e++)if(t[e][n]===i[n])return!0;return!1},textSize:(e,t)=>{const i=document.createElement("canvas"),n=i.getContext("2d");n.font=t;e=n.measureText(e);return i.remove(),{width:e.width,height:e.height}},base64:n=>new Promise((e,t)=>{const i=new FileReader;i.readAsDataURL(n),i.onload=()=>e(i.result),i.onerror=t})},"undefined"==typeof dialog&&(dialog={}),dialog.alert=function(e){layer.open({type:0,icon:0,offset:"150px",shade:0,shadeClose:!0,title:"警告",content:e})},dialog.info=function(e){layer.open({type:0,offset:"150px",shade:0,shadeClose:!0,title:"信息",content:e})},dialog.info2=function(e){layer.open({type:0,offset:"100px",shade:.3,shadeClose:!0,title:"信息",content:e})},dialog.error=function(e){e=e.replaceAll("\n","<br>"),layer.open({type:0,icon:2,offset:"150px",shade:0,shadeClose:!0,title:"错误",content:e})},dialog.success=function(e,i){i?layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e,btn:["确定","确定并返回"],yes:function(e,t){layer.close(e)},btn2:function(e,t){layer.close(e),i()}}):layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e})},dialog.confirm=function(e,i){layer.confirm(e,{title:"确认",btn:["确定","取消"]},function(e,t){t=dom.formdata(t[0]);layer.close(e),i(t)},function(){})},dialog.view=function(i){let n=i.title;var e=i.url;$(document.body);$("#dialogApplication").length&&$("#dialogApplication").remove();let o=[];i.save&&o.push({text:"保存",class:"btn-save",onClicked:i.save}),$.ajax({url:e,success:function(e){let t=Handlebars.compile('<div class="modal fade fadeIn show" id="dialogApplication">  <div class="modal-dialog modal-dialog-centered">    <div class="modal-content">      <div class="modal-header">        <h4 class="modal-title">{{title}}</h4>        <button type="button" class="close" data-dismiss="modal">&times;</button>      </div>      <div id="dialogApplicationBody" class="modal-body">{{{body}}}</div>      <div class="modal-footer">        {{#each buttons}}        <button type="button" class="btn {{class}}" data-dismiss="modal">{{text}}</button>        {{/each}}        <button type="button" class="btn btn-close" data-dismiss="modal">关闭</button>      </div>    </div>  </div></div>');e=t({title:n,body:e,buttons:o});$(document.body).append(e),i.success&&i.success({onClosed:i.onClosed}),$("#dialogApplication").modal("show")}})},dialog.select=function(t){ajax.view({url:t.url,success:function(e){layer.open({type:0,icon:1,offset:"150px",shade:.5,shadeClose:!0,title:t.title,content:e})}})},dialog.simplelist=async function(i){var n=await xhr.promise({url:i.url,params:i.params||{}}),e=dom.element(`
    <div>
      <ul class="list-group"></ul>
    </div>
  `);let o=dom.find("ul",e);for(let t=0;t<n.length;t++){var s=n[t];let e=dom.create("li","list-group-item","list-group-item-action");dom.model(e,s),e.innerText=s[i.fields.text],o.appendChild(e)}layer.open({type:0,closeBtn:1,btn:[],shade:.5,shadeClose:!0,title:"",content:e.innerHTML,success:function(e,t){e.get(0).querySelectorAll("li").forEach((e,t)=>{dom.bind(e,"click",e=>{layer.close(layer.index);e=dom.model(e.target);i.onAccept(e)})})}})},dialog.html=function(i){layer.open({type:0,closeBtn:1,offset:"150px",shade:.5,area:["50%",""],shadeClose:!0,title:i.title||"&nbsp;",content:i.html,btn:["确定","关闭"],success:function(e,t){i.load&&i.load(e,t)},yes:function(e){layer.close(e),i.success()},btn1:function(){}})},dialog.iframe=function(e){layer.open({title:e.title,type:2,area:[e.width,e.height],content:e.url,resize:!1,maxmin:!0,shade:!1,success:e.success||function(e,t){}})},ListView.prototype.fetch=async function(e){var t={};e=e||{},utils.clone(this.params,t),utils.clone(e,t);this.url&&(this.data=this.data||{},this.data.start=this.start,this.data.limit=this.limit,t=await xhr.promise({url:this.url,params:t}),Array.prototype.push.apply(this.local,t)),0==this.local.length?this.emptyHtml&&(this.contentContainer.innerHTML=this.emptyHtml):this.append(this.local)},ListView.prototype.render=function(t,e){this.container="string"==typeof t?document.querySelector(t):t,this.container.innerHTML="";t=this.height-37;if(this.onFilter){let e=dom.element(`
      <div class="input-group position-sticky" style="top: 0; left: 0; z-index: 10;">
        <div class="input-group-prepend">
          <span class="input-group-text" style="border-bottom-left-radius: unset;">
            <i class="fas fa-search"></i>
          </span>
        </div>
        <input class="form-control" placeholder="搜索..."  style="border-bottom-right-radius: unset;">
        <div class="input-group-append">
          <span class="input-group-text pointer text-primary" style="border-bottom-right-radius: unset;">
            <i class="fas fa-plus"></i>
          </span>
          <span class="input-group-text" style="border-bottom-right-radius: unset;">
            <i class="fas fa-question icon-general"></i>
          </span>
          <span class="input-group-text" style="border-bottom-right-radius: unset;">
            <i class="fas fa-asterisk icon-required"></i>
          </span>
        </div>
      </div>
    `),t=dom.find("input",e);dom.bind(t,"input",e=>{clearTimeout(this.delayToSearch),this.delayToSearch=setTimeout(()=>{this.onFilter(this,t.value)},500)}),this.required||e.children[2].children[2].remove(),this.tooltip||e.children[2].children[1].remove(),this.onAdd||e.children[2].children[0].remove(),0==e.children[2].children.length&&e.children[2].remove(),this.container.appendChild(e)}this.contentContainer=dom.create("div","full-width");let i=dom.create("ul","list-group","full-width");if(this.borderless&&i.classList.add("b-a-0"),this.onFilter){let e=dom.create("div");e.style.height=t+"px",e.style.overflowY="auto",e.style.border="1px solid rgba(0, 0, 0, 0.125)",e.style.borderTop="",e.appendChild(i),this.contentContainer.appendChild(e)}else this.contentContainer.appendChild(i);this.container.appendChild(this.contentContainer),!1!==e&&!0!==this.lazy&&this.reload()},ListView.prototype.reload=function(e){e=e||{};let t=dom.find("ul",this.container);t.innerHTML="",this.start=0,this.url&&(this.local=[]),this.fetch(e)},ListView.prototype.load=function(){this.start=this.local.length,this.fetch()},ListView.prototype.remove=function(i){if(this.idField){var n=dom.find("ul",this.container);for(let t=0;t<n.children.length;t++){let e=n.children[t];dom.model(e)[this.idField]===i[this.idField]&&e.remove()}}},ListView.prototype.append=function(t,i){let n=this,s=this.container.querySelector("ul");var l=s.querySelectorAll("li").length;if(Array.isArray(t)){var o=t;for(let e=0;e<o.length;e++)this.append(o[e]);n.complete&&n.complete(t)}else{var a=t;if(this.idField)for(let e=0;e<s.children.length;e++){var r=s.children[e];if(dom.model(r)[this.idField]===a[this.idField])return}let o=dom.create("li","list-group-item");!1!==this.hoverable&&o.classList.add("list-group-item-action"),!0===this.activateable&&dom.bind(o,"click",e=>{for(let t=0;t<o.parentElement.children.length;t++){let e=o.parentElement.children[t];e.classList.remove("active")}o.classList.add("active")});for(let e=0;e<this.itemClass.length;e++)o.classList.add(this.itemClass[e]);this.borderless&&o.classList.add("b-a-0"),this.onClick&&dom.bind(o,"click",this.onClick),o.style.paddingLeft="16px",o.style.paddingRight="16px",o.style.paddingTop="8px",o.style.paddingBottom="8px",o.style.display="flex",o.style.alignItems="center",this.onFilter&&(o.style.borderLeftWidth="0",o.style.borderRightWidth="0",o.style.borderBottomWidth="0");let e=this.create(l,a,o);if(e.style.width="100%",this.onCheck){let t=dom.element(`
        <input class="pointer checkbox color-info is-outline mr-2" type="checkbox">
      `);for(let e=0;e<this.selections.length;e++)if(this.compare(this.selections[e],a)){t.setAttribute("checked",!0);break}dom.bind(t,"change",function(){n.onCheck(this.checked,dom.model(this),this)}),dom.model(t,a),o.appendChild(t)}if(o.appendChild(e),0<this.slidingActions.length){this.actionElements=[];for(let t=0;t<this.slidingActions.length;t++){let e=this.slidingActions[t];e.width=parseInt(e.width||64),o.appendChild(e.create())}dom.bind(o,"touchstart",e=>{this.touchStartX=e.touches[0].screenX,this.touchStartY=e.touches[0].screenY}),dom.bind(o,"touchmove",e=>{this.touchMoveX=e.touches[0].screenX,this.touchMoveY=e.touches[0].screenY;let i=this.touchStartX-this.touchMoveX;e=this.touchStartY-this.touchMoveY;if(!(Math.abs(i)<30||30<Math.abs(e)))if(0<i){let t=i/this.slidingActions.length;for(let e=1;e<o.children.length;e++)o.children[e].getBoundingClientRect().width>=this.slidingActions[e-1].width||(t>=this.slidingActions[e-1].width&&(t=this.slidingActions[e-1].width),o.children[e].style.minWidth=t+"px",o.children[e].style.display="")}else{i=-i/10;var n=i/this.slidingActions.length;for(let t=1;t<o.children.length;t++){let e=o.children[t].getBoundingClientRect().width-n;e=e<=5?0:e,0==e?(o.children[t].style.width="0",o.children[t].style.minWidth="unset"):o.children[t].style.minWidth=e+"px"}}}),dom.bind(o,"touchend",e=>{this.touchendX=e.changedTouches[0].screenX,this.touchendY=e.changedTouches[0].screenY;var t=this.touchStartX-this.touchendX,e=this.touchStartY-this.touchendY;Math.abs(t)<30||30<Math.abs(e)||(30<=t?this.expandSlidingActions(o):this.collapseSlidingActions(o))})}this.idField&&o.setAttribute("data-list-item-id",a[this.idField]),dom.model(o,a),"number"==typeof i?i<0?s.insertBefore(o,s.children[s.children.length+i]):s.insertBefore(o,s.children[i]):s.appendChild(o),this.onRemove&&(i=dom.element(`
        <a class="btn text-danger float-right font-18" style="padding: 0; margin-left: auto;">
          <i class="fas fa-times" style=""></i>
        </a>
      `),dom.bind(i,"click",function(e){e.stopPropagation(),n.onRemove(this.parentElement,dom.model(this.parentElement))}),dom.model(i,a),o.appendChild(i)),this.onReorder?this.setReorderable(o):this.draggable&&(o.setAttribute("draggable","true"),o.addEventListener("dragover",function(e){e.preventDefault()}),o.addEventListener("dragstart",function(e){}))}},ListView.prototype.setLocal=function(e){if(!e||0==e.length)return this.contentContainer.innerHTML="",void(this.emptyHtml&&(this.contentContainer.innerHTML=this.emptyHtml));this.contentContainer.innerHTML="";let t=dom.find("ul",this.contentContainer);if(null==t){let e=dom.create("ul","list-group","full-width");this.borderless&&e.classList.add("b-a-0");let t=dom.create("div");var i=this.height-37;t.style.height=i+"px",t.style.overflowY="auto",t.style.border="1px solid rgba(0, 0, 0, 0.125)",t.style.borderTop="",t.appendChild(e),this.contentContainer.appendChild(t)}else t.innerHTML="";for(var n of e)this.append(n)},ListView.prototype.replace=function(i){var n=this.container.querySelector("ul");for(let t=0;t<n.children.length;t++){let e=n.children[t];if(dom.model(e)[this.idField]===i[this.idField]){dom.model(e,i),e.innerHTML="",e.appendChild(this.create(t,i));break}}},ListView.prototype.search=function(i){var n=this.container.querySelector("ul");for(let t=0;t<n.children.length;t++){let e=n.children[t];-1!=e.innerText.indexOf(i)?e.style.display="":e.style.display="none"}},ListView.prototype.setReorderable=function(e){let t=dom.find("ul",this.container);t.addEventListener("dragover",function(e){e.preventDefault()}),t.ondrop=e=>{this.onReorder&&this.onReorder(dom.model(this.draggingElement),this.getItemIndex(this.draggingElement),this.draggingElementOriginalIndex),this.draggingElement.style.opacity="",this.draggingElement=null,this.clonedDraggingElement=null},e.setAttribute("draggable","true"),e.ondragover=e=>{var t,i=dom.ancestor(e.target,"li");let n=i.parentElement;i!=this.draggingElement&&((t=this.getItemIndex(i))<this.draggingElementIndex?n.insertBefore(this.draggingElement,i):t>this.draggingElementIndex&&(null==i.nextElementSibling?n.appendChild(this.draggingElement):n.insertBefore(this.draggingElement,i.nextElementSibling)),this.draggingElementIndex=t,e.preventDefault())},e.ondragstart=e=>{let t=dom.ancestor(e.target,"li");t.parentElement,e.layerX;var i=e.layerY,i=e.target.offsetTop+i;this.clonedDraggingElement=t.cloneNode(!0),this.draggingElement=t,this.draggingElement.style.opacity="0.3",this.draggingElementIndex=this.getItemIndex(t),this.draggingElementOriginalIndex=this.draggingElementIndex,e.dataTransfer.setData("id",t.getAttribute("data-list-item-id")),e.dataTransfer.setData("y",i)}},ListView.prototype.getItemIndex=function(t){var i=t.parentElement;for(let e=0;e<i.children.length;e++)if(t==i.children[e])return e},ListView.prototype.setHeight=function(e){let t=this.container.querySelector("ul");t.style.height=e+"px"},ListView.prototype.activate=function(e){let t=this.container.querySelector("ul");for(let e=0;e<t.children.length;e++)t.children[e].classList.remove("active");e.classList.add("active")},ListView.prototype.getCheckedValues=function(){if(!this.onCheck)return[];var e,t;let i=[];for(e of this.container.querySelectorAll("input.checkbox"))!0===e.checked&&(t=dom.ancestor(e,"li"),i.push(dom.model(t)));return i},ListView.prototype.expandSlidingActions=function(t){if(!(t.children[1].getBoundingClientRect().width>=this.slidingActions[0].width.width)){let e=i=>{for(let t=1;t<i.children.length;t++){let e=i.children[t];var n=e.getBoundingClientRect();n.width+5>=this.slidingActions[t-1].width?(e.style.minWidth=this.slidingActions[t-1].width+"px",clearInterval(this.interval4SlidingActions)):e.style.minWidth=n.width+5+"px"}};this.interval4SlidingActions=setInterval(()=>{e(t)},5)}},ListView.prototype.collapseSlidingActions=function(n){n.children[1].getBoundingClientRect().width<=0||(this.interval4SlidingActions=setInterval(()=>{for(let t=1;t<n.children.length;t++){let e=n.children[t];var i=e.getBoundingClientRect();i.width-5<=0?(e.style.width="0",e.style.minWidth="unset",e.style.display="none",clearInterval(this.interval4SlidingActions)):e.style.minWidth=i.width-5+"px"}},10))},ListView.prototype.subscribe=function(e,t){},GridView.prototype.fetch=async function(e){if(!this.url)return this.local;e=await xhr.promise({url:this.url,params:this.params},e);return e&&(this.local=e),this.local},GridView.prototype.root=async function(){let t=dom.element(`
    <div class="row mx-0">
    </div>
  `),i=24/this.columnCount;i<10&&(i="0"+i);for(let e=0;e<this.columnCount;e++){var n=dom.element(`<div class="col-24-${i}"></div>`);t.appendChild(n)}this.local=await this.fetch();for(let e=0;e<this.local.length;e++){var o=this.local[e],s=this.create(e,o),o=e%this.columnCount;t.children[o].appendChild(s)}return t},GridView.prototype.render=async function(e){this.container=dom.find(e),this.container.appendChild(await this.root())},GridView.prototype.appendElement=function(e){for(let e=0;e<this.columnCount;e++);},Timeline.prototype.createTile=function(e,t){var i,n=dom.element(`
    <li class="timeline-item">
      <div class="time"></div>
      <div class="small text-muted"></div>
      <p></p>
    </li>
  `);let o=n.children[0],s=n.children[1],l=n.children[2];return this.fnTitle&&(void 0===(i=this.fnTitle(e,t))?o.innerHTML="":"string"==typeof i||"number"==typeof i?o.innerHTML=i:o.appendChild(i)),this.fnSubtitle&&(void 0===(i=this.fnSubtitle(e,t))?s.innerHTML="":"string"==typeof i||"number"==typeof i?s.innerHTML=i:s.appendChild(i)),this.fnContent&&(void 0===(t=this.fnContent(e,t))?l.innerHTML="":"string"==typeof t||"number"==typeof t?l.innerHTML=t:l.appendChild(t)),n},Timeline.prototype.render=function(e,t){let i=this;this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="",t=t||{};let n=dom.create("ul","timeline-simple");this.container.appendChild(n);e={};if(utils.clone(this.params,e),utils.clone(t,e),this.url)xhr.post({url:this.url,params:e,success:function(e){if(e.data){var t=e.data;for(let e=0;e<t.length;e++)n.appendChild(i.createTile(t[e],e))}}});else for(let e=0;e<i.data.length;e++)n.appendChild(i.createTile(i.data[e],e));i.onComplete&&i.onComplete()},Tabs.prototype.loadPage=function(e,t,i,n){let o=dom.find(`div[data-tab-content-id="${e}"]`);null==o?o=dom.templatize('<div data-tab-content-id="{{id}}"></div>',{id:e}):o.innerHTML="",void 0!==t&&ajax.view({url:t,containerId:o,success:n||function(){}}),!0===i&&(o.style.display="none"),this.content.appendChild(o)},Tabs.prototype.reload=function(e){let i=0,n=this.navigator.children[i];for(let t=1;t<this.navigator.children.length;t++){let e=this.navigator.children[t];if(e.classList.contains(this.tabActiveClass)){i=t-1,n=e;break}}this.loadPage(n.getAttribute("data-tab-id"),n.getAttribute("data-tab-url"),!1,e=>{this.tabs[i].success(e)})},Tabs.prototype.render=function(){let s=this;this.content&&(this.content.innerHTML=""),this.navigator.innerHTML="",this.slider=dom.element('<div class="slider position-absolute"></div>'),this.navigator.appendChild(this.slider),this.tabs.forEach((n,e)=>{n.style=n.style||"padding: 0 16px;",n.style+="min-width: "+(16*n.text.length+32)+"px;text-align: center;";let o=dom.templatize(`
      <div class="nav-item font-weight-bold mr-0 pointer" style="{{style}}"
           data-tab-url="{{{url}}}"
           data-tab-id="{{{id}}}" >{{{text}}}</div>
    `,n);s.navigator.appendChild(o),dom.bind(o,"click",t=>{if(!o.classList.contains(s.tabActiveClass)){for(let t=0;t<s.navigator.children.length;t++){let e=s.navigator.children[t];e.classList.remove(s.tabActiveClass)}if(s.content)for(let e=0;e<s.content.children.length;e++)s.content.children[e].style.display="none";s.activate(o),!0===this.autoClear&&(this.content.innerHTML="");let e=dom.find('div[data-tab-content-id="'+o.getAttribute("data-tab-id")+'"]',s.content);var i;null!=e?e.style.display="":n.onClicked?n.onClicked(t):(i=o.getAttribute("data-tab-id"),t=o.getAttribute("data-tab-url"),s.loadPage(i,t,!1,n.success))}}),!0===s.lazy?0==e&&(s.activate(o),n.onClicked?n.onClicked():s.loadPage(n.id,n.url,!1,n.success)):0==e?(s.activate(o),n.onClicked?n.onClicked():s.loadPage(n.id,n.url,!1,n.success)):n.onClicked?n.onClicked():s.loadPage(n.id,n.url,!0,n.success)})},Tabs.prototype.activate=function(e){e.classList.add(this.tabActiveClass),this.slider.style.width=e.clientWidth+"px",this.slider.style.left=e.offsetLeft+"px"},DataSheet.prototype.root=function(o){o=o||{};let s=this;this.table=dom.create("table","table","table-bordered");let e=dom.create("thead");this.tbody=dom.create("tbody");let t=dom.create("tr"),i=dom.create("th");i.style.borderBottomWidth="0",i.style.width=this.rowHeaderWidth+"px",e.appendChild(t),this.table.appendChild(e),this.table.appendChild(this.tbody);for(let e=0;e<this.columns.length;e++){var n=this.columns[e];i=dom.create("th","text-center"),i.style.borderBottomWidth="0",i.innerHTML=n.title,t.appendChild(i)}for(let n=0;n<this.rowCount;n++){var l=this.rowHeaders[n];let t=dom.create("tr"),i=dom.create("td");i.innerHTML=l.title,i.style.fontWeight="bold",t.appendChild(i);for(let e=0;e<this.columnCount;e++){var a=this.columns[e];i=dom.create("td"),i.style.textAlign="right",i.style.padding="6px 12px",i.setAttribute("data-ds-format",a.format||""),i.setAttribute("data-ds-row",n),i.setAttribute("data-ds-column",e),i.addEventListener("focus",function(){}),o[l.title]&&o[l.title][a.title]?i.innerHTML=o[l.title][a.title]:i.innerHTML="",i.addEventListener("keyup",function(e){var t=parseInt(this.getAttribute("data-ds-row")),i=parseInt(this.getAttribute("data-ds-column"));let n=null;if(13==e.keyCode)n=this;else if(37==e.keyCode){if(0==i)return;n=s.getCell(t,i-1)}else if(38==e.keyCode){if(0==t)return;n=s.getCell(t-1,i)}else if(39==e.keyCode){if(i==s.columnCount-1)return;n=s.getCell(t,i+1)}else if(40==e.keyCode){if(t==s.rowCount-1)return;n=s.getCell(t+1,i)}s.totalize(),null!=n&&(this.blur(),n.focus(),document.execCommand("selectAll",!1,null))}),t.appendChild(i)}this.tbody.appendChild(t)}if(0<this.totalColumns.length){let t=dom.create("tr"),i=dom.create("td");i.innerHTML="合计",i.style.fontWeight="bold",t.appendChild(i);for(let e=0;e<this.columnCount;e++)i=dom.create("td"),t.appendChild(i);this.tbody.appendChild(t)}return this.totalize(),this.table},DataSheet.prototype.getCell=function(t,i){var n=dom.find("tbody",this.table);let o=null;for(let e=0;e<n.children.length;e++){var s=n.children[e];if(e==t){for(let e=1;e<s.children.length;e++)if(e-1==i){o=s.children[e];break}break}}return o},DataSheet.prototype.render=function(e,t){this.container=dom.find(e),this.container.innerHTML="";e=dom.element(`
    <table class="table table-bordered">
      <thead></thead>
      <tbody></tbody>
    </table>
  `);let i=dom.find("thead",e),n=dom.find("tbody",e);this.rowHeaderRowCount,this.colHeaderRowCount;let o=[];for(let e=0;e<this.colHeaderRowCount;e++){var s=dom.create("tr");o.push(s),i.appendChild(s)}for(let i=0;i<this.colHeaderRowCount;i++){let t=o[i];for(let e=0;e<this.colHeaderColumnCount;e++){var l=this.matrixColumn[i][e];if(null!=l){let e=dom.create("th","text-center");e.style="border-bottom-width: 1px;",e.setAttribute("colspan",this.getSpanColumnCount(l)),e.innerHTML=l.title,t.appendChild(e)}}}for(let i=0;i<this.rowHeaderRowCount;i++){let t=dom.create("tr");for(let e=0;e<this.rowHeaderColumnCount;e++){var a=this.matrixRowHeader[e][i];if(null!=a){let i=dom.create("td");i.style="vertical-align: middle;",i.setAttribute("rowspan",this.getSpanRowCount(a)),i.innerHTML="<strong>"+a.title+"</strong>",this.onRowHeaderClicked&&(i.onclick=e=>{let t=Array.prototype.slice.call(i.parentElement.children);this.onRowHeaderClicked(i,t.indexOf(i))}),t.appendChild(i)}}for(let e=0;e<this.colHeaderColumnCount-this.rowHeaderColumnCount;e++){let i=dom.create("td");i.style.textAlign="right",i.style.padding="6px 12px",this.onCellClicked&&(i.onclick=e=>{let t=Array.prototype.slice.call(i.parentElement.children);this.onCellClicked(i,t.indexOf(i))}),t.appendChild(i)}n.appendChild(t)}this.container.appendChild(e)},DataSheet.prototype.getValues=function(){let i={};for(let t=0;t<this.rowHeaders.length;t++){var n=this.rowHeaders[t];i[n.title]={};for(let e=0;e<this.columns.length;e++){var o=this.columns[e];i[n.title][o.title]=this.tbody.rows[t].cells[e+1].innerText.trim()}}return i},DataSheet.prototype.totalize=function(){if(0!=this.totalColumns.length){let e=this.tbody.children[this.tbody.children.length-1];for(let n=0;n<this.columns.length;n++)if(!0===this.columns[n].totalable){let t=0,i=!1;for(let e=0;e<this.rowHeaders.length;e++){var o=parseFloat(this.tbody.rows[e].cells[n+1].innerText.trim());isNaN(o)||(t+=o,i=!0)}isNaN(t)||!0!==i||(e.cells[n+1].innerText=t.toFixed(2))}}},DataSheet.prototype.buildColumnMatrix=function(i,n,o){if(i){let t;n[o]?t=n[o]:(t=[],n.push(t));for(let e=0;e<i.length;e++){var s=i[e];t.push(s);var l=this.getSpanColumnCount(s);for(let e=1;e<l;e++)t.push(null);this.buildColumnMatrix(s.children,n,o+1)}}},DataSheet.prototype.buildRowHeaderMatrix=function(i,n,o){if(i){let t;n[o]?t=n[o]:(t=[],n.push(t));for(let e=0;e<i.length;e++){var s=i[e];t.push(s);var l=this.getSpanRowCount(s);for(let e=1;e<l;e++)t.push(null);this.buildRowHeaderMatrix(s.children,n,o+1)}}},DataSheet.prototype.getSpanColumnCount=function(t){let i=0;if(!t.children||0==t.children.length)return 1;for(let e=0;e<t.children.length;e++)i+=this.getSpanColumnCount(t.children[e]);return i},DataSheet.prototype.getSpanRowCount=function(e){return e.children&&0!=e.children.length?e.children.length:1},DataSheet.prototype.getRowCount=function(t){let i=0;for(let e=0;e<t.length;e++){var n=t[e];i+=1,n.children&&(i+=this.getRowCount(n.children))}return i},DataSheet.prototype.getColumnCount=function(t){let i=0;for(let e=0;e<t.length;e++){var n=t[e];i+=1,n.children&&(i+=this.getColumnCount(n.children))}return i},DataSheet.prototype.getColumnHeaderRowCount=function(i){let n=1;for(let t=0;t<i.length;t++){let e=1;var o=i[t];o.children&&(e+=this.getColumnHeaderRowCount(o.children)),e>n&&(n=e)}return n},DataSheet.prototype.getRowHeaderRowCount=function(t){let i=0;for(let e=0;e<t.length;e++){var n=t[e];n.children?i+=this.getRowHeaderRowCount(n.children):i+=1}return i},DataSheet.prototype.getColumnHeaderColumnCount=function(t){let i=0;for(let e=0;e<t.length;e++){var n=t[e];n.children?i+=this.getColumnHeaderColumnCount(n.children):i+=1}return i},DataSheet.prototype.getRowHeaderColumnCount=function(i){let n=1;for(let t=0;t<i.length;t++){let e=1;var o=i[t];o.children&&(e+=this.getRowHeaderColumnCount(o.children)),e>n&&(n=e)}return n},Chat.MESSAGE_TYPE_TEXT="TEXT",Chat.MESSAGE_TYPE_IMAGE="IMAGE",Chat.MESSAGE_TYPE_AUDIO="AUDIO",Chat.MESSAGE_TYPE_VIDEO="VIDEO",Chat.MESSAGE_TYPE_PATIENT="PATIENT",Chat.MESSAGE_TYPE_CUSTOM="CUSTOM",Chat.MESSAGE_STATUS_UNREAD="01",Chat.MESSAGE_STATUS_READ="02",Chat.MESSAGE_STATUS_REVOKE="90",Chat.prototype.init=async function(e){await this.onInit();this.scheduleName=e;var t=this.userId+"@"+this.userType,i=await xhr.promise({url:this.host+"/api/v3/common/script/tim/user_signature",params:{userId:t}}),e={SDKAppID:i.appId};this.tim=TIM.create(e),this.tim.setLogLevel(1),this.tim.registerPlugin({"tim-upload-plugin":TIMUploadPlugin}),this.tim.login({userID:t,userSig:i.signature}),this.tim.on(TIM.EVENT.SDK_READY,function(e){}),this.tim.on(TIM.EVENT.MESSAGE_RECEIVED,o=>{for(let n=0;n<o.data.length;n++){let e=o.data[n],t=Chat.MESSAGE_TYPE_TEXT,i=null;"TIMCustomElem"===e.type?(i=JSON.parse(e.payload.data).messageContent,i.imagepath?t=Chat.MESSAGE_TYPE_IMAGE:i.audiopath?t=Chat.MESSAGE_TYPE_AUDIO:i.archiveId&&(t=Chat.MESSAGE_TYPE_PATIENT)):i=e.payload.text,this.onMessageReceived({senderId:e.conversationID.substring(3),messageTime:moment(1e3*o.data[n].time).format("YYYY-MM-DD HH:mm"),messageType:t,messageContent:i})}})},Chat.prototype.getConversations=async function(){var e,t=await xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId}});let i={};for(let e=0;e<t.length;e++){var n=t[e],o=n.senderId+"#"+n.senderType;if(i[o]){let e=i[o];e.createTime=n.createTime,e.messages.push(n)}else{let e={messages:[]};i[o]=e,e.id=o,e.createTime=n.createTime,e.name=n.senderType,e.senderId=n.senderId,e.senderType=n.senderType,e.messages.push(n)}}let s=[];for(e in i)s.push(i[e]);return s},Chat.prototype.fetchMessages=async function(e,t,i){let n="";n=e>this.userId?e+"&"+this.userId:this.userId+"&"+e;var o=await xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{conversationId:n,_order_by:"messageTime asc"}});let s=[],l=null;for(let n=0;n<o.length;n++){var a=o[n],r=moment(a.createTime).format("YYYY-MM-DD HH:mm");r!=l&&(l=r,s.push({createTime:r,groupingMessages:[{direction:a.senderId==this.userId?"outgoing":"incoming",messages:[]}]}));let e=s[s.length-1],t=e.groupingMessages[e.groupingMessages.length-1],i="";i=a.senderId==this.userId?"outgoing":"incoming",t.direction===i?t.messages.push(a):e.groupingMessages.push({direction:i,messages:[a]})}return s},Chat.prototype.fetchUnreadMessages=function(){let t=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId,receiverType:this.userType}}).then(e=>{t.onUnreadMessages(e)})},Chat.prototype.sendMessage=async function(e,t,i,n,o){return o=o||this.userId+"&"+e,"string"==typeof n&&(n=n.replace("\\","\\\\")),xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/save",params:{conversationId:o,senderId:this.userId,senderType:this.userType,receiverId:e,receiverType:t,messageType:i,messageTime:"now",messageContent:n,createTime:"now",status:Chat.MESSAGE_STATUS_UNREAD,"||stdbiz/pim/conversation/merge":{conversationId:o,conversationName:o,unreadCount:1,lastConversationTime:"now"}}})},Chat.prototype.sendTextMessage=async function(e,t,i,n){var o=e+"@"+t,n=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_TEXT,i,n),i=this.tim.createTextMessage({to:o,conversationType:TIM.TYPES.CONV_C2C,payload:{id:n.conversationMessageId,text:i}});return this.tim.sendMessage(i)},Chat.prototype.sendImageMessage=async function(e,t,i,n){var o=e+"@"+t,i=await xhr.promise({url:this.host+"/api/v3/common/image",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:i.ext}}),n=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_IMAGE,JSON.stringify({imagepath:i.filepath,thumbnail:i.thumbnail}),n),i=this.tim.createCustomMessage({to:o,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_IMAGE,messageContent:{id:n.conversationMessageId,imagepath:i.filepath,thumbnail:i.thumbnail}})}});return this.tim.sendMessage(i)},Chat.prototype.sendAudioMessage=async function(e,t,i,n){var o=e+"@"+t,i=await xhr.promise({url:this.host+"/api/v3/common/audio",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:"ogg"}}),n=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_AUDIO,JSON.stringify({audiopath:i.filepath,duration:i.duration}),n),i=this.tim.createCustomMessage({to:o,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_AUDIO,messageContent:{id:n.conversationMessageId,audiopath:i.filepath,duration:i.duration}})}});return this.tim.sendMessage(i)},Chat.prototype.sendPatientMessage=async function(e,t,i,n){var o=e+"@"+t,n=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_PATIENT,JSON.stringify(i),n);i.id=n.conversationMessageId;i=this.tim.createCustomMessage({to:o,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_PATIENT,messageContent:i})}});return this.tim.sendMessage(i)},Chat.prototype.readMessages=function(e){let t=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{senderId:e,readTime:"now",status:Chat.MESSAGE_STATUS_READ}}).then(e=>{t.onReadMessages(e)})},Chat.prototype.revokeMessage=function(t){return xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{messageId:t,status:Chat.MESSAGE_STATUS_REVOKE}}).then(e=>{this.onRevokeMessage(t)})},Chat.prototype.stop=function(){schedule.stop(this.scheduleName)},"undefined"!=typeof module&&(module.exports={Chat:Chat}),Sparkline.PADDING=3,Sparkline.prototype.render=function(e){this.container=dom.find(e);var t=this.container.getBoundingClientRect(),i=t.width,e=t.height;let n=0,o=0;for(let e=0;e<this.data.length;e++){var s=parseFloat(this.data[e]);0==n&&(n=s),n>s&&(n=s),o<s&&(o=s)}let l=document.createElement("canvas");l.width=i,l.height=e,this.container.appendChild(l);t=l.getContext("2d");"line"==this.type?this.line(t,o,n,i,e):"bar"==this.type&&this.bar(t,o,n,i,e),this.container.appendChild(l)},Sparkline.prototype.line=function(t,e,i,n,o){var e=Math.abs(e-i),s=(o-2*Sparkline.PADDING)/e,l=n/(this.data.length-1);t.strokeStyle=this.color,t.lineWidth=3,t.beginPath();for(let e=0;e<this.data.length;e++){var a=e*l,r=o-(this.data[e]-i)*s-Sparkline.PADDING;0==e?t.moveTo(a,r):t.lineTo(a,r)}t.stroke()},Sparkline.prototype.bar=function(n,e,t,i,o){Math.abs(e-t);var s=(o-2*Sparkline.PADDING)/e;let l=i/this.data.length-Sparkline.PADDING;n.fillStyle=this.color,n.lineWidth=0,n.beginPath();for(let i=0;i<this.data.length;i++){let e=(l+Sparkline.PADDING)*i,t=o-Sparkline.PADDING-this.data[i]*s;n.rect(e.toFixed(0),t.toFixed(0),l.toFixed(0),(this.data[i]*s).toFixed(0)),n.fill()}},ruler={initPlugin:function(e){let n={el:e.el,height:e.height||60,maxScale:e.maxScale||200,startValue:e.startValue||0,region:e.region||!1,background:e.background||!1,color:e.color||!1,markColor:e.markColor||"#FFCC33",isConstant:e.isConstant||!1,minicolor:e.minicolor||"#f6f6f6",scale:e.scale||1,point:e.point||0};if(!n.el)return console.warn("没有容器元素的参数"),!1;let t=e.el;t.style.height=n.height<50?"50px":n.height+"px",n.maxScale=n.maxScale<50?50:n.maxScale,n.startValue>n.maxScale&&(n.startValue=n.maxScale);let i=0,o=n.maxScale;n.region&&(i=Math.floor(n.region[0]),o=Math.floor(n.region[1]));let s=n.startValue,l=t.offsetWidth,a=l/50,r=[];for(let e=0;e<=n.maxScale;e+=10)r.push((e/n.scale).toFixed(n.point));let d=t.getElementsByTagName("canvas")[0];d||(d=document.createElement("canvas"),d.width=l,d.height=n.height,t.appendChild(d));let c=d.getContext("2d");function u(i){i-=25,c.clearRect(0,0,l,n.height),n.background&&(c.fillStyle=n.background,c.fillRect(0,0,d.width,n.height));for(let e=0;e<n.maxScale;e++)c.beginPath(),c.save(),c.strokeStyle=n.minicolor||"#F6F6F6",c.lineWidth=1,c.lineCap="round",c.moveTo(a*e-i*a,0),c.lineTo(a*e-i*a,Math.floor(.3*n.height)),e%5==0&&(c.strokeStyle=n.color||"#999",c.lineTo(a*e-i*a,Math.floor(.35*n.height))),e%10==0&&(c.strokeStyle=n.color||"#666",c.lineTo(a*e-i*a,Math.floor(.52*n.height))),c.stroke(),c.restore(),c.closePath();c.beginPath(),c.font="14px Arial",c.fillStyle=n.color||"#333",c.textAlign="center",c.textBaseline="middle",r.forEach(function(e,t){c.fillText(e.toString(),a*t*10-i*a,Math.floor(.78*n.height))}),c.closePath(),c.beginPath(),c.save(),c.strokeStyle=n.markColor,c.lineWidth=2,c.lineCap="round",c.moveTo(l/2,0),c.lineTo(l/2,Math.floor(.52*n.height)),c.stroke(),c.restore(),c.closePath()}window.devicePixelRatio&&(d.width=window.devicePixelRatio*l,d.height=window.devicePixelRatio*n.height,c.scale(window.devicePixelRatio,window.devicePixelRatio)),window.devicePixelRatio&&(d.style.transform="scale("+1/window.devicePixelRatio+")",d.style.transformOrigin="left top"),u(s);let h=0,p=0,m=0,f=0,g=s;if(!d)return!1;d.addEventListener("touchstart",function(e){h=e.targetTouches[0].pageX},!1),d.addEventListener("touchmove",function(e){p=e.targetTouches[0].pageX,y()},!1),d.addEventListener("touchend",function(e){g=s,b()},!1);let v=!1;function y(){m=Math.floor((p-h)/(l/50)),m!==f&&(f=m,s=g+m,(s>=n.maxScale||s<=0)&&(s=s>=n.maxScale?n.maxScale:0),u(s),n.isConstant&&e.success&&e.success(s))}function b(){s>o?g=s=s>o?o:s:s<i&&(g=s=s<i?i:s),u(s),e.success&&e.success(s)}d.addEventListener("mousedown",function(e){v=!0,h=e.layerX},!1),d.addEventListener("mousemove",function(e){return!!v&&(p=e.layerX,void y())},!1),d.addEventListener("mouseup",function(e){g=s,v=!1,b()},!1),d.addEventListener("mouseleave",function(e){v&&(g=s,v=!1,b())},!1)}},MobileWizard.prototype.render=function(e,t){this.container=dom.find(e),this.content=dom.find("div.wizard-content",this.root);let n=dom.find("div.wizard-progress",this.root);for(let i=0;i<this.steps.length;i++){let e=this.steps[i];var o=i+1;let t=dom.element(`
      <div class="step-${o}" widget-on-render="" data-step="${i}" style="cursor: pointer;">
        <strong class="title"></strong>
      </div>
    `);e.index=i,t.style.width=100/this.steps.length+"%",!0===e.active&&(this.current=e),dom.find("strong.title",t).innerHTML=e.title,n.appendChild(t)}this.container.appendChild(this.root),this.display(this.current)},MobileWizard.prototype.display=function(e){let t=dom.find('div[data-step="'+e.index+'"]',this.root);t.classList.remove("completed"),t.classList.add("active"),e.onClicked||kuim.navigateWidget(e.url,this.content,{wizard:this})},MobileWizard.prototype.commit=function(e){let t=dom.find("div.active",this.root);var i=parseInt(t.getAttribute("data-step"));t.classList.remove("active"),t.classList.add("completed"),this.display(this.steps[i+1])},MobileWizard.prototype.rollback=function(){let e=dom.find("div.step.active",this.container);var t=parseInt(e.getAttribute("data-step"));e.classList.remove("active"),this.display(this.steps[t-1])},MobileForm.prototype.render=async function(e){e.innerHTML="";var t=await this.root();e.appendChild(t)},MobileForm.prototype.root=async function(){let i=dom.element(`
    <div class="form form-horizontal"></div>
  `);for(let t=0;t<this.fields.length;t++){var n=this.fields[t];let e=null;"date"===n.input?e=this.buildDate(n):"time"===n.input?e=this.buildTime(n):"bool"===n.input?e=this.buildSwitch(n):"radio"===n.input?e=await this.buildRadio(n):"check"===n.input?e=await this.buildCheck(n):"select"===n.input?e=await this.buildSelect(n):"hidden"===n.input?e=dom.templatize(`
        <input type="hidden" name="{{name}}">
      `,n):"mobile"===n.input?e=this.buildMobile(n):"id"===n.input?e=this.buildId(n):"district"===n.input?e=this.buildDistrict(n):"ruler"===n.input?e=this.buildRuler(n):"images"===n.input?e=this.buildImages(n):"longtext"===n.input?(e=dom.templatize(`
        <div class="form-group row">
          <label class="col-form-label col-24-06">{{title}}</label>
          <div class="col-24-18">
            <textarea type="text" name="{{name}}" class="form-control" placeholder="请填写"></textarea>
          </div>
        </div>
      `,n),!0===this.readonly&&(dom.find("textarea",e).setAttribute("placeholder",""),dom.find("textarea",e).setAttribute("readonly",!0))):(e=dom.templatize(`
        <div class="form-group row">
          <label class="col-form-label col-24-06">{{title}}</label>
          <div class="col-24-18 d-flex">
            <input type="text" name="{{name}}" class="form-control" placeholder="请填写">
            {{#if unit}}
            <span class="ml-auto text-muted small mr-2 mt-2">{{unit}}</span>
            {{/if}}
          </div>
        </div>
      `,n),!0===this.readonly&&(dom.find("input",e).setAttribute("placeholder",""),dom.find("input",e).setAttribute("readonly",!0))),i.appendChild(e)}return i},MobileForm.prototype.buildDate=function(t){let e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" class="form-control" readonly placeholder="请选择...">
        <input type="hidden" name="{{name}}">
        <span class="ml-auto material-icons font-16 position-relative" style="top: 5px; left: -2px;">calendar_today</span>
      </div>
    </div>
  `,t);return!0===this.readonly?e.querySelectorAll("input")[0].setAttribute("placeholder",""):dom.bind(e,"click",i=>{let e=new Rolldate({title:t.title,confirm:e=>{var t=dom.ancestor(i.target,"div","col-24-18");dom.find("input[type=text]",t).value=moment(e).format("YYYY年MM月DD日"),dom.find("input[type=hidden]",t).value=moment(e).format("YYYY-MM-DD HH:mm:ss")}});e.show()}),e},MobileForm.prototype.buildTime=function(t){let e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" class="form-control" readonly placeholder="请选择...">
        <input type="hidden" name="{{name}}">
        <span class="ml-auto material-icons font-16 position-relative" style="top: 5px; left: -2px;">schedule</span>
      </div>
    </div>
  `,t);return!0===this.readonly?e.querySelectorAll("input")[0].setAttribute("placeholder",""):dom.bind(e,"click",i=>{let e=new Rolldate({title:t.title,confirm:e=>{var t=dom.ancestor(i.target,"div","col-24-18");dom.find("input[type=text]",t).value=moment(e).format("YYYY年MM月DD日"),dom.find("input[type=hidden]",t).value=moment(e).format("YYYY-MM-DD HH:mm:ss")}});e.show()}),e},MobileForm.prototype.buildSwitch=function(e){return dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex pr-3 pl-3">
        <label class="c-switch c-switch-label c-switch-pill c-switch-info mt-1" style="min-width: 48px;">
        <input class="c-switch-input" value="T" name="{{name}}" type="checkbox">
        <span class="c-switch-slider" data-checked="是" data-unchecked="否"></span>
      </label>
      </div>
    </div>
  `,e)},MobileForm.prototype.buildRadio=async function(e){let t=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 input-group pr-3 pl-3"></div>
    </div>
  `,e);if(!0===this.readonly)return t.children[1].innerText=e.text||"",t;for(var i of e.options.values){i.checked=i.checked||!1;i=dom.templatize(`
      <div class="form-check form-check-inline">
        <input name="{{name}}" value="{{value}}" {{#if checked}}checked{{/if}} type="radio" class="form-check-input radio color-primary is-outline">
        <label class="form-check-label" for="">{{text}}</label>
      </div>
    `,{...i,name:e.name});t.children[1].appendChild(i)}return t},MobileForm.prototype.buildCheck=async function(e){let t=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 input-group pr-3 pl-3"></div>
    </div>
  `,e);if(!0===this.readonly)return t.children[1].innerText=e.text||"",t;for(var i of e.options.values){i.checked=i.checked||!1;i=dom.templatize(`
      <div class="form-check form-check-inline">
        <input name="{{name}}" value="{{value}}" {{#if checked}}checked{{/if}} type="checkbox" class="form-check-input checkbox color-primary is-outline">
        <label class="form-check-label" for="">{{text}}</label>
      </div>
    `,{...i,name:e.name});t.children[1].appendChild(i)}return t},MobileForm.prototype.buildSelect=async function(t){let e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" class="form-control" readonly placeholder="请选择...">
        <input type="hidden" name="{{name}}">
        <span class="ml-auto material-icons font-20 position-relative" style="top: 3px;">expand_more</span>
      </div>
    </div>
  `,t);if(!0===this.readonly)return e.querySelectorAll("input")[0].setAttribute("placeholder",""),e;let n=t.values;if(!n&&t.url){var i=await xhr.promise({url:t.url,params:{}});n=[];for(let e=0;e<i.length;e++)n.push({text:i[e][t.textField],value:i[e][t.valueField]})}return dom.bind(e,"click",i=>{let e=new Rolldate({title:t.title,format:"oo",values:n,confirm:e=>{var t=dom.ancestor(i.target,"div","col-24-18");dom.find("input[type=text]",t).value=e.text,dom.find("input[type=hidden]",t).value=e.value}});e.show()}),e},MobileForm.prototype.buildMobile=function(e){e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请输入...">
      </div>
    </div>
  `,e);let t=dom.find("input",e);return!0===this.readonly?t.setAttribute("placeholder",""):dom.bind(e,"click",e=>{new Numpad({type:"mobile",success:e=>{t.value=e}}).show(document.body)}),e},MobileForm.prototype.buildId=function(e){e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请输入...">
      </div>
    </div>
  `,e);let t=dom.find("input",e);return!0===this.readonly?t.setAttribute("placeholder",""):dom.bind(e,"click",e=>{new Numpad({type:"id",success:e=>{t.value=e}}).show(document.body)}),e},MobileForm.prototype.buildDistrict=function(e){e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请选择...">
        <span class="ml-auto material-icons font-20 position-relative" style="top: 3px;">expand_more</span>
      </div>
    </div>
  `,e);let i=dom.find("input",e);return!0===this.readonly?i.setAttribute("placeholder",""):dom.bind(e,"click",e=>{new DistrictPicker({type:"id",success:e=>{let t="";e.province&&(t+=e.province.chineseDistrictName),e.city&&(t+=" "+e.city.chineseDistrictName),e.county&&(t+=" "+e.county.chineseDistrictName),e.town&&(t+=" "+e.town.chineseDistrictName),i.value=t,i.setAttribute("data-value",JSON.stringify(e))}}).show(document.body)}),e},MobileForm.prototype.buildRuler=function(e){e=dom.templatize(`
    <div class="form-group row">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <input type="text" name="{{name}}" class="form-control" readonly placeholder="请选择...">
        {{#if unit}}
        <span class="ml-auto text-muted small mr-2 mt-2">{{unit}}</span>
        {{/if}}
        <span class="ml-auto material-icons font-20 position-relative" style="top: 3px;">straighten</span>
      </div>
    </div>
  `,e);let t=dom.find("input",e);return!0===this.readonly?t.setAttribute("placeholder",""):dom.bind(e,"click",e=>{}),e},MobileForm.prototype.buildImages=function(e){return dom.templatize(`
    <div class="form-group row pb-2">
      <label class="col-form-label col-24-06">{{title}}</label>
      <div class="col-24-18 d-flex">
        <div class="d-flex align-items-center justify-content-center" 
             style="height: 80px; width: 80px; border: 1px solid #eee;">
          <i class="fas fa-plus" style="color: #bbb;"></i>
        </div>
      </div>
    </div>
  `,e)},Numpad.prototype.root=function(){let e=dom.templatize(`
    <div class="popup-container">
      <div class="popup-mask"></div>
      <div class="popup-bottom numpad in">
        <div class="popup-title">
          <button class="cancel">取消</button>
          <span class="value"></span>
          <span class="unit">{{unit}}</span>
          <button class="confirm">确认</button>
        </div>
        <div class="d-flex flex-wrap full-width">
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">1</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">2</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">3</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">4</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">5</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">6</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">7</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">8</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">9</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button widget-id="buttonSpecial" class="number">.</button>
          </div>
          <div class="col-24-08" style="line-height: 48px;">
            <button class="number">0</button>
          </div>
          <div class="col-24-08" style="line-height: 48px; font-size: 24px;">
            <button class="number">
              <i class="fas fa-backspace" style="font-size: 20px;"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  `,this);this.bottom=dom.find(".popup-bottom",e);var t=dom.find(".popup-mask",e),i=dom.find(".confirm",e),n=dom.find(".cancel",e);let o=dom.find(".value",e),s=dom.find("[widget-id=buttonSpecial]",e);"id"==this.type?(s.innerText="X",this.regex=/^.{0,18}$/):"mobile"==this.type&&(s.remove(),this.regex=/^.{0,11}$/);var l=e.querySelectorAll(".number");for(let e=0;e<l.length;e++){var a=l[e];dom.bind(a,"click",e=>{let t=o.innerText;e=e.currentTarget.innerText;if(""==e){if(""===t)return;t=t.substr(0,t.length-1)}else this.regex.test(t+e)&&(t+=e);o.innerText=t})}return dom.bind(t,"click",e=>{e.stopPropagation(),e.preventDefault(),this.close()}),dom.bind(n,"click",e=>{this.close()}),dom.bind(i,"click",e=>{this.success(o.innerText),this.close()}),e},Numpad.prototype.show=function(e){e.appendChild(this.root())},Numpad.prototype.close=function(){this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(()=>{this.bottom.parentElement.remove()},300)},DistrictPicker.prototype.root=function(){var e=dom.templatize(`
    <div class="popup-container">
      <div class="popup-mask"></div>
      <div class="popup-bottom district-picker">
        <div class="popup-title">
          <button class="cancel">取消</button>
          <span class="value"></span>
          <span class="unit">{{unit}}</span>
          <button class="confirm">确认</button>
        </div>
        <div class="bottom-dialog-body">
          <div style="padding: 4px 16px">
            <div class="d-flex" style="line-height: 40px;">
              <strong widget-id="widgetProvince" class="font-16">选择省份</strong>
              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>
            </div>
            <div class="d-flex" style="line-height: 40px;">
              <strong widget-id="widgetCity" class="font-16">选择城市</strong>
              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>
            </div>
            <div class="d-flex" style="line-height: 40px;">
              <strong widget-id="widgetCounty" class="font-16">选择区县</strong>
              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>
            </div>
            <div class="d-flex" style="line-height: 40px;">
              <strong widget-id="widgetTown" class="font-16">选择街道/乡镇</strong>
              <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>
            </div>
          </div>
          <div style="border-top: 1px solid var(--color-divider);"></div>
          <ul widget-id="widgetDistrict" class="list-group" style="height: 240px; overflow-y: auto;">
          </ul>
        </div>
      </div>
    </div>
  `,this);this.bottom=dom.find(".popup-bottom",e),this.district=dom.find("[widget-id=widgetDistrict]",e),this.province=dom.find("[widget-id=widgetProvince]",e),this.city=dom.find("[widget-id=widgetCity]",e),this.county=dom.find("[widget-id=widgetCounty]",e),this.town=dom.find("[widget-id=widgetTown]",e);var t=dom.find(".popup-mask",e),i=dom.find(".confirm",e),n=dom.find(".cancel",e);dom.find(".value",e);dom.bind(t,"click",e=>{this.close()}),dom.bind(n,"click",e=>{this.close()}),this.selections.province&&(this.province.setAttribute("data-model-chinese-district-code",this.selections.province.chineseDistrictCode),this.province.innerText=this.selections.province.chineseDistrictName),this.selections.city&&(this.city.setAttribute("data-model-chinese-district-code",this.selections.city.chineseDistrictCode),this.city.innerText=this.selections.city.chineseDistrictName),this.selections.county&&(this.county.setAttribute("data-model-chinese-district-code",this.selections.county.chineseDistrictCode),this.county.innerText=this.selections.county.chineseDistrictName),this.selections.town&&(this.town.setAttribute("data-model-chinese-district-code",this.selections.town.chineseDistrictCode),this.town.innerText=this.selections.town.chineseDistrictName),dom.bind(i,"click",e=>{let t={};var i=this.province.getAttribute("data-model-chinese-district-code"),n=this.city.getAttribute("data-model-chinese-district-code"),o=this.county.getAttribute("data-model-chinese-district-code"),s=this.town.getAttribute("data-model-chinese-district-code");""!=i&&(t.province={chineseDistrictCode:i,chineseDistrictName:this.province.innerText}),""!=n&&(t.city={chineseDistrictCode:n,chineseDistrictName:this.city.innerText}),""!=o&&(t.county={chineseDistrictCode:o,chineseDistrictName:this.county.innerText}),""!=s&&(t.town={chineseDistrictCode:s,chineseDistrictName:this.town.innerText}),this.success(t),this.close()});let o=e=>{e=dom.ancestor(e.target,"div");let t=dom.find("strong",e),i=t.getAttribute("data-model-chinese-district-code");9==i.length?this.renderDistrict(i.substr(0,6)):this.renderDistrict(i.substr(0,i.length-2))};return dom.bind(this.province.parentElement,"click",e=>{o(e)}),dom.bind(this.city.parentElement,"click",e=>{o(e)}),dom.bind(this.county.parentElement,"click",e=>{o(e)}),dom.bind(this.town.parentElement,"click",e=>{o(e)}),setTimeout(()=>{this.bottom.classList.add("in")},50),e},DistrictPicker.prototype.renderDistrict=async function(e){let t=null,i=null;if(e)if(2==e.length)t=`
      and length(chndistcd) = 4 and substring(chndistcd, 1, 2) = '${e}'
    `,i=this.city,this.county.setAttribute("data-model-chinese-district-code",""),this.county.innerText="选择区县",this.town.setAttribute("data-model-chinese-district-code",""),this.town.innerText="选择街道/乡镇";else if(4==e.length)t=`
      and length(chndistcd) = 6 and substring(chndistcd, 1, 4) = '${e}'
    `,i=this.county,this.town.setAttribute("data-model-chinese-district-code",""),this.town.innerText="选择街道/乡镇";else{if(6!=e.length)return;t=`
      and length(chndistcd) = 9 and substring(chndistcd, 1, 6) = '${e}'
    `,i=this.town}else t=`
      and length(chndistcd) = 2
    `,i=this.province,this.city.setAttribute("data-model-chinese-district-code",""),this.city.innerText="选择城市",this.county.setAttribute("data-model-chinese-district-code",""),this.county.innerText="选择区县",this.town.setAttribute("data-model-chinese-district-code",""),this.town.innerText="选择街道/乡镇";var n=await xhr.promise({url:"/api/v3/common/script/stdbiz/gb/chinese_district/find",params:{_and_condition:t,_order_by:"convert(chndistnm using gbk) asc"}});this.district.innerHTML="";for(let e=0;e<n.length;e++){var o=n[e],s=dom.templatize(`
      <li class="list-group-item">{{chineseDistrictName}}</li>
    `,o);dom.model(s,o),dom.bind(s,"click",e=>{e=dom.ancestor(e.target,"li"),e=dom.model(e);i.innerText=e.chineseDistrictName,i.setAttribute("data-model-chinese-district-code",e.chineseDistrictCode),this.renderDistrict(e.chineseDistrictCode)}),this.district.appendChild(s)}},DistrictPicker.prototype.show=function(e){e.appendChild(this.root()),this.renderDistrict()},DistrictPicker.prototype.close=function(){this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(()=>{this.bottom.parentElement.remove()},300)},Calendar.prototype.root=function(){let s=dom.templatize(`
    <div class="calendar">
      <div class="title"></div>
      <div class="weekdays" style="position: sticky; top: 0;z-index: 10;">
        <div class="weekday">日</div>
        <div class="weekday">一</div>
        <div class="weekday">二</div>
        <div class="weekday">三</div>
        <div class="weekday">四</div>
        <div class="weekday">五</div>
        <div class="weekday">六</div>
      </div>
      <div class="swiper">
        <div class="swiper-wrapper">
          <div class="prev swiper-slide"></div>
          <div class="curr swiper-slide"></div>
          <div class="next swiper-slide"></div>
        </div>
      </div>
    </div>
  `,{});this.widgetSwiper=dom.find(".swiper",s),this.title=dom.find(".title",s);var e=dom.find(".prev",s),t=dom.find(".curr",s),i=dom.find(".next",s);this.renderMonth(e,moment(this.currentMonth).subtract(1,"months").startOf("month")),this.renderMonth(t,this.currentMonth),this.renderMonth(i,moment(this.currentMonth).add(1,"months").startOf("month"));let n=new Swiper(this.widgetSwiper,{speed:400,initialSlide:this.currentIndex,loop:!0});return n.on("slideChange",e=>{0==e.realIndex?1==this.currentIndex?this.currentMonth=moment(this.currentMonth).subtract(1,"months"):2==this.currentIndex&&(this.currentMonth=moment(this.currentMonth).add(1,"months")):1==e.realIndex?0==this.currentIndex?this.currentMonth=moment(this.currentMonth).add(1,"months"):2==this.currentIndex&&(this.currentMonth=moment(this.currentMonth).subtract(1,"months")):2==e.realIndex&&(0==this.currentIndex?this.currentMonth=moment(this.currentMonth).subtract(1,"months"):1==this.currentIndex&&(this.currentMonth=moment(this.currentMonth).add(1,"months"))),this.currentIndex=e.realIndex;var t=moment(this.currentMonth).subtract(1,"months"),i=moment(this.currentMonth).add(1,"months");let n=null,o=null;0==this.currentIndex?(n=s.querySelectorAll(".next"),o=s.querySelectorAll(".curr")):1==this.currentIndex?(n=s.querySelectorAll(".prev"),o=s.querySelectorAll(".next")):2==this.currentIndex&&(n=s.querySelectorAll(".curr"),o=s.querySelectorAll(".prev"));for(let e=0;e<n.length;e++)this.renderMonth(n[e],t);for(let e=0;e<o.length;e++)this.renderMonth(o[e],i)}),s},Calendar.prototype.renderMonth=function(i,n){var o=n.startOf("month").day(),e=n.daysInMonth();i.innerHTML="";let s=null;for(let t=0;t<e+o;t++){t%7==0&&(s=dom.create("div","dates"));let e=dom.element('<div class="date"></div>');var l=t-o+1;t>=o&&(e.innerHTML=l);l=n.format("YYYY-MM-")+(l<10?"0"+l:l);l==this.today.format("YYYY-MM-DD")&&e.classList.add("today"),e.setAttribute("data-calendar-date",l),s.appendChild(e),t%7==6&&(i.appendChild(s),s=null)}null!=s&&i.appendChild(s);var t=7-(e+o)%7;for(let e=0;e<t;e++){var a=dom.element('<div class="date"></div>');i.appendChild(a)}this.title.innerText=this.currentMonth.format("YYYY年MM月")},Calendar.prototype.stylizeDates=function(i,n,t){let o=dom.find(".dates.curr",this.root);if(Array.isArray(n)){for(let t=0;t<n.length;t++)for(let e=0;e<o.children.length;e++)if(moment(n[t]).format("YYYY-MM-DD")==o.children[e].getAttribute("data-calendar-date")){o.children[e].style=i;break}}else{n=moment(n).format("YYYY-MM-DD"),t=moment(t).format("YYYY-MM-DD");for(let e=0;e<o.children.length;e++){var s=o.children[e].getAttribute("data-calendar-date");n<=s&&s<=t&&(o.children[e].style=i)}}},Calendar.prototype.render=function(e,t){this.root=this.root();let i=dom.find(e);i.innerHTML="",i.appendChild(this.root)},CascadePicker.prototype.root=function(){var e=dom.templatize(`
    <div class="popup-container">
      <div class="popup-mask"></div>
      <div class="popup-bottom district-picker">
        <div class="popup-title">
          <button class="cancel">取消</button>
          <span class="value"></span>
          <span class="unit">{{unit}}</span>
          <button class="confirm">确认</button>
        </div>
        <div>
          <div widget-id="widgetLevel" style="padding: 4px 16px">
          </div>
          <div style="border-top: 1px solid var(--color-divider);"></div>
          <ul widget-id="widgetValue" class="list-group" style="height: 240px; overflow-y: auto;">
          </ul>
        </div>
      </div>
    </div>
  `,this);this.bottom=dom.find(".popup-bottom",e),this.widgetLevel=dom.find("[widget-id=widgetLevel]",e),this.widgetValue=dom.find("[widget-id=widgetValue]",e);var t=dom.find(".popup-mask",e),i=dom.find(".confirm",e),n=dom.find(".cancel",e);let o=e=>{var t=dom.ancestor(e.target,"div");let i=dom.find("strong",t);var n=parseInt(i.getAttribute("data-cascade-level"));i.getAttribute("data-cascade-value"),i.getAttribute("data-cascade-name");let o=null,s=dom.find('[data-cascade-level="'+(n-1)+'"]',this.widgetLevel);null!=s&&(e=s.getAttribute("data-cascade-value"),t=s.getAttribute("data-cascade-name"),o={},o[t]=e),this.renderValue(n,o);for(let t=n+1;t<this.levels.length;t++){let e=dom.find('[data-cascade-level="'+t+'"]',this.widgetLevel);e.setAttribute("data-cascade-value",""),e.innerText=this.levels[t].placeholder}};for(let e=0;e<this.levels.length;e++){var s=dom.templatize(`
      <div class="d-flex" style="line-height: 40px;">
        <strong data-cascade-level="${e}" data-cascade-name="{{name}}" class="font-16">{{placeholder}}</strong>
        <span class="ml-auto material-icons font-18 position-relative" style="top: 12px;">navigate_next</span>
      </div>
    `,this.levels[e]);this.widgetLevel.appendChild(s),dom.bind(s,"click",e=>{o(e)})}return dom.bind(t,"click",e=>{this.close()}),dom.bind(n,"click",e=>{this.close()}),dom.bind(i,"click",e=>{var i=dom.find("strong",this.widgetLevel);let n={};for(let t=0;t<i.length;t++){let e=i[t];var o=dom.model(e);n[e.getAttribute("data-cascade-name")]=o}this.success(n),this.close()}),setTimeout(()=>{this.bottom.classList.add("in")},50),e},CascadePicker.prototype.renderValue=async function(n,e,t){let o=dom.find('[data-cascade-level="'+n+'"]',this.widgetLevel);if(null!=o){let i=this.levels[n];if(this.widgetValue.innerHTML="",i.url){e="function"==typeof i.params?i.params(e):i.params;var s=await xhr.promise({url:i.url,params:e});for(let e=0;e<s.length;e++){var l={value:s[e][i.fields.value],text:s[e][i.fields.text]},l=dom.templatize(`
      <li class="list-group-item" data-cascade-value="{{value}}">{{text}}</li>
    `,l);dom.model(l,s[e]),dom.bind(l,"click",e=>{e=dom.ancestor(e.target,"li"),e=dom.model(e);o.innerText=e[i.fields.text],o.setAttribute("data-cascade-value",e[i.fields.value]),dom.model(o,e);let t={};t[i.fields.value]=e[i.fields.value],this.renderValue(n+1,t,e)}),this.widgetValue.appendChild(l)}}}},CascadePicker.prototype.show=function(e){e.appendChild(this.root()),this.renderValue(0)},CascadePicker.prototype.close=function(){this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(()=>{this.bottom.parentElement.remove()},300)},ActionSheet.prototype.root=function(){var e=dom.templatize(`
    <div class="popup-container">
      <div class="popup-mask"></div>
      <div class="popup-bottom" style="background: transparent;">
        <div class="action-sheet">
          <div class="title">{{title}}</div>
          <div class="actions"></div>
          <div class="cancel">取消</div>
        </div>
      </div>
    </div>
  `,this);this.bottom=dom.find(".popup-bottom",e);var t=dom.find(".cancel",e),i=dom.find(".popup-mask",e);let n=dom.find(".actions",e);dom.bind(i,"click",e=>{this.close()}),dom.bind(t,"click",e=>{this.close()});for(let t=0;t<this.actions.length;t++){let e=dom.templatize(`
      <div class="action">{{text}}</div>
    `,this.actions[t]);dom.bind(e,"click",e=>{this.close(),this.actions[t].onClick(e)}),t==this.actions.length-1&&e.classList.add("last"),n.appendChild(e)}return this.bottom.classList.add("in"),setTimeout(()=>{this.bottom.style.bottom="0"},300),e},ActionSheet.prototype.show=function(e){e.appendChild(this.root())},ActionSheet.prototype.close=function(){this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(()=>{this.bottom.parentElement.remove()},300)},Weekdays.prototype.root=function(){let s=dom.templatize(`
    <div class="swiper weekly">
      <div class="swiper-wrapper">
      </div>
    </div>
  `,{}),l=dom.find(".swiper-wrapper",s);for(let o=0;o<this.days;o++){let e=moment(this.today).add(o,"days"),t=e.day();t=1==t?"一":2==t?"二":3==t?"三":4==t?"四":5==t?"五":6==t?"六":"日";let i=dom.element('<div class="swiper-slide d-flex" style="width: calc(100% / 7)"></div>'),n=dom.templatize(`
      <div class="weekday pb-2" data-date="{{fulldate}}">
        <span class="day">{{day}}</span>
        <span class="date">{{date}}</span>
      </div>
    `,{day:t,date:e.format("DD"),fulldate:e.format("YYYY-MM-DD")});0==o&&n.classList.add("active"),i.appendChild(n),l.appendChild(i),dom.bind(n,"click",e=>{let t=s.querySelectorAll(".weekday");t.forEach(e=>{e.classList.remove("active")}),n.classList.add("active")})}new Swiper(s,{speed:400,slidesPerView:7,loop:!1});return s},Weekdays.prototype.render=function(e){let t=dom.find(e);t.appendChild(this.root())},PopupRuler.prototype.root=function(){var e=dom.templatize(`
    <div class="popup-container">
      <div class="popup-mask"></div>
      <div class="popup-bottom in">
        <div class="popup-title">
          <button class="cancel">取消</button>
          <span class="value"></span>
          <span class="unit">{{unit}}</span>
          <button class="confirm">确认</button>
        </div>
        <div class="popup-content" style="height: 200px; width: 100%;"></div>
      </div>
    </div>
  `,this);this.bottom=dom.find(".popup-bottom",e);var t=dom.find(".popup-mask",e),i=dom.find(".confirm",e),n=dom.find(".cancel",e);let o=dom.find(".value",e);return dom.bind(t,"click",e=>{e.stopPropagation(),e.preventDefault(),this.close()}),dom.bind(n,"click",e=>{this.close()}),dom.bind(i,"click",e=>{this.success(o.innerText),this.close()}),e},PopupRuler.prototype.show=function(e){var t=this.root();e.appendChild(t);e=dom.find(".popup-content",t);let i=dom.find(".value",t);i.innerText=this.value,ruler.initPlugin({el:e,startValue:this.value,maxScale:this.range[1],region:[this.range[0],this.range[1]],background:"#fff",color:"#E0E0E0",markColor:"#73B17B",isConstant:!0,success:e=>{i.innerText=e}})},PopupRuler.prototype.close=function(){this.bottom.classList.remove("in"),this.bottom.classList.add("out"),setTimeout(()=>{this.bottom.parentElement.remove()},300)},"undefined"!=typeof Handlebars&&Handlebars.registerHelper("ifeq",function(e,t,i){return e==t?i.fn(this):i.inverse(this)}),"undefined"==typeof kuim&&(kuim={}),kuim={routedPages:[],presentPageObj:null,navigateTo:async function(t,i,n){clearTimeout(kuim.delayToLoad),void 0===n&&(n=!1);let o=document.querySelector("main");kuim.presentPageObj&&(kuim.presentPageObj.page.classList.remove("in"),kuim.presentPageObj.page.classList.add("out")),kuim.delayToLoad=setTimeout(async()=>{kuim.presentPageObj&&(kuim.presentPageObj.page.parentElement.style.display="none"),kuim.presentPageObj&&!1!==n&&(kuim.presentPageObj.page.parentElement.remove(),kuim.presentPageObj.destroy&&kuim.presentPageObj.destroy(),delete kuim.presentPageObj);var e=await xhr.asyncGet({url:t+(-1==t.indexOf("?")?"?":"&")+(new Date).getTime()},"GET");kuim.reload(o,t,e,i)},400)},navigateWidget:function(t,i,n){clearTimeout(kuim.delayToLoad),kuim.delayToLoad=setTimeout(()=>{i.children[0]&&(i.children[0].classList.remove("in"),i.children[0].classList.add("out")),setTimeout(async()=>{i.innerHTML="";var e=await xhr.asyncGet({url:t},"GET");kuim.replace(i,t,e,n)},400)},200)},navigateBack:function(e){clearTimeout(kuim.delayToLoad),kuim.delayToLoad=setTimeout(()=>{var e=document.querySelector("main");let t=e.children[e.children.length-2];kuim.presentPageObj.page.classList.remove("in"),kuim.presentPageObj.page.classList.add("out"),setTimeout(()=>{kuim.presentPageObj.page.parentElement.remove(),kuim.presentPageObj.destroy&&kuim.presentPageObj.destroy(),delete kuim.presentPageObj,t.style.display="",kuim.presentPageObj=window[t.getAttribute("kuim-page-id")],kuim.presentPageObj.page.classList.remove("out"),kuim.presentPageObj.page.classList.add("in"),kuim.setTitleAndIcon(t.getAttribute("kuim-page-title"),t.getAttribute("kuim-page-icon"))},400)},200)},reload:function(e,t,i,n){n=n||{};let o=dom.element('<div style="height: 100%; width: 100%;"></div>'),s=document.createRange();i=s.createContextualFragment(i);o.appendChild(i);let l=dom.find("[id^=page]",o);i=l.getAttribute("id");e.appendChild(o),o.setAttribute("kuim-page-id",i),o.setAttribute("kuim-page-url",t),n.title&&(o.setAttribute("kuim-page-title",n.title),o.setAttribute("kuim-page-icon",n.icon||"")),kuim.presentPageObj=window[i],kuim.presentPageObj.page.classList.add("in");t=utils.getParameters(t);kuim.presentPageObj.show(t),kuim.setTitleAndIcon(n.title,n.icon),n.success&&n.success()},replace:function(e,t,i,n){n=n||{};let o=dom.element('<div style="height: 100%; width: 100%;"></div>'),s=document.createRange();i=s.createContextualFragment(i);e.appendChild(i);let l=dom.find("[id^=page]",e);var a=l.getAttribute("id");n.title&&(o.setAttribute("kuim-page-title",n.title),o.setAttribute("kuim-page-icon",n.icon||"")),l.classList.add("in");var r,t=utils.getParameters(t);for(r in window[a].show(t),n)window[a][r]=n[r];n.success&&n.success()},setTitleAndIcon:function(e,t){let i=dom.find(".bottom-navigator"),n=dom.find("header h1.title");n.innerText=e;let o=dom.find("header div.left");t?(o.innerHTML=t,null!=i&&(i.style.display=""),o.onclick=e=>{}):(o.innerHTML='<i class="fas fa-arrow-left button icon"></i>',null!=i&&(i.style.display="none"),o.onclick=e=>{kuim.navigateBack()})},select:async function(i){var t=await xhr.promise({url:i.url,params:i.params||{}});let n=[];for(let e=0;e<t.length;e++){var o=t[e];n.push({id:o[i.fieldId||"id"],value:o[i.fieldName||"value"]})}new MobileSelect({trigger:i.trigger,title:i.title,wheels:[{data:n}],callback:(e,t)=>{i.onSelected&&i.onSelected(t[0])}})},tabs:function(e){let t=dom.find(e.container),o=dom.element(`
    <div class="nav nav-tabs mt-0"></div>
  `),s=dom.element(`
    <div class="swiper">
      <div class="swiper-wrapper">
      </div>
    </div>
  `);var l=e.tabs;for(let n=0;n<l.length;n++){let e=l[n],t=dom.templatize(`
      <div class="nav-item font-weight-bold mr-0" 
           style="padding: 0 16px; line-height: 36px; text-align: center; flex: 1;">{{title}}</div>
    `,e);o.appendChild(t),0==n&&t.classList.add("active-bg-info"),dom.bind(t,"click",e=>{a.slideTo(n,400,!0)});let i=dom.templatize(`
      <div class="swiper-slide full-width"></div>
    `,e);e.render?e.render(i,e.params||{}):i.innerHTML='<img src="https://via.placeholder.com/240x150">',s.children[0].appendChild(i)}t.appendChild(o),t.appendChild(s);let a=new Swiper(s,{direction:"horizontal",loop:!1});a.on("slideChange",function(e){e=e.activeIndex;for(let e=0;e<o.children.length;e++)o.children[e].classList.remove("active-bg-info");o.children[e].classList.add("active-bg-info")})},wizard:function(e){let t=dom.find(e.container),o=dom.element(`
    <div class="wizard"></div>
  `),s=dom.element(`
    <div class="swiper">
      <div class="swiper-wrapper">
      </div>
    </div>
  `);var l=e.steps;for(let n=0;n<l.length;n++){let e=l[n];e.index=n+1;let t=dom.templatize(`
      <div class="wizard-step">
        <div class="wizard-dot">
          <div class="wizard-connector-left"></div>
          <div class="wizard-number">{{index}}</div>
          <div class="wizard-connector-right"></div>
        </div>
      </div>
    `,e);o.appendChild(t),dom.bind(t,"click",e=>{t.classList.contains("wizard-step-completed")&&a.slideTo(n,400,!0)});let i=dom.templatize(`
      <div class="swiper-slide full-width"></div>
    `,e);e.render?e.render(i,e.params||{}):i.innerHTML='<img src="https://via.placeholder.com/240x150">',s.children[0].appendChild(i)}t.appendChild(o),t.appendChild(s);let a=new Swiper(s,{direction:"horizontal",loop:!1});return a.on("slideChange",e=>{var t=e.activeIndex;for(let e=0;e<o.children.length;e++)o.children[e].classList.remove("wizard-step-completed");for(let e=0;e<t;e++)o.children[e].classList.add("wizard-step-completed")}),a.on("sliderMove",(e,t)=>{}),a},overlay:function(){},success:function(e,t){let i=dom.templatize(`
    <div class="toast">
      <i class="far fa-check-circle font-36"></i>
      <div class="font-18 mt-2">${e}</div>
    </div>
  `);document.body.appendChild(i),setTimeout(()=>{i.classList.add("show")},50),setTimeout(()=>{i.classList.remove("show"),setTimeout(()=>{i.remove(),t&&t()},500)},1e3)},error:function(e,t){let i=dom.templatize(`
    <div class="toast">
      <i class="far fa-times-circle font-36"></i>
      <div class="font-18 mt-2">${e}</div>
    </div>
  `);document.body.appendChild(i),setTimeout(()=>{i.classList.add("show")},50),setTimeout(()=>{i.classList.remove("show"),setTimeout(()=>{i.remove(),t&&t()},500)},1e3)},loading:function(t){if(null==document.getElementById("__widgetLoading")){let e=dom.templatize(`
    <div id="__widgetLoading" style="background: rgba(0,0,0,0.3); position: absolute; top: 0; left: 0; 
                z-index: 9999; height: 100%; width: 100%; display: flex; color: white">
      <div class="m-auto" style="text-align: center;">
        <i class="fas fa-spinner fa-spin font-36"></i>
        <div class="font-18 mt-2">数据加载中</div>
      </div>          
    </div>
  `);document.body.appendChild(e),setTimeout(()=>{t&&t(e)},300)}},dialog:function(e){let t=e.confirm,i=e.cancel;e=e.content;let n=dom.element(`
    <div style="background: rgba(0,0,0,0.3); position: absolute; top: 0; left: 0; 
                z-index: 9999; height: 100%; width: 100%; display: flex;">
      <div class="dialog m-auto" 
           style="width: 88%; min-height: 400px; position: relative;
                  background: var(--color-white);">
        <div class="dialog-body">${e}</div>
        <div class="dialog-footer" 
             style="font-size: 24px; font-weight: bold; position: absolute;
                    width: 100%; height: 56px; bottom: 0; display: table;">
          <button style="background: var(--color-error); width: 50%; display: inline-table;
                         color: var(--color-text-primary-dark); border: none; 
                         line-height: 56px;">取  消</button>
          <button style="background: var(--color-primary); width: 50%; display: inline-table;
                         color: var(--color-text-primary-dark); border: none; 
                         line-height: 56px;">确  定</button>
        </div>
      </div>
    </div>
  `);e=n.querySelectorAll("button");dom.bind(e[0],"click",e=>{n.remove(),i&&i()}),dom.bind(e[1],"click",e=>{n.remove(),t&&t()}),document.body.appendChild(n)}},pStart={x:0,y:0},pStop={x:0,y:0},kuim.swipeStart=function(e){var t;void 0!==e.targetTouches?(t=e.targetTouches[0],pStart.x=t.screenX,pStart.y=t.screenY):(pStart.x=e.screenX,pStart.y=e.screenY)},kuim.swipeEnd=function(e){var t;void 0!==e.changedTouches?(t=e.changedTouches[0],pStop.x=t.screenX,pStop.y=t.screenY):(pStop.x=e.screenX,pStop.y=e.screenY)},kuim.swipeCheck=function(){var e=pStart.y-pStop.y,t=pStart.x-pStop.x;return kuim.isPullDown(e,t)},kuim.isPullDown=function(e,t){return e<0&&(Math.abs(t)<=100&&300<=Math.abs(e)||Math.abs(t)/Math.abs(e)<=.3&&60<=e)},document.addEventListener("touchstart",kuim.swipeStart,!1),document.addEventListener("touchend",e=>{kuim.swipeEnd(e),kuim.swipeCheck()&&(kuim.presentPageObj.page.getBoundingClientRect(),kuim.presentPageObj&&kuim.presentPageObj.pullToRefresh&&0<=kuim.presentPageObj.page.getBoundingClientRect().top&&kuim.loading(e=>{kuim.presentPageObj.pullToRefresh(e)}))},!1),flutter={log:e=>{window.print&&print.postMessage(e)}};
xhr={},xhr.request=function(e,t){let i=e.url,n=e.data||e.params||{},s=e.type||"json",o=e.success,a=e.error;n={...utils.getParameters(e.url),...n};let l=e.usecase||"",r=new XMLHttpRequest;r.timeout=1e4,r.onload=function(){let e=r.responseText;if("json"==s)try{e=JSON.parse(e)}catch(t){return void(a&&a(e))}4==r.readyState&&"200"==r.status?o&&o(e):a&&a(e)},r.onerror=function(){a&&a({error:{code:-500,message:"网络访问错误！"}})},r.ontimeout=function(){a&&a({error:{code:-501,message:"网络请求超时！"}})},r.open(t,i,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("usecase",l),"undefined"!=typeof APPTOKEN&&r.setRequestHeader("apptoken",APPTOKEN),window.user?r.setRequestHeader("_current_user",window.user.userId):r.setRequestHeader("_current_user","unauthorized user"),n?r.send(JSON.stringify(n)):r.send(null)},xhr.get=function(e){let t=e.url,i=(e.data,e.success),n=e.error,s=new XMLHttpRequest;s.open("GET",t,!0),s.onload=function(){let e=s.responseText;4==s.readyState&&"200"==s.status?i&&i(e):n&&n(e)},s.send(null)},xhr.post=function(e){let t=e.url;"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.request(e,"POST")},xhr.put=function(e){xhr.request(e,"PUT")},xhr.delete=function(e){xhr.request(e,"DELETE")},xhr.connect=function(e){xhr.request(e,"CONNECT")},xhr.upload=function(e){let t=e.url,i=e.data||e.params,n=e.type||"json",s=e.success,o=e.error,a=new FormData;for(let e in i)a.append(e,i[e]);a.append("file",e.file);let l=new XMLHttpRequest;l.timeout=1e4,l.onload=function(){let e=l.responseText;if("json"==n)try{e=JSON.parse(e)}catch(t){return void(o&&o(e))}4==l.readyState&&"200"==l.status?s&&s(e):o&&o(e)},e.progress&&(l.onprogress=function(t){e.progress(t.loaded,t.total)}),l.onerror=function(){o&&o({error:{code:-500,message:"网络访问错误！"}})},l.ontimeout=function(){o&&o({error:{code:-501,message:"网络请求超时！"}})},l.open("POST",t,!0),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),l.send(a)},xhr.chain=function(e){if(0==e.length)return;let t=e[0],i=t.success;xhr.promise(t,function(t){i(t),xhr.chain(e.slice(1))})},xhr.asyncGet=function(e,t){return new Promise(function(i,n){e.success=function(e){i(e)},e.error=t,xhr.get(e)})},xhr.promise=function(e,t){return new Promise(function(i,n){e.success=function(e){if(e.error)return dialog.error(e.error.message),void(t&&t(e.error));i(e.data)},e.error=t,xhr.post(e)})},xhr.longpromise=function(e,t){let i=e.container||dom.find("#container"),n=e.tooltip||"操作处理中...",s=dom.element(`\n    <div class="page-loading hide">\n      <div class="ring">${n}\n        <span></span>\n      </div>\n    </div>\n  `);return i.appendChild(s),s.classList.remove("hide"),new Promise(function(i,n){e.success=function(e){if(e.error)return setTimeout(()=>{s.classList.add("hide"),s.remove()},600),dialog.error(e.error.message),void(t&&t(e.error));setTimeout(()=>{s.classList.add("hide"),s.remove()},1200),i(e.data)},e.error=t,xhr.post(e)})},xhr.download=function(e){let t=new XMLHttpRequest;t.open("POST",e.url,!0),t.responseType="arraybuffer",t.onload=function(){if(200===this.status){let o="",a=t.getResponseHeader("Content-Disposition");if(a&&-1!==a.indexOf("attachment")){let e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(a);null!=e&&e[1]&&(o=e[1].replace(/['"]/g,""))}let l=t.getResponseHeader("Content-Type"),r=new Blob([this.response],{type:l});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(r,o);else{var i=window.URL||window.webkitURL,n=i.createObjectURL(r),s=document.createElement("a");void 0===s.download?window.location=n:(s.href=n,s.download=e.filename||"下载的文件",document.body.appendChild(s),s.click()),setTimeout(function(){i.revokeObjectURL(n)},100)}}},t.setRequestHeader("Content-type","application/json"),"undefined"!=typeof APPTOKEN&&t.setRequestHeader("apptoken",APPTOKEN),t.send(JSON.stringify(e.params||{}))},xhr.asyncRequest=function(e,t){let i=e.url,n=e.data||e.params,s=e.type||"json",o=e.usecase||"";return new Promise((e,a)=>{if(i){let l=new XMLHttpRequest;l.timeout=1e4,l.onload=function(){let t=l.responseText;if("json"==s)try{t=JSON.parse(t)}catch(e){return console.log(e),void a(e)}4==l.readyState&&"200"==l.status?e(t):a(t)},l.onerror=function(){a({error:{code:-500,message:"网络访问错误！"}})},l.ontimeout=function(){a({error:{code:-501,message:"网络请求超时！"}})},l.open(t,i,!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("usecase",o),"undefined"!=typeof APPTOKEN&&l.setRequestHeader("apptoken",APPTOKEN),n?l.send(JSON.stringify(n)):l.send(null)}})},xhr.asyncPost=function(e){let t=e.url;return"undefined"!=typeof HOST&&-1==t.indexOf("http")&&(t=HOST+t,e.url=t),xhr.asyncRequest(e,"POST")},"undefined"!=typeof module&&(module.exports={xhr:xhr});var ajax={save:function(e){for(var t=e.url||"",i=e.form,n=e.button,s=e.success,o=i.validate(),a="",l=0;l<o.length;l++)a+=o[l].message+"<br>";if(""==a){n&&n.prop("disabled",!0);var r=i.formdata();$.ajax({url:t,data:r,method:"POST",dataType:"json",success:function(e){if(void 0!==e.error)return dialog.error("保存信息出错！"),void(n&&n.prop("disabled",!1));dialog.success("保存信息成功！"),void 0!==s&&s(e),n&&n.prop("disabled",!1)},error:function(){dialog.error("系统异常！"),n&&n.prop("disabled",!1)}})}else dialog.error(a)},post:function(e){let t={...utils.getParameters(e.url),...e.data};$.ajax({url:e.url,data:t,method:"POST",dataType:"json",success:function(t){void 0!==e.success&&e.success(t)}})},get:function(e){$.ajax({url:e.url,data:e.data,dataType:"json",success:function(t){void 0!==e.success&&e.success(t)}})},text:function(e,t,i){$.ajax({url:e,data:t,success:function(e){void 0!==i&&i(e)}})},view:function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();let t=e.url,i=!1;i=void 0===e.empty||e.empty;let n=e.page;t&&0==t.indexOf(":")&&(n=t.substring(1),t=null);let s=utils.getParameters(e.url),o={...s,...e.params},a=e.title||"",l=e.containerId,r=e.success,d=null;if("string"==typeof l?null==(d=document.getElementById(l.trim()))&&(d=document.querySelector(l.trim())):d=l,void 0===o&&(o={}),window.parameters)for(let e in o)window.parameters[e]=o[e];t?xhr.get({url:t,success:function(e){let t=null;d&&(t=utils.append(d,e,i)),t.id&&window[t.id].show(s),r&&r(a,t,s)}}):n&&xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:n},success:function(e){let t=e.data.script;t||(t='<div class="full-width full-height d-flex"><img src="img/under-construction.jpeg" class="m-auto full-width"></div>');let n=null;d&&(n=utils.append(d,t,i)),r&&r(a,n,s)}})}};ajax.append=function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();let t=dom.find("#tabsMain"),i=dom.find("#tabsOthers");if(null==t)return void ajax.view(e);let n=t.children.length,s=e.url,o=e.title||"",a=e.containerId,l=e.params,r=e.success,d=null;if("string"==typeof a?null==(d=document.getElementById(a.trim()))&&(d=document.querySelector(a.trim())):d=a,void 0===l&&(l={}),window.parameters)for(let e in l)window.parameters[e]=l[e];u();let c=d.querySelector('div[data-url="'+s+'"]');if(null!=c){c.classList.remove("hide"),setTimeout(function(){c.classList.add("show")},150);let e=dom.find('a[data-url="'+s+'"]',t);return null!=e?void e.classList.add("active"):void dom.find('a[data-url="'+s+'"]',i).classList.add("active")}function u(){d.querySelectorAll("div[data-url]").forEach(e=>{e.classList.remove("show"),e.classList.add("hide","fade","fadeIn")}),t.querySelectorAll("a.active").forEach(e=>{e.classList.remove("active")}),i.querySelectorAll("a.active").forEach(e=>{e.classList.remove("active")})}function p(e,s){if(""==e||null==t)return;let o=dom.element('\n      <li class="nav-item">\n        <a class="nav-link head-link">\n          <span></span>\n          <i class="fas fa-times-circle ml-1"></i>\n        </a>\n      </li>\n    ');dom.find("a",o).setAttribute("data-url",s),dom.bind(dom.find("i",o),"click",e=>{e.preventDefault(),e.stopPropagation();let n=e.target.parentElement,s=d.querySelector('div[data-url="'+n.getAttribute("data-url")+'"]');if(s&&s.remove(),e.target.parentElement.parentElement.remove(),d.querySelectorAll("div[data-url]").length>0&&t.children[0].click(),i.children.length>0){let e=i.children[0];e.remove(),function(e){dom.find("a",e).classList.add("nav-link"),dom.find("a",e).classList.remove("dropdown-item"),dom.find("i",e).classList.add("ml-1"),dom.find("i",e).classList.remove("float-right"),t.appendChild(e)}(e)}}),dom.bind(dom.find("a",o),"click",e=>{let t=dom.ancestor(e.target,"a");t.classList.contains("active")||(u(),t.classList.add("active"),m(r.getAttribute("data-url")))});let a=!1;if(t.querySelectorAll("li").forEach(t=>{dom.find("span",t).innerText==e&&(a=!0,dom.find("a",t).classList.add("active"))}),a)return;if(0==n)t.appendChild(o);else if(n+1>MAX_HEAD_LINK_COUNT){let e=dom.find("li:last-child",t);e.remove(),function(e){dom.find("a",e).classList.add("pointer"),dom.find("a",e).classList.remove("nav-link"),dom.find("a",e).classList.add("dropdown-item"),dom.find("i",e).classList.remove("ml-1"),dom.find("i",e).classList.add("float-right"),0==i.children.length?i.appendChild(e):i.insertBefore(e,i.children[0])}(e)}t.insertBefore(o,t.children[0]);let l=dom.find("span",o),r=dom.find("a",o);r.classList.add("active"),l.innerText=e}function m(e){d.querySelectorAll("div[data-url]").forEach(e=>{e.classList.remove("show"),e.classList.add("hide")});let n=d.querySelector('div[data-url="'+e+'"]');if(null!=n){n.classList.remove("hide"),setTimeout(function(){n.classList.add("show")},150);let s=dom.find('a[data-url="'+e+'"]',t);return null!=s?void s.classList.add("active"):void dom.find('a[data-url="'+e+'"]',i).classList.add("active")}xhr.get({url:e,success:function(t){let i=utils.getParameters(e),n=utils.append(d,t,!1);n.id&&window[n.id].show(i);for(let t=d.children.length-1;t>=0;t--){let i=d.children[t];if("DIV"==i.tagName){i.setAttribute("data-url",e),setTimeout(function(){i.classList.add("show")},150);break}}p(o,e),r&&r(o,t)}})}if(0==s.indexOf(":")){let e=s.substring(1);xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:e},success:function(t){let i=t.data.script;utils.append(d,i,!1);for(let e=d.children.length-1;e>=0;e--){let t=d.children[e];if("DIV"==t.tagName){t.setAttribute("data-url",s),setTimeout(function(){t.classList.add("show")},150);break}}p(o,s),stdbiz.render(e,d.querySelector('[data-url="'+s+'"]'),{})}})}else m(s)},ajax.shade=function(e){"undefined"!=typeof schedule&&schedule.stop();let t=e.url,i=e.success,n=document.querySelector(".page.full");null!=n&&n.parentElement.remove(),-1===t.indexOf(":")?xhr.get({url:t,success:function(t){let n=utils.append(document.body,t);i&&i(e.title||"",n)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:t.substring(1)},success:function(t){let n=t.data.script,s=utils.append(document.body,n);i&&i(e.title||"",s)}})},ajax.stack=function(e){"undefined"!=typeof schedule&&e.clear&&schedule.stop();let t=e.pageId,i=e.params,n=dom.find(e.containerId);void 0===i&&(i={});let s=!1;for(let e=0;e<n.children.length;e++){let i=n.children[e];"DIV"==i.tagName&&"true"!=i.getAttribute("data-stack-back")&&(i.classList.remove("show"),i.classList.add("hide"),i.id==t&&(i.classList.remove("hide"),i.classList.add("show"),s=!0))}s||(e.empty=!1,ajax.view(e));let o=dom.find("div[data-stack-back]",n);null==o&&((o=dom.element('\n    <div data-stack-back="true" class="pointer">\n      <i class="fas fa-angle-left font-32" style="margin-top: 12px;"></i>\n    </div>\n  ')).style.position="fixed",o.style.width="60px",o.style.height="60px",o.style.bottom="40px",o.style.right="40px",o.style.backgroundColor="#0C9",o.style.color="#fff",o.style.borderRadius="50px",o.style.textAlign="center",o.style.boxShadow="2px 2px 3px #999",o.style.zIndex="99",dom.bind(o,"click",e=>{o.remove(),ajax.unstack({containerId:n})}),n.appendChild(o))},ajax.unstack=function(e){let t=dom.find(e.containerId);t.children[t.children.length-1].remove();let i=t.children[t.children.length-1];i.classList.remove("hide"),i.classList.add("show")},ajax.template=function(e){let t=e.url,i=e.usecase,n=e.containerId,s=e.templateId,o=e.data,a=e.success;xhr.post({url:t,usecase:i,data:o,success:function(e){if(n){var t=document.getElementById(s).innerHTML,i=Handlebars.compile(t)(e);document.getElementById(n).innerHTML=i}a&&a(e)}})},ajax.dialog=function(e){let t=e.title||"",i=e.url||"",n=e.params||{},s=e.success,o=e.end,a=!1!==e.shadeClose,l=!0===e.allowClose,r=e.width||"80%",d=e.height||"",c=e.offset||"auto";if(window.parameters)for(var u in n)window.parameters[u]=n[u];$.ajax({url:i,data:n,async:!0,success:function(e){layer.open({type:1,offset:c,title:t,closeBtn:!0===l?1:0,shade:.3,shadeClose:a,area:[r,d],content:e,success:function(e,t){document.querySelector(".layui-layer-content").style+="; overflow: hidden;",s&&s()},end:o||function(){}})}})},ajax.video=function(e,t,i,n){layer.open({type:2,title:!1,closeBtn:1,shade:[0],area:[i+"px",n+"px"],offset:"rb",anim:2,content:[e,"no"]})},ajax.svg=function(e,t,i,n){void 0===i&&(i={}),$.ajax({url:e,data:i,success:function(e){t.empty();var i=(new XMLSerializer).serializeToString(e.documentElement);t.html(i),n&&n(e)}})},ajax.upload=function(e){let t=e.data;void 0===t&&(t={});let i=new FormData;for(let e in t)i.append(e,t[e]);$.ajax({url:e.url,data:i,method:"POST",cache:!1,contentType:!1,processData:!1,xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&e.progress&&t.upload.addEventListener("progress",function(t){t.lengthComputable&&e.progress&&e.progress(t.total,t.loaded)},!1),t},success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},ajax.sidebar=function(e){let t=dom.find(e.containerId),i=e.success||function(e,t){},n=dom.find("[widget-id=right-bar]"),s=e.allowClose||!1;null!=n&&n.remove(),n=dom.element('\n    <div widget-id="right-bar" style="position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: transparent; z-index: 999999;">\n      <div class="right-bar fade show">\n        <div class="modal-dialog" role="document">\n          <div class="modal-content">\n            <div class="card-header pl-3">\n              <h5 class="modal-title"></h5>\n              <button type="button" class="close text-danger">\n                <i class="fas fa-times"></i>\n              </button>\n            </div>\n            <div class="modal-body" style="overflow-y: auto;"></div>\n            <div style="position: absolute; bottom: 24px; left: 0; width: 100%; height: 48px; border-top: 1px solid lightgrey; background: white; display:none;">\n              <div widget-id="right-bar-bottom" class="mh-10 mt-2" style="float: right;"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  '),!0===e.showBottom&&(dom.find(".modal-body",n).style.marginBottom="36px",dom.find("[widget-id=right-bar-bottom]",n).parentElement.style.display=""),n.addEventListener("click",e=>{"right-bar"===e.target.getAttribute("widget-id")&&(n.children[0].classList.remove("in"),n.children[0].classList.add("out"),setTimeout(function(){n.remove()},300))}),t.appendChild(n),0==e.url.indexOf(":")&&(e.page=e.url.substring(1),e.url=null),e.url?xhr.get({url:e.url,success:function(t){dom.find(".modal-title",n).innerHTML=e.title||"",dom.find(".modal-body",n).innerHTML="",s||e.close||dom.find("button.close",n).classList.add("hidden"),dom.find("button.close",n).addEventListener("click",function(){n.children[0].classList.add("out"),n.remove(),e.close&&e.close()});let o=utils.append(dom.find(".modal-body",n),t);i&&i(e.title||"",o),setTimeout(function(){n.children[0].classList.remove("out"),n.children[0].classList.add("in")},300)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",params:{customWindowId:e.page},success:function(t){let o=t.data.script;dom.find(".modal-body",n).innerHTML="";let a=utils.append(dom.find(".modal-body",n),o);dom.find(".modal-title",n).innerHTML=e.title||"&nbsp;",s||e.close||dom.find("button.close",n).classList.add("hidden"),dom.find("button.close",n).addEventListener("click",function(){dom.find(".right-bar").classList.add("out"),setTimeout(function(){n.remove()},300),e.close&&e.close()}),i&&i(e.title||"",a),setTimeout(function(){n.children[0].classList.remove("out"),n.children[0].classList.add("in")},300)}})},ajax.bottombar=function(e){let t=dom.find(e.containerId),i=e.success||function(){},n=dom.find(".bottom-bar",t),s=e.allowClose||!1;null!=n&&n.remove(),n=dom.element('\n    <div class="bottom-bar fade show">\n      <div class="modal-dialog" role="document">\n        <div class="modal-content">\n          <div class="card-header pt-2 pb-2">\n            <button type="button" class="close text-danger">\n              <i class="fas fa-times"></i>\n            </button>\n            <h5 class="modal-title"></h5>\n          </div>\n          <div class="modal-body" style="overflow-y: auto"></div>\n        </div>\n      </div>\n    </div>\n  '),t.appendChild(n);let o=n.parentElement.clientWidth,a=parseInt(window.getComputedStyle(n.parentElement,null).getPropertyValue("padding-left")),l=parseInt(window.getComputedStyle(n.parentElement,null).getPropertyValue("padding-right"));n.style.width=o-l-a+"px",e.url?xhr.get({url:e.url,success:function(t){dom.find(".modal-title",n).innerHTML=e.title||"",s||e.close||dom.find("button.close",n).classList.add("hidden"),dom.find("button.close",n).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),e.close&&e.close()}),utils.append(dom.find(".modal-body",n),t),i&&i(t),setTimeout(function(){n.classList.remove("out"),n.classList.add("in")},200)}}):xhr.post({url:"/api/v3/common/script/stdbiz/uxd/custom_window/read",data:{customWindowId:e.page},success:function(t){let o=t.data.script;utils.append(dom.find(".modal-body",n),o),dom.find(".modal-title",n).innerHTML=e.title,s||e.close||dom.find("button.close",n).classList.add("hidden"),dom.find("button.close",n).addEventListener("click",function(){dom.find(".bottom-bar").classList.add("out"),e.close&&e.close()}),i&&i(t),setTimeout(function(){n.classList.remove("out"),n.classList.add("in")},200)}})},ajax.tabs=function(e){let t=document.querySelector(e.containerId),i=e.tabs,n=(e.closeable,dom.create("ul","nav","nav-tabs")),s=dom.create("div","tab-content"),o=dom.create("div","float-right"),a=dom.create("button","btn","btn-link");function l(e,t,i,n){ajax.view({url:t,containerId:e,success:function(){window[i]&&window[i].show(n)}})}o.appendChild(a),dom.bind(a,"click",function(){let e=dom.find("li.active link",this.parentElement.parentElement),t=e.getAttribute("data-model-url"),i=e.getAttribute("data-model-page"),n=JSON.parse("data-model-data");l(dom.find("div.tab-content div[data-model-url='"+t+"']",this.parentElement.parentElement),t,i,n)});for(let e=0;e<i.length;e++){let t=i[e],o=dom.create("li","nav-item"),a=dom.create("a","nav-link");0==e&&a.classList.add("active"),a.setAttribute("data-model-url",t.url),a.setAttribute("data-model-data",JSON.stringify(t.data||{})),a.setAttribute("data-model-page",t.page),a.innerHTML=t.title,dom.bind(a,"click",function(){if(this.classList.contains("active"))return;dom.find("a.active",this.parentElement.parentElement.parentElement).classList.remove("active"),dom.find("div.active",this.parentElement.parentElement.parentElement).classList.remove("active");let e=a.getAttribute("data-model-url"),t=JSON.parse(a.getAttribute("data-model-data")),i=a.getAttribute("data-model-page"),n=dom.find("div.tab-content div[data-model-url='"+e+"']",this.parentElement.parentElement.parentElement);this.classList.add("active"),n.classList.add("active"),""===n.innerHTML.trim()&&l(n,e,i,t)}),o.appendChild(a),n.appendChild(o);let r=dom.create("div","tab-pane");0==e&&(r.classList.add("active"),l(r,t.url,t.page,t.data)),r.setAttribute("data-model-url",t.url),s.append(r)}t.appendChild(o),t.appendChild(n),t.appendChild(s)},"undefined"==typeof dialog&&(dialog={}),dialog.alert=function(e){layer.open({type:0,icon:0,offset:"150px",shade:0,shadeClose:!0,title:"警告",content:e})},dialog.info=function(e){layer.open({type:0,offset:"150px",shade:0,shadeClose:!0,title:"信息",content:e})},dialog.info2=function(e){layer.open({type:0,offset:"100px",shade:.3,shadeClose:!0,title:"信息",content:e})},dialog.error=function(e){e=e.replaceAll("\n","<br>"),layer.open({type:0,icon:2,offset:"150px",shade:0,shadeClose:!0,title:"错误",content:e})},dialog.success=function(e,t){t?layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e,btn:["确定","确定并返回"],yes:function(e,t){layer.close(e)},btn2:function(e,i){layer.close(e),t()}}):layer.open({type:0,icon:1,offset:"150px",shade:0,shadeClose:!0,title:"成功",content:e})},dialog.confirm=function(e,t){layer.confirm(e,{title:"确认",btn:["确定","取消"]},function(e){layer.close(e),t()},function(){})},dialog.view=function(e){let t=e.title,i=e.url;$(document.body);$("#dialogApplication").length&&$("#dialogApplication").remove();let n=[];e.save&&n.push({text:"保存",class:"btn-save",success:e.save}),$.ajax({url:i,success:function(e){let i=Handlebars.compile('<div class="modal fade" id="dialogApplication">  <div class="modal-dialog modal-dialog-centered">    <div class="modal-content">      <div class="modal-header">        <h4 class="modal-title">{{title}}</h4>        <button type="button" class="close" data-dismiss="modal">&times;</button>      </div>      <div id="dialogApplicationBody" class="modal-body">{{body}}</div>      <div class="modal-footer">        {{#each buttons}}        <button type="button" class="btn {{class}}" data-dismiss="modal">{{text}}</button>        {{/each}}        <button type="button" class="btn btn-close" data-dismiss="modal">关闭</button>      </div>    </div>  </div></div>')({title:t,body:e,buttons:n});$(document.body).append(i),$("#dialogApplication").modal("show")}})},dialog.select=function(e){ajax.view({url:e.url,success:function(t){layer.open({type:0,icon:1,offset:"150px",shade:.5,shadeClose:!0,title:e.title,content:t})}})},dialog.simplelist=async function(e){let t=await xhr.promise({url:e.url,params:e.params||{}}),i=dom.element('\n    <div>\n      <ul class="list-group"></ul>\n    </div>\n  '),n=dom.find("ul",i);for(let i=0;i<t.length;i++){let s=t[i],o=dom.create("li","list-group-item","list-group-item-action");dom.model(o,s),o.innerText=s[e.fields.text],n.appendChild(o)}layer.open({type:0,closeBtn:1,btn:[],shade:.5,shadeClose:!0,title:"",content:i.innerHTML,success:function(t,i){t.get(0).querySelectorAll("li").forEach((t,i)=>{dom.bind(t,"click",t=>{layer.close(layer.index);let i=dom.model(t.target);e.onAccept(i)})})}})},dialog.html=function(e){layer.open({type:0,closeBtn:1,offset:"150px",shade:.5,area:["50%",""],shadeClose:!0,title:e.title||"&nbsp;",content:e.html,btn:["确定","关闭"],success:function(t,i){e.load&&e.load(t,i)},yes:function(t){layer.close(t),e.success()},btn1:function(){}})},dialog.iframe=function(e){layer.open({title:e.title,type:2,area:[e.width,e.height],content:e.url,resize:!1,maxmin:!0,shade:!1,success:e.success||function(e,t){}})};var dom={};function ListView(e){this.url=e.url,this.usecase=e.usecase,this.params=e.params||{},this.lazy=!0===e.lazy,this.hoverable=!1!==e.hoverable,this.activateable=!0===e.activateable,this.itemClass=e.itemClass||[],this.idField=e.idField,this.compare=e.compare||function(e,t){return!1},this.selections=e.selections||[],this.local=e.local||[],this.create=e.create||function(e,t){},this.complete=e.complete,this.draggable=!0===e.draggable,this.start=e.start||0,this.limit=e.limit||-1,this.borderless=e.borderless||!1,this.height=e.height,this.tooltip=e.tooltip,this.required=e.required||!1,this.onRemove=e.onRemove,this.onReorder=e.onReorder,this.onCheck=e.onCheck,this.onSelect=e.onSelect,this.onFilter=e.onFilter,this.onAdd=e.onAdd,this.onSearch=e.onSearch,this.onClick=e.onClick,this.observableItems=new rxjs.Observable}function Timeline(e){this.url=e.url,this.params=e.params||{},this.data=e.data||[],this.fnTitle=e.title||function(e,t){return""},this.fnSubtitle=e.subtitle||function(e,t){return""},this.fnContent=e.content||function(e,t){return""},this.onComplete=e.onComplete}function Wizard(e){this.topic=e.topic,this.steps=e.steps||[],this.root=dom.element('\n    <div style="width: 100%">\n      <div class="wizard">\n      </div>\n      <div class="wizard-content">\n      </div>\n    </div>\n  ')}dom.value=function(e,t){const i=document.querySelector(e);if(!t)return i.value.trim();i.value=t},dom.empty=function(e){const t=document.querySelector(e);t.value?t.value="":t.innerHTML=""},dom.valid=function(e){const t=document.querySelector(e);return void 0!==t.value&&null!=t.value&&""!=t.value.trim()},dom.create=function(e){let t=Array.prototype.slice.call(arguments,1),i=document.createElement(e);for(let e=0;e<t.length;e++)i.classList.add(t[e]);return i},dom.fix=function(e){let t=null,i=(t="string"==typeof e?document.querySelector(e):e).getBoundingClientRect(),n=i.left,s=i.top,o=(i.width,i.height),a=(parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-top"))),l=parseInt(window.getComputedStyle(t,null).getPropertyValue("padding-bottom")),r=(parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-left")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-right")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-top")),parseInt(window.getComputedStyle(t,null).getPropertyValue("margin-bottom")),t.parentElement.parentElement),d=r.getBoundingClientRect(),c=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"));parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right")),parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-top")),parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-bottom"));return t.style.position="absolute",t.style.top=s-d.top+"px",t.style.left=n-d.left+"px",t.style.width="calc(100% - "+2*c+"px )",{top:s-d.top,left:n-d.left,width:d.width-2*c,height:o+a+l}},dom.find=function(e,t){if(t=t||document,"string"!=typeof e)return e;let i=t.querySelectorAll(e);return 0==i.length?null:1==i.length?i[0]:i},dom.ancestor=function(e,t,i){let n=null;if(i=i||"",null==(n="string"==typeof e?document.querySelector(e):e))return null;t=t.toUpperCase();let s=n;if(""==i)for(;null!=s&&s.tagName!=t;)s=s.parentElement;else for(;null!=s&&(s.tagName!=t||!s.classList.contains(i));)s=s.parentElement;return s},dom.element=function(e){let t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},dom.bind=function(e,t,i){let n=null;null!=(n="string"==typeof e?document.querySelector(e):e)&&n&&n.addEventListener(t,i)},dom.model=function(e,t){let i=null;if(i="string"==typeof e?document.querySelector(e):e,void 0===t){let e={};return Array.prototype.slice.call(i.attributes).forEach(function(t){if(0==t.name.indexOf("data-model-"))if(0==t.value.indexOf("{"))try{e[utils.nameVar(t.name.slice("data-model-".length))]=JSON.parse(t.value)}catch(i){e[utils.nameVar(t.name.slice("data-model-".length))]=t.value}else e[utils.nameVar(t.name.slice("data-model-".length))]=t.value}),e}{let e=Array.prototype.slice.call(arguments,2);if(0==e.length)for(const e in t)0!=e.indexOf("||")&&0!=e.indexOf("//")&&0!=e.indexOf(">>")&&("object"==typeof t[e]?i.setAttribute(utils.nameAttr(e),JSON.stringify(t[e])):i.setAttribute(utils.nameAttr(e),t[e]));else for(let n=0;n<e.length;n++){let s=e[n];0!=s.indexOf("||")&&0!=s.indexOf("//")&&0!=s.indexOf(">>")&&("object"==typeof t[s]?i.setAttribute(utils.nameAttr(s),JSON.stringify(t[s])):i.setAttribute(utils.nameAttr(s),t[s]))}}},dom.collect=function(e,t){let i=[],n=document.querySelectorAll(e);for(let e=0;e<n.length;e++){let s={};if(Array.isArray(t))for(let i=0;i<t.length;i++)s[t[i]]=n[e].getAttribute(utils.nameAttr(t[i]));else s[t]=n.getAttribute(utils.nameAttr(t[j]));i.push(s)}return i},dom.propagate=function(e,t,i,n){let s=n(t);if(Array.isArray(i))for(let e=0;e<i.length;e++)s.setAttribute(utils.nameAttr(i[e]),t[i[e]]);else s.setAttribute(utils.nameAttr(i),t[i]);e.appendChild(s)},dom.toggle=function(e,t){let i=document.querySelectorAll(e);for(let e=0;e<i.length;e++){i[e].addEventListener("click",function(){let e=this.getAttribute("data-toggle").split(">>"),i=e[0].split("+"),n=e[1].split("+"),s=!1;for(let e=0;e<i.length;e++){let t=i[e].trim();if(0==t.indexOf("."))s=this.classList.contains(t.substring(1));else{s=null!=this.querySelector(t)}}if(s){for(let e=0;e<n.length;e++){let t=n[e].trim();if(0===t.indexOf("."))this.classList.add(t.substring(1));else{this.querySelector(t.substring(0,t.indexOf("."))).classList.add(t.substring(t.indexOf(".")+1))}}for(let e=0;e<i.length;e++){let t=i[e].trim();if(0==t.indexOf("."))this.classList.remove(t.substring(1));else{this.querySelector(t).classList.remove(t.substring(t.indexOf(".")+1))}}}else{for(let e=0;e<i.length;e++){let t=i[e].trim();if(0==t.indexOf("."))this.classList.add(t.substring(1));else{this.querySelector(t.substring(0,t.indexOf("."))).classList.add(t.substring(t.indexOf(".")+1))}}for(let e=0;e<n.length;e++){let t=n[e].trim();if(0==t.indexOf("."))this.classList.remove(t.substring(1));else{this.querySelector(t).classList.remove(t.substring(t.indexOf(".")+1))}}t&&resovle(this)}})}},dom.switch=function(e,t){let i=dom.find(e),n=i.getAttribute("data-switch").split("+"),s=i.querySelectorAll(n[0]);for(let e=0;e<s.length;e++){let o=s[e];o.addEventListener("click",function(){let e=i.querySelectorAll(n[0]);for(let t=0;t<e.length;t++)e[t].classList.remove(n[1].substring(1));o.classList.add(n[1].substring(1)),t&&t(o)})}},dom.tabs=function(e){let t=dom.find(e);if(null==t)return;let i=t.getAttribute("data-tab-active-class");for(let e=0;e<t.children.length;e++){let n=t.children[e];n.addEventListener("click",e=>{for(let e=0;e<t.children.length;e++){t.children[e].classList.remove(i)}n.classList.add(i)})}},dom.top=function(e){let t=null;if(null==(t="string"==typeof e?document.querySelector(e):e))return 0;let i=t.offsetTop;return void 0!==t.offsetParent&&(i+=dom.top(t.offsetParent)),i},dom.formdata=function(e,t){let i=null;if(i="string"==typeof e?document.querySelector(e):e,void 0===t){let e={},t={},n=i.querySelectorAll("input");for(let i=0;i<n.length;i++){let s=n[i],o=s.name,a=s.type,l=s.value;"text"==a||"number"==a||"password"==a||"hidden"==a?(e[o]=null,""!=l?-1!=o.indexOf("[]")?e[o]=[l]:e[o]=l:e[o]=""):"radio"==a?s.checked&&(e[o]=l):"checkbox"==a&&(void 0===t[o]&&(t[o]=0),s.checked&&(void 0===e[o]&&(t[o]=0,e[o]=[]),e[o].push(l)),t[o]+=1)}let s=i.querySelectorAll("select");for(let t=0;t<s.length;t++){let i=s[t],n=i.name;e[n]=null,-1!=i.selectedIndex?-1!=n.indexOf("[]")?e[n]=[i.value]:e[n]=i.value:e[n]=""}let o=i.querySelectorAll("textarea");for(let t=0;t<o.length;t++){let i=o[t],n=i.name;e[n]=null,e[n]=i.value}for(let i in t)-1==i.indexOf("[]")&&1==t[i]&&e[i]&&(e[i]=e[i][0]);for(let t in e)"string"==typeof e[t]&&0==e[t].indexOf("${")&&(e[t]=e[e[t].substring(2,e[t].length-1)]);return e}{function n(e,t,i){let n=dom.find("[name='"+t+"']",e);null!=n&&("INPUT"==n.tagName?"check"==n.type||(n.value=i||""):"SELECT"==n.tagName&&$("select[name='"+t+"']").val(i).trigger("change"))}for(let e in t)if("object"==typeof t[e])for(let s in t[e])n(i,e+"."+s,t[e][s]);else n(i,e,t[e])}},dom.setAttribute=function(e,t,i){let n=document.querySelectorAll(e);for(let e=0;e<n.length;e++)n[e][t]=i},dom.removeAttribute=function(e,t){let i=document.querySelectorAll(e);for(let e=0;e<i.length;e++)i[e].removeAttribute(t)},dom.enable=function(e){let t=document.querySelectorAll(e);for(let e=0;e<t.length;e++)t[e].disabled=!1},dom.disable=function(e){let t;t="string"==typeof e?document.querySelectorAll(e):e;for(let e=0;e<t.length;e++)t[e].disabled=!0},dom.index=function(e,t,i){let n;if(n="string"==typeof e?dom.find(e):e,i);else{let e=n.getAttribute(t),i=n.parentElement.querySelectorAll(n.tagName);for(let n=0;n<i.length;n++){if(e==i[n].getAttribute(t))return n}}return-1},dom.elementAt=function(e,t,i){let n=document.querySelectorAll(e);for(let e=0;e<n.length;e++){let s=n[e];if(i==s.getAttribute(t))return{index:e,element:s}}return null},dom.elementAtTree=function(e,t,i,n,s){let o=document.querySelectorAll(e),a=0;for(let e=0;e<o.length;e++){let l=o[e],r=l.getAttribute(t);if(s==l.getAttribute(i)&&(a++,n==r))return{index:a,element:l}}},dom.stack=function(e,t,i,n){let s=dom.create("a","btn","btn-link"),o=dom.create("i","fas","fa-caret-right","mr-1");s.appendChild(o),dom.bind(s,"click",function(){let o=dom.find("i",s);o.classList.contains("fa-caret-right")?(e.container.querySelectorAll("i.fa-caret-down").forEach(e=>{e.classList.remove("fa-caret-down"),e.classList.add("fa-caret-right")}),o.classList.remove("fa-caret-right"),o.classList.add("fa-caret-down"),e.stack(i,function(e){e.parentElement.classList.add("fade","fadeIn"),e.style.paddingLeft="50px",e.style.paddingRight="50px",setTimeout(function(){e.parentElement.classList.add("show")},200),n(e)})):(o.classList.remove("fa-caret-down"),o.classList.add("fa-caret-right"),t.parentElement.nextSibling.remove())})},dom.inner=function(e){let t=e.clientHeight,i=e.clientWidth,n=getComputedStyle(e);return{height:t-parseInt(n.paddingTop)-parseInt(n.paddingBottom),width:i-parseInt(n.paddingLeft)-parseInt(n.paddingLeft)}},dom.outer=function(e){let t=e.clientHeight,i=e.clientWidth,n=getComputedStyle(e);return{height:t+parseInt(n.marginTop)+parseInt(n.borderTop)+parseInt(n.marginBottom)+parseInt(n.borderBottom),width:i+parseInt(n.marginLeft)+parseInt(n.borderLeft)+parseInt(n.marginRight)+parseInt(n.borderRight)}},dom.height=function(e,t,i){t=t||0,void 0===i&&(i=dom.find("#container")),i=i||document.body;let n=null;n="string"==typeof e?document.querySelector(e):e;let s=dom.top(n),o=getComputedStyle(i,null),a=(parseInt(o.getPropertyValue("padding-top")),parseInt(o.getPropertyValue("padding-bottom")));o=getComputedStyle(n,null);parseInt(o.getPropertyValue("border-top-width")),parseInt(o.getPropertyValue("border-bottom-width"));n.style.marginBottom="0px",n.style.height=i.clientHeight-s-t-a+"px",n.style.overflowY="auto"},dom.height2=function(e,t,i){t=t||0,void 0===i&&(i=dom.find("#container")),i=i||document.body;let n=null;n="string"==typeof e?document.querySelector(e):e;dom.top(n);let s=getComputedStyle(i,null),o=parseInt(s.getPropertyValue("padding-top")),a=parseInt(s.getPropertyValue("padding-bottom"));s=getComputedStyle(n,null);let l=parseInt(s.getPropertyValue("border-top-width")),r=parseInt(s.getPropertyValue("border-bottom-width")),d=parseInt(s.getPropertyValue("border-top-width")),c=parseInt(s.getPropertyValue("border-bottom-width"));n.style.marginBottom="0px";let u=i.getBoundingClientRect();n.style.height=u.height-o-a-l-r-d-c-t+"px",n.style.overflowY="auto"},dom.templatize=function(e,t){let i=Handlebars.compile(e)(t);return dom.element(i)},dom.render=function(e,t,i){let n=null;function s(e,t,n){let s=dom.find("[name='"+t+"']",e);null!=s&&("DIV"===s.nodeName&&i?n&&function(e,t){let i=dom.find("[value='"+t+"']",e);null!=i&&(i.checked=!0)}(s,n):"INPUT"==s.tagName?"radio"==s.type||(s.value=n):"SPAN"==s.tagName?n&&(s.innerHTML=n):"SELECT"==s.tagName&&$("select[name='"+t+"']").val(n).trigger("change"))}n="string"==typeof e?document.querySelector(e):e;for(let e in t)if("object"==typeof t[e])for(let i in t[e])s(n,e+"."+i,t[e][i]);else s(n,e,t[e])},dom.popup=function(e,t){let i=dom.create("div","full-width","full-height","position-absolute");return i.style.background="transparent",dom.bind(i,"click",e=>{i.remove(),t.remove()}),document.body.appendChild(i),e.appendChild(t),i},dom.html=function(e){let t=dom.element("<div></div>");return t.appendChild(e),t.innerHTML},ListView.prototype.fetch=async function(e){let t={};e=e||{},utils.clone(this.params,t),utils.clone(e,t);let i=this;if(this.url){this.data=this.data||{},this.data.start=this.start,this.data.limit=this.limit;let e=await xhr.promise({url:this.url,params:t});Array.prototype.push.apply(i.local,e),i.append(e)}else i.append(this.local)},ListView.prototype.render=function(e,t){this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="";let i=this.height-37;if(this.onFilter){let e=dom.element('\n      <div class="input-group position-sticky" style="top: 0; left: 0; z-index: 10;">\n        <div class="input-group-prepend">\n          <span class="input-group-text" style="border-bottom-left-radius: unset;">\n            <i class="fas fa-search"></i>\n          </span>\n        </div>\n        <input class="form-control" placeholder="搜索..."  style="border-bottom-right-radius: unset;">\n        <div class="input-group-append">\n          <span class="input-group-text pointer text-primary" style="border-bottom-right-radius: unset;">\n            <i class="fas fa-plus"></i>\n          </span>\n          <span class="input-group-text" style="border-bottom-right-radius: unset;">\n            <i class="fas fa-question icon-general"></i>\n          </span>\n          <span class="input-group-text" style="border-bottom-right-radius: unset;">\n            <i class="fas fa-asterisk icon-required"></i>\n          </span>\n        </div>\n      </div>\n    '),t=dom.find("input",e);dom.bind(t,"input",e=>{clearTimeout(this.delayToSearch),this.delayToSearch=setTimeout(()=>{this.onFilter(this,t.value)},500)}),this.required||e.children[2].children[2].remove(),this.tooltip||e.children[2].children[1].remove(),this.onAdd||e.children[2].children[0].remove(),0==e.children[2].children.length&&e.children[2].remove(),this.container.appendChild(e)}let n=dom.create("ul","list-group","full-width");if(this.borderless&&n.classList.add("b-a-0"),this.onFilter){let e=dom.create("div");e.style.height=i+"px",e.style.overflowY="auto",e.style.border="1px solid rgba(0, 0, 0, 0.125)",e.style.borderTop="",e.appendChild(n),this.container.appendChild(e)}else this.container.appendChild(n);!1!==t&&!0!==this.lazy&&this.reload()},ListView.prototype.reload=function(e){e=e||{},dom.find("ul",this.container).innerHTML="",this.start=0,this.url&&(this.local=[]),this.fetch(e)},ListView.prototype.load=function(){this.start=this.local.length,this.fetch()},ListView.prototype.remove=function(e){if(this.idField){let t=dom.find("ul",this.container);for(let i=0;i<t.children.length;i++){let n=t.children[i];dom.model(n)[this.idField]===e[this.idField]&&n.remove()}}},ListView.prototype.append=function(e,t){let i=this,n=this.container.querySelector("ul"),s=n.querySelectorAll("li").length;if(Array.isArray(e)){let t=e;for(let e=0;e<t.length;e++)this.append(t[e]);i.complete&&i.complete(e)}else{let o=e;if(this.idField)for(let e=0;e<n.children.length;e++){let t=n.children[e];if(dom.model(t)[this.idField]===o[this.idField])return}let a=dom.create("li","list-group-item");!1!==this.hoverable&&a.classList.add("list-group-item-action"),!0===this.activateable&&dom.bind(a,"click",e=>{for(let e=0;e<a.parentElement.children.length;e++){a.parentElement.children[e].classList.remove("active")}a.classList.add("active")});for(let e=0;e<this.itemClass.length;e++)a.classList.add(this.itemClass[e]);this.borderless&&a.classList.add("b-a-0"),this.onClick&&dom.bind(a,"click",this.onClick),a.style.paddingLeft="16px",a.style.paddingRight="16px",a.style.paddingTop="8px",a.style.paddingBottom="8px",a.style.display="flex",a.style.alignItems="center",this.onFilter&&(a.style.borderLeftWidth="0",a.style.borderRightWidth="0",a.style.borderBottomWidth="0");let l=this.create(s,o,a);if(this.onCheck){let e=dom.element('\n        <input class="pointer checkbox color-info is-outline mr-2" type="checkbox">\n      ');for(let t=0;t<this.selections.length;t++)if(this.compare(this.selections[t],o)){e.setAttribute("checked",!0);break}dom.bind(e,"change",function(){i.onCheck(this.checked,dom.model(this),this)}),dom.model(e,o),a.appendChild(e)}if(a.appendChild(l),this.idField&&a.setAttribute("data-list-item-id",o[this.idField]),dom.model(a,o),"number"==typeof t?t<0?n.insertBefore(a,n.children[n.children.length+t]):n.insertBefore(a,n.children[t]):n.appendChild(a),this.onRemove){let e=dom.element('\n        <a class="btn text-danger float-right font-18" style="padding: 0; margin-left: auto;">\n          <i class="fas fa-times" style=""></i>\n        </a>\n      ');dom.bind(e,"click",function(e){e.stopPropagation(),i.onRemove(this.parentElement,dom.model(this.parentElement))}),dom.model(e,o),a.appendChild(e)}this.onReorder?this.setReorderable(a):this.draggable&&(a.setAttribute("draggable","true"),a.addEventListener("dragover",function(e){e.preventDefault()}),a.addEventListener("dragstart",function(e){}))}},ListView.prototype.replace=function(e){let t=this.container.querySelector("ul");for(let i=0;i<t.children.length;i++){let n=t.children[i];if(dom.model(n)[this.idField]===e[this.idField]){dom.model(n,e),n.innerHTML="",n.appendChild(this.create(i,e));break}}},ListView.prototype.search=function(e){let t=this.container.querySelector("ul");for(let i=0;i<t.children.length;i++){let n=t.children[i];-1!=n.innerText.indexOf(e)?n.style.display="":n.style.display="none"}},ListView.prototype.setReorderable=function(e){let t=dom.find("ul",this.container);t.addEventListener("dragover",function(e){e.preventDefault()}),t.ondrop=(e=>{this.onReorder&&this.onReorder(dom.model(this.draggingElement),this.getItemIndex(this.draggingElement),this.draggingElementOriginalIndex),this.draggingElement.style.opacity="",this.draggingElement=null,this.clonedDraggingElement=null}),e.setAttribute("draggable","true"),e.ondragover=(e=>{let t=dom.ancestor(e.target,"li"),i=t.parentElement;if(t==this.draggingElement)return;let n=this.getItemIndex(t);n<this.draggingElementIndex?i.insertBefore(this.draggingElement,t):n>this.draggingElementIndex&&(null==t.nextElementSibling?i.appendChild(this.draggingElement):i.insertBefore(this.draggingElement,t.nextElementSibling)),this.draggingElementIndex=n,e.preventDefault()}),e.ondragstart=(e=>{let t=dom.ancestor(e.target,"li"),i=(t.parentElement,e.layerX,e.layerY);i=e.target.offsetTop+i,this.clonedDraggingElement=t.cloneNode(!0),console.log(this.clonedDraggingElement),this.draggingElement=t,this.draggingElement.style.opacity="0.3",this.draggingElementIndex=this.getItemIndex(t),this.draggingElementOriginalIndex=this.draggingElementIndex,e.dataTransfer.setData("id",t.getAttribute("data-list-item-id")),e.dataTransfer.setData("y",i)})},ListView.prototype.getItemIndex=function(e){let t=e.parentElement;for(let i=0;i<t.children.length;i++)if(e==t.children[i])return i},ListView.prototype.setHeight=function(e){this.container.querySelector("ul").style.height=e+"px"},ListView.prototype.activate=function(e){let t=this.container.querySelector("ul");for(let e=0;e<t.children.length;e++)t.children[e].classList.remove("active");e.classList.add("active")},ListView.prototype.subscribe=function(e,t){},Timeline.prototype.createTile=function(e,t){let i=dom.element('\n    <li class="timeline-item">\n      <div class="time"></div>\n      <div class="small text-muted"></div>\n      <p></p>\n    </li>\n  '),n=i.children[0],s=i.children[1],o=i.children[2];if(this.fnTitle){let i=this.fnTitle(e,t);void 0===i?n.innerHTML="":"string"==typeof i||"number"==typeof i?n.innerHTML=i:n.appendChild(i)}if(this.fnSubtitle){let i=this.fnSubtitle(e,t);void 0===i?s.innerHTML="":"string"==typeof i||"number"==typeof i?s.innerHTML=i:s.appendChild(i)}if(this.fnContent){let i=this.fnContent(e,t);void 0===i?o.innerHTML="":"string"==typeof i||"number"==typeof i?o.innerHTML=i:o.appendChild(i)}return i},Timeline.prototype.render=function(e,t){let i=this;this.container="string"==typeof e?document.querySelector(e):e,this.container.innerHTML="",t=t||{};let n=dom.create("ul","timeline-simple");this.container.appendChild(n);let s={};if(utils.clone(this.params,s),utils.clone(t,s),this.url)xhr.post({url:this.url,params:s,success:function(e){if(!e.data)return;let t=e.data;console.log(t);for(let e=0;e<t.length;e++)n.appendChild(i.createTile(t[e],e))}});else for(let e=0;e<i.data.length;e++)n.appendChild(i.createTile(i.data[e],e));i.onComplete&&i.onComplete()},Wizard.prototype.render=function(e,t){this.container=dom.find(e),this.body=dom.find("div.wizard-content",this.root);let i=dom.find("div.wizard",this.root);for(let e=0;e<this.steps.length;e++){let t=this.steps[e],n=dom.element(`\n      <div class="wizard-step" widget-on-render="" data-step="${e}" style="cursor: pointer;">\n        <div class="content">\n          <div class="title"></div>\n          <div class="description"></div>\n        </div>\n      </div>\n    `);t.index=e,t.active&&(this.current=t),null==this.current&&n.classList.add("completed"),dom.find("div.title",n).innerHTML=t.title,dom.find("div.description",n).innerHTML=t.description,i.appendChild(n)}this.container.appendChild(this.root),this.display(this.current)},Wizard.prototype.display=function(e){let t=this,i=dom.find('div.step[data-step="'+e.index+'"]',this.root);i.classList.remove("completed"),i.classList.add("active");let n=!1;for(let t=0;t<this.body.children.length;t++){let i=this.body.children[t];i.getAttribute("data-page-url")==e.url?(n=!0,i.classList.add("active")):i.classList.remove("active")}if(n)return;let s=dom.create("div","tab-pane","active");this.body.appendChild(s),ajax.view({url:e.url,page:e.page,containerId:s,success:function(i){t.body.children[t.body.children.length-1].setAttribute("data-page-url",e.url)}})},Wizard.prototype.commit=function(){let e=dom.find("div.step.active",this.root),t=parseInt(e.getAttribute("data-step"));e.classList.remove("active"),e.classList.add("completed"),this.display(this.steps[t+1])},Wizard.prototype.rollback=function(){let e=dom.find("div.step.active",this.container),t=parseInt(e.getAttribute("data-step"));e.classList.remove("active"),this.display(this.steps[t-1])};let utils={};function Chat(e){this.host=e.host||"",this.userId=e.userId,this.userType=e.userType,this.getConversations=e.getConversations,this.onInit=e.onInit||async function(){},this.onSendTextMessage=e.onSendTextMessage,this.onSendImageMessage=e.onSendImageMessage,this.onSendAudioMessage=e.onSendAudioMessage,this.onSendVideoMessage=e.onSendVideoMessage,this.onSendCustomMessage=e.onSendCustomMessage,this.onRevokeMessage=e.onRevokeMessage||function(e){},this.onMessageReceived=e.onMessageReceived,this.onUnreadMessages=e.onUnreadMessages||function(e){},this.onReadMessages=e.onReadMessages||function(e){}}utils.append=function(e,t,i){let n=dom.create("div");n.style.height="100%",n.style.width="100%",i=i||!1;let s=document.createRange().createContextualFragment(t);!1!==i&&(e.innerHTML=""),e.appendChild(n),n.appendChild(s);let o=dom.find("[id^=page]",n);return o?n.setAttribute("page-id",o.id):n.setAttribute("page-id","page.not.in.database"),{id:o?o.id:"",container:n}},utils.message=function(e){if(!e&&0==e.length)return;let t="";for(let i=0;i<e.length;i++)t+=e[i].message+"<br>";return t},utils.prompt=function(e){if(e||0!=e.length)for(let t=0;t<e.length;t++)$(e[t].element).addClass("is-invalid")},utils.render=function(e,t,i){let n=document.getElementById(t).innerHTML,s=Handlebars.compile(n)(i);document.getElementById(e).innerHTML=s},utils.assemble=function(e,t){if("object"==typeof e)for(let i in e){let n=e[i];"object"==typeof n&&(e[i+"Id"]=n.id),"id"==i?e[t+"Id"]=n:"name"==i&&(e[t+"Name"]=n)}},utils.in=function(e){let t=e.split(" "),i=null,n=[];1==t.length?(i=document.getElementById(e),n.push(i)):n=(i=document.getElementById(t[0])).querySelectorAll(t[1]);for(let e=0;e<n.length;e++)(i=n[e]).addEventListener("animationend",function(){this.classList.remove("animated","fadeIn"),this.style.display="",this.removeEventListener("animationend",function(){}),this.removeEventListener("animationstart",function(){})}),i.classList.remove("fadeOut","hide"),i.classList.add("animated","fadeIn","show")},utils.out=function(e){let t=e.split(" "),i=null,n=[];1==t.length?(i=document.getElementById(e),n.push(i)):n=(i=document.getElementById(t[0])).querySelectorAll(t[1]);for(let e=0;e<n.length;e++)(i=n[e]).addEventListener("animationend",function(){this.classList.remove("animated","fadeOut"),this.removeEventListener("animationend",function(){})}),i.classList.remove("fadeIn","show"),i.classList.add("animated","fadeOut","hide")},utils.nameAttr=function(e){const t=[];let i="";for(let n=0;n<e.length;n++){let s=e.charAt(n);s==s.toUpperCase()?(t.push(i),i="",i+=s.toLowerCase()):i+=s}return""!=i&&t.push(i),"data-model-"+t.join("-")},utils.nameVar=function(e){if(-1==e.indexOf("-"))return e;const t=e.split("-");let i="";for(let e=0;e<t.length;e++){const n=t[e];i+=0==e?n:n.charAt(0).toUpperCase()+n.slice(1)}return i},utils.camelcase=function(e,t){if(-1==e.indexOf(t))return e;const i=e.split(t);let n="";for(let e=0;e<i.length;e++){const t=i[e];n+=0==e?t:t.charAt(0).toUpperCase()+t.slice(1)}return n},utils.pascalcase=function(e,t){if(-1==e.indexOf(t))return e.charAt(0).toUpperCase()+e.slice(1);const i=e.split(t);let n="";for(let e=0;e<i.length;e++){const t=i[e];n+=t.charAt(0).toUpperCase()+t.slice(1)}return n},utils.clone=function(e,t){e=e||{};for(let i in e)t[i]=e[i]},utils.get=function(e){let t=Array.prototype.slice.call(arguments,1),i={};for(let n=0;n<t.length;n++)i[t[n]]=e[t[n]];return i},utils.isEmpty=function(e){let t=0;for(let i in e)t++;return 0==t},utils.isBlank=function(e){let t=0;for(let i in e)null!=e[i]&&""!==e[i]&&t++;return 0==t},utils.getParameter=function(e,t){t=t.replace(/[\[\]]/g,"\\$&");let i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},utils.getParameters=function(e){if(-1==e.indexOf("?"))return{};let t={},i=(e=e.substring(e.indexOf("?")+1)).split("&");for(let e=0;e<i.length;e++){let n=i[e].split("=");if(1==n.length)return{};t[n[0].trim()]=decodeURIComponent(n[1].trim())}return t},utils.isExisting=((e,t,i)=>{for(let n=0;n<e.length;n++)if(e[n][i]===t[i])return!0;return!1}),Chat.MESSAGE_TYPE_TEXT="TEXT",Chat.MESSAGE_TYPE_IMAGE="IMAGE",Chat.MESSAGE_TYPE_AUDIO="AUDIO",Chat.MESSAGE_TYPE_VIDEO="VIDEO",Chat.MESSAGE_TYPE_PATIENT="PATIENT",Chat.MESSAGE_TYPE_CUSTOM="CUSTOM",Chat.MESSAGE_STATUS_UNREAD="01",Chat.MESSAGE_STATUS_READ="02",Chat.MESSAGE_STATUS_REVOKE="90",Chat.prototype.init=async function(e){await this.onInit();this.scheduleName=e;let t=this.userId+"@"+this.userType,i=await xhr.promise({url:this.host+"/api/v3/common/script/tim/user_signature",params:{userId:t}}),n={SDKAppID:i.appId};this.tim=TIM.create(n),this.tim.setLogLevel(1),this.tim.registerPlugin({"tim-upload-plugin":TIMUploadPlugin}),this.tim.login({userID:t,userSig:i.signature}),this.tim.on(TIM.EVENT.SDK_READY,function(e){}),this.tim.on(TIM.EVENT.MESSAGE_RECEIVED,e=>{for(let t=0;t<e.data.length;t++){let i=e.data[t],n=Chat.MESSAGE_TYPE_TEXT,s=null;"TIMCustomElem"===i.type?(s=JSON.parse(i.payload.data).messageContent).imagepath?n=Chat.MESSAGE_TYPE_IMAGE:s.audiopath?n=Chat.MESSAGE_TYPE_AUDIO:s.archiveId&&(n=Chat.MESSAGE_TYPE_PATIENT):s=i.payload.text,this.onMessageReceived({senderId:i.conversationID.substring(3),messageTime:moment(1e3*e.data[t].time).format("YYYY-MM-DD HH:mm"),messageType:n,messageContent:s})}})},Chat.prototype.getConversations=async function(){let e=await xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId}}),t={};for(let i=0;i<e.length;i++){let n=e[i],s=n.senderId+"#"+n.senderType;if(t[s]){let e=t[s];e.createTime=n.createTime,e.messages.push(n)}else{let e={messages:[]};t[s]=e,e.id=s,e.createTime=n.createTime,e.name=n.senderType,e.senderId=n.senderId,e.senderType=n.senderType,e.messages.push(n)}}let i=[];for(let e in t)i.push(t[e]);return i},Chat.prototype.fetchMessages=async function(e,t,i){let n="";n=e>this.userId?e+"&"+this.userId:this.userId+"&"+e;let s=await xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{conversationId:n,_order_by:"messageTime asc"}}),o=[],a=null;for(let e=0;e<s.length;e++){let t=s[e],i=moment(t.createTime).format("YYYY-MM-DD HH:mm");i!=a&&(a=i,o.push({createTime:i,groupingMessages:[{direction:t.senderId==this.userId?"outgoing":"incoming",messages:[]}]}));let n=o[o.length-1],l=n.groupingMessages[n.groupingMessages.length-1],r="";r=t.senderId==this.userId?"outgoing":"incoming",l.direction===r?l.messages.push(t):n.groupingMessages.push({direction:r,messages:[t]})}return o},Chat.prototype.fetchUnreadMessages=function(){let e=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/find",params:{status:Chat.MESSAGE_STATUS_UNREAD,receiverId:this.userId,receiverType:this.userType}}).then(t=>{e.onUnreadMessages(t)})},Chat.prototype.sendMessage=async function(e,t,i,n,s){return s=s||this.userId+"&"+e,"string"==typeof n&&(n=n.replace("\\","\\\\")),xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/save",params:{conversationId:s,senderId:this.userId,senderType:this.userType,receiverId:e,receiverType:t,messageType:i,messageTime:"now",messageContent:n,createTime:"now",status:Chat.MESSAGE_STATUS_UNREAD,"||stdbiz/pim/conversation/merge":{conversationId:s,conversationName:s,unreadCount:1,lastConversationTime:"now"}}})},Chat.prototype.sendTextMessage=async function(e,t,i,n){let s=e+"@"+t,o=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_TEXT,i,n),a=this.tim.createTextMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{id:o.conversationMessageId,text:i}});return this.tim.sendMessage(a)},Chat.prototype.sendImageMessage=async function(e,t,i,n){let s=e+"@"+t,o=await xhr.promise({url:this.host+"/api/v3/common/image",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:i.ext}}),a=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_IMAGE,JSON.stringify({imagepath:o.filepath,thumbnail:o.thumbnail}),n),l=this.tim.createCustomMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_IMAGE,messageContent:{id:a.conversationMessageId,imagepath:o.filepath,thumbnail:o.thumbnail}})}});return this.tim.sendMessage(l)},Chat.prototype.sendAudioMessage=async function(e,t,i,n){let s=e+"@"+t,o=await xhr.promise({url:this.host+"/api/v3/common/audio",params:{directoryKey:"chat",filedata:i.data.substring(i.data.indexOf(",")+1),fileext:"ogg"}}),a=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_AUDIO,JSON.stringify({audiopath:o.filepath,duration:o.duration}),n),l=this.tim.createCustomMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_AUDIO,messageContent:{id:a.conversationMessageId,audiopath:o.filepath,duration:o.duration}})}});return this.tim.sendMessage(l)},Chat.prototype.sendPatientMessage=async function(e,t,i,n){let s=e+"@"+t,o=await this.sendMessage(e,t,Chat.MESSAGE_TYPE_PATIENT,JSON.stringify(i),n);i.id=o.conversationMessageId;let a=this.tim.createCustomMessage({to:s,conversationType:TIM.TYPES.CONV_C2C,payload:{data:JSON.stringify({messageType:Chat.MESSAGE_TYPE_PATIENT,messageContent:i})}});return this.tim.sendMessage(a)},Chat.prototype.readMessages=function(e){let t=this;xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{senderId:e,readTime:"now",status:Chat.MESSAGE_STATUS_READ}}).then(e=>{t.onReadMessages(e)})},Chat.prototype.revokeMessage=function(e){return xhr.promise({url:this.host+"/api/v3/common/script/stdbiz/pim/conversation_message/update",params:{messageId:e,status:Chat.MESSAGE_STATUS_REVOKE}}).then(t=>{this.onRevokeMessage(e)})},Chat.prototype.stop=function(){schedule.stop(this.scheduleName)},"undefined"!=typeof module&&(module.exports={Chat:Chat}),Handlebars.registerHelper("ifeq",function(e,t,i){return e==t?i.fn(this):i.inverse(this)}),"undefined"==typeof kuim&&(kuim={}),kuim={routedPages:[],presentPageObj:null},kuim.navigateTo=async function(e,t,i){clearTimeout(kuim.delayToLoad),kuim.delayToLoad=setTimeout(()=>{void 0===i&&(i=!1);let n=document.querySelector("main");kuim.presentPageObj&&(kuim.presentPageObj.page.classList.remove("in"),kuim.presentPageObj.page.classList.add("out")),setTimeout(async()=>{kuim.presentPageObj&&(kuim.presentPageObj.page.parentElement.style.display="none"),kuim.presentPageObj&&!1!==i&&(kuim.presentPageObj.page.parentElement.remove(),kuim.presentPageObj.destroy&&kuim.presentPageObj.destroy(),delete kuim.presentPageObj);let s=await xhr.asyncGet({url:e},"GET");kuim.reload(n,e,s,t)},400)},200)},kuim.navigateBack=function(e){clearTimeout(kuim.delayToLoad),kuim.delayToLoad=setTimeout(()=>{let e=document.querySelector("main"),t=e.children[e.children.length-2];kuim.presentPageObj.page.classList.remove("in"),kuim.presentPageObj.page.classList.add("out"),setTimeout(()=>{kuim.presentPageObj.page.parentElement.remove(),kuim.presentPageObj.destroy&&kuim.presentPageObj.destroy(),delete kuim.presentPageObj,t.style.display="",kuim.presentPageObj=window[t.getAttribute("kuim-page-id")],kuim.presentPageObj.page.classList.remove("out"),kuim.presentPageObj.page.classList.add("in"),kuim.setTitleAndIcon(t.getAttribute("kuim-page-title"),t.getAttribute("kuim-page-icon"))},400)},200)},kuim.reload=function(e,t,i,n){let s=dom.element('<div style="height: 100%; width: 100%;"></div>'),o=document.createRange().createContextualFragment(i);dom.find("[id^=page]",e);s.appendChild(o);let a=dom.find("[id^=page]",s).getAttribute("id");e.appendChild(s),s.setAttribute("kuim-page-id",a),s.setAttribute("kuim-page-url",t),s.setAttribute("kuim-page-title",n.title),s.setAttribute("kuim-page-icon",n.icon||""),kuim.presentPageObj=window[a],kuim.presentPageObj.page.classList.add("in");let l=utils.getParameters(t);kuim.presentPageObj.show(l),kuim.setTitleAndIcon(n.title,n.icon),n.success&&n.success()},kuim.setTitleAndIcon=function(e,t){let i=dom.find(".bottom-bar");dom.find("header h1.title").innerText=e;let n=dom.find("header div.left");t?(n.innerHTML=t,i.style.display="",n.onclick=(e=>{})):(n.innerHTML='<i class="fas fa-arrow-left text-white button icon"></i>',i.style.display="none",n.onclick=(e=>{kuim.navigateBack()}))},kuim.select=async function(e){let t=await xhr.promise({url:e.url,params:e.params||{}}),i=[];for(let n=0;n<t.length;n++){let s=t[n];i.push({id:s[e.fieldId||"id"],value:s[e.fieldName||"value"]})}new MobileSelect({trigger:e.trigger,title:e.title,wheels:[{data:i}],callback:(t,i)=>{e.onSelected&&e.onSelected(i[0])}})},kuim.tabs=function(e){let t=dom.find(e.container),i=dom.element('\n    <div class="nav nav-tabs mt-0"></div>\n  '),n=dom.element('\n    <div class="swiper">\n      <div class="swiper-wrapper">\n      </div>\n    </div>\n  '),s=e.tabs;for(let e=0;e<s.length;e++){let t=s[e],a=dom.templatize('\n      <div class="nav-item font-weight-bold mr-0" \n           style="padding: 0 16px; line-height: 36px; text-align: center; flex: 1;">{{title}}</div>\n    ',t);i.appendChild(a),0==e&&a.classList.add("active-bg-info"),dom.bind(a,"click",t=>{o.slideTo(e,400,!0)});let l=dom.templatize('\n      <div class="swiper-slide full-width"></div>\n    ',t);t.render?t.render(l,t.params||{}):l.innerHTML='<img src="https://via.placeholder.com/240x150">',n.children[0].appendChild(l)}t.appendChild(i),t.appendChild(n);let o=new Swiper(n,{direction:"horizontal",loop:!1});o.on("slideChange",function(e){let t=e.activeIndex;for(let e=0;e<i.children.length;e++)i.children[e].classList.remove("active-bg-info");i.children[t].classList.add("active-bg-info")})},kuim.wizard=function(e){let t=dom.find(e.container),i=dom.element('\n    <div class="wizard"></div>\n  '),n=dom.element('\n    <div class="swiper">\n      <div class="swiper-wrapper">\n      </div>\n    </div>\n  '),s=e.steps;for(let e=0;e<s.length;e++){let t=s[e];t.index=e+1;let a=dom.templatize('\n      <div class="wizard-step">\n        <div class="wizard-dot">\n          <div class="wizard-connector-left"></div>\n          <div class="wizard-number">{{index}}</div>\n          <div class="wizard-connector-right"></div>\n        </div>\n      </div>\n    ',t);i.appendChild(a),dom.bind(a,"click",t=>{a.classList.contains("wizard-step-completed")&&o.slideTo(e,400,!0)});let l=dom.templatize('\n      <div class="swiper-slide full-width"></div>\n    ',t);t.render?t.render(l,t.params||{}):l.innerHTML='<img src="https://via.placeholder.com/240x150">',n.children[0].appendChild(l)}t.appendChild(i),t.appendChild(n);let o=new Swiper(n,{direction:"horizontal",loop:!1});return o.on("slideChange",e=>{let t=e.activeIndex;for(let e=0;e<i.children.length;e++)i.children[e].classList.remove("wizard-step-completed");for(let e=0;e<t;e++)i.children[e].classList.add("wizard-step-completed")}),o.on("sliderMove",(e,t)=>{}),o},kuim.overlay=function(){};
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1">
  <title>手机应用展示</title>
  <style>
    html, body {
      -ms-overflow-style: none;
      scrollbar-width: none;
      overflow-y: scroll;
      overscroll-behavior: contain;
    }

    body::-webkit-scrollbar {
      display: none;
    }
  </style>
  <link href="/3rd/font-awesome/css/all.min.css" rel="stylesheet">
  <link href="/3rd/animation/animate.min.css" rel="stylesheet">
  <link href="/3rd/material-icons/material-icons.css" rel="stylesheet">
  <link href="/3rd/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="/3rd/viewerjs/viewer.min.css" rel="stylesheet">
  <link href="/3rd/videojs/video-js.min.css" rel="stylesheet">
  <link href="/3rd/videojs/videojs-mobile-ui.css" rel="stylesheet">
  <link href="/dist/kui-all.mobile.min.css" rel="stylesheet">

  <script src="/3rd/jquery/jquery-3.2.1.min.js"></script>
  <script src="/3rd/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/3rd/moment/moment.min.js"></script>
  <script src="/3rd/handlebars/handlebars-v4.0.11.js"></script>
  <script src="/3rd/rxjs/rxjs.umd.js"></script>
  <script src="/3rd/rxjs/rxjs-pubsub.js"></script>
  <script src="/3rd/viewerjs/viewer.js"></script>
  <script src="/3rd/videojs/video.min.js"></script>
  <script src="/3rd/videojs/videojs-mobile-ui.min.js"></script>
  <script src="/3rd/mobile/rolldate.js"></script>
  <script src="/3rd/swiper/swiper-bundle.min.js"></script>
  <script src="/3rd/iSlider/iSlider.js"></script>
  <script src="/3rd/echarts/echarts.simple.min.js"></script>

  <script src="/dist/kui-all.mobile.min.js"></script>
  <script src="/src/js/jim.js"></script>
</head>
<body>
  <header class="header-bar">
    <div class="left">
      <span class="button icon material-icons">home</span>
    </div>
    <div class="center">
      <h1 class="title">首页</h1>
    </div>
  </header>
  <div widget-id="widgetRefresh" class="pull-to-refresh out">
    <i class="fas fa-spinner fa-spin font-48 text-gray m-auto"></i>
  </div>
  <main></main>
  <footer>
    <div class="bottom-navigator">
      <div class="active-0">
        <label widget-id="buttonHome" class="active" style="flex: 0 0 25%;">
          <i class="fas fa-home" style="left: -2px;"></i>
          <span>首页</span>
        </label>
        <label widget-id="buttonComponent" style="flex: 0 0 25%;">
          <i class="fas fa-window-maximize" style="left: -1px;"></i>
          <span>组件</span>
        </label>
        <label widget-id="buttonApplication" style="flex: 0 0 25%;">
          <i class="fab fa-app-store-ios" style="left: 1px;"></i>
          <span>应用</span>
        </label>
        <label widget-id="buttonUser" style="flex: 0 0 25%;">
          <i class="fas fa-user" style="left: 1px;"></i>
          <span>用户</span>
        </label>
        <span style="width: 25%;"></span>
      </div>
    </div>
  </footer>
</body>
</html>

<script>
const PAGE_OFFSET = 136;
function PageIndex() {

}

PageIndex.prototype.initialize = async function (params) {
  let main = document.querySelector('main');
  let header = document.querySelector('header');
  let footer = document.querySelector('footer');
  let tabsNavigator = document.querySelector('[widget-id=tabsNavigator]');
  this.buttonHome = document.querySelector('[widget-id=buttonHome]');
  this.buttonComponent = document.querySelector('[widget-id=buttonComponent]');
  this.buttonApplication = document.querySelector('[widget-id=buttonApplication]');
  this.buttonUser = document.querySelector('[widget-id=buttonUser]');
  this.buttonSettings = document.querySelector('[widget-id=buttonSettings]');
  // 初始化环境
  // header.style.width = window.clientWidth + 'px';
  // footer.style.width = window.clientWidth + 'px';
  main.style.height = (window.innerHeight - 0) + 'px';

  let start = {};
  let end = {};
  document.addEventListener('touchstart', ev => {
    start.x = ev.changedTouches[0].screenX;
    start.y = ev.changedTouches[0].screenY;
  });

  // let widgetRefresh = dom.find('[widget-id=widgetRefresh]');
  // document.addEventListener('touchend', ev => {
  //   end.x = ev.changedTouches[0].screenX;
  //   end.y = ev.changedTouches[0].screenY;
  //   if ((end.y - start.y) >= 200 && window.scrollY <= 0) {
  //     widgetRefresh.classList.remove('out');
  //     widgetRefresh.classList.add('in');
  //     setTimeout(() => {
  //       widgetRefresh.classList.remove('in');
  //       widgetRefresh.classList.add('out');
  //     }, 600)
  //   }
  //   start = {};
  //   end = {};
  // });

  dom.bind(this.buttonHome, 'click', ev => {
    // if (this.buttonHome.parentElement.classList.contains('active-0')) return;
    this.buttonHome.parentElement.className = 'active-0';
    this.buttonHome.parentElement.querySelectorAll('label').forEach(el => {
      el.className = '';
    });
    this.buttonHome.classList.add('active');
    kuim.navigateTo('mhtml/home.html', {
      title: '首页',
      icon: '<i class="fas fa-home text-white button icon"></i>',
    }, true);
  });

  dom.bind(this.buttonComponent, 'click', ev => {
    if (this.buttonComponent.parentElement.classList.contains('active-1')) return;
    this.buttonComponent.parentElement.className = 'active-1';
    this.buttonComponent.parentElement.querySelectorAll('label').forEach(el => {
      el.className = '';
    });
    this.buttonComponent.classList.add('active');
    kuim.navigateTo('mhtml/example/main.html', {
      title: '组件示例',
      icon: '<i class="fas fa-window-maximize text-white button icon"></i>',
    }, true);
  });

  dom.bind(this.buttonApplication, 'click', ev => {
    if (this.buttonApplication.parentElement.classList.contains('active-2')) return;
    this.buttonApplication.parentElement.className = 'active-2';
    this.buttonApplication.parentElement.querySelectorAll('label').forEach(el => {
      el.className = '';
    });
    this.buttonApplication.classList.add('active');
    kuim.navigateTo('mhtml/demo/main.html', {
      title: '页面示例',
      icon: '<i class="fab fa-app-store-ios text-white button icon"></i>',
    }, true);
  });

  dom.bind(this.buttonUser, 'click', ev => {
    if (this.buttonUser.parentElement.classList.contains('active-3')) return;
    this.buttonUser.parentElement.className = 'active-3';
    this.buttonUser.parentElement.querySelectorAll('label').forEach(el => {
      el.className = '';
    });
    this.buttonUser.classList.add('active');
    kuim.navigateTo('mhtml/personal/main.html', {
      title: '用户',
      icon: '<i class="fas fa-user text-white button icon"></i>',
    }, true);
  });

  dom.bind(this.buttonSettings, 'click', ev => {
    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.openFavourite) {
      window.webkit.messageHandlers.openFavourite.postMessage({
        "message": ""
      });
    }
  });

  // 底部导航
  let navbar = document.querySelector(".bottom-bar")
  let navbarItems = document.querySelectorAll("li", navbar);

  navbarItems.forEach((li, index) => {
    li.addEventListener("click" , e =>{
      e.preventDefault();
      navbar.querySelector(".active").classList.remove("active");
      li.classList.add("active");

      const indicator = document.querySelector(".indicator");
      indicator.style.transform = `translateX(calc(${li.offsetLeft}px + 0px))`;
    });
    if (index == 0) {
      const indicator = document.querySelector(".indicator");
      indicator.style.transform = `translateX(calc(${li.offsetLeft}px + 0px))`;
    }
  });
};

PageIndex.prototype.show = async function (params) {
  this.initialize(params);
  this.buttonHome.click();
};

pageIndex = new PageIndex();
pageIndex.show({});

</script>
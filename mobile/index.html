<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1">
  <title>手机应用展示</title>
  <style>
    body {
      -ms-overflow-style: none;
      scrollbar-width: none;
      overflow-y: scroll;
    }

    body::-webkit-scrollbar {
      display: none;
    }
  </style>
  <link href="/3rd/font-awesome/css/all.min.css" rel="stylesheet">
  <link href="/3rd/animation/animate.min.css" rel="stylesheet">
  <link href="/3rd/material-icons/material-icons.css" rel="stylesheet">
  <link href="/3rd/swiper/swiper-bundle.min.css" rel="stylesheet">

  <link href="/dist/kui-all.mobile.min.css" rel="stylesheet">

  <script src="/3rd/jquery/jquery-3.2.1.min.js"></script>
  <script src="/3rd/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/3rd/moment/moment.min.js"></script>
  <script src="/3rd/handlebars/handlebars-v4.0.11.js"></script>
  <script src="/3rd/rxjs/rxjs.umd.js"></script>
  <script src="/3rd/rxjs/rxjs-pubsub.js"></script>
  <script src="/3rd/viewerjs/viewer.js"></script>
  <script src="/3rd/mobile/rolldate.js"></script>
  <script src="/3rd/swiper/swiper-bundle.min.js"></script>

  <script src="/dist/kui-all.mobile.min.js"></script>
</head>
<body>
  <header class="header-bar">
    <div class="left">
      <span class="button icon material-icons">home</span>
    </div>
    <div class="center">
      <h1 class="title">首页</h1>
    </div>
    <div class="ml-auto">

    </div>
  </header>
  <div widget-id="widgetRefresh" class="pull-to-refresh out">
    <i class="fas fa-spinner fa-spin font-48 text-gray m-auto"></i>
  </div>
  <main></main>
  <footer>
    <div class="bottom-bar">
      <ul style="padding-left: 0;">
        <li class="active">
          <a widget-id="buttonHome" href="#">
            <i class='fas fa-home text-info'></i>
            <i class='fas fa-home active-icon'></i>
          </a>
        </li>
        <li>
          <a widget-id="buttonFavourite" href="#">
            <i class='fas fa-heart text-info'></i>
            <i class='fas fa-heart active-icon'></i>
          </a>
        </li>
        <li>
          <a widget-id="buttonCalendar" href="#">
            <i class='fas fa-calendar text-info'></i>
            <i class='fas fa-calendar active-icon'></i>
          </a>
        </li>
        <li>
          <a widget-id="buttonUser" href="#">
            <i class='fas fa-user text-info'></i>
            <i class='fas fa-user active-icon'></i>
          </a>
        </li>
        <div class="indicator"></div>
      </ul>
    </div>
  </footer>
</body>
</html>

<script>
function PageIndex() {

}

PageIndex.prototype.initialize = async function (params) {
  let main = document.querySelector('main');
  let header = document.querySelector('header');
  let footer = document.querySelector('footer');
  let tabsNavigator = document.querySelector('[widget-id=tabsNavigator]');
  this.buttonHome = document.querySelector('[widget-id=buttonHome]');
  this.buttonFavourite = document.querySelector('[widget-id=buttonFavourite]');
  this.buttonCalendar = document.querySelector('[widget-id=buttonCalendar]');
  this.buttonUser = document.querySelector('[widget-id=buttonUser]');

  // 初始化环境
  // header.style.width = window.clientWidth + 'px';
  // footer.style.width = window.clientWidth + 'px';
  main.style.height = (window.innerHeight - 0) + 'px';

  let start = {};
  let end = {};
  document.addEventListener('touchstart', ev => {
    start.x = ev.changedTouches[0].screenX;
    start.y = ev.changedTouches[0].screenY;
  });

  let widgetRefresh = dom.find('[widget-id=widgetRefresh]');
  document.addEventListener('touchend', ev => {
    end.x = ev.changedTouches[0].screenX;
    end.y = ev.changedTouches[0].screenY;
    if ((end.y - start.y) >= 200 && window.scrollY <= 0) {
      widgetRefresh.classList.remove('out');
      widgetRefresh.classList.add('in');
      setTimeout(() => {
        widgetRefresh.classList.remove('in');
        widgetRefresh.classList.add('out');
      }, 600)
    }
    start = {};
    end = {};
  });

  dom.bind(this.buttonHome, 'click', ev => {
    kuim.navigateTo('mhtml/home.html', {
      title: '首页',
      icon: '<i class="fas fa-home text-white button icon"></i>',
    }, true);
  });

  dom.bind(this.buttonFavourite, 'click', ev => {
    kuim.navigateTo('mhtml/example/main.html', {
      title: '示例',
      icon: '<i class="fas fa-heart text-white button icon"></i>',
    }, true);
  });

  dom.bind(this.buttonCalendar, 'click', ev => {
    kuim.navigateTo('mhtml/demo/main.html', {
      title: '页面',
      icon: '<i class="fas fa-calendar text-white button icon"></i>',
    }, true);
  });

  dom.bind(this.buttonUser, 'click', ev => {
    kuim.navigateTo('mhtml/personal/main.html', {
      title: '用户',
      icon: '<i class="fas fa-user text-white button icon"></i>',
    }, true);
  });

  // 底部导航
  let navbar = document.querySelector(".bottom-bar")
  let navbarItems = document.querySelectorAll("li", navbar);

  navbarItems.forEach((li, index) => {
    li.addEventListener("click" , e =>{
      e.preventDefault();
      navbar.querySelector(".active").classList.remove("active");
      li.classList.add("active");

      const indicator = document.querySelector(".indicator");
      indicator.style.transform = `translateX(calc(${li.offsetLeft}px + 0px))`;
    });
    if (index == 0) {
      const indicator = document.querySelector(".indicator");
      indicator.style.transform = `translateX(calc(${li.offsetLeft}px + 0px))`;
    }
  });
};

PageIndex.prototype.show = async function (params) {
  this.initialize(params);
  this.buttonHome.click();
};

pageIndex = new PageIndex();
pageIndex.show({});
</script>
<div id="pageContractList" class="card b-a-0">
  <div class="card-body p-0">
    <div id="tableContractList" class="col-md-12 pl-0 pr-0"></div>
  </div>
</div>

<script>
function PageContractList() {
  let self = this;
  this.tableProject = new TreelikeTable({
    url: 'data/treepage.json',
    limit: 5,
    levels: 2, /* 最多两级 */
    fields: {
      name: 'name',
      id: 'id',
      parentId: 'parentId'
    },
    columns: [{
      title: '任务名称',
    }, {
      title: '开发进度',
      display: function(row, td) {
        let html = '<div class="clearfix">\n' +
          '        <div class="float-left"><strong>50%</strong></div>\n' +
          '        <div class="float-right"><small class="text-muted">Jun 11, 2015 - Jul 10, 2015</small></div>\n' +
          '      </div>\n' +
          '      <div class="progress progress-xs">\n' +
          '        <div class="progress-bar bg-gradient-success" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div> \n' +
          '      </div>';
        td.innerHTML = html;
      }
    },{
      title: '责任人',
      style: 'text-align: center;',
      display: function(row, td) {
        let a = document.createElement('a');
        a.classList.add('btn', 'text-success');
        a.innerText = row.principalName;
        td.append(a);
      }
    },{
      title: '操作',
      style: 'text-align: center;',
      display: function(row, td) {
        let link = dom.create('a', 'btn', 'btn-link');
        link.setAttribute('data-model-project-id', 1);
        link.innerHTML = '编辑';
        dom.bind(link, 'click', function() {
          let projectId = this.getAttribute('data-model-project-id');
          self.edit(projectId, 'HTTPDB数据库项目');
        });
        td.appendChild(link);

        link = dom.create('a', 'btn', 'btn-link');
        link.setAttribute('data-model-project-id', 1);
        link.innerHTML = '查看';
        dom.bind(link, 'click', function() {
          let projectId = this.getAttribute('data-model-project-id');
          self.view(projectId, 'HTTPDB数据库项目');
        });
        td.appendChild(link);
      }
    }]
  });
}

PageContactList.prototype.show = function () {
  this.setup();
};

PageContactList.prototype.setup = function () {
  this.tableProject.render('tableProject', {});
};

PageContactList.prototype.edit = function (projectId, projectName) {
  ajax.sidebar({
    containerId: '#pageProjectList',
    title: projectName,
    url: 'html/composite/project/edit.html',
    success: function() {
      pageProjectEdit.show(projectId);
    }
  });
};

PageContactList.prototype.view = function (projectId, projectName) {
  ajax.sidebar({
    containerId: '#pageProjectList',
    title: projectName,
    allowClose: true,
    url: 'html/composite/project/view.html',
    success: function() {
      pageProjectView.show(projectId);
    }
  });
};

pageContactList = new PageContactList();
pageContactList.show();

</script>